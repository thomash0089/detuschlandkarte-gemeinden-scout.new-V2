function pg(D,G){for(var H=0;H<G.length;H++){const Z=G[H];if(typeof Z!="string"&&!Array.isArray(Z)){for(const Q in Z)if(Q!=="default"&&!(Q in D)){const ie=Object.getOwnPropertyDescriptor(Z,Q);ie&&Object.defineProperty(D,Q,ie.get?ie:{enumerable:!0,get:()=>Z[Q]})}}}return Object.freeze(Object.defineProperty(D,Symbol.toStringTag,{value:"Module"}))}(function(){const G=document.createElement("link").relList;if(G&&G.supports&&G.supports("modulepreload"))return;for(const Q of document.querySelectorAll('link[rel="modulepreload"]'))Z(Q);new MutationObserver(Q=>{for(const ie of Q)if(ie.type==="childList")for(const F of ie.addedNodes)F.tagName==="LINK"&&F.rel==="modulepreload"&&Z(F)}).observe(document,{childList:!0,subtree:!0});function H(Q){const ie={};return Q.integrity&&(ie.integrity=Q.integrity),Q.referrerPolicy&&(ie.referrerPolicy=Q.referrerPolicy),Q.crossOrigin==="use-credentials"?ie.credentials="include":Q.crossOrigin==="anonymous"?ie.credentials="omit":ie.credentials="same-origin",ie}function Z(Q){if(Q.ep)return;Q.ep=!0;const ie=H(Q);fetch(Q.href,ie)}})();function mg(D){return D&&D.__esModule&&Object.prototype.hasOwnProperty.call(D,"default")?D.default:D}var um={exports:{}},Hp={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rm;function yy(){if(Rm)return Hp;Rm=1;var D=Symbol.for("react.transitional.element"),G=Symbol.for("react.fragment");function H(Z,Q,ie){var F=null;if(ie!==void 0&&(F=""+ie),Q.key!==void 0&&(F=""+Q.key),"key"in Q){ie={};for(var y in Q)y!=="key"&&(ie[y]=Q[y])}else ie=Q;return Q=ie.ref,{$$typeof:D,type:Z,key:F,ref:Q!==void 0?Q:null,props:ie}}return Hp.Fragment=G,Hp.jsx=H,Hp.jsxs=H,Hp}var Dm;function _y(){return Dm||(Dm=1,um.exports=yy()),um.exports}var dt=_y(),hm={exports:{}},Xi={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lm;function xy(){if(Lm)return Xi;Lm=1;var D=Symbol.for("react.transitional.element"),G=Symbol.for("react.portal"),H=Symbol.for("react.fragment"),Z=Symbol.for("react.strict_mode"),Q=Symbol.for("react.profiler"),ie=Symbol.for("react.consumer"),F=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),se=Symbol.for("react.suspense"),pe=Symbol.for("react.memo"),Ce=Symbol.for("react.lazy"),Ze=Symbol.iterator;function Le(_e){return _e===null||typeof _e!="object"?null:(_e=Ze&&_e[Ze]||_e["@@iterator"],typeof _e=="function"?_e:null)}var Se={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},wt=Object.assign,Ut={};function Et(_e,rt,It){this.props=_e,this.context=rt,this.refs=Ut,this.updater=It||Se}Et.prototype.isReactComponent={},Et.prototype.setState=function(_e,rt){if(typeof _e!="object"&&typeof _e!="function"&&_e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,_e,rt,"setState")},Et.prototype.forceUpdate=function(_e){this.updater.enqueueForceUpdate(this,_e,"forceUpdate")};function Yt(){}Yt.prototype=Et.prototype;function Nt(_e,rt,It){this.props=_e,this.context=rt,this.refs=Ut,this.updater=It||Se}var ot=Nt.prototype=new Yt;ot.constructor=Nt,wt(ot,Et.prototype),ot.isPureReactComponent=!0;var St=Array.isArray,Rt={H:null,A:null,T:null,S:null,V:null},Gt=Object.prototype.hasOwnProperty;function ti(_e,rt,It,mt,ut,bi){return It=bi.ref,{$$typeof:D,type:_e,key:rt,ref:It!==void 0?It:null,props:bi}}function zt(_e,rt){return ti(_e.type,rt,void 0,void 0,void 0,_e.props)}function ui(_e){return typeof _e=="object"&&_e!==null&&_e.$$typeof===D}function Pi(_e){var rt={"=":"=0",":":"=2"};return"$"+_e.replace(/[=:]/g,function(It){return rt[It]})}var $e=/\/+/g;function Ji(_e,rt){return typeof _e=="object"&&_e!==null&&_e.key!=null?Pi(""+_e.key):rt.toString(36)}function ft(){}function fn(_e){switch(_e.status){case"fulfilled":return _e.value;case"rejected":throw _e.reason;default:switch(typeof _e.status=="string"?_e.then(ft,ft):(_e.status="pending",_e.then(function(rt){_e.status==="pending"&&(_e.status="fulfilled",_e.value=rt)},function(rt){_e.status==="pending"&&(_e.status="rejected",_e.reason=rt)})),_e.status){case"fulfilled":return _e.value;case"rejected":throw _e.reason}}throw _e}function Ri(_e,rt,It,mt,ut){var bi=typeof _e;(bi==="undefined"||bi==="boolean")&&(_e=null);var Zt=!1;if(_e===null)Zt=!0;else switch(bi){case"bigint":case"string":case"number":Zt=!0;break;case"object":switch(_e.$$typeof){case D:case G:Zt=!0;break;case Ce:return Zt=_e._init,Ri(Zt(_e._payload),rt,It,mt,ut)}}if(Zt)return ut=ut(_e),Zt=mt===""?"."+Ji(_e,0):mt,St(ut)?(It="",Zt!=null&&(It=Zt.replace($e,"$&/")+"/"),Ri(ut,rt,It,"",function(kr){return kr})):ut!=null&&(ui(ut)&&(ut=zt(ut,It+(ut.key==null||_e&&_e.key===ut.key?"":(""+ut.key).replace($e,"$&/")+"/")+Zt)),rt.push(ut)),1;Zt=0;var Di=mt===""?".":mt+":";if(St(_e))for(var Ei=0;Ei<_e.length;Ei++)mt=_e[Ei],bi=Di+Ji(mt,Ei),Zt+=Ri(mt,rt,It,bi,ut);else if(Ei=Le(_e),typeof Ei=="function")for(_e=Ei.call(_e),Ei=0;!(mt=_e.next()).done;)mt=mt.value,bi=Di+Ji(mt,Ei++),Zt+=Ri(mt,rt,It,bi,ut);else if(bi==="object"){if(typeof _e.then=="function")return Ri(fn(_e),rt,It,mt,ut);throw rt=String(_e),Error("Objects are not valid as a React child (found: "+(rt==="[object Object]"?"object with keys {"+Object.keys(_e).join(", ")+"}":rt)+"). If you meant to render a collection of children, use an array instead.")}return Zt}function Qe(_e,rt,It){if(_e==null)return _e;var mt=[],ut=0;return Ri(_e,mt,"","",function(bi){return rt.call(It,bi,ut++)}),mt}function bt(_e){if(_e._status===-1){var rt=_e._result;rt=rt(),rt.then(function(It){(_e._status===0||_e._status===-1)&&(_e._status=1,_e._result=It)},function(It){(_e._status===0||_e._status===-1)&&(_e._status=2,_e._result=It)}),_e._status===-1&&(_e._status=0,_e._result=rt)}if(_e._status===1)return _e._result.default;throw _e._result}var Be=typeof reportError=="function"?reportError:function(_e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var rt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof _e=="object"&&_e!==null&&typeof _e.message=="string"?String(_e.message):String(_e),error:_e});if(!window.dispatchEvent(rt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",_e);return}console.error(_e)};function _t(){}return Xi.Children={map:Qe,forEach:function(_e,rt,It){Qe(_e,function(){rt.apply(this,arguments)},It)},count:function(_e){var rt=0;return Qe(_e,function(){rt++}),rt},toArray:function(_e){return Qe(_e,function(rt){return rt})||[]},only:function(_e){if(!ui(_e))throw Error("React.Children.only expected to receive a single React element child.");return _e}},Xi.Component=Et,Xi.Fragment=H,Xi.Profiler=Q,Xi.PureComponent=Nt,Xi.StrictMode=Z,Xi.Suspense=se,Xi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Rt,Xi.__COMPILER_RUNTIME={__proto__:null,c:function(_e){return Rt.H.useMemoCache(_e)}},Xi.cache=function(_e){return function(){return _e.apply(null,arguments)}},Xi.cloneElement=function(_e,rt,It){if(_e==null)throw Error("The argument must be a React element, but you passed "+_e+".");var mt=wt({},_e.props),ut=_e.key,bi=void 0;if(rt!=null)for(Zt in rt.ref!==void 0&&(bi=void 0),rt.key!==void 0&&(ut=""+rt.key),rt)!Gt.call(rt,Zt)||Zt==="key"||Zt==="__self"||Zt==="__source"||Zt==="ref"&&rt.ref===void 0||(mt[Zt]=rt[Zt]);var Zt=arguments.length-2;if(Zt===1)mt.children=It;else if(1<Zt){for(var Di=Array(Zt),Ei=0;Ei<Zt;Ei++)Di[Ei]=arguments[Ei+2];mt.children=Di}return ti(_e.type,ut,void 0,void 0,bi,mt)},Xi.createContext=function(_e){return _e={$$typeof:F,_currentValue:_e,_currentValue2:_e,_threadCount:0,Provider:null,Consumer:null},_e.Provider=_e,_e.Consumer={$$typeof:ie,_context:_e},_e},Xi.createElement=function(_e,rt,It){var mt,ut={},bi=null;if(rt!=null)for(mt in rt.key!==void 0&&(bi=""+rt.key),rt)Gt.call(rt,mt)&&mt!=="key"&&mt!=="__self"&&mt!=="__source"&&(ut[mt]=rt[mt]);var Zt=arguments.length-2;if(Zt===1)ut.children=It;else if(1<Zt){for(var Di=Array(Zt),Ei=0;Ei<Zt;Ei++)Di[Ei]=arguments[Ei+2];ut.children=Di}if(_e&&_e.defaultProps)for(mt in Zt=_e.defaultProps,Zt)ut[mt]===void 0&&(ut[mt]=Zt[mt]);return ti(_e,bi,void 0,void 0,null,ut)},Xi.createRef=function(){return{current:null}},Xi.forwardRef=function(_e){return{$$typeof:y,render:_e}},Xi.isValidElement=ui,Xi.lazy=function(_e){return{$$typeof:Ce,_payload:{_status:-1,_result:_e},_init:bt}},Xi.memo=function(_e,rt){return{$$typeof:pe,type:_e,compare:rt===void 0?null:rt}},Xi.startTransition=function(_e){var rt=Rt.T,It={};Rt.T=It;try{var mt=_e(),ut=Rt.S;ut!==null&&ut(It,mt),typeof mt=="object"&&mt!==null&&typeof mt.then=="function"&&mt.then(_t,Be)}catch(bi){Be(bi)}finally{Rt.T=rt}},Xi.unstable_useCacheRefresh=function(){return Rt.H.useCacheRefresh()},Xi.use=function(_e){return Rt.H.use(_e)},Xi.useActionState=function(_e,rt,It){return Rt.H.useActionState(_e,rt,It)},Xi.useCallback=function(_e,rt){return Rt.H.useCallback(_e,rt)},Xi.useContext=function(_e){return Rt.H.useContext(_e)},Xi.useDebugValue=function(){},Xi.useDeferredValue=function(_e,rt){return Rt.H.useDeferredValue(_e,rt)},Xi.useEffect=function(_e,rt,It){var mt=Rt.H;if(typeof It=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return mt.useEffect(_e,rt)},Xi.useId=function(){return Rt.H.useId()},Xi.useImperativeHandle=function(_e,rt,It){return Rt.H.useImperativeHandle(_e,rt,It)},Xi.useInsertionEffect=function(_e,rt){return Rt.H.useInsertionEffect(_e,rt)},Xi.useLayoutEffect=function(_e,rt){return Rt.H.useLayoutEffect(_e,rt)},Xi.useMemo=function(_e,rt){return Rt.H.useMemo(_e,rt)},Xi.useOptimistic=function(_e,rt){return Rt.H.useOptimistic(_e,rt)},Xi.useReducer=function(_e,rt,It){return Rt.H.useReducer(_e,rt,It)},Xi.useRef=function(_e){return Rt.H.useRef(_e)},Xi.useState=function(_e){return Rt.H.useState(_e)},Xi.useSyncExternalStore=function(_e,rt,It){return Rt.H.useSyncExternalStore(_e,rt,It)},Xi.useTransition=function(){return Rt.H.useTransition()},Xi.version="19.1.0",Xi}var Bm;function Tm(){return Bm||(Bm=1,hm.exports=xy()),hm.exports}var De=Tm();const Lf=mg(De),gg=pg({__proto__:null,default:Lf},[De]);var dm={exports:{}},Xp={},fm={exports:{}},pm={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Om;function vy(){return Om||(Om=1,function(D){function G(Qe,bt){var Be=Qe.length;Qe.push(bt);e:for(;0<Be;){var _t=Be-1>>>1,_e=Qe[_t];if(0<Q(_e,bt))Qe[_t]=bt,Qe[Be]=_e,Be=_t;else break e}}function H(Qe){return Qe.length===0?null:Qe[0]}function Z(Qe){if(Qe.length===0)return null;var bt=Qe[0],Be=Qe.pop();if(Be!==bt){Qe[0]=Be;e:for(var _t=0,_e=Qe.length,rt=_e>>>1;_t<rt;){var It=2*(_t+1)-1,mt=Qe[It],ut=It+1,bi=Qe[ut];if(0>Q(mt,Be))ut<_e&&0>Q(bi,mt)?(Qe[_t]=bi,Qe[ut]=Be,_t=ut):(Qe[_t]=mt,Qe[It]=Be,_t=It);else if(ut<_e&&0>Q(bi,Be))Qe[_t]=bi,Qe[ut]=Be,_t=ut;else break e}}return bt}function Q(Qe,bt){var Be=Qe.sortIndex-bt.sortIndex;return Be!==0?Be:Qe.id-bt.id}if(D.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var ie=performance;D.unstable_now=function(){return ie.now()}}else{var F=Date,y=F.now();D.unstable_now=function(){return F.now()-y}}var se=[],pe=[],Ce=1,Ze=null,Le=3,Se=!1,wt=!1,Ut=!1,Et=!1,Yt=typeof setTimeout=="function"?setTimeout:null,Nt=typeof clearTimeout=="function"?clearTimeout:null,ot=typeof setImmediate<"u"?setImmediate:null;function St(Qe){for(var bt=H(pe);bt!==null;){if(bt.callback===null)Z(pe);else if(bt.startTime<=Qe)Z(pe),bt.sortIndex=bt.expirationTime,G(se,bt);else break;bt=H(pe)}}function Rt(Qe){if(Ut=!1,St(Qe),!wt)if(H(se)!==null)wt=!0,Gt||(Gt=!0,Ji());else{var bt=H(pe);bt!==null&&Ri(Rt,bt.startTime-Qe)}}var Gt=!1,ti=-1,zt=5,ui=-1;function Pi(){return Et?!0:!(D.unstable_now()-ui<zt)}function $e(){if(Et=!1,Gt){var Qe=D.unstable_now();ui=Qe;var bt=!0;try{e:{wt=!1,Ut&&(Ut=!1,Nt(ti),ti=-1),Se=!0;var Be=Le;try{t:{for(St(Qe),Ze=H(se);Ze!==null&&!(Ze.expirationTime>Qe&&Pi());){var _t=Ze.callback;if(typeof _t=="function"){Ze.callback=null,Le=Ze.priorityLevel;var _e=_t(Ze.expirationTime<=Qe);if(Qe=D.unstable_now(),typeof _e=="function"){Ze.callback=_e,St(Qe),bt=!0;break t}Ze===H(se)&&Z(se),St(Qe)}else Z(se);Ze=H(se)}if(Ze!==null)bt=!0;else{var rt=H(pe);rt!==null&&Ri(Rt,rt.startTime-Qe),bt=!1}}break e}finally{Ze=null,Le=Be,Se=!1}bt=void 0}}finally{bt?Ji():Gt=!1}}}var Ji;if(typeof ot=="function")Ji=function(){ot($e)};else if(typeof MessageChannel<"u"){var ft=new MessageChannel,fn=ft.port2;ft.port1.onmessage=$e,Ji=function(){fn.postMessage(null)}}else Ji=function(){Yt($e,0)};function Ri(Qe,bt){ti=Yt(function(){Qe(D.unstable_now())},bt)}D.unstable_IdlePriority=5,D.unstable_ImmediatePriority=1,D.unstable_LowPriority=4,D.unstable_NormalPriority=3,D.unstable_Profiling=null,D.unstable_UserBlockingPriority=2,D.unstable_cancelCallback=function(Qe){Qe.callback=null},D.unstable_forceFrameRate=function(Qe){0>Qe||125<Qe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):zt=0<Qe?Math.floor(1e3/Qe):5},D.unstable_getCurrentPriorityLevel=function(){return Le},D.unstable_next=function(Qe){switch(Le){case 1:case 2:case 3:var bt=3;break;default:bt=Le}var Be=Le;Le=bt;try{return Qe()}finally{Le=Be}},D.unstable_requestPaint=function(){Et=!0},D.unstable_runWithPriority=function(Qe,bt){switch(Qe){case 1:case 2:case 3:case 4:case 5:break;default:Qe=3}var Be=Le;Le=Qe;try{return bt()}finally{Le=Be}},D.unstable_scheduleCallback=function(Qe,bt,Be){var _t=D.unstable_now();switch(typeof Be=="object"&&Be!==null?(Be=Be.delay,Be=typeof Be=="number"&&0<Be?_t+Be:_t):Be=_t,Qe){case 1:var _e=-1;break;case 2:_e=250;break;case 5:_e=1073741823;break;case 4:_e=1e4;break;default:_e=5e3}return _e=Be+_e,Qe={id:Ce++,callback:bt,priorityLevel:Qe,startTime:Be,expirationTime:_e,sortIndex:-1},Be>_t?(Qe.sortIndex=Be,G(pe,Qe),H(se)===null&&Qe===H(pe)&&(Ut?(Nt(ti),ti=-1):Ut=!0,Ri(Rt,Be-_t))):(Qe.sortIndex=_e,G(se,Qe),wt||Se||(wt=!0,Gt||(Gt=!0,Ji()))),Qe},D.unstable_shouldYield=Pi,D.unstable_wrapCallback=function(Qe){var bt=Le;return function(){var Be=Le;Le=bt;try{return Qe.apply(this,arguments)}finally{Le=Be}}}}(pm)),pm}var Fm;function by(){return Fm||(Fm=1,fm.exports=vy()),fm.exports}var mm={exports:{}},uo={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jm;function wy(){if(jm)return uo;jm=1;var D=Tm();function G(se){var pe="https://react.dev/errors/"+se;if(1<arguments.length){pe+="?args[]="+encodeURIComponent(arguments[1]);for(var Ce=2;Ce<arguments.length;Ce++)pe+="&args[]="+encodeURIComponent(arguments[Ce])}return"Minified React error #"+se+"; visit "+pe+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function H(){}var Z={d:{f:H,r:function(){throw Error(G(522))},D:H,C:H,L:H,m:H,X:H,S:H,M:H},p:0,findDOMNode:null},Q=Symbol.for("react.portal");function ie(se,pe,Ce){var Ze=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Q,key:Ze==null?null:""+Ze,children:se,containerInfo:pe,implementation:Ce}}var F=D.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function y(se,pe){if(se==="font")return"";if(typeof pe=="string")return pe==="use-credentials"?pe:""}return uo.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Z,uo.createPortal=function(se,pe){var Ce=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!pe||pe.nodeType!==1&&pe.nodeType!==9&&pe.nodeType!==11)throw Error(G(299));return ie(se,pe,null,Ce)},uo.flushSync=function(se){var pe=F.T,Ce=Z.p;try{if(F.T=null,Z.p=2,se)return se()}finally{F.T=pe,Z.p=Ce,Z.d.f()}},uo.preconnect=function(se,pe){typeof se=="string"&&(pe?(pe=pe.crossOrigin,pe=typeof pe=="string"?pe==="use-credentials"?pe:"":void 0):pe=null,Z.d.C(se,pe))},uo.prefetchDNS=function(se){typeof se=="string"&&Z.d.D(se)},uo.preinit=function(se,pe){if(typeof se=="string"&&pe&&typeof pe.as=="string"){var Ce=pe.as,Ze=y(Ce,pe.crossOrigin),Le=typeof pe.integrity=="string"?pe.integrity:void 0,Se=typeof pe.fetchPriority=="string"?pe.fetchPriority:void 0;Ce==="style"?Z.d.S(se,typeof pe.precedence=="string"?pe.precedence:void 0,{crossOrigin:Ze,integrity:Le,fetchPriority:Se}):Ce==="script"&&Z.d.X(se,{crossOrigin:Ze,integrity:Le,fetchPriority:Se,nonce:typeof pe.nonce=="string"?pe.nonce:void 0})}},uo.preinitModule=function(se,pe){if(typeof se=="string")if(typeof pe=="object"&&pe!==null){if(pe.as==null||pe.as==="script"){var Ce=y(pe.as,pe.crossOrigin);Z.d.M(se,{crossOrigin:Ce,integrity:typeof pe.integrity=="string"?pe.integrity:void 0,nonce:typeof pe.nonce=="string"?pe.nonce:void 0})}}else pe==null&&Z.d.M(se)},uo.preload=function(se,pe){if(typeof se=="string"&&typeof pe=="object"&&pe!==null&&typeof pe.as=="string"){var Ce=pe.as,Ze=y(Ce,pe.crossOrigin);Z.d.L(se,Ce,{crossOrigin:Ze,integrity:typeof pe.integrity=="string"?pe.integrity:void 0,nonce:typeof pe.nonce=="string"?pe.nonce:void 0,type:typeof pe.type=="string"?pe.type:void 0,fetchPriority:typeof pe.fetchPriority=="string"?pe.fetchPriority:void 0,referrerPolicy:typeof pe.referrerPolicy=="string"?pe.referrerPolicy:void 0,imageSrcSet:typeof pe.imageSrcSet=="string"?pe.imageSrcSet:void 0,imageSizes:typeof pe.imageSizes=="string"?pe.imageSizes:void 0,media:typeof pe.media=="string"?pe.media:void 0})}},uo.preloadModule=function(se,pe){if(typeof se=="string")if(pe){var Ce=y(pe.as,pe.crossOrigin);Z.d.m(se,{as:typeof pe.as=="string"&&pe.as!=="script"?pe.as:void 0,crossOrigin:Ce,integrity:typeof pe.integrity=="string"?pe.integrity:void 0})}else Z.d.m(se)},uo.requestFormReset=function(se){Z.d.r(se)},uo.unstable_batchedUpdates=function(se,pe){return se(pe)},uo.useFormState=function(se,pe,Ce){return F.H.useFormState(se,pe,Ce)},uo.useFormStatus=function(){return F.H.useHostTransitionStatus()},uo.version="19.1.0",uo}var Nm;function yg(){if(Nm)return mm.exports;Nm=1;function D(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(D)}catch(G){console.error(G)}}return D(),mm.exports=wy(),mm.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vm;function Sy(){if(Vm)return Xp;Vm=1;var D=by(),G=Tm(),H=yg();function Z(a){var u="https://react.dev/errors/"+a;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)u+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+a+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Q(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function ie(a){var u=a,m=a;if(a.alternate)for(;u.return;)u=u.return;else{a=u;do u=a,(u.flags&4098)!==0&&(m=u.return),a=u.return;while(a)}return u.tag===3?m:null}function F(a){if(a.tag===13){var u=a.memoizedState;if(u===null&&(a=a.alternate,a!==null&&(u=a.memoizedState)),u!==null)return u.dehydrated}return null}function y(a){if(ie(a)!==a)throw Error(Z(188))}function se(a){var u=a.alternate;if(!u){if(u=ie(a),u===null)throw Error(Z(188));return u!==a?null:a}for(var m=a,w=u;;){var E=m.return;if(E===null)break;var R=E.alternate;if(R===null){if(w=E.return,w!==null){m=w;continue}break}if(E.child===R.child){for(R=E.child;R;){if(R===m)return y(E),a;if(R===w)return y(E),u;R=R.sibling}throw Error(Z(188))}if(m.return!==w.return)m=E,w=R;else{for(var Y=!1,te=E.child;te;){if(te===m){Y=!0,m=E,w=R;break}if(te===w){Y=!0,w=E,m=R;break}te=te.sibling}if(!Y){for(te=R.child;te;){if(te===m){Y=!0,m=R,w=E;break}if(te===w){Y=!0,w=R,m=E;break}te=te.sibling}if(!Y)throw Error(Z(189))}}if(m.alternate!==w)throw Error(Z(190))}if(m.tag!==3)throw Error(Z(188));return m.stateNode.current===m?a:u}function pe(a){var u=a.tag;if(u===5||u===26||u===27||u===6)return a;for(a=a.child;a!==null;){if(u=pe(a),u!==null)return u;a=a.sibling}return null}var Ce=Object.assign,Ze=Symbol.for("react.element"),Le=Symbol.for("react.transitional.element"),Se=Symbol.for("react.portal"),wt=Symbol.for("react.fragment"),Ut=Symbol.for("react.strict_mode"),Et=Symbol.for("react.profiler"),Yt=Symbol.for("react.provider"),Nt=Symbol.for("react.consumer"),ot=Symbol.for("react.context"),St=Symbol.for("react.forward_ref"),Rt=Symbol.for("react.suspense"),Gt=Symbol.for("react.suspense_list"),ti=Symbol.for("react.memo"),zt=Symbol.for("react.lazy"),ui=Symbol.for("react.activity"),Pi=Symbol.for("react.memo_cache_sentinel"),$e=Symbol.iterator;function Ji(a){return a===null||typeof a!="object"?null:(a=$e&&a[$e]||a["@@iterator"],typeof a=="function"?a:null)}var ft=Symbol.for("react.client.reference");function fn(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===ft?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case wt:return"Fragment";case Et:return"Profiler";case Ut:return"StrictMode";case Rt:return"Suspense";case Gt:return"SuspenseList";case ui:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case Se:return"Portal";case ot:return(a.displayName||"Context")+".Provider";case Nt:return(a._context.displayName||"Context")+".Consumer";case St:var u=a.render;return a=a.displayName,a||(a=u.displayName||u.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case ti:return u=a.displayName||null,u!==null?u:fn(a.type)||"Memo";case zt:u=a._payload,a=a._init;try{return fn(a(u))}catch{}}return null}var Ri=Array.isArray,Qe=G.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,bt=H.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Be={pending:!1,data:null,method:null,action:null},_t=[],_e=-1;function rt(a){return{current:a}}function It(a){0>_e||(a.current=_t[_e],_t[_e]=null,_e--)}function mt(a,u){_e++,_t[_e]=a.current,a.current=u}var ut=rt(null),bi=rt(null),Zt=rt(null),Di=rt(null);function Ei(a,u){switch(mt(Zt,u),mt(bi,a),mt(ut,null),u.nodeType){case 9:case 11:a=(a=u.documentElement)&&(a=a.namespaceURI)?up(a):0;break;default:if(a=u.tagName,u=u.namespaceURI)u=up(u),a=qd(u,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}It(ut),mt(ut,a)}function kr(){It(ut),It(bi),It(Zt)}function jn(a){a.memoizedState!==null&&mt(Di,a);var u=ut.current,m=qd(u,a.type);u!==m&&(mt(bi,a),mt(ut,m))}function Hn(a){bi.current===a&&(It(ut),It(bi)),Di.current===a&&(It(Di),L._currentValue=Be)}var sr=Object.prototype.hasOwnProperty,xi=D.unstable_scheduleCallback,Qr=D.unstable_cancelCallback,oa=D.unstable_shouldYield,rs=D.unstable_requestPaint,sn=D.unstable_now,Nn=D.unstable_getCurrentPriorityLevel,ns=D.unstable_ImmediatePriority,Wo=D.unstable_UserBlockingPriority,as=D.unstable_NormalPriority,La=D.unstable_LowPriority,Ns=D.unstable_IdlePriority,Vl=D.log,Ko=D.unstable_setDisableYieldValue,ss=null,pn=null;function ba(a){if(typeof Vl=="function"&&Ko(a),pn&&typeof pn.setStrictMode=="function")try{pn.setStrictMode(ss,a)}catch{}}var Ee=Math.clz32?Math.clz32:re,K=Math.log,ee=Math.LN2;function re(a){return a>>>=0,a===0?32:31-(K(a)/ee|0)|0}var me=256,Ae=4194304;function Pe(a){var u=a&42;if(u!==0)return u;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function je(a,u,m){var w=a.pendingLanes;if(w===0)return 0;var E=0,R=a.suspendedLanes,Y=a.pingedLanes;a=a.warmLanes;var te=w&134217727;return te!==0?(w=te&~R,w!==0?E=Pe(w):(Y&=te,Y!==0?E=Pe(Y):m||(m=te&~a,m!==0&&(E=Pe(m))))):(te=w&~R,te!==0?E=Pe(te):Y!==0?E=Pe(Y):m||(m=w&~a,m!==0&&(E=Pe(m)))),E===0?0:u!==0&&u!==E&&(u&R)===0&&(R=E&-E,m=u&-u,R>=m||R===32&&(m&4194048)!==0)?u:E}function Re(a,u){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&u)===0}function Je(a,u){switch(a){case 1:case 2:case 4:case 8:case 64:return u+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ht(){var a=me;return me<<=1,(me&4194048)===0&&(me=256),a}function at(){var a=Ae;return Ae<<=1,(Ae&62914560)===0&&(Ae=4194304),a}function Dt(a){for(var u=[],m=0;31>m;m++)u.push(a);return u}function ke(a,u){a.pendingLanes|=u,u!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Tt(a,u,m,w,E,R){var Y=a.pendingLanes;a.pendingLanes=m,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=m,a.entangledLanes&=m,a.errorRecoveryDisabledLanes&=m,a.shellSuspendCounter=0;var te=a.entanglements,be=a.expirationTimes,Ge=a.hiddenUpdates;for(m=Y&~m;0<m;){var nt=31-Ee(m),lt=1<<nt;te[nt]=0,be[nt]=-1;var Xe=Ge[nt];if(Xe!==null)for(Ge[nt]=null,nt=0;nt<Xe.length;nt++){var Ke=Xe[nt];Ke!==null&&(Ke.lane&=-536870913)}m&=~lt}w!==0&&Ti(a,w,0),R!==0&&E===0&&a.tag!==0&&(a.suspendedLanes|=R&~(Y&~u))}function Ti(a,u,m){a.pendingLanes|=u,a.suspendedLanes&=~u;var w=31-Ee(u);a.entangledLanes|=u,a.entanglements[w]=a.entanglements[w]|1073741824|m&4194090}function $t(a,u){var m=a.entangledLanes|=u;for(a=a.entanglements;m;){var w=31-Ee(m),E=1<<w;E&u|a[w]&u&&(a[w]|=u),m&=~E}}function hi(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Ii(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function Yi(){var a=bt.p;return a!==0?a:(a=window.event,a===void 0?32:et(a.type))}function er(a,u){var m=bt.p;try{return bt.p=a,u()}finally{bt.p=m}}var Mi=Math.random().toString(36).slice(2),Lt="__reactFiber$"+Mi,di="__reactProps$"+Mi,Bi="__reactContainer$"+Mi,pt="__reactEvents$"+Mi,Ar="__reactListeners$"+Mi,Ur="__reactHandles$"+Mi,Ba="__reactResources$"+Mi,dr="__reactMarker$"+Mi;function xt(a){delete a[Lt],delete a[di],delete a[pt],delete a[Ar],delete a[Ur]}function ai(a){var u=a[Lt];if(u)return u;for(var m=a.parentNode;m;){if(u=m[Bi]||m[Lt]){if(m=u.alternate,u.child!==null||m!==null&&m.child!==null)for(a=Ll(a);a!==null;){if(m=a[Lt])return m;a=Ll(a)}return u}a=m,m=a.parentNode}return null}function si(a){if(a=a[Lt]||a[Bi]){var u=a.tag;if(u===5||u===6||u===13||u===26||u===27||u===3)return a}return null}function lr(a){var u=a.tag;if(u===5||u===26||u===27||u===6)return a.stateNode;throw Error(Z(33))}function Oa(a){var u=a[Ba];return u||(u=a[Ba]={hoistableStyles:new Map,hoistableScripts:new Map}),u}function or(a){a[dr]=!0}var wi=new Set,Pc={};function Vn(a,u){os(a,u),os(a+"Capture",u)}function os(a,u){for(Pc[a]=u,a=0;a<u.length;a++)wi.add(u[a])}var Fa=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ho={},Br={};function Ul(a){return sr.call(Br,a)?!0:sr.call(ho,a)?!1:Fa.test(a)?Br[a]=!0:(ho[a]=!0,!1)}function Sn(a,u,m){if(Ul(u))if(m===null)a.removeAttribute(u);else{switch(typeof m){case"undefined":case"function":case"symbol":a.removeAttribute(u);return;case"boolean":var w=u.toLowerCase().slice(0,5);if(w!=="data-"&&w!=="aria-"){a.removeAttribute(u);return}}a.setAttribute(u,""+m)}}function tr(a,u,m){if(m===null)a.removeAttribute(u);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttribute(u,""+m)}}function ja(a,u,m,w){if(w===null)a.removeAttribute(m);else{switch(typeof w){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(m);return}a.setAttributeNS(u,m,""+w)}}var Vs,Qo;function Na(a){if(Vs===void 0)try{throw Error()}catch(m){var u=m.stack.trim().match(/\n( *(at )?)/);Vs=u&&u[1]||"",Qo=-1<m.stack.indexOf(`
    at`)?" (<anonymous>)":-1<m.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Vs+a+Qo}var ls=!1;function Ic(a,u){if(!a||ls)return"";ls=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var w={DetermineComponentFrameRoot:function(){try{if(u){var lt=function(){throw Error()};if(Object.defineProperty(lt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(lt,[])}catch(Ke){var Xe=Ke}Reflect.construct(a,[],lt)}else{try{lt.call()}catch(Ke){Xe=Ke}a.call(lt.prototype)}}else{try{throw Error()}catch(Ke){Xe=Ke}(lt=a())&&typeof lt.catch=="function"&&lt.catch(function(){})}}catch(Ke){if(Ke&&Xe&&typeof Ke.stack=="string")return[Ke.stack,Xe.stack]}return[null,null]}};w.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var E=Object.getOwnPropertyDescriptor(w.DetermineComponentFrameRoot,"name");E&&E.configurable&&Object.defineProperty(w.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var R=w.DetermineComponentFrameRoot(),Y=R[0],te=R[1];if(Y&&te){var be=Y.split(`
`),Ge=te.split(`
`);for(E=w=0;w<be.length&&!be[w].includes("DetermineComponentFrameRoot");)w++;for(;E<Ge.length&&!Ge[E].includes("DetermineComponentFrameRoot");)E++;if(w===be.length||E===Ge.length)for(w=be.length-1,E=Ge.length-1;1<=w&&0<=E&&be[w]!==Ge[E];)E--;for(;1<=w&&0<=E;w--,E--)if(be[w]!==Ge[E]){if(w!==1||E!==1)do if(w--,E--,0>E||be[w]!==Ge[E]){var nt=`
`+be[w].replace(" at new "," at ");return a.displayName&&nt.includes("<anonymous>")&&(nt=nt.replace("<anonymous>",a.displayName)),nt}while(1<=w&&0<=E);break}}}finally{ls=!1,Error.prepareStackTrace=m}return(m=a?a.displayName||a.name:"")?Na(m):""}function ef(a){switch(a.tag){case 26:case 27:case 5:return Na(a.type);case 16:return Na("Lazy");case 13:return Na("Suspense");case 19:return Na("SuspenseList");case 0:case 15:return Ic(a.type,!1);case 11:return Ic(a.type.render,!1);case 1:return Ic(a.type,!0);case 31:return Na("Activity");default:return""}}function hd(a){try{var u="";do u+=ef(a),a=a.return;while(a);return u}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}function br(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Mu(a){var u=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(u==="checkbox"||u==="radio")}function Gl(a){var u=Mu(a)?"checked":"value",m=Object.getOwnPropertyDescriptor(a.constructor.prototype,u),w=""+a[u];if(!a.hasOwnProperty(u)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var E=m.get,R=m.set;return Object.defineProperty(a,u,{configurable:!0,get:function(){return E.call(this)},set:function(Y){w=""+Y,R.call(this,Y)}}),Object.defineProperty(a,u,{enumerable:m.enumerable}),{getValue:function(){return w},setValue:function(Y){w=""+Y},stopTracking:function(){a._valueTracker=null,delete a[u]}}}}function ql(a){a._valueTracker||(a._valueTracker=Gl(a))}function dd(a){if(!a)return!1;var u=a._valueTracker;if(!u)return!0;var m=u.getValue(),w="";return a&&(w=Mu(a)?a.checked?"true":"false":a.value),a=w,a!==m?(u.setValue(a),!0):!1}function Zl(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Ss=/[\n"\\]/g;function wa(a){return a.replace(Ss,function(u){return"\\"+u.charCodeAt(0).toString(16)+" "})}function Au(a,u,m,w,E,R,Y,te){a.name="",Y!=null&&typeof Y!="function"&&typeof Y!="symbol"&&typeof Y!="boolean"?a.type=Y:a.removeAttribute("type"),u!=null?Y==="number"?(u===0&&a.value===""||a.value!=u)&&(a.value=""+br(u)):a.value!==""+br(u)&&(a.value=""+br(u)):Y!=="submit"&&Y!=="reset"||a.removeAttribute("value"),u!=null?Cu(a,Y,br(u)):m!=null?Cu(a,Y,br(m)):w!=null&&a.removeAttribute("value"),E==null&&R!=null&&(a.defaultChecked=!!R),E!=null&&(a.checked=E&&typeof E!="function"&&typeof E!="symbol"),te!=null&&typeof te!="function"&&typeof te!="symbol"&&typeof te!="boolean"?a.name=""+br(te):a.removeAttribute("name")}function $l(a,u,m,w,E,R,Y,te){if(R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(a.type=R),u!=null||m!=null){if(!(R!=="submit"&&R!=="reset"||u!=null))return;m=m!=null?""+br(m):"",u=u!=null?""+br(u):m,te||u===a.value||(a.value=u),a.defaultValue=u}w=w??E,w=typeof w!="function"&&typeof w!="symbol"&&!!w,a.checked=te?a.checked:!!w,a.defaultChecked=!!w,Y!=null&&typeof Y!="function"&&typeof Y!="symbol"&&typeof Y!="boolean"&&(a.name=Y)}function Cu(a,u,m){u==="number"&&Zl(a.ownerDocument)===a||a.defaultValue===""+m||(a.defaultValue=""+m)}function Jo(a,u,m,w){if(a=a.options,u){u={};for(var E=0;E<m.length;E++)u["$"+m[E]]=!0;for(m=0;m<a.length;m++)E=u.hasOwnProperty("$"+a[m].value),a[m].selected!==E&&(a[m].selected=E),E&&w&&(a[m].defaultSelected=!0)}else{for(m=""+br(m),u=null,E=0;E<a.length;E++){if(a[E].value===m){a[E].selected=!0,w&&(a[E].defaultSelected=!0);return}u!==null||a[E].disabled||(u=a[E])}u!==null&&(u.selected=!0)}}function tf(a,u,m){if(u!=null&&(u=""+br(u),u!==a.value&&(a.value=u),m==null)){a.defaultValue!==u&&(a.defaultValue=u);return}a.defaultValue=m!=null?""+br(m):""}function Us(a,u,m,w){if(u==null){if(w!=null){if(m!=null)throw Error(Z(92));if(Ri(w)){if(1<w.length)throw Error(Z(93));w=w[0]}m=w}m==null&&(m=""),u=m}m=br(u),a.defaultValue=m,w=a.textContent,w===m&&w!==""&&w!==null&&(a.value=w)}function cs(a,u){if(u){var m=a.firstChild;if(m&&m===a.lastChild&&m.nodeType===3){m.nodeValue=u;return}}a.textContent=u}var Sa=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ai(a,u,m){var w=u.indexOf("--")===0;m==null||typeof m=="boolean"||m===""?w?a.setProperty(u,""):u==="float"?a.cssFloat="":a[u]="":w?a.setProperty(u,m):typeof m!="number"||m===0||Sa.has(u)?u==="float"?a.cssFloat=m:a[u]=(""+m).trim():a[u]=m+"px"}function Gs(a,u,m){if(u!=null&&typeof u!="object")throw Error(Z(62));if(a=a.style,m!=null){for(var w in m)!m.hasOwnProperty(w)||u!=null&&u.hasOwnProperty(w)||(w.indexOf("--")===0?a.setProperty(w,""):w==="float"?a.cssFloat="":a[w]="");for(var E in u)w=u[E],u.hasOwnProperty(E)&&m[E]!==w&&Ai(a,E,w)}else for(var R in u)u.hasOwnProperty(R)&&Ai(a,R,u[R])}function Tn(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fo=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),po=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function pi(a){return po.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var Va=null;function kc(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var mo=null,Jr=null;function Mn(a){var u=si(a);if(u&&(a=u.stateNode)){var m=a[di]||null;e:switch(a=u.stateNode,u.type){case"input":if(Au(a,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name),u=m.name,m.type==="radio"&&u!=null){for(m=a;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll('input[name="'+wa(""+u)+'"][type="radio"]'),u=0;u<m.length;u++){var w=m[u];if(w!==a&&w.form===a.form){var E=w[di]||null;if(!E)throw Error(Z(90));Au(w,E.value,E.defaultValue,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name)}}for(u=0;u<m.length;u++)w=m[u],w.form===a.form&&dd(w)}break e;case"textarea":tf(a,m.value,m.defaultValue);break e;case"select":u=m.value,u!=null&&Jo(a,!!m.multiple,u,!1)}}}var on=!1;function mn(a,u,m){if(on)return a(u,m);on=!0;try{var w=a(u);return w}finally{if(on=!1,(mo!==null||Jr!==null)&&(zd(),mo&&(u=mo,a=Jr,Jr=mo=null,Mn(u),a)))for(u=0;u<a.length;u++)Mn(a[u])}}function ir(a,u){var m=a.stateNode;if(m===null)return null;var w=m[di]||null;if(w===null)return null;m=w[u];e:switch(u){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(w=!w.disabled)||(a=a.type,w=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!w;break e;default:a=!1}if(a)return null;if(m&&typeof m!="function")throw Error(Z(231,u,typeof m));return m}var qs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Dn=!1;if(qs)try{var An={};Object.defineProperty(An,"passive",{get:function(){Dn=!0}}),window.addEventListener("test",An,An),window.removeEventListener("test",An,An)}catch{Dn=!1}var Gr=null,wr=null,Ts=null;function ii(){if(Ts)return Ts;var a,u=wr,m=u.length,w,E="value"in Gr?Gr.value:Gr.textContent,R=E.length;for(a=0;a<m&&u[a]===E[a];a++);var Y=m-a;for(w=1;w<=Y&&u[m-w]===E[R-w];w++);return Ts=E.slice(a,1<w?1-w:void 0)}function ri(a){var u=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&u===13&&(a=13)):a=u,a===10&&(a=13),32<=a||a===13?a:0}function Ua(){return!0}function Li(){return!1}function fr(a){function u(m,w,E,R,Y){this._reactName=m,this._targetInst=E,this.type=w,this.nativeEvent=R,this.target=Y,this.currentTarget=null;for(var te in a)a.hasOwnProperty(te)&&(m=a[te],this[te]=m?m(R):R[te]);return this.isDefaultPrevented=(R.defaultPrevented!=null?R.defaultPrevented:R.returnValue===!1)?Ua:Li,this.isPropagationStopped=Li,this}return Ce(u.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=Ua)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=Ua)},persist:function(){},isPersistent:Ua}),u}var Xn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Yn=fr(Xn),el=Ce({},Xn,{view:0,detail:0}),fd=fr(el),go,tl,yo,_o=Ce({},el,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hl,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==yo&&(yo&&a.type==="mousemove"?(go=a.screenX-yo.screenX,tl=a.screenY-yo.screenY):tl=go=0,yo=a),go)},movementY:function(a){return"movementY"in a?a.movementY:tl}}),Rc=fr(_o),Ta=Ce({},_o,{dataTransfer:0}),Rr=fr(Ta),il=Ce({},el,{relatedTarget:0}),xo=fr(il),vo=Ce({},Xn,{animationName:0,elapsedTime:0,pseudoElement:0}),en=fr(vo),Mh=Ce({},Xn,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Ms=fr(Mh),Eu=Ce({},Xn,{data:0}),rf=fr(Eu),Dc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Un={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zu={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function As(a){var u=this.nativeEvent;return u.getModifierState?u.getModifierState(a):(a=zu[a])?!!u[a]:!1}function Hl(){return As}var Lc=Ce({},el,{key:function(a){if(a.key){var u=Dc[a.key]||a.key;if(u!=="Unidentified")return u}return a.type==="keypress"?(a=ri(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Un[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hl,charCode:function(a){return a.type==="keypress"?ri(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?ri(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),rl=fr(Lc),Cn=Ce({},_o,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Bc=fr(Cn),Oc=Ce({},el,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hl}),Xl=fr(Oc),Yl=Ce({},Xn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Fc=fr(Yl),us=Ce({},_o,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Pu=fr(us),Ah=Ce({},Xn,{newState:0,oldState:0}),bo=fr(Ah),wo=[9,13,27,32],So=qs&&"CompositionEvent"in window,Ln=null;qs&&"documentMode"in document&&(Ln=document.documentMode);var Iu=qs&&"TextEvent"in window&&!Ln,nl=qs&&(!So||Ln&&8<Ln&&11>=Ln),Wl=" ",Cs=!1;function Kl(a,u){switch(a){case"keyup":return wo.indexOf(u.keyCode)!==-1;case"keydown":return u.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jc(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var al=!1;function Si(a,u){switch(a){case"compositionend":return jc(u);case"keypress":return u.which!==32?null:(Cs=!0,Wl);case"textInput":return a=u.data,a===Wl&&Cs?null:a;default:return null}}function ku(a,u){if(al)return a==="compositionend"||!So&&Kl(a,u)?(a=ii(),Ts=wr=Gr=null,al=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(u.ctrlKey||u.altKey||u.metaKey)||u.ctrlKey&&u.altKey){if(u.char&&1<u.char.length)return u.char;if(u.which)return String.fromCharCode(u.which)}return null;case"compositionend":return nl&&u.locale!=="ko"?null:u.data;default:return null}}var pd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function md(a){var u=a&&a.nodeName&&a.nodeName.toLowerCase();return u==="input"?!!pd[a.type]:u==="textarea"}function Ql(a,u,m,w){mo?Jr?Jr.push(w):Jr=[w]:mo=w,u=ed(u,"onChange"),0<u.length&&(m=new Yn("onChange","change",null,m,w),a.push({event:m,listeners:u}))}var Jl=null,Nc=null;function Ru(a){lp(a,0)}function Du(a){var u=lr(a);if(dd(u))return a}function Lu(a,u){if(a==="change")return u}var Es=!1;if(qs){var Zs;if(qs){var sl="oninput"in document;if(!sl){var ol=document.createElement("div");ol.setAttribute("oninput","return;"),sl=typeof ol.oninput=="function"}Zs=sl}else Zs=!1;Es=Zs&&(!document.documentMode||9<document.documentMode)}function gd(){Jl&&(Jl.detachEvent("onpropertychange",To),Nc=Jl=null)}function To(a){if(a.propertyName==="value"&&Du(Nc)){var u=[];Ql(u,Nc,a,kc(a)),mn(Ru,u)}}function Bu(a,u,m){a==="focusin"?(gd(),Jl=u,Nc=m,Jl.attachEvent("onpropertychange",To)):a==="focusout"&&gd()}function Ch(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Du(Nc)}function Eh(a,u){if(a==="click")return Du(u)}function nf(a,u){if(a==="input"||a==="change")return Du(u)}function ec(a,u){return a===u&&(a!==0||1/a===1/u)||a!==a&&u!==u}var la=typeof Object.is=="function"?Object.is:ec;function tc(a,u){if(la(a,u))return!0;if(typeof a!="object"||a===null||typeof u!="object"||u===null)return!1;var m=Object.keys(a),w=Object.keys(u);if(m.length!==w.length)return!1;for(w=0;w<m.length;w++){var E=m[w];if(!sr.call(u,E)||!la(a[E],u[E]))return!1}return!0}function ll(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function hs(a,u){var m=ll(a);a=0;for(var w;m;){if(m.nodeType===3){if(w=a+m.textContent.length,a<=u&&w>=u)return{node:m,offset:u-a};a=w}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=ll(m)}}function Ui(a,u){return a&&u?a===u?!0:a&&a.nodeType===3?!1:u&&u.nodeType===3?Ui(a,u.parentNode):"contains"in a?a.contains(u):a.compareDocumentPosition?!!(a.compareDocumentPosition(u)&16):!1:!1}function Ou(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var u=Zl(a.document);u instanceof a.HTMLIFrameElement;){try{var m=typeof u.contentWindow.location.href=="string"}catch{m=!1}if(m)a=u.contentWindow;else break;u=Zl(a.document)}return u}function cl(a){var u=a&&a.nodeName&&a.nodeName.toLowerCase();return u&&(u==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||u==="textarea"||a.contentEditable==="true")}var zh=qs&&"documentMode"in document&&11>=document.documentMode,ul=null,$s=null,Sr=null,Mo=!1;function Ga(a,u,m){var w=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;Mo||ul==null||ul!==Zl(w)||(w=ul,"selectionStart"in w&&cl(w)?w={start:w.selectionStart,end:w.selectionEnd}:(w=(w.ownerDocument&&w.ownerDocument.defaultView||window).getSelection(),w={anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}),Sr&&tc(Sr,w)||(Sr=w,w=ed($s,"onSelect"),0<w.length&&(u=new Yn("onSelect","select",null,u,m),a.push({event:u,listeners:w}),u.target=ul)))}function Ao(a,u){var m={};return m[a.toLowerCase()]=u.toLowerCase(),m["Webkit"+a]="webkit"+u,m["Moz"+a]="moz"+u,m}var Co={animationend:Ao("Animation","AnimationEnd"),animationiteration:Ao("Animation","AnimationIteration"),animationstart:Ao("Animation","AnimationStart"),transitionrun:Ao("Transition","TransitionRun"),transitionstart:Ao("Transition","TransitionStart"),transitioncancel:Ao("Transition","TransitionCancel"),transitionend:Ao("Transition","TransitionEnd")},Fu={},ic={};qs&&(ic=document.createElement("div").style,"AnimationEvent"in window||(delete Co.animationend.animation,delete Co.animationiteration.animation,delete Co.animationstart.animation),"TransitionEvent"in window||delete Co.transitionend.transition);function Hs(a){if(Fu[a])return Fu[a];if(!Co[a])return a;var u=Co[a],m;for(m in u)if(u.hasOwnProperty(m)&&m in ic)return Fu[a]=u[m];return a}var Eo=Hs("animationend"),rc=Hs("animationiteration"),Vc=Hs("animationstart"),Ph=Hs("transitionrun"),hl=Hs("transitionstart"),Uc=Hs("transitioncancel"),dl=Hs("transitionend"),En=new Map,ju="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ju.push("scrollEnd");function qa(a,u){En.set(a,u),Vn(u,[a])}var Nu=new WeakMap;function zn(a,u){if(typeof a=="object"&&a!==null){var m=Nu.get(a);return m!==void 0?m:(u={value:a,source:u,stack:hd(u)},Nu.set(a,u),u)}return{value:a,source:u,stack:hd(u)}}var Wn=[],Xs=0,fl=0;function pl(){for(var a=Xs,u=fl=Xs=0;u<a;){var m=Wn[u];Wn[u++]=null;var w=Wn[u];Wn[u++]=null;var E=Wn[u];Wn[u++]=null;var R=Wn[u];if(Wn[u++]=null,w!==null&&E!==null){var Y=w.pending;Y===null?E.next=E:(E.next=Y.next,Y.next=E),w.pending=E}R!==0&&Za(m,E,R)}}function ml(a,u,m,w){Wn[Xs++]=a,Wn[Xs++]=u,Wn[Xs++]=m,Wn[Xs++]=w,fl|=w,a.lanes|=w,a=a.alternate,a!==null&&(a.lanes|=w)}function zo(a,u,m,w){return ml(a,u,m,w),nc(a)}function qr(a,u){return ml(a,null,null,u),nc(a)}function Za(a,u,m){a.lanes|=m;var w=a.alternate;w!==null&&(w.lanes|=m);for(var E=!1,R=a.return;R!==null;)R.childLanes|=m,w=R.alternate,w!==null&&(w.childLanes|=m),R.tag===22&&(a=R.stateNode,a===null||a._visibility&1||(E=!0)),a=R,R=R.return;return a.tag===3?(R=a.stateNode,E&&u!==null&&(E=31-Ee(m),a=R.hiddenUpdates,w=a[E],w===null?a[E]=[u]:w.push(u),u.lane=m|536870912),R):null}function nc(a){if(50<fu)throw fu=0,pu=null,Error(Z(185));for(var u=a.return;u!==null;)a=u,u=a.return;return a.tag===3?a.stateNode:null}var ni={};function Gc(a,u,m,w){this.tag=a,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=u,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ma(a,u,m,w){return new Gc(a,u,m,w)}function qc(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Kn(a,u){var m=a.alternate;return m===null?(m=Ma(a.tag,u,a.key,a.mode),m.elementType=a.elementType,m.type=a.type,m.stateNode=a.stateNode,m.alternate=a,a.alternate=m):(m.pendingProps=u,m.type=a.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=a.flags&65011712,m.childLanes=a.childLanes,m.lanes=a.lanes,m.child=a.child,m.memoizedProps=a.memoizedProps,m.memoizedState=a.memoizedState,m.updateQueue=a.updateQueue,u=a.dependencies,m.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext},m.sibling=a.sibling,m.index=a.index,m.ref=a.ref,m.refCleanup=a.refCleanup,m}function yd(a,u){a.flags&=65011714;var m=a.alternate;return m===null?(a.childLanes=0,a.lanes=u,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=m.childLanes,a.lanes=m.lanes,a.child=m.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=m.memoizedProps,a.memoizedState=m.memoizedState,a.updateQueue=m.updateQueue,a.type=m.type,u=m.dependencies,a.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext}),a}function Vu(a,u,m,w,E,R){var Y=0;if(w=a,typeof a=="function")qc(a)&&(Y=1);else if(typeof a=="string")Y=r(a,m,ut.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case ui:return a=Ma(31,m,u,E),a.elementType=ui,a.lanes=R,a;case wt:return zs(m.children,E,R,u);case Ut:Y=8,E|=24;break;case Et:return a=Ma(12,m,u,E|2),a.elementType=Et,a.lanes=R,a;case Rt:return a=Ma(13,m,u,E),a.elementType=Rt,a.lanes=R,a;case Gt:return a=Ma(19,m,u,E),a.elementType=Gt,a.lanes=R,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Yt:case ot:Y=10;break e;case Nt:Y=9;break e;case St:Y=11;break e;case ti:Y=14;break e;case zt:Y=16,w=null;break e}Y=29,m=Error(Z(130,a===null?"null":typeof a,"")),w=null}return u=Ma(Y,m,u,E),u.elementType=a,u.type=w,u.lanes=R,u}function zs(a,u,m,w){return a=Ma(7,a,w,u),a.lanes=m,a}function Ih(a,u,m){return a=Ma(6,a,null,u),a.lanes=m,a}function Zc(a,u,m){return u=Ma(4,a.children!==null?a.children:[],a.key,u),u.lanes=m,u.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},u}var Gn=[],Mt=0,Po=null,gl=0,Aa=[],vn=0,ca=null,$a=1,ds="";function Io(a,u){Gn[Mt++]=gl,Gn[Mt++]=Po,Po=a,gl=u}function ko(a,u,m){Aa[vn++]=$a,Aa[vn++]=ds,Aa[vn++]=ca,ca=a;var w=$a;a=ds;var E=32-Ee(w)-1;w&=~(1<<E),m+=1;var R=32-Ee(u)+E;if(30<R){var Y=E-E%5;R=(w&(1<<Y)-1).toString(32),w>>=Y,E-=Y,$a=1<<32-Ee(u)+E|m<<E|w,ds=R+a}else $a=1<<R|m<<E|w,ds=a}function ac(a){a.return!==null&&(Io(a,1),ko(a,1,0))}function sc(a){for(;a===Po;)Po=Gn[--Mt],Gn[Mt]=null,gl=Gn[--Mt],Gn[Mt]=null;for(;a===ca;)ca=Aa[--vn],Aa[vn]=null,ds=Aa[--vn],Aa[vn]=null,$a=Aa[--vn],Aa[vn]=null}var ln=null,Zr=null,Wi=!1,yl=null,Ha=!1,$c=Error(Z(519));function _l(a){var u=Error(Z(418,""));throw Ys(zn(u,a)),$c}function Hc(a){var u=a.stateNode,m=a.type,w=a.memoizedProps;switch(u[Lt]=a,u[di]=w,m){case"dialog":$i("cancel",u),$i("close",u);break;case"iframe":case"object":case"embed":$i("load",u);break;case"video":case"audio":for(m=0;m<mh.length;m++)$i(mh[m],u);break;case"source":$i("error",u);break;case"img":case"image":case"link":$i("error",u),$i("load",u);break;case"details":$i("toggle",u);break;case"input":$i("invalid",u),$l(u,w.value,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name,!0),ql(u);break;case"select":$i("invalid",u);break;case"textarea":$i("invalid",u),Us(u,w.value,w.defaultValue,w.children),ql(u)}m=w.children,typeof m!="string"&&typeof m!="number"&&typeof m!="bigint"||u.textContent===""+m||w.suppressHydrationWarning===!0||cp(u.textContent,m)?(w.popover!=null&&($i("beforetoggle",u),$i("toggle",u)),w.onScroll!=null&&$i("scroll",u),w.onScrollEnd!=null&&$i("scrollend",u),w.onClick!=null&&(u.onclick=Da),u=!0):u=!1,u||_l(a)}function Or(a){for(ln=a.return;ln;)switch(ln.tag){case 5:case 13:Ha=!1;return;case 27:case 3:Ha=!0;return;default:ln=ln.return}}function ua(a){if(a!==ln)return!1;if(!Wi)return Or(a),Wi=!0,!1;var u=a.tag,m;if((m=u!==3&&u!==27)&&((m=u===5)&&(m=a.type,m=!(m!=="form"&&m!=="button")||co(a.type,a.memoizedProps)),m=!m),m&&Zr&&_l(a),Or(a),u===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Z(317));e:{for(a=a.nextSibling,u=0;a;){if(a.nodeType===8)if(m=a.data,m==="/$"){if(u===0){Zr=Yo(a.nextSibling);break e}u--}else m!=="$"&&m!=="$!"&&m!=="$?"||u++;a=a.nextSibling}Zr=null}}else u===27?(u=Zr,Cc(a.type)?(a=vh,vh=null,Zr=a):Zr=u):Zr=ln?Yo(a.stateNode.nextSibling):null;return!0}function qn(){Zr=ln=null,Wi=!1}function Xc(){var a=yl;return a!==null&&(Ja===null?Ja=a:Ja.push.apply(Ja,a),yl=null),a}function Ys(a){yl===null?yl=[a]:yl.push(a)}var Yc=rt(null),Ca=null,Ea=null;function Bn(a,u,m){mt(Yc,u._currentValue),u._currentValue=m}function Ps(a){a._currentValue=Yc.current,It(Yc)}function Wc(a,u,m){for(;a!==null;){var w=a.alternate;if((a.childLanes&u)!==u?(a.childLanes|=u,w!==null&&(w.childLanes|=u)):w!==null&&(w.childLanes&u)!==u&&(w.childLanes|=u),a===m)break;a=a.return}}function kh(a,u,m,w){var E=a.child;for(E!==null&&(E.return=a);E!==null;){var R=E.dependencies;if(R!==null){var Y=E.child;R=R.firstContext;e:for(;R!==null;){var te=R;R=E;for(var be=0;be<u.length;be++)if(te.context===u[be]){R.lanes|=m,te=R.alternate,te!==null&&(te.lanes|=m),Wc(R.return,m,a),w||(Y=null);break e}R=te.next}}else if(E.tag===18){if(Y=E.return,Y===null)throw Error(Z(341));Y.lanes|=m,R=Y.alternate,R!==null&&(R.lanes|=m),Wc(Y,m,a),Y=null}else Y=E.child;if(Y!==null)Y.return=E;else for(Y=E;Y!==null;){if(Y===a){Y=null;break}if(E=Y.sibling,E!==null){E.return=Y.return,Y=E;break}Y=Y.return}E=Y}}function Kc(a,u,m,w){a=null;for(var E=u,R=!1;E!==null;){if(!R){if((E.flags&524288)!==0)R=!0;else if((E.flags&262144)!==0)break}if(E.tag===10){var Y=E.alternate;if(Y===null)throw Error(Z(387));if(Y=Y.memoizedProps,Y!==null){var te=E.type;la(E.pendingProps.value,Y.value)||(a!==null?a.push(te):a=[te])}}else if(E===Di.current){if(Y=E.alternate,Y===null)throw Error(Z(387));Y.memoizedState.memoizedState!==E.memoizedState.memoizedState&&(a!==null?a.push(L):a=[L])}E=E.return}a!==null&&kh(u,a,m,w),u.flags|=262144}function Qc(a){for(a=a.firstContext;a!==null;){if(!la(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Ws(a){Ca=a,Ea=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Cr(a){return Qn(Ca,a)}function Ro(a,u){return Ca===null&&Ws(a),Qn(a,u)}function Qn(a,u){var m=u._currentValue;if(u={context:u,memoizedValue:m,next:null},Ea===null){if(a===null)throw Error(Z(308));Ea=u,a.dependencies={lanes:0,firstContext:u},a.flags|=524288}else Ea=Ea.next=u;return m}var Jc=typeof AbortController<"u"?AbortController:function(){var a=[],u=this.signal={aborted:!1,addEventListener:function(m,w){a.push(w)}};this.abort=function(){u.aborted=!0,a.forEach(function(m){return m()})}},_d=D.unstable_scheduleCallback,Ks=D.unstable_NormalPriority,vi={$$typeof:ot,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Is(){return{controller:new Jc,data:new Map,refCount:0}}function Do(a){a.refCount--,a.refCount===0&&_d(Ks,function(){a.controller.abort()})}var Qs=null,Uu=0,bn=0,Jn=null;function ha(a,u){if(Qs===null){var m=Qs=[];Uu=0,bn=Qh(),Jn={status:"pending",value:void 0,then:function(w){m.push(w)}}}return Uu++,u.then(da,da),u}function da(){if(--Uu===0&&Qs!==null){Jn!==null&&(Jn.status="fulfilled");var a=Qs;Qs=null,bn=0,Jn=null;for(var u=0;u<a.length;u++)(0,a[u])()}}function Ft(a,u){var m=[],w={status:"pending",value:null,reason:null,then:function(E){m.push(E)}};return a.then(function(){w.status="fulfilled",w.value=u;for(var E=0;E<m.length;E++)(0,m[E])(u)},function(E){for(w.status="rejected",w.reason=E,E=0;E<m.length;E++)(0,m[E])(void 0)}),w}var Qt=Qe.S;Qe.S=function(a,u){typeof u=="object"&&u!==null&&typeof u.then=="function"&&ha(a,u),Qt!==null&&Qt(a,u)};var za=rt(null);function Gu(){var a=za.current;return a!==null?a:Vr.pooledCache}function oc(a,u){u===null?mt(za,za.current):mt(za,u.pool)}function Pn(){var a=Gu();return a===null?null:{parent:vi._currentValue,pool:a}}var Js=Error(Z(460)),cn=Error(Z(474)),At=Error(Z(542)),Lo={then:function(){}};function Er(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Fr(){}function xl(a,u,m){switch(m=a[m],m===void 0?a.push(u):m!==u&&(u.then(Fr,Fr),u=m),u.status){case"fulfilled":return u.value;case"rejected":throw a=u.reason,ki(a),a;default:if(typeof u.status=="string")u.then(Fr,Fr);else{if(a=Vr,a!==null&&100<a.shellSuspendCounter)throw Error(Z(482));a=u,a.status="pending",a.then(function(w){if(u.status==="pending"){var E=u;E.status="fulfilled",E.value=w}},function(w){if(u.status==="pending"){var E=u;E.status="rejected",E.reason=w}})}switch(u.status){case"fulfilled":return u.value;case"rejected":throw a=u.reason,ki(a),a}throw fa=u,Js}}var fa=null;function lc(){if(fa===null)throw Error(Z(459));var a=fa;return fa=null,a}function ki(a){if(a===Js||a===At)throw Error(Z(483))}var Xa=!1;function qu(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function eo(a,u){a=a.updateQueue,u.updateQueue===a&&(u.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function to(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function ks(a,u,m){var w=a.updateQueue;if(w===null)return null;if(w=w.shared,(Tr&2)!==0){var E=w.pending;return E===null?u.next=u:(u.next=E.next,E.next=u),w.pending=u,u=nc(a),Za(a,null,m),u}return ml(a,w,u,m),nc(a)}function Bo(a,u,m){if(u=u.updateQueue,u!==null&&(u=u.shared,(m&4194048)!==0)){var w=u.lanes;w&=a.pendingLanes,m|=w,u.lanes=m,$t(a,m)}}function cc(a,u){var m=a.updateQueue,w=a.alternate;if(w!==null&&(w=w.updateQueue,m===w)){var E=null,R=null;if(m=m.firstBaseUpdate,m!==null){do{var Y={lane:m.lane,tag:m.tag,payload:m.payload,callback:null,next:null};R===null?E=R=Y:R=R.next=Y,m=m.next}while(m!==null);R===null?E=R=u:R=R.next=u}else E=R=u;m={baseState:w.baseState,firstBaseUpdate:E,lastBaseUpdate:R,shared:w.shared,callbacks:w.callbacks},a.updateQueue=m;return}a=m.lastBaseUpdate,a===null?m.firstBaseUpdate=u:a.next=u,m.lastBaseUpdate=u}var eu=!1;function vl(){if(eu){var a=Jn;if(a!==null)throw a}}function bl(a,u,m,w){eu=!1;var E=a.updateQueue;Xa=!1;var R=E.firstBaseUpdate,Y=E.lastBaseUpdate,te=E.shared.pending;if(te!==null){E.shared.pending=null;var be=te,Ge=be.next;be.next=null,Y===null?R=Ge:Y.next=Ge,Y=be;var nt=a.alternate;nt!==null&&(nt=nt.updateQueue,te=nt.lastBaseUpdate,te!==Y&&(te===null?nt.firstBaseUpdate=Ge:te.next=Ge,nt.lastBaseUpdate=be))}if(R!==null){var lt=E.baseState;Y=0,nt=Ge=be=null,te=R;do{var Xe=te.lane&-536870913,Ke=Xe!==te.lane;if(Ke?(Oi&Xe)===Xe:(w&Xe)===Xe){Xe!==0&&Xe===bn&&(eu=!0),nt!==null&&(nt=nt.next={lane:0,tag:te.tag,payload:te.payload,callback:null,next:null});e:{var _i=a,fi=te;Xe=u;var Mr=m;switch(fi.tag){case 1:if(_i=fi.payload,typeof _i=="function"){lt=_i.call(Mr,lt,Xe);break e}lt=_i;break e;case 3:_i.flags=_i.flags&-65537|128;case 0:if(_i=fi.payload,Xe=typeof _i=="function"?_i.call(Mr,lt,Xe):_i,Xe==null)break e;lt=Ce({},lt,Xe);break e;case 2:Xa=!0}}Xe=te.callback,Xe!==null&&(a.flags|=64,Ke&&(a.flags|=8192),Ke=E.callbacks,Ke===null?E.callbacks=[Xe]:Ke.push(Xe))}else Ke={lane:Xe,tag:te.tag,payload:te.payload,callback:te.callback,next:null},nt===null?(Ge=nt=Ke,be=lt):nt=nt.next=Ke,Y|=Xe;if(te=te.next,te===null){if(te=E.shared.pending,te===null)break;Ke=te,te=Ke.next,Ke.next=null,E.lastBaseUpdate=Ke,E.shared.pending=null}}while(!0);nt===null&&(be=lt),E.baseState=be,E.firstBaseUpdate=Ge,E.lastBaseUpdate=nt,R===null&&(E.shared.lanes=0),$o|=Y,a.lanes=Y,a.memoizedState=lt}}function Zu(a,u){if(typeof a!="function")throw Error(Z(191,a));a.call(u)}function $u(a,u){var m=a.callbacks;if(m!==null)for(a.callbacks=null,a=0;a<m.length;a++)Zu(m[a],u)}var On=rt(null),rr=rt(0);function io(a,u){a=xc,mt(rr,a),mt(On,u),xc=a|u.baseLanes}function uc(){mt(rr,xc),mt(On,On.current)}function tu(){xc=rr.current,It(On),It(rr)}var fs=0,zi=null,cr=null,pr=null,wl=!1,Ot=!1,Ht=!1,Sl=0,Ya=0,ro=null,ea=0;function tn(){throw Error(Z(321))}function pa(a,u){if(u===null)return!1;for(var m=0;m<u.length&&m<a.length;m++)if(!la(a[m],u[m]))return!1;return!0}function Rh(a,u,m,w,E,R){return fs=R,zi=u,u.memoizedState=null,u.updateQueue=null,u.lanes=0,Qe.H=a===null||a.memoizedState===null?_s:ra,Ht=!1,R=m(w,E),Ht=!1,Ot&&(R=mr(u,m,w,E)),hc(a),R}function hc(a){Qe.H=Fn;var u=cr!==null&&cr.next!==null;if(fs=0,pr=cr=zi=null,wl=!1,Ya=0,ro=null,u)throw Error(Z(300));a===null||yn||(a=a.dependencies,a!==null&&Qc(a)&&(yn=!0))}function mr(a,u,m,w){zi=a;var E=0;do{if(Ot&&(ro=null),Ya=0,Ot=!1,25<=E)throw Error(Z(301));if(E+=1,pr=cr=null,a.updateQueue!=null){var R=a.updateQueue;R.lastEffect=null,R.events=null,R.stores=null,R.memoCache!=null&&(R.memoCache.index=0)}Qe.H=No,R=u(m,w)}while(Ot);return R}function un(){var a=Qe.H,u=a.useState()[0];return u=typeof u.then=="function"?Fo(u):u,a=a.useState()[0],(cr!==null?cr.memoizedState:null)!==a&&(zi.flags|=1024),u}function iu(){var a=Sl!==0;return Sl=0,a}function Tl(a,u,m){u.updateQueue=a.updateQueue,u.flags&=-2053,a.lanes&=~m}function Ml(a){if(wl){for(a=a.memoizedState;a!==null;){var u=a.queue;u!==null&&(u.pending=null),a=a.next}wl=!1}fs=0,pr=cr=zi=null,Ot=!1,Ya=Sl=0,ro=null}function ta(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pr===null?zi.memoizedState=pr=a:pr=pr.next=a,pr}function gr(){if(cr===null){var a=zi.alternate;a=a!==null?a.memoizedState:null}else a=cr.next;var u=pr===null?zi.memoizedState:pr.next;if(u!==null)pr=u,cr=a;else{if(a===null)throw zi.alternate===null?Error(Z(467)):Error(Z(310));cr=a,a={memoizedState:cr.memoizedState,baseState:cr.baseState,baseQueue:cr.baseQueue,queue:cr.queue,next:null},pr===null?zi.memoizedState=pr=a:pr=pr.next=a}return pr}function Oo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Fo(a){var u=Ya;return Ya+=1,ro===null&&(ro=[]),a=xl(ro,a,u),u=zi,(pr===null?u.memoizedState:pr.next)===null&&(u=u.alternate,Qe.H=u===null||u.memoizedState===null?_s:ra),a}function dc(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Fo(a);if(a.$$typeof===ot)return Cr(a)}throw Error(Z(438,String(a)))}function no(a){var u=null,m=zi.updateQueue;if(m!==null&&(u=m.memoCache),u==null){var w=zi.alternate;w!==null&&(w=w.updateQueue,w!==null&&(w=w.memoCache,w!=null&&(u={data:w.data.map(function(E){return E.slice()}),index:0})))}if(u==null&&(u={data:[],index:0}),m===null&&(m=Oo(),zi.updateQueue=m),m.memoCache=u,m=u.data[u.index],m===void 0)for(m=u.data[u.index]=Array(a),w=0;w<a;w++)m[w]=Pi;return u.index++,m}function Rs(a,u){return typeof u=="function"?u(a):u}function ao(a){var u=gr();return Al(u,cr,a)}function Al(a,u,m){var w=a.queue;if(w===null)throw Error(Z(311));w.lastRenderedReducer=m;var E=a.baseQueue,R=w.pending;if(R!==null){if(E!==null){var Y=E.next;E.next=R.next,R.next=Y}u.baseQueue=E=R,w.pending=null}if(R=a.baseState,E===null)a.memoizedState=R;else{u=E.next;var te=Y=null,be=null,Ge=u,nt=!1;do{var lt=Ge.lane&-536870913;if(lt!==Ge.lane?(Oi&lt)===lt:(fs&lt)===lt){var Xe=Ge.revertLane;if(Xe===0)be!==null&&(be=be.next={lane:0,revertLane:0,action:Ge.action,hasEagerState:Ge.hasEagerState,eagerState:Ge.eagerState,next:null}),lt===bn&&(nt=!0);else if((fs&Xe)===Xe){Ge=Ge.next,Xe===bn&&(nt=!0);continue}else lt={lane:0,revertLane:Ge.revertLane,action:Ge.action,hasEagerState:Ge.hasEagerState,eagerState:Ge.eagerState,next:null},be===null?(te=be=lt,Y=R):be=be.next=lt,zi.lanes|=Xe,$o|=Xe;lt=Ge.action,Ht&&m(R,lt),R=Ge.hasEagerState?Ge.eagerState:m(R,lt)}else Xe={lane:lt,revertLane:Ge.revertLane,action:Ge.action,hasEagerState:Ge.hasEagerState,eagerState:Ge.eagerState,next:null},be===null?(te=be=Xe,Y=R):be=be.next=Xe,zi.lanes|=lt,$o|=lt;Ge=Ge.next}while(Ge!==null&&Ge!==u);if(be===null?Y=R:be.next=te,!la(R,a.memoizedState)&&(yn=!0,nt&&(m=Jn,m!==null)))throw m;a.memoizedState=R,a.baseState=Y,a.baseQueue=be,w.lastRenderedState=R}return E===null&&(w.lanes=0),[a.memoizedState,w.dispatch]}function Hu(a){var u=gr(),m=u.queue;if(m===null)throw Error(Z(311));m.lastRenderedReducer=a;var w=m.dispatch,E=m.pending,R=u.memoizedState;if(E!==null){m.pending=null;var Y=E=E.next;do R=a(R,Y.action),Y=Y.next;while(Y!==E);la(R,u.memoizedState)||(yn=!0),u.memoizedState=R,u.baseQueue===null&&(u.baseState=R),m.lastRenderedState=R}return[R,w]}function b(a,u,m){var w=zi,E=gr(),R=Wi;if(R){if(m===void 0)throw Error(Z(407));m=m()}else m=u();var Y=!la((cr||E).memoizedState,m);Y&&(E.memoizedState=m,yn=!0),E=E.queue;var te=f.bind(null,w,E,a);if(ze(2048,8,te,[a]),E.getSnapshot!==u||Y||pr!==null&&pr.memoizedState.tag&1){if(w.flags|=2048,de(9,xe(),c.bind(null,w,E,m,u),null),Vr===null)throw Error(Z(349));R||(fs&124)!==0||t(w,u,m)}return m}function t(a,u,m){a.flags|=16384,a={getSnapshot:u,value:m},u=zi.updateQueue,u===null?(u=Oo(),zi.updateQueue=u,u.stores=[a]):(m=u.stores,m===null?u.stores=[a]:m.push(a))}function c(a,u,m,w){u.value=m,u.getSnapshot=w,x(u)&&S(a)}function f(a,u,m){return m(function(){x(u)&&S(a)})}function x(a){var u=a.getSnapshot;a=a.value;try{var m=u();return!la(a,m)}catch{return!0}}function S(a){var u=qr(a,2);u!==null&&Bs(u,a,2)}function C(a){var u=ta();if(typeof a=="function"){var m=a;if(a=m(),Ht){ba(!0);try{m()}finally{ba(!1)}}}return u.memoizedState=u.baseState=a,u.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rs,lastRenderedState:a},u}function P(a,u,m,w){return a.baseState=m,Al(a,cr,typeof w=="function"?w:Rs)}function k(a,u,m,w,E){if(ys(a))throw Error(Z(485));if(a=u.action,a!==null){var R={payload:E,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Y){R.listeners.push(Y)}};Qe.T!==null?m(!0):R.isTransition=!1,w(R),m=u.pending,m===null?(R.next=u.pending=R,O(u,R)):(R.next=m.next,u.pending=m.next=R)}}function O(a,u){var m=u.action,w=u.payload,E=a.state;if(u.isTransition){var R=Qe.T,Y={};Qe.T=Y;try{var te=m(E,w),be=Qe.S;be!==null&&be(Y,te),N(a,u,te)}catch(Ge){V(a,u,Ge)}finally{Qe.T=R}}else try{R=m(E,w),N(a,u,R)}catch(Ge){V(a,u,Ge)}}function N(a,u,m){m!==null&&typeof m=="object"&&typeof m.then=="function"?m.then(function(w){U(a,u,w)},function(w){return V(a,u,w)}):U(a,u,m)}function U(a,u,m){u.status="fulfilled",u.value=m,$(u),a.state=m,u=a.pending,u!==null&&(m=u.next,m===u?a.pending=null:(m=m.next,u.next=m,O(a,m)))}function V(a,u,m){var w=a.pending;if(a.pending=null,w!==null){w=w.next;do u.status="rejected",u.reason=m,$(u),u=u.next;while(u!==w)}a.action=null}function $(a){a=a.listeners;for(var u=0;u<a.length;u++)(0,a[u])()}function W(a,u){return u}function ae(a,u){if(Wi){var m=Vr.formState;if(m!==null){e:{var w=zi;if(Wi){if(Zr){t:{for(var E=Zr,R=Ha;E.nodeType!==8;){if(!R){E=null;break t}if(E=Yo(E.nextSibling),E===null){E=null;break t}}R=E.data,E=R==="F!"||R==="F"?E:null}if(E){Zr=Yo(E.nextSibling),w=E.data==="F!";break e}}_l(w)}w=!1}w&&(u=m[0])}}return m=ta(),m.memoizedState=m.baseState=u,w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:W,lastRenderedState:u},m.queue=w,m=Pa.bind(null,zi,w),w.dispatch=m,w=C(!1),R=gs.bind(null,zi,!1,w.queue),w=ta(),E={state:u,dispatch:null,action:a,pending:null},w.queue=E,m=k.bind(null,zi,E,R,m),E.dispatch=m,w.memoizedState=a,[u,m,!1]}function ne(a){var u=gr();return oe(u,cr,a)}function oe(a,u,m){if(u=Al(a,u,W)[0],a=ao(Rs)[0],typeof u=="object"&&u!==null&&typeof u.then=="function")try{var w=Fo(u)}catch(Y){throw Y===Js?At:Y}else w=u;u=gr();var E=u.queue,R=E.dispatch;return m!==u.memoizedState&&(zi.flags|=2048,de(9,xe(),he.bind(null,E,m),null)),[w,R,a]}function he(a,u){a.action=u}function ge(a){var u=gr(),m=cr;if(m!==null)return oe(u,m,a);gr(),u=u.memoizedState,m=gr();var w=m.queue.dispatch;return m.memoizedState=a,[u,w,!1]}function de(a,u,m,w){return a={tag:a,create:m,deps:w,inst:u,next:null},u=zi.updateQueue,u===null&&(u=Oo(),zi.updateQueue=u),m=u.lastEffect,m===null?u.lastEffect=a.next=a:(w=m.next,m.next=a,a.next=w,u.lastEffect=a),a}function xe(){return{destroy:void 0,resource:void 0}}function Me(){return gr().memoizedState}function fe(a,u,m,w){var E=ta();w=w===void 0?null:w,zi.flags|=a,E.memoizedState=de(1|u,xe(),m,w)}function ze(a,u,m,w){var E=gr();w=w===void 0?null:w;var R=E.memoizedState.inst;cr!==null&&w!==null&&pa(w,cr.memoizedState.deps)?E.memoizedState=de(u,R,m,w):(zi.flags|=a,E.memoizedState=de(1|u,R,m,w))}function Ve(a,u){fe(8390656,8,a,u)}function Ne(a,u){ze(2048,8,a,u)}function Fe(a,u){return ze(4,2,a,u)}function He(a,u){return ze(4,4,a,u)}function gt(a,u){if(typeof u=="function"){a=a();var m=u(a);return function(){typeof m=="function"?m():u(null)}}if(u!=null)return a=a(),u.current=a,function(){u.current=null}}function yt(a,u,m){m=m!=null?m.concat([a]):null,ze(4,4,gt.bind(null,u,a),m)}function st(){}function Bt(a,u){var m=gr();u=u===void 0?null:u;var w=m.memoizedState;return u!==null&&pa(u,w[1])?w[0]:(m.memoizedState=[a,u],a)}function oi(a,u){var m=gr();u=u===void 0?null:u;var w=m.memoizedState;if(u!==null&&pa(u,w[1]))return w[0];if(w=a(),Ht){ba(!0);try{a()}finally{ba(!1)}}return m.memoizedState=[w,u],w}function Gi(a,u,m){return m===void 0||(fs&1073741824)!==0?a.memoizedState=u:(a.memoizedState=m,a=Xf(),zi.lanes|=a,$o|=a,m)}function yr(a,u,m,w){return la(m,u)?m:On.current!==null?(a=Gi(a,m,w),la(a,u)||(yn=!0),a):(fs&42)===0?(yn=!0,a.memoizedState=m):(a=Xf(),zi.lanes|=a,$o|=a,u)}function nr(a,u,m,w,E){var R=bt.p;bt.p=R!==0&&8>R?R:8;var Y=Qe.T,te={};Qe.T=te,gs(a,!1,u,m);try{var be=E(),Ge=Qe.S;if(Ge!==null&&Ge(te,be),be!==null&&typeof be=="object"&&typeof be.then=="function"){var nt=Ft(be,w);ms(a,u,nt,_a(a))}else ms(a,u,w,_a(a))}catch(lt){ms(a,u,{then:function(){},status:"rejected",reason:lt},_a())}finally{bt.p=R,Qe.T=Y}}function $r(){}function jr(a,u,m,w){if(a.tag!==5)throw Error(Z(476));var E=mi(a).queue;nr(a,E,u,Be,m===null?$r:function(){return _r(a),m(w)})}function mi(a){var u=a.memoizedState;if(u!==null)return u;u={memoizedState:Be,baseState:Be,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rs,lastRenderedState:Be},next:null};var m={};return u.next={memoizedState:m,baseState:m,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rs,lastRenderedState:m},next:null},a.memoizedState=u,a=a.alternate,a!==null&&(a.memoizedState=u),u}function _r(a){var u=mi(a).next.queue;ms(a,u,{},_a())}function Hr(){return Cr(L)}function wn(){return gr().memoizedState}function gn(){return gr().memoizedState}function ia(a){for(var u=a.return;u!==null;){switch(u.tag){case 24:case 3:var m=_a();a=to(m);var w=ks(u,a,m);w!==null&&(Bs(w,u,m),Bo(w,u,m)),u={cache:Is()},a.payload=u;return}u=u.return}}function ps(a,u,m){var w=_a();m={lane:w,revertLane:0,action:m,hasEagerState:!1,eagerState:null,next:null},ys(a)?Ds(u,m):(m=zo(a,u,m,w),m!==null&&(Bs(m,a,w),jo(m,u,w)))}function Pa(a,u,m){var w=_a();ms(a,u,m,w)}function ms(a,u,m,w){var E={lane:w,revertLane:0,action:m,hasEagerState:!1,eagerState:null,next:null};if(ys(a))Ds(u,E);else{var R=a.alternate;if(a.lanes===0&&(R===null||R.lanes===0)&&(R=u.lastRenderedReducer,R!==null))try{var Y=u.lastRenderedState,te=R(Y,m);if(E.hasEagerState=!0,E.eagerState=te,la(te,Y))return ml(a,u,E,0),Vr===null&&pl(),!1}catch{}finally{}if(m=zo(a,u,E,w),m!==null)return Bs(m,a,w),jo(m,u,w),!0}return!1}function gs(a,u,m,w){if(w={lane:2,revertLane:Qh(),action:w,hasEagerState:!1,eagerState:null,next:null},ys(a)){if(u)throw Error(Z(479))}else u=zo(a,m,w,2),u!==null&&Bs(u,a,2)}function ys(a){var u=a.alternate;return a===zi||u!==null&&u===zi}function Ds(a,u){Ot=wl=!0;var m=a.pending;m===null?u.next=u:(u.next=m.next,m.next=u),a.pending=u}function jo(a,u,m){if((m&4194048)!==0){var w=u.lanes;w&=a.pendingLanes,m|=w,u.lanes=m,$t(a,m)}}var Fn={readContext:Cr,use:dc,useCallback:tn,useContext:tn,useEffect:tn,useImperativeHandle:tn,useLayoutEffect:tn,useInsertionEffect:tn,useMemo:tn,useReducer:tn,useRef:tn,useState:tn,useDebugValue:tn,useDeferredValue:tn,useTransition:tn,useSyncExternalStore:tn,useId:tn,useHostTransitionStatus:tn,useFormState:tn,useActionState:tn,useOptimistic:tn,useMemoCache:tn,useCacheRefresh:tn},_s={readContext:Cr,use:dc,useCallback:function(a,u){return ta().memoizedState=[a,u===void 0?null:u],a},useContext:Cr,useEffect:Ve,useImperativeHandle:function(a,u,m){m=m!=null?m.concat([a]):null,fe(4194308,4,gt.bind(null,u,a),m)},useLayoutEffect:function(a,u){return fe(4194308,4,a,u)},useInsertionEffect:function(a,u){fe(4,2,a,u)},useMemo:function(a,u){var m=ta();u=u===void 0?null:u;var w=a();if(Ht){ba(!0);try{a()}finally{ba(!1)}}return m.memoizedState=[w,u],w},useReducer:function(a,u,m){var w=ta();if(m!==void 0){var E=m(u);if(Ht){ba(!0);try{m(u)}finally{ba(!1)}}}else E=u;return w.memoizedState=w.baseState=E,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:E},w.queue=a,a=a.dispatch=ps.bind(null,zi,a),[w.memoizedState,a]},useRef:function(a){var u=ta();return a={current:a},u.memoizedState=a},useState:function(a){a=C(a);var u=a.queue,m=Pa.bind(null,zi,u);return u.dispatch=m,[a.memoizedState,m]},useDebugValue:st,useDeferredValue:function(a,u){var m=ta();return Gi(m,a,u)},useTransition:function(){var a=C(!1);return a=nr.bind(null,zi,a.queue,!0,!1),ta().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,u,m){var w=zi,E=ta();if(Wi){if(m===void 0)throw Error(Z(407));m=m()}else{if(m=u(),Vr===null)throw Error(Z(349));(Oi&124)!==0||t(w,u,m)}E.memoizedState=m;var R={value:m,getSnapshot:u};return E.queue=R,Ve(f.bind(null,w,R,a),[a]),w.flags|=2048,de(9,xe(),c.bind(null,w,R,m,u),null),m},useId:function(){var a=ta(),u=Vr.identifierPrefix;if(Wi){var m=ds,w=$a;m=(w&~(1<<32-Ee(w)-1)).toString(32)+m,u=""+u+"R"+m,m=Sl++,0<m&&(u+="H"+m.toString(32)),u+=""}else m=ea++,u=""+u+"r"+m.toString(32)+"";return a.memoizedState=u},useHostTransitionStatus:Hr,useFormState:ae,useActionState:ae,useOptimistic:function(a){var u=ta();u.memoizedState=u.baseState=a;var m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return u.queue=m,u=gs.bind(null,zi,!0,m),m.dispatch=u,[a,u]},useMemoCache:no,useCacheRefresh:function(){return ta().memoizedState=ia.bind(null,zi)}},ra={readContext:Cr,use:dc,useCallback:Bt,useContext:Cr,useEffect:Ne,useImperativeHandle:yt,useInsertionEffect:Fe,useLayoutEffect:He,useMemo:oi,useReducer:ao,useRef:Me,useState:function(){return ao(Rs)},useDebugValue:st,useDeferredValue:function(a,u){var m=gr();return yr(m,cr.memoizedState,a,u)},useTransition:function(){var a=ao(Rs)[0],u=gr().memoizedState;return[typeof a=="boolean"?a:Fo(a),u]},useSyncExternalStore:b,useId:wn,useHostTransitionStatus:Hr,useFormState:ne,useActionState:ne,useOptimistic:function(a,u){var m=gr();return P(m,cr,a,u)},useMemoCache:no,useCacheRefresh:gn},No={readContext:Cr,use:dc,useCallback:Bt,useContext:Cr,useEffect:Ne,useImperativeHandle:yt,useInsertionEffect:Fe,useLayoutEffect:He,useMemo:oi,useReducer:Hu,useRef:Me,useState:function(){return Hu(Rs)},useDebugValue:st,useDeferredValue:function(a,u){var m=gr();return cr===null?Gi(m,a,u):yr(m,cr.memoizedState,a,u)},useTransition:function(){var a=Hu(Rs)[0],u=gr().memoizedState;return[typeof a=="boolean"?a:Fo(a),u]},useSyncExternalStore:b,useId:wn,useHostTransitionStatus:Hr,useFormState:ge,useActionState:ge,useOptimistic:function(a,u){var m=gr();return cr!==null?P(m,cr,a,u):(m.baseState=a,[a,m.queue.dispatch])},useMemoCache:no,useCacheRefresh:gn},Dr=null,Xr=0;function ma(a){var u=Xr;return Xr+=1,Dr===null&&(Dr=[]),xl(Dr,a,u)}function Lr(a,u){u=u.props.ref,a.ref=u!==void 0?u:null}function Vo(a,u){throw u.$$typeof===Ze?Error(Z(525)):(a=Object.prototype.toString.call(u),Error(Z(31,a==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":a)))}function Uo(a){var u=a._init;return u(a._payload)}function Ia(a){function u(Oe,Ie){if(a){var qe=Oe.deletions;qe===null?(Oe.deletions=[Ie],Oe.flags|=16):qe.push(Ie)}}function m(Oe,Ie){if(!a)return null;for(;Ie!==null;)u(Oe,Ie),Ie=Ie.sibling;return null}function w(Oe){for(var Ie=new Map;Oe!==null;)Oe.key!==null?Ie.set(Oe.key,Oe):Ie.set(Oe.index,Oe),Oe=Oe.sibling;return Ie}function E(Oe,Ie){return Oe=Kn(Oe,Ie),Oe.index=0,Oe.sibling=null,Oe}function R(Oe,Ie,qe){return Oe.index=qe,a?(qe=Oe.alternate,qe!==null?(qe=qe.index,qe<Ie?(Oe.flags|=67108866,Ie):qe):(Oe.flags|=67108866,Ie)):(Oe.flags|=1048576,Ie)}function Y(Oe){return a&&Oe.alternate===null&&(Oe.flags|=67108866),Oe}function te(Oe,Ie,qe,ct){return Ie===null||Ie.tag!==6?(Ie=Ih(qe,Oe.mode,ct),Ie.return=Oe,Ie):(Ie=E(Ie,qe),Ie.return=Oe,Ie)}function be(Oe,Ie,qe,ct){var Xt=qe.type;return Xt===wt?nt(Oe,Ie,qe.props.children,ct,qe.key):Ie!==null&&(Ie.elementType===Xt||typeof Xt=="object"&&Xt!==null&&Xt.$$typeof===zt&&Uo(Xt)===Ie.type)?(Ie=E(Ie,qe.props),Lr(Ie,qe),Ie.return=Oe,Ie):(Ie=Vu(qe.type,qe.key,qe.props,null,Oe.mode,ct),Lr(Ie,qe),Ie.return=Oe,Ie)}function Ge(Oe,Ie,qe,ct){return Ie===null||Ie.tag!==4||Ie.stateNode.containerInfo!==qe.containerInfo||Ie.stateNode.implementation!==qe.implementation?(Ie=Zc(qe,Oe.mode,ct),Ie.return=Oe,Ie):(Ie=E(Ie,qe.children||[]),Ie.return=Oe,Ie)}function nt(Oe,Ie,qe,ct,Xt){return Ie===null||Ie.tag!==7?(Ie=zs(qe,Oe.mode,ct,Xt),Ie.return=Oe,Ie):(Ie=E(Ie,qe),Ie.return=Oe,Ie)}function lt(Oe,Ie,qe){if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint")return Ie=Ih(""+Ie,Oe.mode,qe),Ie.return=Oe,Ie;if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case Le:return qe=Vu(Ie.type,Ie.key,Ie.props,null,Oe.mode,qe),Lr(qe,Ie),qe.return=Oe,qe;case Se:return Ie=Zc(Ie,Oe.mode,qe),Ie.return=Oe,Ie;case zt:var ct=Ie._init;return Ie=ct(Ie._payload),lt(Oe,Ie,qe)}if(Ri(Ie)||Ji(Ie))return Ie=zs(Ie,Oe.mode,qe,null),Ie.return=Oe,Ie;if(typeof Ie.then=="function")return lt(Oe,ma(Ie),qe);if(Ie.$$typeof===ot)return lt(Oe,Ro(Oe,Ie),qe);Vo(Oe,Ie)}return null}function Xe(Oe,Ie,qe,ct){var Xt=Ie!==null?Ie.key:null;if(typeof qe=="string"&&qe!==""||typeof qe=="number"||typeof qe=="bigint")return Xt!==null?null:te(Oe,Ie,""+qe,ct);if(typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case Le:return qe.key===Xt?be(Oe,Ie,qe,ct):null;case Se:return qe.key===Xt?Ge(Oe,Ie,qe,ct):null;case zt:return Xt=qe._init,qe=Xt(qe._payload),Xe(Oe,Ie,qe,ct)}if(Ri(qe)||Ji(qe))return Xt!==null?null:nt(Oe,Ie,qe,ct,null);if(typeof qe.then=="function")return Xe(Oe,Ie,ma(qe),ct);if(qe.$$typeof===ot)return Xe(Oe,Ie,Ro(Oe,qe),ct);Vo(Oe,qe)}return null}function Ke(Oe,Ie,qe,ct,Xt){if(typeof ct=="string"&&ct!==""||typeof ct=="number"||typeof ct=="bigint")return Oe=Oe.get(qe)||null,te(Ie,Oe,""+ct,Xt);if(typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case Le:return Oe=Oe.get(ct.key===null?qe:ct.key)||null,be(Ie,Oe,ct,Xt);case Se:return Oe=Oe.get(ct.key===null?qe:ct.key)||null,Ge(Ie,Oe,ct,Xt);case zt:var Zi=ct._init;return ct=Zi(ct._payload),Ke(Oe,Ie,qe,ct,Xt)}if(Ri(ct)||Ji(ct))return Oe=Oe.get(qe)||null,nt(Ie,Oe,ct,Xt,null);if(typeof ct.then=="function")return Ke(Oe,Ie,qe,ma(ct),Xt);if(ct.$$typeof===ot)return Ke(Oe,Ie,qe,Ro(Ie,ct),Xt);Vo(Ie,ct)}return null}function _i(Oe,Ie,qe,ct){for(var Xt=null,Zi=null,qt=Ie,ci=Ie=0,$n=null;qt!==null&&ci<qe.length;ci++){qt.index>ci?($n=qt,qt=null):$n=qt.sibling;var vr=Xe(Oe,qt,qe[ci],ct);if(vr===null){qt===null&&(qt=$n);break}a&&qt&&vr.alternate===null&&u(Oe,qt),Ie=R(vr,Ie,ci),Zi===null?Xt=vr:Zi.sibling=vr,Zi=vr,qt=$n}if(ci===qe.length)return m(Oe,qt),Wi&&Io(Oe,ci),Xt;if(qt===null){for(;ci<qe.length;ci++)qt=lt(Oe,qe[ci],ct),qt!==null&&(Ie=R(qt,Ie,ci),Zi===null?Xt=qt:Zi.sibling=qt,Zi=qt);return Wi&&Io(Oe,ci),Xt}for(qt=w(qt);ci<qe.length;ci++)$n=Ke(qt,Oe,ci,qe[ci],ct),$n!==null&&(a&&$n.alternate!==null&&qt.delete($n.key===null?ci:$n.key),Ie=R($n,Ie,ci),Zi===null?Xt=$n:Zi.sibling=$n,Zi=$n);return a&&qt.forEach(function(bu){return u(Oe,bu)}),Wi&&Io(Oe,ci),Xt}function fi(Oe,Ie,qe,ct){if(qe==null)throw Error(Z(151));for(var Xt=null,Zi=null,qt=Ie,ci=Ie=0,$n=null,vr=qe.next();qt!==null&&!vr.done;ci++,vr=qe.next()){qt.index>ci?($n=qt,qt=null):$n=qt.sibling;var bu=Xe(Oe,qt,vr.value,ct);if(bu===null){qt===null&&(qt=$n);break}a&&qt&&bu.alternate===null&&u(Oe,qt),Ie=R(bu,Ie,ci),Zi===null?Xt=bu:Zi.sibling=bu,Zi=bu,qt=$n}if(vr.done)return m(Oe,qt),Wi&&Io(Oe,ci),Xt;if(qt===null){for(;!vr.done;ci++,vr=qe.next())vr=lt(Oe,vr.value,ct),vr!==null&&(Ie=R(vr,Ie,ci),Zi===null?Xt=vr:Zi.sibling=vr,Zi=vr);return Wi&&Io(Oe,ci),Xt}for(qt=w(qt);!vr.done;ci++,vr=qe.next())vr=Ke(qt,Oe,ci,vr.value,ct),vr!==null&&(a&&vr.alternate!==null&&qt.delete(vr.key===null?ci:vr.key),Ie=R(vr,Ie,ci),Zi===null?Xt=vr:Zi.sibling=vr,Zi=vr);return a&&qt.forEach(function($p){return u(Oe,$p)}),Wi&&Io(Oe,ci),Xt}function Mr(Oe,Ie,qe,ct){if(typeof qe=="object"&&qe!==null&&qe.type===wt&&qe.key===null&&(qe=qe.props.children),typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case Le:e:{for(var Xt=qe.key;Ie!==null;){if(Ie.key===Xt){if(Xt=qe.type,Xt===wt){if(Ie.tag===7){m(Oe,Ie.sibling),ct=E(Ie,qe.props.children),ct.return=Oe,Oe=ct;break e}}else if(Ie.elementType===Xt||typeof Xt=="object"&&Xt!==null&&Xt.$$typeof===zt&&Uo(Xt)===Ie.type){m(Oe,Ie.sibling),ct=E(Ie,qe.props),Lr(ct,qe),ct.return=Oe,Oe=ct;break e}m(Oe,Ie);break}else u(Oe,Ie);Ie=Ie.sibling}qe.type===wt?(ct=zs(qe.props.children,Oe.mode,ct,qe.key),ct.return=Oe,Oe=ct):(ct=Vu(qe.type,qe.key,qe.props,null,Oe.mode,ct),Lr(ct,qe),ct.return=Oe,Oe=ct)}return Y(Oe);case Se:e:{for(Xt=qe.key;Ie!==null;){if(Ie.key===Xt)if(Ie.tag===4&&Ie.stateNode.containerInfo===qe.containerInfo&&Ie.stateNode.implementation===qe.implementation){m(Oe,Ie.sibling),ct=E(Ie,qe.children||[]),ct.return=Oe,Oe=ct;break e}else{m(Oe,Ie);break}else u(Oe,Ie);Ie=Ie.sibling}ct=Zc(qe,Oe.mode,ct),ct.return=Oe,Oe=ct}return Y(Oe);case zt:return Xt=qe._init,qe=Xt(qe._payload),Mr(Oe,Ie,qe,ct)}if(Ri(qe))return _i(Oe,Ie,qe,ct);if(Ji(qe)){if(Xt=Ji(qe),typeof Xt!="function")throw Error(Z(150));return qe=Xt.call(qe),fi(Oe,Ie,qe,ct)}if(typeof qe.then=="function")return Mr(Oe,Ie,ma(qe),ct);if(qe.$$typeof===ot)return Mr(Oe,Ie,Ro(Oe,qe),ct);Vo(Oe,qe)}return typeof qe=="string"&&qe!==""||typeof qe=="number"||typeof qe=="bigint"?(qe=""+qe,Ie!==null&&Ie.tag===6?(m(Oe,Ie.sibling),ct=E(Ie,qe),ct.return=Oe,Oe=ct):(m(Oe,Ie),ct=Ih(qe,Oe.mode,ct),ct.return=Oe,Oe=ct),Y(Oe)):m(Oe,Ie)}return function(Oe,Ie,qe,ct){try{Xr=0;var Xt=Mr(Oe,Ie,qe,ct);return Dr=null,Xt}catch(qt){if(qt===Js||qt===At)throw qt;var Zi=Ma(29,qt,null,Oe.mode);return Zi.lanes=ct,Zi.return=Oe,Zi}finally{}}}var xr=Ia(!0),so=Ia(!1),Wa=rt(null),rn=null;function Go(a){var u=a.alternate;mt(zr,zr.current&1),mt(Wa,a),rn===null&&(u===null||On.current!==null||u.memoizedState!==null)&&(rn=a)}function Dh(a){if(a.tag===22){if(mt(zr,zr.current),mt(Wa,a),rn===null){var u=a.alternate;u!==null&&u.memoizedState!==null&&(rn=a)}}else xs()}function xs(){mt(zr,zr.current),mt(Wa,Wa.current)}function vs(a){It(Wa),rn===a&&(rn=null),It(zr)}var zr=rt(0);function Ka(a){for(var u=a;u!==null;){if(u.tag===13){var m=u.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||m.data==="$?"||rd(m)))return u}else if(u.tag===19&&u.memoizedProps.revealOrder!==void 0){if((u.flags&128)!==0)return u}else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===a)break;for(;u.sibling===null;){if(u.return===null||u.return===a)return null;u=u.return}u.sibling.return=u.return,u=u.sibling}return null}function xd(a,u,m,w){u=a.memoizedState,m=m(w,u),m=m==null?u:Ce({},u,m),a.memoizedState=m,a.lanes===0&&(a.updateQueue.baseState=m)}var Of={enqueueSetState:function(a,u,m){a=a._reactInternals;var w=_a(),E=to(w);E.payload=u,m!=null&&(E.callback=m),u=ks(a,E,w),u!==null&&(Bs(u,a,w),Bo(u,a,w))},enqueueReplaceState:function(a,u,m){a=a._reactInternals;var w=_a(),E=to(w);E.tag=1,E.payload=u,m!=null&&(E.callback=m),u=ks(a,E,w),u!==null&&(Bs(u,a,w),Bo(u,a,w))},enqueueForceUpdate:function(a,u){a=a._reactInternals;var m=_a(),w=to(m);w.tag=2,u!=null&&(w.callback=u),u=ks(a,w,m),u!==null&&(Bs(u,a,m),Bo(u,a,m))}};function af(a,u,m,w,E,R,Y){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(w,R,Y):u.prototype&&u.prototype.isPureReactComponent?!tc(m,w)||!tc(E,R):!0}function Ff(a,u,m,w){a=u.state,typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps(m,w),typeof u.UNSAFE_componentWillReceiveProps=="function"&&u.UNSAFE_componentWillReceiveProps(m,w),u.state!==a&&Of.enqueueReplaceState(u,u.state,null)}function fc(a,u){var m=u;if("ref"in u){m={};for(var w in u)w!=="ref"&&(m[w]=u[w])}if(a=a.defaultProps){m===u&&(m=Ce({},m));for(var E in a)m[E]===void 0&&(m[E]=a[E])}return m}var Xu=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var u=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(u))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function jf(a){Xu(a)}function Cl(a){console.error(a)}function Lh(a){Xu(a)}function Bh(a,u){try{var m=a.onUncaughtError;m(u.value,{componentStack:u.stack})}catch(w){setTimeout(function(){throw w})}}function Nf(a,u,m){try{var w=a.onCaughtError;w(m.value,{componentStack:m.stack,errorBoundary:u.tag===1?u.stateNode:null})}catch(E){setTimeout(function(){throw E})}}function sf(a,u,m){return m=to(m),m.tag=3,m.payload={element:null},m.callback=function(){Bh(a,u)},m}function Yu(a){return a=to(a),a.tag=3,a}function _p(a,u,m,w){var E=m.type.getDerivedStateFromError;if(typeof E=="function"){var R=w.value;a.payload=function(){return E(R)},a.callback=function(){Nf(u,m,w)}}var Y=m.stateNode;Y!==null&&typeof Y.componentDidCatch=="function"&&(a.callback=function(){Nf(u,m,w),typeof E!="function"&&(bc===null?bc=new Set([this]):bc.add(this));var te=w.stack;this.componentDidCatch(w.value,{componentStack:te!==null?te:""})})}function vd(a,u,m,w,E){if(m.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){if(u=m.alternate,u!==null&&Kc(u,m,E,!0),m=Wa.current,m!==null){switch(m.tag){case 13:return rn===null?_f():m.alternate===null&&_n===0&&(_n=3),m.flags&=-257,m.flags|=65536,m.lanes=E,w===Lo?m.flags|=16384:(u=m.updateQueue,u===null?m.updateQueue=new Set([w]):u.add(w),Jf(a,w,E)),!1;case 22:return m.flags|=65536,w===Lo?m.flags|=16384:(u=m.updateQueue,u===null?(u={transitions:null,markerInstances:null,retryQueue:new Set([w])},m.updateQueue=u):(m=u.retryQueue,m===null?u.retryQueue=new Set([w]):m.add(w)),Jf(a,w,E)),!1}throw Error(Z(435,m.tag))}return Jf(a,w,E),_f(),!1}if(Wi)return u=Wa.current,u!==null?((u.flags&65536)===0&&(u.flags|=256),u.flags|=65536,u.lanes=E,w!==$c&&(a=Error(Z(422),{cause:w}),Ys(zn(a,m)))):(w!==$c&&(u=Error(Z(423),{cause:w}),Ys(zn(u,m))),a=a.current.alternate,a.flags|=65536,E&=-E,a.lanes|=E,w=zn(w,m),E=sf(a.stateNode,w,E),cc(a,E),_n!==4&&(_n=2)),!1;var R=Error(Z(520),{cause:w});if(R=zn(R,m),kl===null?kl=[R]:kl.push(R),_n!==4&&(_n=2),u===null)return!0;w=zn(w,m),m=u;do{switch(m.tag){case 3:return m.flags|=65536,a=E&-E,m.lanes|=a,a=sf(m.stateNode,w,a),cc(m,a),!1;case 1:if(u=m.type,R=m.stateNode,(m.flags&128)===0&&(typeof u.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(bc===null||!bc.has(R))))return m.flags|=65536,E&=-E,m.lanes|=E,E=Yu(E),_p(E,a,m,w),cc(m,E),!1}m=m.return}while(m!==null);return!1}var bd=Error(Z(461)),yn=!1;function na(a,u,m,w){u.child=a===null?so(u,null,m,w):xr(u,a.child,m,w)}function of(a,u,m,w,E){m=m.render;var R=u.ref;if("ref"in w){var Y={};for(var te in w)te!=="ref"&&(Y[te]=w[te])}else Y=w;return Ws(u),w=Rh(a,u,m,Y,R,E),te=iu(),a!==null&&!yn?(Tl(a,u,E),qo(a,u,E)):(Wi&&te&&ac(u),u.flags|=1,na(a,u,w,E),u.child)}function Oh(a,u,m,w,E){if(a===null){var R=m.type;return typeof R=="function"&&!qc(R)&&R.defaultProps===void 0&&m.compare===null?(u.tag=15,u.type=R,xp(a,u,R,w,E)):(a=Vu(m.type,null,w,u,u.mode,E),a.ref=u.ref,a.return=u,u.child=a)}if(R=a.child,!Md(a,E)){var Y=R.memoizedProps;if(m=m.compare,m=m!==null?m:tc,m(Y,w)&&a.ref===u.ref)return qo(a,u,E)}return u.flags|=1,a=Kn(R,w),a.ref=u.ref,a.return=u,u.child=a}function xp(a,u,m,w,E){if(a!==null){var R=a.memoizedProps;if(tc(R,w)&&a.ref===u.ref)if(yn=!1,u.pendingProps=w=R,Md(a,E))(a.flags&131072)!==0&&(yn=!0);else return u.lanes=a.lanes,qo(a,u,E)}return jh(a,u,m,w,E)}function nn(a,u,m){var w=u.pendingProps,E=w.children,R=a!==null?a.memoizedState:null;if(w.mode==="hidden"){if((u.flags&128)!==0){if(w=R!==null?R.baseLanes|m:m,a!==null){for(E=u.child=a.child,R=0;E!==null;)R=R|E.lanes|E.childLanes,E=E.sibling;u.childLanes=R&~w}else u.childLanes=0,u.child=null;return ru(a,u,w,m)}if((m&536870912)!==0)u.memoizedState={baseLanes:0,cachePool:null},a!==null&&oc(u,R!==null?R.cachePool:null),R!==null?io(u,R):uc(),Dh(u);else return u.lanes=u.childLanes=536870912,ru(a,u,R!==null?R.baseLanes|m:m,m)}else R!==null?(oc(u,R.cachePool),io(u,R),xs(),u.memoizedState=null):(a!==null&&oc(u,null),uc(),xs());return na(a,u,E,m),u.child}function ru(a,u,m,w){var E=Gu();return E=E===null?null:{parent:vi._currentValue,pool:E},u.memoizedState={baseLanes:m,cachePool:E},a!==null&&oc(u,null),uc(),Dh(u),a!==null&&Kc(a,u,w,!0),null}function Fh(a,u){var m=u.ref;if(m===null)a!==null&&a.ref!==null&&(u.flags|=4194816);else{if(typeof m!="function"&&typeof m!="object")throw Error(Z(284));(a===null||a.ref!==m)&&(u.flags|=4194816)}}function jh(a,u,m,w,E){return Ws(u),m=Rh(a,u,m,w,void 0,E),w=iu(),a!==null&&!yn?(Tl(a,u,E),qo(a,u,E)):(Wi&&w&&ac(u),u.flags|=1,na(a,u,m,E),u.child)}function Wu(a,u,m,w,E,R){return Ws(u),u.updateQueue=null,m=mr(u,w,m,E),hc(a),w=iu(),a!==null&&!yn?(Tl(a,u,R),qo(a,u,R)):(Wi&&w&&ac(u),u.flags|=1,na(a,u,m,R),u.child)}function Ku(a,u,m,w,E){if(Ws(u),u.stateNode===null){var R=ni,Y=m.contextType;typeof Y=="object"&&Y!==null&&(R=Cr(Y)),R=new m(w,R),u.memoizedState=R.state!==null&&R.state!==void 0?R.state:null,R.updater=Of,u.stateNode=R,R._reactInternals=u,R=u.stateNode,R.props=w,R.state=u.memoizedState,R.refs={},qu(u),Y=m.contextType,R.context=typeof Y=="object"&&Y!==null?Cr(Y):ni,R.state=u.memoizedState,Y=m.getDerivedStateFromProps,typeof Y=="function"&&(xd(u,m,Y,w),R.state=u.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof R.getSnapshotBeforeUpdate=="function"||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(Y=R.state,typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount(),Y!==R.state&&Of.enqueueReplaceState(R,R.state,null),bl(u,w,R,E),vl(),R.state=u.memoizedState),typeof R.componentDidMount=="function"&&(u.flags|=4194308),w=!0}else if(a===null){R=u.stateNode;var te=u.memoizedProps,be=fc(m,te);R.props=be;var Ge=R.context,nt=m.contextType;Y=ni,typeof nt=="object"&&nt!==null&&(Y=Cr(nt));var lt=m.getDerivedStateFromProps;nt=typeof lt=="function"||typeof R.getSnapshotBeforeUpdate=="function",te=u.pendingProps!==te,nt||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(te||Ge!==Y)&&Ff(u,R,w,Y),Xa=!1;var Xe=u.memoizedState;R.state=Xe,bl(u,w,R,E),vl(),Ge=u.memoizedState,te||Xe!==Ge||Xa?(typeof lt=="function"&&(xd(u,m,lt,w),Ge=u.memoizedState),(be=Xa||af(u,m,be,w,Xe,Ge,Y))?(nt||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(u.flags|=4194308)):(typeof R.componentDidMount=="function"&&(u.flags|=4194308),u.memoizedProps=w,u.memoizedState=Ge),R.props=w,R.state=Ge,R.context=Y,w=be):(typeof R.componentDidMount=="function"&&(u.flags|=4194308),w=!1)}else{R=u.stateNode,eo(a,u),Y=u.memoizedProps,nt=fc(m,Y),R.props=nt,lt=u.pendingProps,Xe=R.context,Ge=m.contextType,be=ni,typeof Ge=="object"&&Ge!==null&&(be=Cr(Ge)),te=m.getDerivedStateFromProps,(Ge=typeof te=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(Y!==lt||Xe!==be)&&Ff(u,R,w,be),Xa=!1,Xe=u.memoizedState,R.state=Xe,bl(u,w,R,E),vl();var Ke=u.memoizedState;Y!==lt||Xe!==Ke||Xa||a!==null&&a.dependencies!==null&&Qc(a.dependencies)?(typeof te=="function"&&(xd(u,m,te,w),Ke=u.memoizedState),(nt=Xa||af(u,m,nt,w,Xe,Ke,be)||a!==null&&a.dependencies!==null&&Qc(a.dependencies))?(Ge||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(w,Ke,be),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(w,Ke,be)),typeof R.componentDidUpdate=="function"&&(u.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(u.flags|=1024)):(typeof R.componentDidUpdate!="function"||Y===a.memoizedProps&&Xe===a.memoizedState||(u.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||Y===a.memoizedProps&&Xe===a.memoizedState||(u.flags|=1024),u.memoizedProps=w,u.memoizedState=Ke),R.props=w,R.state=Ke,R.context=be,w=nt):(typeof R.componentDidUpdate!="function"||Y===a.memoizedProps&&Xe===a.memoizedState||(u.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||Y===a.memoizedProps&&Xe===a.memoizedState||(u.flags|=1024),w=!1)}return R=w,Fh(a,u),w=(u.flags&128)!==0,R||w?(R=u.stateNode,m=w&&typeof m.getDerivedStateFromError!="function"?null:R.render(),u.flags|=1,a!==null&&w?(u.child=xr(u,a.child,null,E),u.child=xr(u,null,m,E)):na(a,u,m,E),u.memoizedState=R.state,a=u.child):a=qo(a,u,E),a}function wd(a,u,m,w){return qn(),u.flags|=256,na(a,u,m,w),u.child}var nu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function In(a){return{baseLanes:a,cachePool:Pn()}}function Nh(a,u,m){return a=a!==null?a.childLanes&~m:0,u&&(a|=bs),a}function au(a,u,m){var w=u.pendingProps,E=!1,R=(u.flags&128)!==0,Y;if((Y=R)||(Y=a!==null&&a.memoizedState===null?!1:(zr.current&2)!==0),Y&&(E=!0,u.flags&=-129),Y=(u.flags&32)!==0,u.flags&=-33,a===null){if(Wi){if(E?Go(u):xs(),Wi){var te=Zr,be;if(be=te){e:{for(be=te,te=Ha;be.nodeType!==8;){if(!te){te=null;break e}if(be=Yo(be.nextSibling),be===null){te=null;break e}}te=be}te!==null?(u.memoizedState={dehydrated:te,treeContext:ca!==null?{id:$a,overflow:ds}:null,retryLane:536870912,hydrationErrors:null},be=Ma(18,null,null,0),be.stateNode=te,be.return=u,u.child=be,ln=u,Zr=null,be=!0):be=!1}be||_l(u)}if(te=u.memoizedState,te!==null&&(te=te.dehydrated,te!==null))return rd(te)?u.lanes=32:u.lanes=536870912,null;vs(u)}return te=w.children,w=w.fallback,E?(xs(),E=u.mode,te=pc({mode:"hidden",children:te},E),w=zs(w,E,m,null),te.return=u,w.return=u,te.sibling=w,u.child=te,E=u.child,E.memoizedState=In(m),E.childLanes=Nh(a,Y,m),u.memoizedState=nu,w):(Go(u),Sd(u,te))}if(be=a.memoizedState,be!==null&&(te=be.dehydrated,te!==null)){if(R)u.flags&256?(Go(u),u.flags&=-257,u=Vh(a,u,m)):u.memoizedState!==null?(xs(),u.child=a.child,u.flags|=128,u=null):(xs(),E=w.fallback,te=u.mode,w=pc({mode:"visible",children:w.children},te),E=zs(E,te,m,null),E.flags|=2,w.return=u,E.return=u,w.sibling=E,u.child=w,xr(u,a.child,null,m),w=u.child,w.memoizedState=In(m),w.childLanes=Nh(a,Y,m),u.memoizedState=nu,u=E);else if(Go(u),rd(te)){if(Y=te.nextSibling&&te.nextSibling.dataset,Y)var Ge=Y.dgst;Y=Ge,w=Error(Z(419)),w.stack="",w.digest=Y,Ys({value:w,source:null,stack:null}),u=Vh(a,u,m)}else if(yn||Kc(a,u,m,!1),Y=(m&a.childLanes)!==0,yn||Y){if(Y=Vr,Y!==null&&(w=m&-m,w=(w&42)!==0?1:hi(w),w=(w&(Y.suspendedLanes|m))!==0?0:w,w!==0&&w!==be.retryLane))throw be.retryLane=w,qr(a,w),Bs(Y,a,w),bd;te.data==="$?"||_f(),u=Vh(a,u,m)}else te.data==="$?"?(u.flags|=192,u.child=a.child,u=null):(a=be.treeContext,Zr=Yo(te.nextSibling),ln=u,Wi=!0,yl=null,Ha=!1,a!==null&&(Aa[vn++]=$a,Aa[vn++]=ds,Aa[vn++]=ca,$a=a.id,ds=a.overflow,ca=u),u=Sd(u,w.children),u.flags|=4096);return u}return E?(xs(),E=w.fallback,te=u.mode,be=a.child,Ge=be.sibling,w=Kn(be,{mode:"hidden",children:w.children}),w.subtreeFlags=be.subtreeFlags&65011712,Ge!==null?E=Kn(Ge,E):(E=zs(E,te,m,null),E.flags|=2),E.return=u,w.return=u,w.sibling=E,u.child=w,w=E,E=u.child,te=a.child.memoizedState,te===null?te=In(m):(be=te.cachePool,be!==null?(Ge=vi._currentValue,be=be.parent!==Ge?{parent:Ge,pool:Ge}:be):be=Pn(),te={baseLanes:te.baseLanes|m,cachePool:be}),E.memoizedState=te,E.childLanes=Nh(a,Y,m),u.memoizedState=nu,w):(Go(u),m=a.child,a=m.sibling,m=Kn(m,{mode:"visible",children:w.children}),m.return=u,m.sibling=null,a!==null&&(Y=u.deletions,Y===null?(u.deletions=[a],u.flags|=16):Y.push(a)),u.child=m,u.memoizedState=null,m)}function Sd(a,u){return u=pc({mode:"visible",children:u},a.mode),u.return=a,a.child=u}function pc(a,u){return a=Ma(22,a,null,u),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function Vh(a,u,m){return xr(u,a.child,null,m),a=Sd(u,u.pendingProps.children),a.flags|=2,u.memoizedState=null,a}function vp(a,u,m){a.lanes|=u;var w=a.alternate;w!==null&&(w.lanes|=u),Wc(a.return,u,m)}function Td(a,u,m,w,E){var R=a.memoizedState;R===null?a.memoizedState={isBackwards:u,rendering:null,renderingStartTime:0,last:w,tail:m,tailMode:E}:(R.isBackwards=u,R.rendering=null,R.renderingStartTime=0,R.last=w,R.tail=m,R.tailMode=E)}function su(a,u,m){var w=u.pendingProps,E=w.revealOrder,R=w.tail;if(na(a,u,w.children,m),w=zr.current,(w&2)!==0)w=w&1|2,u.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=u.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&vp(a,m,u);else if(a.tag===19)vp(a,m,u);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===u)break e;for(;a.sibling===null;){if(a.return===null||a.return===u)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}w&=1}switch(mt(zr,w),E){case"forwards":for(m=u.child,E=null;m!==null;)a=m.alternate,a!==null&&Ka(a)===null&&(E=m),m=m.sibling;m=E,m===null?(E=u.child,u.child=null):(E=m.sibling,m.sibling=null),Td(u,!1,E,m,R);break;case"backwards":for(m=null,E=u.child,u.child=null;E!==null;){if(a=E.alternate,a!==null&&Ka(a)===null){u.child=E;break}a=E.sibling,E.sibling=m,m=E,E=a}Td(u,!0,m,null,R);break;case"together":Td(u,!1,null,null,void 0);break;default:u.memoizedState=null}return u.child}function qo(a,u,m){if(a!==null&&(u.dependencies=a.dependencies),$o|=u.lanes,(m&u.childLanes)===0)if(a!==null){if(Kc(a,u,m,!1),(m&u.childLanes)===0)return null}else return null;if(a!==null&&u.child!==a.child)throw Error(Z(153));if(u.child!==null){for(a=u.child,m=Kn(a,a.pendingProps),u.child=m,m.return=u;a.sibling!==null;)a=a.sibling,m=m.sibling=Kn(a,a.pendingProps),m.return=u;m.sibling=null}return u.child}function Md(a,u){return(a.lanes&u)!==0?!0:(a=a.dependencies,!!(a!==null&&Qc(a)))}function Uh(a,u,m){switch(u.tag){case 3:Ei(u,u.stateNode.containerInfo),Bn(u,vi,a.memoizedState.cache),qn();break;case 27:case 5:jn(u);break;case 4:Ei(u,u.stateNode.containerInfo);break;case 10:Bn(u,u.type,u.memoizedProps.value);break;case 13:var w=u.memoizedState;if(w!==null)return w.dehydrated!==null?(Go(u),u.flags|=128,null):(m&u.child.childLanes)!==0?au(a,u,m):(Go(u),a=qo(a,u,m),a!==null?a.sibling:null);Go(u);break;case 19:var E=(a.flags&128)!==0;if(w=(m&u.childLanes)!==0,w||(Kc(a,u,m,!1),w=(m&u.childLanes)!==0),E){if(w)return su(a,u,m);u.flags|=128}if(E=u.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),mt(zr,zr.current),w)break;return null;case 22:case 23:return u.lanes=0,nn(a,u,m);case 24:Bn(u,vi,a.memoizedState.cache)}return qo(a,u,m)}function lf(a,u,m){if(a!==null)if(a.memoizedProps!==u.pendingProps)yn=!0;else{if(!Md(a,m)&&(u.flags&128)===0)return yn=!1,Uh(a,u,m);yn=(a.flags&131072)!==0}else yn=!1,Wi&&(u.flags&1048576)!==0&&ko(u,gl,u.index);switch(u.lanes=0,u.tag){case 16:e:{a=u.pendingProps;var w=u.elementType,E=w._init;if(w=E(w._payload),u.type=w,typeof w=="function")qc(w)?(a=fc(w,a),u.tag=1,u=Ku(null,u,w,a,m)):(u.tag=0,u=jh(null,u,w,a,m));else{if(w!=null){if(E=w.$$typeof,E===St){u.tag=11,u=of(null,u,w,a,m);break e}else if(E===ti){u.tag=14,u=Oh(null,u,w,a,m);break e}}throw u=fn(w)||w,Error(Z(306,u,""))}}return u;case 0:return jh(a,u,u.type,u.pendingProps,m);case 1:return w=u.type,E=fc(w,u.pendingProps),Ku(a,u,w,E,m);case 3:e:{if(Ei(u,u.stateNode.containerInfo),a===null)throw Error(Z(387));w=u.pendingProps;var R=u.memoizedState;E=R.element,eo(a,u),bl(u,w,null,m);var Y=u.memoizedState;if(w=Y.cache,Bn(u,vi,w),w!==R.cache&&kh(u,[vi],m,!0),vl(),w=Y.element,R.isDehydrated)if(R={element:w,isDehydrated:!1,cache:Y.cache},u.updateQueue.baseState=R,u.memoizedState=R,u.flags&256){u=wd(a,u,w,m);break e}else if(w!==E){E=zn(Error(Z(424)),u),Ys(E),u=wd(a,u,w,m);break e}else{switch(a=u.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Zr=Yo(a.firstChild),ln=u,Wi=!0,yl=null,Ha=!0,m=so(u,null,w,m),u.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling}else{if(qn(),w===E){u=qo(a,u,m);break e}na(a,u,w,m)}u=u.child}return u;case 26:return Fh(a,u),a===null?(m=nd(u.type,null,u.pendingProps,null))?u.memoizedState=m:Wi||(m=u.type,a=u.pendingProps,w=Gd(Zt.current).createElement(m),w[Lt]=u,w[di]=a,xn(w,m,a),or(w),u.stateNode=w):u.memoizedState=nd(u.type,a.memoizedProps,u.pendingProps,a.memoizedState),null;case 27:return jn(u),a===null&&Wi&&(w=u.stateNode=Rn(u.type,u.pendingProps,Zt.current),ln=u,Ha=!0,E=Zr,Cc(u.type)?(vh=E,Zr=Yo(w.firstChild)):Zr=E),na(a,u,u.pendingProps.children,m),Fh(a,u),a===null&&(u.flags|=4194304),u.child;case 5:return a===null&&Wi&&((E=w=Zr)&&(w=_h(w,u.type,u.pendingProps,Ha),w!==null?(u.stateNode=w,ln=u,Zr=Yo(w.firstChild),Ha=!1,E=!0):E=!1),E||_l(u)),jn(u),E=u.type,R=u.pendingProps,Y=a!==null?a.memoizedProps:null,w=R.children,co(E,R)?w=null:Y!==null&&co(E,Y)&&(u.flags|=32),u.memoizedState!==null&&(E=Rh(a,u,un,null,null,m),L._currentValue=E),Fh(a,u),na(a,u,w,m),u.child;case 6:return a===null&&Wi&&((a=m=Zr)&&(m=xh(m,u.pendingProps,Ha),m!==null?(u.stateNode=m,ln=u,Zr=null,a=!0):a=!1),a||_l(u)),null;case 13:return au(a,u,m);case 4:return Ei(u,u.stateNode.containerInfo),w=u.pendingProps,a===null?u.child=xr(u,null,w,m):na(a,u,w,m),u.child;case 11:return of(a,u,u.type,u.pendingProps,m);case 7:return na(a,u,u.pendingProps,m),u.child;case 8:return na(a,u,u.pendingProps.children,m),u.child;case 12:return na(a,u,u.pendingProps.children,m),u.child;case 10:return w=u.pendingProps,Bn(u,u.type,w.value),na(a,u,w.children,m),u.child;case 9:return E=u.type._context,w=u.pendingProps.children,Ws(u),E=Cr(E),w=w(E),u.flags|=1,na(a,u,w,m),u.child;case 14:return Oh(a,u,u.type,u.pendingProps,m);case 15:return xp(a,u,u.type,u.pendingProps,m);case 19:return su(a,u,m);case 31:return w=u.pendingProps,m=u.mode,w={mode:w.mode,children:w.children},a===null?(m=pc(w,m),m.ref=u.ref,u.child=m,m.return=u,u=m):(m=Kn(a.child,w),m.ref=u.ref,u.child=m,m.return=u,u=m),u;case 22:return nn(a,u,m);case 24:return Ws(u),w=Cr(vi),a===null?(E=Gu(),E===null&&(E=Vr,R=Is(),E.pooledCache=R,R.refCount++,R!==null&&(E.pooledCacheLanes|=m),E=R),u.memoizedState={parent:w,cache:E},qu(u),Bn(u,vi,E)):((a.lanes&m)!==0&&(eo(a,u),bl(u,null,null,m),vl()),E=a.memoizedState,R=u.memoizedState,E.parent!==w?(E={parent:w,cache:w},u.memoizedState=E,u.lanes===0&&(u.memoizedState=u.updateQueue.baseState=E),Bn(u,vi,w)):(w=R.cache,Bn(u,vi,w),w!==E.cache&&kh(u,[vi],m,!0))),na(a,u,u.pendingProps.children,m),u.child;case 29:throw u.pendingProps}throw Error(Z(156,u.tag))}function El(a){a.flags|=4}function Vf(a,u){if(u.type!=="stylesheet"||(u.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!o(u)){if(u=Wa.current,u!==null&&((Oi&4194048)===Oi?rn!==null:(Oi&62914560)!==Oi&&(Oi&536870912)===0||u!==rn))throw fa=Lo,cn;a.flags|=8192}}function Gh(a,u){u!==null&&(a.flags|=4),a.flags&16384&&(u=a.tag!==22?at():536870912,a.lanes|=u,uh|=u)}function Qu(a,u){if(!Wi)switch(a.tailMode){case"hidden":u=a.tail;for(var m=null;u!==null;)u.alternate!==null&&(m=u),u=u.sibling;m===null?a.tail=null:m.sibling=null;break;case"collapsed":m=a.tail;for(var w=null;m!==null;)m.alternate!==null&&(w=m),m=m.sibling;w===null?u||a.tail===null?a.tail=null:a.tail.sibling=null:w.sibling=null}}function hn(a){var u=a.alternate!==null&&a.alternate.child===a.child,m=0,w=0;if(u)for(var E=a.child;E!==null;)m|=E.lanes|E.childLanes,w|=E.subtreeFlags&65011712,w|=E.flags&65011712,E.return=a,E=E.sibling;else for(E=a.child;E!==null;)m|=E.lanes|E.childLanes,w|=E.subtreeFlags,w|=E.flags,E.return=a,E=E.sibling;return a.subtreeFlags|=w,a.childLanes=m,u}function Ju(a,u,m){var w=u.pendingProps;switch(sc(u),u.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return hn(u),null;case 1:return hn(u),null;case 3:return m=u.stateNode,w=null,a!==null&&(w=a.memoizedState.cache),u.memoizedState.cache!==w&&(u.flags|=2048),Ps(vi),kr(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(a===null||a.child===null)&&(ua(u)?El(u):a===null||a.memoizedState.isDehydrated&&(u.flags&256)===0||(u.flags|=1024,Xc())),hn(u),null;case 26:return m=u.memoizedState,a===null?(El(u),m!==null?(hn(u),Vf(u,m)):(hn(u),u.flags&=-16777217)):m?m!==a.memoizedState?(El(u),hn(u),Vf(u,m)):(hn(u),u.flags&=-16777217):(a.memoizedProps!==w&&El(u),hn(u),u.flags&=-16777217),null;case 27:Hn(u),m=Zt.current;var E=u.type;if(a!==null&&u.stateNode!=null)a.memoizedProps!==w&&El(u);else{if(!w){if(u.stateNode===null)throw Error(Z(166));return hn(u),null}a=ut.current,ua(u)?Hc(u):(a=Rn(E,w,m),u.stateNode=a,El(u))}return hn(u),null;case 5:if(Hn(u),m=u.type,a!==null&&u.stateNode!=null)a.memoizedProps!==w&&El(u);else{if(!w){if(u.stateNode===null)throw Error(Z(166));return hn(u),null}if(a=ut.current,ua(u))Hc(u);else{switch(E=Gd(Zt.current),a){case 1:a=E.createElementNS("http://www.w3.org/2000/svg",m);break;case 2:a=E.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;default:switch(m){case"svg":a=E.createElementNS("http://www.w3.org/2000/svg",m);break;case"math":a=E.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;case"script":a=E.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof w.is=="string"?E.createElement("select",{is:w.is}):E.createElement("select"),w.multiple?a.multiple=!0:w.size&&(a.size=w.size);break;default:a=typeof w.is=="string"?E.createElement(m,{is:w.is}):E.createElement(m)}}a[Lt]=u,a[di]=w;e:for(E=u.child;E!==null;){if(E.tag===5||E.tag===6)a.appendChild(E.stateNode);else if(E.tag!==4&&E.tag!==27&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===u)break e;for(;E.sibling===null;){if(E.return===null||E.return===u)break e;E=E.return}E.sibling.return=E.return,E=E.sibling}u.stateNode=a;e:switch(xn(a,m,w),m){case"button":case"input":case"select":case"textarea":a=!!w.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&El(u)}}return hn(u),u.flags&=-16777217,null;case 6:if(a&&u.stateNode!=null)a.memoizedProps!==w&&El(u);else{if(typeof w!="string"&&u.stateNode===null)throw Error(Z(166));if(a=Zt.current,ua(u)){if(a=u.stateNode,m=u.memoizedProps,w=null,E=ln,E!==null)switch(E.tag){case 27:case 5:w=E.memoizedProps}a[Lt]=u,a=!!(a.nodeValue===m||w!==null&&w.suppressHydrationWarning===!0||cp(a.nodeValue,m)),a||_l(u)}else a=Gd(a).createTextNode(w),a[Lt]=u,u.stateNode=a}return hn(u),null;case 13:if(w=u.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(E=ua(u),w!==null&&w.dehydrated!==null){if(a===null){if(!E)throw Error(Z(318));if(E=u.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(Z(317));E[Lt]=u}else qn(),(u.flags&128)===0&&(u.memoizedState=null),u.flags|=4;hn(u),E=!1}else E=Xc(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=E),E=!0;if(!E)return u.flags&256?(vs(u),u):(vs(u),null)}if(vs(u),(u.flags&128)!==0)return u.lanes=m,u;if(m=w!==null,a=a!==null&&a.memoizedState!==null,m){w=u.child,E=null,w.alternate!==null&&w.alternate.memoizedState!==null&&w.alternate.memoizedState.cachePool!==null&&(E=w.alternate.memoizedState.cachePool.pool);var R=null;w.memoizedState!==null&&w.memoizedState.cachePool!==null&&(R=w.memoizedState.cachePool.pool),R!==E&&(w.flags|=2048)}return m!==a&&m&&(u.child.flags|=8192),Gh(u,u.updateQueue),hn(u),null;case 4:return kr(),a===null&&Tf(u.stateNode.containerInfo),hn(u),null;case 10:return Ps(u.type),hn(u),null;case 19:if(It(zr),E=u.memoizedState,E===null)return hn(u),null;if(w=(u.flags&128)!==0,R=E.rendering,R===null)if(w)Qu(E,!1);else{if(_n!==0||a!==null&&(a.flags&128)!==0)for(a=u.child;a!==null;){if(R=Ka(a),R!==null){for(u.flags|=128,Qu(E,!1),a=R.updateQueue,u.updateQueue=a,Gh(u,a),u.subtreeFlags=0,a=m,m=u.child;m!==null;)yd(m,a),m=m.sibling;return mt(zr,zr.current&1|2),u.child}a=a.sibling}E.tail!==null&&sn()>ff&&(u.flags|=128,w=!0,Qu(E,!1),u.lanes=4194304)}else{if(!w)if(a=Ka(R),a!==null){if(u.flags|=128,w=!0,a=a.updateQueue,u.updateQueue=a,Gh(u,a),Qu(E,!0),E.tail===null&&E.tailMode==="hidden"&&!R.alternate&&!Wi)return hn(u),null}else 2*sn()-E.renderingStartTime>ff&&m!==536870912&&(u.flags|=128,w=!0,Qu(E,!1),u.lanes=4194304);E.isBackwards?(R.sibling=u.child,u.child=R):(a=E.last,a!==null?a.sibling=R:u.child=R,E.last=R)}return E.tail!==null?(u=E.tail,E.rendering=u,E.tail=u.sibling,E.renderingStartTime=sn(),u.sibling=null,a=zr.current,mt(zr,w?a&1|2:a&1),u):(hn(u),null);case 22:case 23:return vs(u),tu(),w=u.memoizedState!==null,a!==null?a.memoizedState!==null!==w&&(u.flags|=8192):w&&(u.flags|=8192),w?(m&536870912)!==0&&(u.flags&128)===0&&(hn(u),u.subtreeFlags&6&&(u.flags|=8192)):hn(u),m=u.updateQueue,m!==null&&Gh(u,m.retryQueue),m=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(m=a.memoizedState.cachePool.pool),w=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(w=u.memoizedState.cachePool.pool),w!==m&&(u.flags|=2048),a!==null&&It(za),null;case 24:return m=null,a!==null&&(m=a.memoizedState.cache),u.memoizedState.cache!==m&&(u.flags|=2048),Ps(vi),hn(u),null;case 25:return null;case 30:return null}throw Error(Z(156,u.tag))}function Ad(a,u){switch(sc(u),u.tag){case 1:return a=u.flags,a&65536?(u.flags=a&-65537|128,u):null;case 3:return Ps(vi),kr(),a=u.flags,(a&65536)!==0&&(a&128)===0?(u.flags=a&-65537|128,u):null;case 26:case 27:case 5:return Hn(u),null;case 13:if(vs(u),a=u.memoizedState,a!==null&&a.dehydrated!==null){if(u.alternate===null)throw Error(Z(340));qn()}return a=u.flags,a&65536?(u.flags=a&-65537|128,u):null;case 19:return It(zr),null;case 4:return kr(),null;case 10:return Ps(u.type),null;case 22:case 23:return vs(u),tu(),a!==null&&It(za),a=u.flags,a&65536?(u.flags=a&-65537|128,u):null;case 24:return Ps(vi),null;case 25:return null;default:return null}}function eh(a,u){switch(sc(u),u.tag){case 3:Ps(vi),kr();break;case 26:case 27:case 5:Hn(u);break;case 4:kr();break;case 13:vs(u);break;case 19:It(zr);break;case 10:Ps(u.type);break;case 22:case 23:vs(u),tu(),a!==null&&It(za);break;case 24:Ps(vi)}}function Cd(a,u){try{var m=u.updateQueue,w=m!==null?m.lastEffect:null;if(w!==null){var E=w.next;m=E;do{if((m.tag&a)===a){w=void 0;var R=m.create,Y=m.inst;w=R(),Y.destroy=w}m=m.next}while(m!==E)}}catch(te){Ir(u,u.return,te)}}function ou(a,u,m){try{var w=u.updateQueue,E=w!==null?w.lastEffect:null;if(E!==null){var R=E.next;w=R;do{if((w.tag&a)===a){var Y=w.inst,te=Y.destroy;if(te!==void 0){Y.destroy=void 0,E=u;var be=m,Ge=te;try{Ge()}catch(nt){Ir(E,be,nt)}}}w=w.next}while(w!==R)}}catch(nt){Ir(u,u.return,nt)}}function Uf(a){var u=a.updateQueue;if(u!==null){var m=a.stateNode;try{$u(u,m)}catch(w){Ir(a,a.return,w)}}}function bp(a,u,m){m.props=fc(a.type,a.memoizedProps),m.state=a.memoizedState;try{m.componentWillUnmount()}catch(w){Ir(a,u,w)}}function qh(a,u){try{var m=a.ref;if(m!==null){switch(a.tag){case 26:case 27:case 5:var w=a.stateNode;break;case 30:w=a.stateNode;break;default:w=a.stateNode}typeof m=="function"?a.refCleanup=m(w):m.current=w}}catch(E){Ir(a,u,E)}}function zl(a,u){var m=a.ref,w=a.refCleanup;if(m!==null)if(typeof w=="function")try{w()}catch(E){Ir(a,u,E)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof m=="function")try{m(null)}catch(E){Ir(a,u,E)}else m.current=null}function Zh(a){var u=a.type,m=a.memoizedProps,w=a.stateNode;try{e:switch(u){case"button":case"input":case"select":case"textarea":m.autoFocus&&w.focus();break e;case"img":m.src?w.src=m.src:m.srcSet&&(w.srcset=m.srcSet)}}catch(E){Ir(a,a.return,E)}}function th(a,u,m){try{var w=a.stateNode;Cf(w,a.type,m,u),w[di]=u}catch(E){Ir(a,a.return,E)}}function Ed(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Cc(a.type)||a.tag===4}function ih(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Ed(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Cc(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Gf(a,u,m){var w=a.tag;if(w===5||w===6)a=a.stateNode,u?(m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m).insertBefore(a,u):(u=m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m,u.appendChild(a),m=m._reactRootContainer,m!=null||u.onclick!==null||(u.onclick=Da));else if(w!==4&&(w===27&&Cc(a.type)&&(m=a.stateNode,u=null),a=a.child,a!==null))for(Gf(a,u,m),a=a.sibling;a!==null;)Gf(a,u,m),a=a.sibling}function Nr(a,u,m){var w=a.tag;if(w===5||w===6)a=a.stateNode,u?m.insertBefore(a,u):m.appendChild(a);else if(w!==4&&(w===27&&Cc(a.type)&&(m=a.stateNode),a=a.child,a!==null))for(Nr(a,u,m),a=a.sibling;a!==null;)Nr(a,u,m),a=a.sibling}function lu(a){var u=a.stateNode,m=a.memoizedProps;try{for(var w=a.type,E=u.attributes;E.length;)u.removeAttributeNode(E[0]);xn(u,w,m),u[Lt]=a,u[di]=m}catch(R){Ir(a,a.return,R)}}var Pl=!1,dn=!1,Il=!1,rh=typeof WeakSet=="function"?WeakSet:Set,Zn=null;function wp(a,u){if(a=a.containerInfo,Ud=ce,a=Ou(a),cl(a)){if("selectionStart"in a)var m={start:a.selectionStart,end:a.selectionEnd};else e:{m=(m=a.ownerDocument)&&m.defaultView||window;var w=m.getSelection&&m.getSelection();if(w&&w.rangeCount!==0){m=w.anchorNode;var E=w.anchorOffset,R=w.focusNode;w=w.focusOffset;try{m.nodeType,R.nodeType}catch{m=null;break e}var Y=0,te=-1,be=-1,Ge=0,nt=0,lt=a,Xe=null;t:for(;;){for(var Ke;lt!==m||E!==0&&lt.nodeType!==3||(te=Y+E),lt!==R||w!==0&&lt.nodeType!==3||(be=Y+w),lt.nodeType===3&&(Y+=lt.nodeValue.length),(Ke=lt.firstChild)!==null;)Xe=lt,lt=Ke;for(;;){if(lt===a)break t;if(Xe===m&&++Ge===E&&(te=Y),Xe===R&&++nt===w&&(be=Y),(Ke=lt.nextSibling)!==null)break;lt=Xe,Xe=lt.parentNode}lt=Ke}m=te===-1||be===-1?null:{start:te,end:be}}else m=null}m=m||{start:0,end:0}}else m=null;for(Ef={focusedElem:a,selectionRange:m},ce=!1,Zn=u;Zn!==null;)if(u=Zn,a=u.child,(u.subtreeFlags&1024)!==0&&a!==null)a.return=u,Zn=a;else for(;Zn!==null;){switch(u=Zn,R=u.alternate,a=u.flags,u.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&R!==null){a=void 0,m=u,E=R.memoizedProps,R=R.memoizedState,w=m.stateNode;try{var _i=fc(m.type,E,m.elementType===m.type);a=w.getSnapshotBeforeUpdate(_i,R),w.__reactInternalSnapshotBeforeUpdate=a}catch(fi){Ir(m,m.return,fi)}}break;case 3:if((a&1024)!==0){if(a=u.stateNode.containerInfo,m=a.nodeType,m===9)Hd(a);else if(m===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Hd(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(Z(163))}if(a=u.sibling,a!==null){a.return=u.return,Zn=a;break}Zn=u.return}}function $h(a,u,m){var w=m.flags;switch(m.tag){case 0:case 11:case 15:gc(a,m),w&4&&Cd(5,m);break;case 1:if(gc(a,m),w&4)if(a=m.stateNode,u===null)try{a.componentDidMount()}catch(Y){Ir(m,m.return,Y)}else{var E=fc(m.type,u.memoizedProps);u=u.memoizedState;try{a.componentDidUpdate(E,u,a.__reactInternalSnapshotBeforeUpdate)}catch(Y){Ir(m,m.return,Y)}}w&64&&Uf(m),w&512&&qh(m,m.return);break;case 3:if(gc(a,m),w&64&&(a=m.updateQueue,a!==null)){if(u=null,m.child!==null)switch(m.child.tag){case 27:case 5:u=m.child.stateNode;break;case 1:u=m.child.stateNode}try{$u(a,u)}catch(Y){Ir(m,m.return,Y)}}break;case 27:u===null&&w&4&&lu(m);case 26:case 5:gc(a,m),u===null&&w&4&&Zh(m),w&512&&qh(m,m.return);break;case 12:gc(a,m);break;case 13:gc(a,m),w&4&&qf(a,m),w&64&&(a=m.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(m=Ep.bind(null,m),dp(a,m))));break;case 22:if(w=m.memoizedState!==null||Pl,!w){u=u!==null&&u.memoizedState!==null||dn,E=Pl;var R=dn;Pl=w,(dn=u)&&!R?uu(a,m,(m.subtreeFlags&8772)!==0):gc(a,m),Pl=E,dn=R}break;case 30:break;default:gc(a,m)}}function cf(a){var u=a.alternate;u!==null&&(a.alternate=null,cf(u)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(u=a.stateNode,u!==null&&xt(u)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Pr=null,aa=!1;function ka(a,u,m){for(m=m.child;m!==null;)nh(a,u,m),m=m.sibling}function nh(a,u,m){if(pn&&typeof pn.onCommitFiberUnmount=="function")try{pn.onCommitFiberUnmount(ss,m)}catch{}switch(m.tag){case 26:dn||zl(m,u),ka(a,u,m),m.memoizedState?m.memoizedState.count--:m.stateNode&&(m=m.stateNode,m.parentNode.removeChild(m));break;case 27:dn||zl(m,u);var w=Pr,E=aa;Cc(m.type)&&(Pr=m.stateNode,aa=!1),ka(a,u,m),xu(m.stateNode),Pr=w,aa=E;break;case 5:dn||zl(m,u);case 6:if(w=Pr,E=aa,Pr=null,ka(a,u,m),Pr=w,aa=E,Pr!==null)if(aa)try{(Pr.nodeType===9?Pr.body:Pr.nodeName==="HTML"?Pr.ownerDocument.body:Pr).removeChild(m.stateNode)}catch(R){Ir(m,u,R)}else try{Pr.removeChild(m.stateNode)}catch(R){Ir(m,u,R)}break;case 18:Pr!==null&&(aa?(a=Pr,id(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,m.stateNode),Vi(a)):id(Pr,m.stateNode));break;case 4:w=Pr,E=aa,Pr=m.stateNode.containerInfo,aa=!0,ka(a,u,m),Pr=w,aa=E;break;case 0:case 11:case 14:case 15:dn||ou(2,m,u),dn||ou(4,m,u),ka(a,u,m);break;case 1:dn||(zl(m,u),w=m.stateNode,typeof w.componentWillUnmount=="function"&&bp(m,u,w)),ka(a,u,m);break;case 21:ka(a,u,m);break;case 22:dn=(w=dn)||m.memoizedState!==null,ka(a,u,m),dn=w;break;default:ka(a,u,m)}}function qf(a,u){if(u.memoizedState===null&&(a=u.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Vi(a)}catch(m){Ir(u,u.return,m)}}function Zf(a){switch(a.tag){case 13:case 19:var u=a.stateNode;return u===null&&(u=a.stateNode=new rh),u;case 22:return a=a.stateNode,u=a._retryCache,u===null&&(u=a._retryCache=new rh),u;default:throw Error(Z(435,a.tag))}}function mc(a,u){var m=Zf(a);u.forEach(function(w){var E=bf.bind(null,a,w);m.has(w)||(m.add(w),w.then(E,E))})}function Ra(a,u){var m=u.deletions;if(m!==null)for(var w=0;w<m.length;w++){var E=m[w],R=a,Y=u,te=Y;e:for(;te!==null;){switch(te.tag){case 27:if(Cc(te.type)){Pr=te.stateNode,aa=!1;break e}break;case 5:Pr=te.stateNode,aa=!1;break e;case 3:case 4:Pr=te.stateNode.containerInfo,aa=!0;break e}te=te.return}if(Pr===null)throw Error(Z(160));nh(R,Y,E),Pr=null,aa=!1,R=E.alternate,R!==null&&(R.return=null),E.return=null}if(u.subtreeFlags&13878)for(u=u.child;u!==null;)ah(u,a),u=u.sibling}var oo=null;function ah(a,u){var m=a.alternate,w=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Ra(u,a),Qa(a),w&4&&(ou(3,a,a.return),Cd(3,a),ou(5,a,a.return));break;case 1:Ra(u,a),Qa(a),w&512&&(dn||m===null||zl(m,m.return)),w&64&&Pl&&(a=a.updateQueue,a!==null&&(w=a.callbacks,w!==null&&(m=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=m===null?w:m.concat(w))));break;case 26:var E=oo;if(Ra(u,a),Qa(a),w&512&&(dn||m===null||zl(m,m.return)),w&4){var R=m!==null?m.memoizedState:null;if(w=a.memoizedState,m===null)if(w===null)if(a.stateNode===null){e:{w=a.type,m=a.memoizedProps,E=E.ownerDocument||E;t:switch(w){case"title":R=E.getElementsByTagName("title")[0],(!R||R[dr]||R[Lt]||R.namespaceURI==="http://www.w3.org/2000/svg"||R.hasAttribute("itemprop"))&&(R=E.createElement(w),E.head.insertBefore(R,E.querySelector("head > title"))),xn(R,w,m),R[Lt]=a,or(R),w=R;break e;case"link":var Y=n("link","href",E).get(w+(m.href||""));if(Y){for(var te=0;te<Y.length;te++)if(R=Y[te],R.getAttribute("href")===(m.href==null||m.href===""?null:m.href)&&R.getAttribute("rel")===(m.rel==null?null:m.rel)&&R.getAttribute("title")===(m.title==null?null:m.title)&&R.getAttribute("crossorigin")===(m.crossOrigin==null?null:m.crossOrigin)){Y.splice(te,1);break t}}R=E.createElement(w),xn(R,w,m),E.head.appendChild(R);break;case"meta":if(Y=n("meta","content",E).get(w+(m.content||""))){for(te=0;te<Y.length;te++)if(R=Y[te],R.getAttribute("content")===(m.content==null?null:""+m.content)&&R.getAttribute("name")===(m.name==null?null:m.name)&&R.getAttribute("property")===(m.property==null?null:m.property)&&R.getAttribute("http-equiv")===(m.httpEquiv==null?null:m.httpEquiv)&&R.getAttribute("charset")===(m.charSet==null?null:m.charSet)){Y.splice(te,1);break t}}R=E.createElement(w),xn(R,w,m),E.head.appendChild(R);break;default:throw Error(Z(468,w))}R[Lt]=a,or(R),w=R}a.stateNode=w}else e(E,a.type,a.stateNode);else a.stateNode=i(E,w,a.memoizedProps);else R!==w?(R===null?m.stateNode!==null&&(m=m.stateNode,m.parentNode.removeChild(m)):R.count--,w===null?e(E,a.type,a.stateNode):i(E,w,a.memoizedProps)):w===null&&a.stateNode!==null&&th(a,a.memoizedProps,m.memoizedProps)}break;case 27:Ra(u,a),Qa(a),w&512&&(dn||m===null||zl(m,m.return)),m!==null&&w&4&&th(a,a.memoizedProps,m.memoizedProps);break;case 5:if(Ra(u,a),Qa(a),w&512&&(dn||m===null||zl(m,m.return)),a.flags&32){E=a.stateNode;try{cs(E,"")}catch(Ke){Ir(a,a.return,Ke)}}w&4&&a.stateNode!=null&&(E=a.memoizedProps,th(a,E,m!==null?m.memoizedProps:E)),w&1024&&(Il=!0);break;case 6:if(Ra(u,a),Qa(a),w&4){if(a.stateNode===null)throw Error(Z(162));w=a.memoizedProps,m=a.stateNode;try{m.nodeValue=w}catch(Ke){Ir(a,a.return,Ke)}}break;case 3:if(T=null,E=oo,oo=bh(u.containerInfo),Ra(u,a),oo=E,Qa(a),w&4&&m!==null&&m.memoizedState.isDehydrated)try{Vi(u.containerInfo)}catch(Ke){Ir(a,a.return,Ke)}Il&&(Il=!1,$f(a));break;case 4:w=oo,oo=bh(a.stateNode.containerInfo),Ra(u,a),Qa(a),oo=w;break;case 12:Ra(u,a),Qa(a);break;case 13:Ra(u,a),Qa(a),a.child.flags&8192&&a.memoizedState!==null!=(m!==null&&m.memoizedState!==null)&&(df=sn()),w&4&&(w=a.updateQueue,w!==null&&(a.updateQueue=null,mc(a,w)));break;case 22:E=a.memoizedState!==null;var be=m!==null&&m.memoizedState!==null,Ge=Pl,nt=dn;if(Pl=Ge||E,dn=nt||be,Ra(u,a),dn=nt,Pl=Ge,Qa(a),w&8192)e:for(u=a.stateNode,u._visibility=E?u._visibility&-2:u._visibility|1,E&&(m===null||be||Pl||dn||cu(a)),m=null,u=a;;){if(u.tag===5||u.tag===26){if(m===null){be=m=u;try{if(R=be.stateNode,E)Y=R.style,typeof Y.setProperty=="function"?Y.setProperty("display","none","important"):Y.display="none";else{te=be.stateNode;var lt=be.memoizedProps.style,Xe=lt!=null&&lt.hasOwnProperty("display")?lt.display:null;te.style.display=Xe==null||typeof Xe=="boolean"?"":(""+Xe).trim()}}catch(Ke){Ir(be,be.return,Ke)}}}else if(u.tag===6){if(m===null){be=u;try{be.stateNode.nodeValue=E?"":be.memoizedProps}catch(Ke){Ir(be,be.return,Ke)}}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===a)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===a)break e;for(;u.sibling===null;){if(u.return===null||u.return===a)break e;m===u&&(m=null),u=u.return}m===u&&(m=null),u.sibling.return=u.return,u=u.sibling}w&4&&(w=a.updateQueue,w!==null&&(m=w.retryQueue,m!==null&&(w.retryQueue=null,mc(a,m))));break;case 19:Ra(u,a),Qa(a),w&4&&(w=a.updateQueue,w!==null&&(a.updateQueue=null,mc(a,w)));break;case 30:break;case 21:break;default:Ra(u,a),Qa(a)}}function Qa(a){var u=a.flags;if(u&2){try{for(var m,w=a.return;w!==null;){if(Ed(w)){m=w;break}w=w.return}if(m==null)throw Error(Z(160));switch(m.tag){case 27:var E=m.stateNode,R=ih(a);Nr(a,R,E);break;case 5:var Y=m.stateNode;m.flags&32&&(cs(Y,""),m.flags&=-33);var te=ih(a);Nr(a,te,Y);break;case 3:case 4:var be=m.stateNode.containerInfo,Ge=ih(a);Gf(a,Ge,be);break;default:throw Error(Z(161))}}catch(nt){Ir(a,a.return,nt)}a.flags&=-3}u&4096&&(a.flags&=-4097)}function $f(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var u=a;$f(u),u.tag===5&&u.flags&1024&&u.stateNode.reset(),a=a.sibling}}function gc(a,u){if(u.subtreeFlags&8772)for(u=u.child;u!==null;)$h(a,u.alternate,u),u=u.sibling}function cu(a){for(a=a.child;a!==null;){var u=a;switch(u.tag){case 0:case 11:case 14:case 15:ou(4,u,u.return),cu(u);break;case 1:zl(u,u.return);var m=u.stateNode;typeof m.componentWillUnmount=="function"&&bp(u,u.return,m),cu(u);break;case 27:xu(u.stateNode);case 26:case 5:zl(u,u.return),cu(u);break;case 22:u.memoizedState===null&&cu(u);break;case 30:cu(u);break;default:cu(u)}a=a.sibling}}function uu(a,u,m){for(m=m&&(u.subtreeFlags&8772)!==0,u=u.child;u!==null;){var w=u.alternate,E=a,R=u,Y=R.flags;switch(R.tag){case 0:case 11:case 15:uu(E,R,m),Cd(4,R);break;case 1:if(uu(E,R,m),w=R,E=w.stateNode,typeof E.componentDidMount=="function")try{E.componentDidMount()}catch(Ge){Ir(w,w.return,Ge)}if(w=R,E=w.updateQueue,E!==null){var te=w.stateNode;try{var be=E.shared.hiddenCallbacks;if(be!==null)for(E.shared.hiddenCallbacks=null,E=0;E<be.length;E++)Zu(be[E],te)}catch(Ge){Ir(w,w.return,Ge)}}m&&Y&64&&Uf(R),qh(R,R.return);break;case 27:lu(R);case 26:case 5:uu(E,R,m),m&&w===null&&Y&4&&Zh(R),qh(R,R.return);break;case 12:uu(E,R,m);break;case 13:uu(E,R,m),m&&Y&4&&qf(E,R);break;case 22:R.memoizedState===null&&uu(E,R,m),qh(R,R.return);break;case 30:break;default:uu(E,R,m)}u=u.sibling}}function sh(a,u){var m=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(m=a.memoizedState.cachePool.pool),a=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(a=u.memoizedState.cachePool.pool),a!==m&&(a!=null&&a.refCount++,m!=null&&Do(m))}function kn(a,u){a=null,u.alternate!==null&&(a=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==a&&(u.refCount++,a!=null&&Do(a))}function lo(a,u,m,w){if(u.subtreeFlags&10256)for(u=u.child;u!==null;)hu(a,u,m,w),u=u.sibling}function hu(a,u,m,w){var E=u.flags;switch(u.tag){case 0:case 11:case 15:lo(a,u,m,w),E&2048&&Cd(9,u);break;case 1:lo(a,u,m,w);break;case 3:lo(a,u,m,w),E&2048&&(a=null,u.alternate!==null&&(a=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==a&&(u.refCount++,a!=null&&Do(a)));break;case 12:if(E&2048){lo(a,u,m,w),a=u.stateNode;try{var R=u.memoizedProps,Y=R.id,te=R.onPostCommit;typeof te=="function"&&te(Y,u.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(be){Ir(u,u.return,be)}}else lo(a,u,m,w);break;case 13:lo(a,u,m,w);break;case 23:break;case 22:R=u.stateNode,Y=u.alternate,u.memoizedState!==null?R._visibility&2?lo(a,u,m,w):yc(a,u):R._visibility&2?lo(a,u,m,w):(R._visibility|=2,oh(a,u,m,w,(u.subtreeFlags&10256)!==0)),E&2048&&sh(Y,u);break;case 24:lo(a,u,m,w),E&2048&&kn(u.alternate,u);break;default:lo(a,u,m,w)}}function oh(a,u,m,w,E){for(E=E&&(u.subtreeFlags&10256)!==0,u=u.child;u!==null;){var R=a,Y=u,te=m,be=w,Ge=Y.flags;switch(Y.tag){case 0:case 11:case 15:oh(R,Y,te,be,E),Cd(8,Y);break;case 23:break;case 22:var nt=Y.stateNode;Y.memoizedState!==null?nt._visibility&2?oh(R,Y,te,be,E):yc(R,Y):(nt._visibility|=2,oh(R,Y,te,be,E)),E&&Ge&2048&&sh(Y.alternate,Y);break;case 24:oh(R,Y,te,be,E),E&&Ge&2048&&kn(Y.alternate,Y);break;default:oh(R,Y,te,be,E)}u=u.sibling}}function yc(a,u){if(u.subtreeFlags&10256)for(u=u.child;u!==null;){var m=a,w=u,E=w.flags;switch(w.tag){case 22:yc(m,w),E&2048&&sh(w.alternate,w);break;case 24:yc(m,w),E&2048&&kn(w.alternate,w);break;default:yc(m,w)}u=u.sibling}}var Zo=8192;function lh(a){if(a.subtreeFlags&Zo)for(a=a.child;a!==null;)Hf(a),a=a.sibling}function Hf(a){switch(a.tag){case 26:lh(a),a.flags&Zo&&a.memoizedState!==null&&g(oo,a.memoizedState,a.memoizedProps);break;case 5:lh(a);break;case 3:case 4:var u=oo;oo=bh(a.stateNode.containerInfo),lh(a),oo=u;break;case 22:a.memoizedState===null&&(u=a.alternate,u!==null&&u.memoizedState!==null?(u=Zo,Zo=16777216,lh(a),Zo=u):lh(a));break;default:lh(a)}}function Sp(a){var u=a.alternate;if(u!==null&&(a=u.child,a!==null)){u.child=null;do u=a.sibling,a.sibling=null,a=u;while(a!==null)}}function ch(a){var u=a.deletions;if((a.flags&16)!==0){if(u!==null)for(var m=0;m<u.length;m++){var w=u[m];Zn=w,Tp(w,a)}Sp(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Hh(a),a=a.sibling}function Hh(a){switch(a.tag){case 0:case 11:case 15:ch(a),a.flags&2048&&ou(9,a,a.return);break;case 3:ch(a);break;case 12:ch(a);break;case 22:var u=a.stateNode;a.memoizedState!==null&&u._visibility&2&&(a.return===null||a.return.tag!==13)?(u._visibility&=-3,Xh(a)):ch(a);break;default:ch(a)}}function Xh(a){var u=a.deletions;if((a.flags&16)!==0){if(u!==null)for(var m=0;m<u.length;m++){var w=u[m];Zn=w,Tp(w,a)}Sp(a)}for(a=a.child;a!==null;){switch(u=a,u.tag){case 0:case 11:case 15:ou(8,u,u.return),Xh(u);break;case 22:m=u.stateNode,m._visibility&2&&(m._visibility&=-3,Xh(u));break;default:Xh(u)}a=a.sibling}}function Tp(a,u){for(;Zn!==null;){var m=Zn;switch(m.tag){case 0:case 11:case 15:ou(8,m,u);break;case 23:case 22:if(m.memoizedState!==null&&m.memoizedState.cachePool!==null){var w=m.memoizedState.cachePool.pool;w!=null&&w.refCount++}break;case 24:Do(m.memoizedState.cache)}if(w=m.child,w!==null)w.return=m,Zn=w;else e:for(m=a;Zn!==null;){w=Zn;var E=w.sibling,R=w.return;if(cf(w),w===m){Zn=null;break e}if(E!==null){E.return=R,Zn=E;break e}Zn=R}}}var qp={getCacheForType:function(a){var u=Cr(vi),m=u.data.get(a);return m===void 0&&(m=a(),u.data.set(a,m)),m}},Mp=typeof WeakMap=="function"?WeakMap:Map,Tr=0,Vr=null,qi=null,Oi=0,Ci=0,ga=null,Ls=!1,_c=!1,Yh=!1,xc=0,_n=0,$o=0,vc=0,uf=0,bs=0,uh=0,kl=null,Ja=null,hf=!1,df=0,ff=1/0,pf=null,bc=null,ya=0,du=null,Ho=null,Yr=0,Rl=0,Xo=null,mf=null,fu=0,pu=null;function _a(){if((Tr&2)!==0&&Oi!==0)return Oi&-Oi;if(Qe.T!==null){var a=bn;return a!==0?a:Qh()}return Yi()}function Xf(){bs===0&&(bs=(Oi&536870912)===0||Wi?ht():536870912);var a=Wa.current;return a!==null&&(a.flags|=32),bs}function Bs(a,u,m){(a===Vr&&(Ci===2||Ci===9)||a.cancelPendingCommit!==null)&&(hh(a,0),wc(a,Oi,bs,!1)),ke(a,m),((Tr&2)===0||a!==Vr)&&(a===Vr&&((Tr&2)===0&&(vc|=m),_n===4&&wc(a,Oi,bs,!1)),sa(a))}function gf(a,u,m){if((Tr&6)!==0)throw Error(Z(327));var w=!m&&(u&124)===0&&(u&a.expiredLanes)===0||Re(a,u),E=w?mu(a,u):Kh(a,u,!0),R=w;do{if(E===0){_c&&!w&&wc(a,u,0,!1);break}else{if(m=a.current.alternate,R&&!Wh(m)){E=Kh(a,u,!1),R=!1;continue}if(E===2){if(R=u,a.errorRecoveryDisabledLanes&R)var Y=0;else Y=a.pendingLanes&-536870913,Y=Y!==0?Y:Y&536870912?536870912:0;if(Y!==0){u=Y;e:{var te=a;E=kl;var be=te.current.memoizedState.isDehydrated;if(be&&(hh(te,Y).flags|=256),Y=Kh(te,Y,!1),Y!==2){if(Yh&&!be){te.errorRecoveryDisabledLanes|=R,vc|=R,E=4;break e}R=Ja,Ja=E,R!==null&&(Ja===null?Ja=R:Ja.push.apply(Ja,R))}E=Y}if(R=!1,E!==2)continue}}if(E===1){hh(a,0),wc(a,u,0,!0);break}e:{switch(w=a,R=E,R){case 0:case 1:throw Error(Z(345));case 4:if((u&4194048)!==u)break;case 6:wc(w,u,bs,!Ls);break e;case 2:Ja=null;break;case 3:case 5:break;default:throw Error(Z(329))}if((u&62914560)===u&&(E=df+300-sn(),10<E)){if(wc(w,u,bs,!Ls),je(w,0,!0)!==0)break e;w.timeoutHandle=$d(yf.bind(null,w,m,Ja,pf,hf,u,bs,vc,uh,Ls,R,2,-0,0),E);break e}yf(w,m,Ja,pf,hf,u,bs,vc,uh,Ls,R,0,-0,0)}}break}while(!0);sa(a)}function yf(a,u,m,w,E,R,Y,te,be,Ge,nt,lt,Xe,Ke){if(a.timeoutHandle=-1,lt=u.subtreeFlags,(lt&8192||(lt&16785408)===16785408)&&(h={stylesheets:null,count:0,unsuspend:p},Hf(u),lt=v(),lt!==null)){a.cancelPendingCommit=lt(gu.bind(null,a,u,R,m,w,E,Y,te,be,nt,1,Xe,Ke)),wc(a,R,Y,!Ge);return}gu(a,u,R,m,w,E,Y,te,be)}function Wh(a){for(var u=a;;){var m=u.tag;if((m===0||m===11||m===15)&&u.flags&16384&&(m=u.updateQueue,m!==null&&(m=m.stores,m!==null)))for(var w=0;w<m.length;w++){var E=m[w],R=E.getSnapshot;E=E.value;try{if(!la(R(),E))return!1}catch{return!1}}if(m=u.child,u.subtreeFlags&16384&&m!==null)m.return=u,u=m;else{if(u===a)break;for(;u.sibling===null;){if(u.return===null||u.return===a)return!0;u=u.return}u.sibling.return=u.return,u=u.sibling}}return!0}function wc(a,u,m,w){u&=~uf,u&=~vc,a.suspendedLanes|=u,a.pingedLanes&=~u,w&&(a.warmLanes|=u),w=a.expirationTimes;for(var E=u;0<E;){var R=31-Ee(E),Y=1<<R;w[R]=-1,E&=~Y}m!==0&&Ti(a,m,u)}function zd(){return(Tr&6)===0?(Tc(0),!1):!0}function Pd(){if(qi!==null){if(Ci===0)var a=qi.return;else a=qi,Ea=Ca=null,Ml(a),Dr=null,Xr=0,a=qi;for(;a!==null;)eh(a.alternate,a),a=a.return;qi=null}}function hh(a,u){var m=a.timeoutHandle;m!==-1&&(a.timeoutHandle=-1,hp(m)),m=a.cancelPendingCommit,m!==null&&(a.cancelPendingCommit=null,m()),Pd(),Vr=a,qi=m=Kn(a.current,null),Oi=u,Ci=0,ga=null,Ls=!1,_c=Re(a,u),Yh=!1,uh=bs=uf=vc=$o=_n=0,Ja=kl=null,hf=!1,(u&8)!==0&&(u|=u&32);var w=a.entangledLanes;if(w!==0)for(a=a.entanglements,w&=u;0<w;){var E=31-Ee(w),R=1<<E;u|=a[E],w&=~R}return xc=u,pl(),m}function Id(a,u){zi=null,Qe.H=Fn,u===Js||u===At?(u=lc(),Ci=3):u===cn?(u=lc(),Ci=4):Ci=u===bd?8:u!==null&&typeof u=="object"&&typeof u.then=="function"?6:1,ga=u,qi===null&&(_n=1,Bh(a,zn(u,a.current)))}function Yf(){var a=Qe.H;return Qe.H=Fn,a===null?Fn:a}function Ap(){var a=Qe.A;return Qe.A=qp,a}function _f(){_n=4,Ls||(Oi&4194048)!==Oi&&Wa.current!==null||(_c=!0),($o&134217727)===0&&(vc&134217727)===0||Vr===null||wc(Vr,Oi,bs,!1)}function Kh(a,u,m){var w=Tr;Tr|=2;var E=Yf(),R=Ap();(Vr!==a||Oi!==u)&&(pf=null,hh(a,u)),u=!1;var Y=_n;e:do try{if(Ci!==0&&qi!==null){var te=qi,be=ga;switch(Ci){case 8:Pd(),Y=6;break e;case 3:case 2:case 9:case 6:Wa.current===null&&(u=!0);var Ge=Ci;if(Ci=0,ga=null,Sc(a,te,be,Ge),m&&_c){Y=0;break e}break;default:Ge=Ci,Ci=0,ga=null,Sc(a,te,be,Ge)}}xf(),Y=_n;break}catch(nt){Id(a,nt)}while(!0);return u&&a.shellSuspendCounter++,Ea=Ca=null,Tr=w,Qe.H=E,Qe.A=R,qi===null&&(Vr=null,Oi=0,pl()),Y}function xf(){for(;qi!==null;)dh(qi)}function mu(a,u){var m=Tr;Tr|=2;var w=Yf(),E=Ap();Vr!==a||Oi!==u?(pf=null,ff=sn()+500,hh(a,u)):_c=Re(a,u);e:do try{if(Ci!==0&&qi!==null){u=qi;var R=ga;t:switch(Ci){case 1:Ci=0,ga=null,Sc(a,u,R,1);break;case 2:case 9:if(Er(R)){Ci=0,ga=null,Rd(u);break}u=function(){Ci!==2&&Ci!==9||Vr!==a||(Ci=7),sa(a)},R.then(u,u);break e;case 3:Ci=7;break e;case 4:Ci=5;break e;case 7:Er(R)?(Ci=0,ga=null,Rd(u)):(Ci=0,ga=null,Sc(a,u,R,7));break;case 5:var Y=null;switch(qi.tag){case 26:Y=qi.memoizedState;case 5:case 27:var te=qi;if(!Y||o(Y)){Ci=0,ga=null;var be=te.sibling;if(be!==null)qi=be;else{var Ge=te.return;Ge!==null?(qi=Ge,Dd(Ge)):qi=null}break t}}Ci=0,ga=null,Sc(a,u,R,5);break;case 6:Ci=0,ga=null,Sc(a,u,R,6);break;case 8:Pd(),_n=6;break e;default:throw Error(Z(462))}}kd();break}catch(nt){Id(a,nt)}while(!0);return Ea=Ca=null,Qe.H=w,Qe.A=E,Tr=m,qi!==null?0:(Vr=null,Oi=0,pl(),_n)}function kd(){for(;qi!==null&&!oa();)dh(qi)}function dh(a){var u=lf(a.alternate,a,xc);a.memoizedProps=a.pendingProps,u===null?Dd(a):qi=u}function Rd(a){var u=a,m=u.alternate;switch(u.tag){case 15:case 0:u=Wu(m,u,u.pendingProps,u.type,void 0,Oi);break;case 11:u=Wu(m,u,u.pendingProps,u.type.render,u.ref,Oi);break;case 5:Ml(u);default:eh(m,u),u=qi=yd(u,xc),u=lf(m,u,xc)}a.memoizedProps=a.pendingProps,u===null?Dd(a):qi=u}function Sc(a,u,m,w){Ea=Ca=null,Ml(u),Dr=null,Xr=0;var E=u.return;try{if(vd(a,E,u,m,Oi)){_n=1,Bh(a,zn(m,a.current)),qi=null;return}}catch(R){if(E!==null)throw qi=E,R;_n=1,Bh(a,zn(m,a.current)),qi=null;return}u.flags&32768?(Wi||w===1?a=!0:_c||(Oi&536870912)!==0?a=!1:(Ls=a=!0,(w===2||w===9||w===3||w===6)&&(w=Wa.current,w!==null&&w.tag===13&&(w.flags|=16384))),Cp(u,a)):Dd(u)}function Dd(a){var u=a;do{if((u.flags&32768)!==0){Cp(u,Ls);return}a=u.return;var m=Ju(u.alternate,u,xc);if(m!==null){qi=m;return}if(u=u.sibling,u!==null){qi=u;return}qi=u=a}while(u!==null);_n===0&&(_n=5)}function Cp(a,u){do{var m=Ad(a.alternate,a);if(m!==null){m.flags&=32767,qi=m;return}if(m=a.return,m!==null&&(m.flags|=32768,m.subtreeFlags=0,m.deletions=null),!u&&(a=a.sibling,a!==null)){qi=a;return}qi=a=m}while(a!==null);_n=6,qi=null}function gu(a,u,m,w,E,R,Y,te,be){a.cancelPendingCommit=null;do fh();while(ya!==0);if((Tr&6)!==0)throw Error(Z(327));if(u!==null){if(u===a.current)throw Error(Z(177));if(R=u.lanes|u.childLanes,R|=fl,Tt(a,m,R,Y,te,be),a===Vr&&(qi=Vr=null,Oi=0),Ho=u,du=a,Yr=m,Rl=R,Xo=E,mf=w,(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,tp(as,function(){return Ld(),null})):(a.callbackNode=null,a.callbackPriority=0),w=(u.flags&13878)!==0,(u.subtreeFlags&13878)!==0||w){w=Qe.T,Qe.T=null,E=bt.p,bt.p=2,Y=Tr,Tr|=4;try{wp(a,u,m)}finally{Tr=Y,bt.p=E,Qe.T=w}}ya=1,vf(),Wf(),Kf()}}function vf(){if(ya===1){ya=0;var a=du,u=Ho,m=(u.flags&13878)!==0;if((u.subtreeFlags&13878)!==0||m){m=Qe.T,Qe.T=null;var w=bt.p;bt.p=2;var E=Tr;Tr|=4;try{ah(u,a);var R=Ef,Y=Ou(a.containerInfo),te=R.focusedElem,be=R.selectionRange;if(Y!==te&&te&&te.ownerDocument&&Ui(te.ownerDocument.documentElement,te)){if(be!==null&&cl(te)){var Ge=be.start,nt=be.end;if(nt===void 0&&(nt=Ge),"selectionStart"in te)te.selectionStart=Ge,te.selectionEnd=Math.min(nt,te.value.length);else{var lt=te.ownerDocument||document,Xe=lt&&lt.defaultView||window;if(Xe.getSelection){var Ke=Xe.getSelection(),_i=te.textContent.length,fi=Math.min(be.start,_i),Mr=be.end===void 0?fi:Math.min(be.end,_i);!Ke.extend&&fi>Mr&&(Y=Mr,Mr=fi,fi=Y);var Oe=hs(te,fi),Ie=hs(te,Mr);if(Oe&&Ie&&(Ke.rangeCount!==1||Ke.anchorNode!==Oe.node||Ke.anchorOffset!==Oe.offset||Ke.focusNode!==Ie.node||Ke.focusOffset!==Ie.offset)){var qe=lt.createRange();qe.setStart(Oe.node,Oe.offset),Ke.removeAllRanges(),fi>Mr?(Ke.addRange(qe),Ke.extend(Ie.node,Ie.offset)):(qe.setEnd(Ie.node,Ie.offset),Ke.addRange(qe))}}}}for(lt=[],Ke=te;Ke=Ke.parentNode;)Ke.nodeType===1&&lt.push({element:Ke,left:Ke.scrollLeft,top:Ke.scrollTop});for(typeof te.focus=="function"&&te.focus(),te=0;te<lt.length;te++){var ct=lt[te];ct.element.scrollLeft=ct.left,ct.element.scrollTop=ct.top}}ce=!!Ud,Ef=Ud=null}finally{Tr=E,bt.p=w,Qe.T=m}}a.current=u,ya=2}}function Wf(){if(ya===2){ya=0;var a=du,u=Ho,m=(u.flags&8772)!==0;if((u.subtreeFlags&8772)!==0||m){m=Qe.T,Qe.T=null;var w=bt.p;bt.p=2;var E=Tr;Tr|=4;try{$h(a,u.alternate,u)}finally{Tr=E,bt.p=w,Qe.T=m}}ya=3}}function Kf(){if(ya===4||ya===3){ya=0,rs();var a=du,u=Ho,m=Yr,w=mf;(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?ya=5:(ya=0,Ho=du=null,Dl(a,a.pendingLanes));var E=a.pendingLanes;if(E===0&&(bc=null),Ii(m),u=u.stateNode,pn&&typeof pn.onCommitFiberRoot=="function")try{pn.onCommitFiberRoot(ss,u,void 0,(u.current.flags&128)===128)}catch{}if(w!==null){u=Qe.T,E=bt.p,bt.p=2,Qe.T=null;try{for(var R=a.onRecoverableError,Y=0;Y<w.length;Y++){var te=w[Y];R(te.value,{componentStack:te.stack})}}finally{Qe.T=u,bt.p=E}}(Yr&3)!==0&&fh(),sa(a),E=a.pendingLanes,(m&4194090)!==0&&(E&42)!==0?a===pu?fu++:(fu=0,pu=a):fu=0,Tc(0)}}function Dl(a,u){(a.pooledCacheLanes&=u)===0&&(u=a.pooledCache,u!=null&&(a.pooledCache=null,Do(u)))}function fh(a){return vf(),Wf(),Kf(),Ld()}function Ld(){if(ya!==5)return!1;var a=du,u=Rl;Rl=0;var m=Ii(Yr),w=Qe.T,E=bt.p;try{bt.p=32>m?32:m,Qe.T=null,m=Xo,Xo=null;var R=du,Y=Yr;if(ya=0,Ho=du=null,Yr=0,(Tr&6)!==0)throw Error(Z(331));var te=Tr;if(Tr|=4,Hh(R.current),hu(R,R.current,Y,m),Tr=te,Tc(0,!1),pn&&typeof pn.onPostCommitFiberRoot=="function")try{pn.onPostCommitFiberRoot(ss,R)}catch{}return!0}finally{bt.p=E,Qe.T=w,Dl(a,u)}}function Qf(a,u,m){u=zn(m,u),u=sf(a.stateNode,u,2),a=ks(a,u,2),a!==null&&(ke(a,2),sa(a))}function Ir(a,u,m){if(a.tag===3)Qf(a,a,m);else for(;u!==null;){if(u.tag===3){Qf(u,a,m);break}else if(u.tag===1){var w=u.stateNode;if(typeof u.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(bc===null||!bc.has(w))){a=zn(m,a),m=Yu(2),w=ks(u,m,2),w!==null&&(_p(m,w,u,a),ke(w,2),sa(w));break}}u=u.return}}function Jf(a,u,m){var w=a.pingCache;if(w===null){w=a.pingCache=new Mp;var E=new Set;w.set(u,E)}else E=w.get(u),E===void 0&&(E=new Set,w.set(u,E));E.has(m)||(Yh=!0,E.add(m),a=Zp.bind(null,a,u,m),u.then(a,a))}function Zp(a,u,m){var w=a.pingCache;w!==null&&w.delete(u),a.pingedLanes|=a.suspendedLanes&m,a.warmLanes&=~m,Vr===a&&(Oi&m)===m&&(_n===4||_n===3&&(Oi&62914560)===Oi&&300>sn()-df?(Tr&2)===0&&hh(a,0):uf|=m,uh===Oi&&(uh=0)),sa(a)}function ep(a,u){u===0&&(u=at()),a=qr(a,u),a!==null&&(ke(a,u),sa(a))}function Ep(a){var u=a.memoizedState,m=0;u!==null&&(m=u.retryLane),ep(a,m)}function bf(a,u){var m=0;switch(a.tag){case 13:var w=a.stateNode,E=a.memoizedState;E!==null&&(m=E.retryLane);break;case 19:w=a.stateNode;break;case 22:w=a.stateNode._retryCache;break;default:throw Error(Z(314))}w!==null&&w.delete(u),ep(a,m)}function tp(a,u){return xi(a,u)}var yu=null,xa=null,Os=!1,Bd=!1,Od=!1,ph=0;function sa(a){a!==xa&&a.next===null&&(xa===null?yu=xa=a:xa=xa.next=a),Bd=!0,Os||(Os=!0,rp())}function Tc(a,u){if(!Od&&Bd){Od=!0;do for(var m=!1,w=yu;w!==null;){if(a!==0){var E=w.pendingLanes;if(E===0)var R=0;else{var Y=w.suspendedLanes,te=w.pingedLanes;R=(1<<31-Ee(42|a)+1)-1,R&=E&~(Y&~te),R=R&201326741?R&201326741|1:R?R|2:0}R!==0&&(m=!0,ip(w,R))}else R=Oi,R=je(w,w===Vr?R:0,w.cancelPendingCommit!==null||w.timeoutHandle!==-1),(R&3)===0||Re(w,R)||(m=!0,ip(w,R));w=w.next}while(m);Od=!1}}function zp(){Fd()}function Fd(){Bd=Os=!1;var a=0;ph!==0&&(td()&&(a=ph),ph=0);for(var u=sn(),m=null,w=yu;w!==null;){var E=w.next,R=wf(w,u);R===0?(w.next=null,m===null?yu=E:m.next=E,E===null&&(xa=m)):(m=w,(a!==0||(R&3)!==0)&&(Bd=!0)),w=E}Tc(a)}function wf(a,u){for(var m=a.suspendedLanes,w=a.pingedLanes,E=a.expirationTimes,R=a.pendingLanes&-62914561;0<R;){var Y=31-Ee(R),te=1<<Y,be=E[Y];be===-1?((te&m)===0||(te&w)!==0)&&(E[Y]=Je(te,u)):be<=u&&(a.expiredLanes|=te),R&=~te}if(u=Vr,m=Oi,m=je(a,a===u?m:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),w=a.callbackNode,m===0||a===u&&(Ci===2||Ci===9)||a.cancelPendingCommit!==null)return w!==null&&w!==null&&Qr(w),a.callbackNode=null,a.callbackPriority=0;if((m&3)===0||Re(a,m)){if(u=m&-m,u===a.callbackPriority)return u;switch(w!==null&&Qr(w),Ii(m)){case 2:case 8:m=Wo;break;case 32:m=as;break;case 268435456:m=Ns;break;default:m=as}return w=_u.bind(null,a),m=xi(m,w),a.callbackPriority=u,a.callbackNode=m,u}return w!==null&&w!==null&&Qr(w),a.callbackPriority=2,a.callbackNode=null,2}function _u(a,u){if(ya!==0&&ya!==5)return a.callbackNode=null,a.callbackPriority=0,null;var m=a.callbackNode;if(fh()&&a.callbackNode!==m)return null;var w=Oi;return w=je(a,a===Vr?w:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),w===0?null:(gf(a,w,u),wf(a,sn()),a.callbackNode!=null&&a.callbackNode===m?_u.bind(null,a):null)}function ip(a,u){if(fh())return null;gf(a,u,!0)}function rp(){Rp(function(){(Tr&6)!==0?xi(ns,zp):Fd()})}function Qh(){return ph===0&&(ph=ht()),ph}function np(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:pi(""+a)}function Jh(a,u){var m=u.ownerDocument.createElement("input");return m.name=u.name,m.value=u.value,a.id&&m.setAttribute("form",a.id),u.parentNode.insertBefore(m,u),a=new FormData(a),m.parentNode.removeChild(m),a}function ap(a,u,m,w,E){if(u==="submit"&&m&&m.stateNode===E){var R=np((E[di]||null).action),Y=w.submitter;Y&&(u=(u=Y[di]||null)?np(u.formAction):Y.getAttribute("formAction"),u!==null&&(R=u,Y=null));var te=new Yn("action","action",null,w,E);a.push({event:te,listeners:[{instance:null,listener:function(){if(w.defaultPrevented){if(ph!==0){var be=Y?Jh(E,Y):new FormData(E);jr(m,{pending:!0,data:be,method:E.method,action:R},null,be)}}else typeof R=="function"&&(te.preventDefault(),be=Y?Jh(E,Y):new FormData(E),jr(m,{pending:!0,data:be,method:E.method,action:R},R,be))},currentTarget:E}]})}}for(var Sf=0;Sf<ju.length;Sf++){var Mc=ju[Sf],sp=Mc.toLowerCase(),Pp=Mc[0].toUpperCase()+Mc.slice(1);qa(sp,"on"+Pp)}qa(Eo,"onAnimationEnd"),qa(rc,"onAnimationIteration"),qa(Vc,"onAnimationStart"),qa("dblclick","onDoubleClick"),qa("focusin","onFocus"),qa("focusout","onBlur"),qa(Ph,"onTransitionRun"),qa(hl,"onTransitionStart"),qa(Uc,"onTransitionCancel"),qa(dl,"onTransitionEnd"),os("onMouseEnter",["mouseout","mouseover"]),os("onMouseLeave",["mouseout","mouseover"]),os("onPointerEnter",["pointerout","pointerover"]),os("onPointerLeave",["pointerout","pointerover"]),Vn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Vn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Vn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Vn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Vn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Vn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),op=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(mh));function lp(a,u){u=(u&4)!==0;for(var m=0;m<a.length;m++){var w=a[m],E=w.event;w=w.listeners;e:{var R=void 0;if(u)for(var Y=w.length-1;0<=Y;Y--){var te=w[Y],be=te.instance,Ge=te.currentTarget;if(te=te.listener,be!==R&&E.isPropagationStopped())break e;R=te,E.currentTarget=Ge;try{R(E)}catch(nt){Xu(nt)}E.currentTarget=null,R=be}else for(Y=0;Y<w.length;Y++){if(te=w[Y],be=te.instance,Ge=te.currentTarget,te=te.listener,be!==R&&E.isPropagationStopped())break e;R=te,E.currentTarget=Ge;try{R(E)}catch(nt){Xu(nt)}E.currentTarget=null,R=be}}}}function $i(a,u){var m=u[pt];m===void 0&&(m=u[pt]=new Set);var w=a+"__bubble";m.has(w)||(jd(u,a,2,!1),m.add(w))}function va(a,u,m){var w=0;u&&(w|=4),jd(m,a,w,u)}var es="_reactListening"+Math.random().toString(36).slice(2);function Tf(a){if(!a[es]){a[es]=!0,wi.forEach(function(m){m!=="selectionchange"&&(op.has(m)||va(m,!1,a),va(m,!0,a))});var u=a.nodeType===9?a:a.ownerDocument;u===null||u[es]||(u[es]=!0,va("selectionchange",!1,u))}}function jd(a,u,m,w){switch(et(u)){case 2:var E=Te;break;case 8:E=ye;break;default:E=ve}m=E.bind(null,u,m,a),E=void 0,!Dn||u!=="touchstart"&&u!=="touchmove"&&u!=="wheel"||(E=!0),w?E!==void 0?a.addEventListener(u,m,{capture:!0,passive:E}):a.addEventListener(u,m,!0):E!==void 0?a.addEventListener(u,m,{passive:E}):a.addEventListener(u,m,!1)}function Nd(a,u,m,w,E){var R=w;if((u&1)===0&&(u&2)===0&&w!==null)e:for(;;){if(w===null)return;var Y=w.tag;if(Y===3||Y===4){var te=w.stateNode.containerInfo;if(te===E)break;if(Y===4)for(Y=w.return;Y!==null;){var be=Y.tag;if((be===3||be===4)&&Y.stateNode.containerInfo===E)return;Y=Y.return}for(;te!==null;){if(Y=ai(te),Y===null)return;if(be=Y.tag,be===5||be===6||be===26||be===27){w=R=Y;continue e}te=te.parentNode}}w=w.return}mn(function(){var Ge=R,nt=kc(m),lt=[];e:{var Xe=En.get(a);if(Xe!==void 0){var Ke=Yn,_i=a;switch(a){case"keypress":if(ri(m)===0)break e;case"keydown":case"keyup":Ke=rl;break;case"focusin":_i="focus",Ke=xo;break;case"focusout":_i="blur",Ke=xo;break;case"beforeblur":case"afterblur":Ke=xo;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ke=Rc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ke=Rr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ke=Xl;break;case Eo:case rc:case Vc:Ke=en;break;case dl:Ke=Fc;break;case"scroll":case"scrollend":Ke=fd;break;case"wheel":Ke=Pu;break;case"copy":case"cut":case"paste":Ke=Ms;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ke=Bc;break;case"toggle":case"beforetoggle":Ke=bo}var fi=(u&4)!==0,Mr=!fi&&(a==="scroll"||a==="scrollend"),Oe=fi?Xe!==null?Xe+"Capture":null:Xe;fi=[];for(var Ie=Ge,qe;Ie!==null;){var ct=Ie;if(qe=ct.stateNode,ct=ct.tag,ct!==5&&ct!==26&&ct!==27||qe===null||Oe===null||(ct=ir(Ie,Oe),ct!=null&&fi.push(gh(Ie,ct,qe))),Mr)break;Ie=Ie.return}0<fi.length&&(Xe=new Ke(Xe,_i,null,m,nt),lt.push({event:Xe,listeners:fi}))}}if((u&7)===0){e:{if(Xe=a==="mouseover"||a==="pointerover",Ke=a==="mouseout"||a==="pointerout",Xe&&m!==Va&&(_i=m.relatedTarget||m.fromElement)&&(ai(_i)||_i[Bi]))break e;if((Ke||Xe)&&(Xe=nt.window===nt?nt:(Xe=nt.ownerDocument)?Xe.defaultView||Xe.parentWindow:window,Ke?(_i=m.relatedTarget||m.toElement,Ke=Ge,_i=_i?ai(_i):null,_i!==null&&(Mr=ie(_i),fi=_i.tag,_i!==Mr||fi!==5&&fi!==27&&fi!==6)&&(_i=null)):(Ke=null,_i=Ge),Ke!==_i)){if(fi=Rc,ct="onMouseLeave",Oe="onMouseEnter",Ie="mouse",(a==="pointerout"||a==="pointerover")&&(fi=Bc,ct="onPointerLeave",Oe="onPointerEnter",Ie="pointer"),Mr=Ke==null?Xe:lr(Ke),qe=_i==null?Xe:lr(_i),Xe=new fi(ct,Ie+"leave",Ke,m,nt),Xe.target=Mr,Xe.relatedTarget=qe,ct=null,ai(nt)===Ge&&(fi=new fi(Oe,Ie+"enter",_i,m,nt),fi.target=qe,fi.relatedTarget=Mr,ct=fi),Mr=ct,Ke&&_i)t:{for(fi=Ke,Oe=_i,Ie=0,qe=fi;qe;qe=Ac(qe))Ie++;for(qe=0,ct=Oe;ct;ct=Ac(ct))qe++;for(;0<Ie-qe;)fi=Ac(fi),Ie--;for(;0<qe-Ie;)Oe=Ac(Oe),qe--;for(;Ie--;){if(fi===Oe||Oe!==null&&fi===Oe.alternate)break t;fi=Ac(fi),Oe=Ac(Oe)}fi=null}else fi=null;Ke!==null&&Mf(lt,Xe,Ke,fi,!1),_i!==null&&Mr!==null&&Mf(lt,Mr,_i,fi,!0)}}e:{if(Xe=Ge?lr(Ge):window,Ke=Xe.nodeName&&Xe.nodeName.toLowerCase(),Ke==="select"||Ke==="input"&&Xe.type==="file")var Xt=Lu;else if(md(Xe))if(Es)Xt=nf;else{Xt=Ch;var Zi=Bu}else Ke=Xe.nodeName,!Ke||Ke.toLowerCase()!=="input"||Xe.type!=="checkbox"&&Xe.type!=="radio"?Ge&&Tn(Ge.elementType)&&(Xt=Lu):Xt=Eh;if(Xt&&(Xt=Xt(a,Ge))){Ql(lt,Xt,m,nt);break e}Zi&&Zi(a,Xe,Ge),a==="focusout"&&Ge&&Xe.type==="number"&&Ge.memoizedProps.value!=null&&Cu(Xe,"number",Xe.value)}switch(Zi=Ge?lr(Ge):window,a){case"focusin":(md(Zi)||Zi.contentEditable==="true")&&(ul=Zi,$s=Ge,Sr=null);break;case"focusout":Sr=$s=ul=null;break;case"mousedown":Mo=!0;break;case"contextmenu":case"mouseup":case"dragend":Mo=!1,Ga(lt,m,nt);break;case"selectionchange":if(zh)break;case"keydown":case"keyup":Ga(lt,m,nt)}var qt;if(So)e:{switch(a){case"compositionstart":var ci="onCompositionStart";break e;case"compositionend":ci="onCompositionEnd";break e;case"compositionupdate":ci="onCompositionUpdate";break e}ci=void 0}else al?Kl(a,m)&&(ci="onCompositionEnd"):a==="keydown"&&m.keyCode===229&&(ci="onCompositionStart");ci&&(nl&&m.locale!=="ko"&&(al||ci!=="onCompositionStart"?ci==="onCompositionEnd"&&al&&(qt=ii()):(Gr=nt,wr="value"in Gr?Gr.value:Gr.textContent,al=!0)),Zi=ed(Ge,ci),0<Zi.length&&(ci=new rf(ci,a,null,m,nt),lt.push({event:ci,listeners:Zi}),qt?ci.data=qt:(qt=jc(m),qt!==null&&(ci.data=qt)))),(qt=Iu?Si(a,m):ku(a,m))&&(ci=ed(Ge,"onBeforeInput"),0<ci.length&&(Zi=new rf("onBeforeInput","beforeinput",null,m,nt),lt.push({event:Zi,listeners:ci}),Zi.data=qt)),ap(lt,a,Ge,m,nt)}lp(lt,u)})}function gh(a,u,m){return{instance:a,listener:u,currentTarget:m}}function ed(a,u){for(var m=u+"Capture",w=[];a!==null;){var E=a,R=E.stateNode;if(E=E.tag,E!==5&&E!==26&&E!==27||R===null||(E=ir(a,m),E!=null&&w.unshift(gh(a,E,R)),E=ir(a,u),E!=null&&w.push(gh(a,E,R))),a.tag===3)return w;a=a.return}return[]}function Ac(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function Mf(a,u,m,w,E){for(var R=u._reactName,Y=[];m!==null&&m!==w;){var te=m,be=te.alternate,Ge=te.stateNode;if(te=te.tag,be!==null&&be===w)break;te!==5&&te!==26&&te!==27||Ge===null||(be=Ge,E?(Ge=ir(m,R),Ge!=null&&Y.unshift(gh(m,Ge,be))):E||(Ge=ir(m,R),Ge!=null&&Y.push(gh(m,Ge,be)))),m=m.return}Y.length!==0&&a.push({event:u,listeners:Y})}var Vd=/\r\n?/g,Ip=/\u0000|\uFFFD/g;function Af(a){return(typeof a=="string"?a:""+a).replace(Vd,`
`).replace(Ip,"")}function cp(a,u){return u=Af(u),Af(a)===u}function Da(){}function ur(a,u,m,w,E,R){switch(m){case"children":typeof w=="string"?u==="body"||u==="textarea"&&w===""||cs(a,w):(typeof w=="number"||typeof w=="bigint")&&u!=="body"&&cs(a,""+w);break;case"className":tr(a,"class",w);break;case"tabIndex":tr(a,"tabindex",w);break;case"dir":case"role":case"viewBox":case"width":case"height":tr(a,m,w);break;case"style":Gs(a,w,R);break;case"data":if(u!=="object"){tr(a,"data",w);break}case"src":case"href":if(w===""&&(u!=="a"||m!=="href")){a.removeAttribute(m);break}if(w==null||typeof w=="function"||typeof w=="symbol"||typeof w=="boolean"){a.removeAttribute(m);break}w=pi(""+w),a.setAttribute(m,w);break;case"action":case"formAction":if(typeof w=="function"){a.setAttribute(m,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof R=="function"&&(m==="formAction"?(u!=="input"&&ur(a,u,"name",E.name,E,null),ur(a,u,"formEncType",E.formEncType,E,null),ur(a,u,"formMethod",E.formMethod,E,null),ur(a,u,"formTarget",E.formTarget,E,null)):(ur(a,u,"encType",E.encType,E,null),ur(a,u,"method",E.method,E,null),ur(a,u,"target",E.target,E,null)));if(w==null||typeof w=="symbol"||typeof w=="boolean"){a.removeAttribute(m);break}w=pi(""+w),a.setAttribute(m,w);break;case"onClick":w!=null&&(a.onclick=Da);break;case"onScroll":w!=null&&$i("scroll",a);break;case"onScrollEnd":w!=null&&$i("scrollend",a);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(Z(61));if(m=w.__html,m!=null){if(E.children!=null)throw Error(Z(60));a.innerHTML=m}}break;case"multiple":a.multiple=w&&typeof w!="function"&&typeof w!="symbol";break;case"muted":a.muted=w&&typeof w!="function"&&typeof w!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(w==null||typeof w=="function"||typeof w=="boolean"||typeof w=="symbol"){a.removeAttribute("xlink:href");break}m=pi(""+w),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":w!=null&&typeof w!="function"&&typeof w!="symbol"?a.setAttribute(m,""+w):a.removeAttribute(m);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":w&&typeof w!="function"&&typeof w!="symbol"?a.setAttribute(m,""):a.removeAttribute(m);break;case"capture":case"download":w===!0?a.setAttribute(m,""):w!==!1&&w!=null&&typeof w!="function"&&typeof w!="symbol"?a.setAttribute(m,w):a.removeAttribute(m);break;case"cols":case"rows":case"size":case"span":w!=null&&typeof w!="function"&&typeof w!="symbol"&&!isNaN(w)&&1<=w?a.setAttribute(m,w):a.removeAttribute(m);break;case"rowSpan":case"start":w==null||typeof w=="function"||typeof w=="symbol"||isNaN(w)?a.removeAttribute(m):a.setAttribute(m,w);break;case"popover":$i("beforetoggle",a),$i("toggle",a),Sn(a,"popover",w);break;case"xlinkActuate":ja(a,"http://www.w3.org/1999/xlink","xlink:actuate",w);break;case"xlinkArcrole":ja(a,"http://www.w3.org/1999/xlink","xlink:arcrole",w);break;case"xlinkRole":ja(a,"http://www.w3.org/1999/xlink","xlink:role",w);break;case"xlinkShow":ja(a,"http://www.w3.org/1999/xlink","xlink:show",w);break;case"xlinkTitle":ja(a,"http://www.w3.org/1999/xlink","xlink:title",w);break;case"xlinkType":ja(a,"http://www.w3.org/1999/xlink","xlink:type",w);break;case"xmlBase":ja(a,"http://www.w3.org/XML/1998/namespace","xml:base",w);break;case"xmlLang":ja(a,"http://www.w3.org/XML/1998/namespace","xml:lang",w);break;case"xmlSpace":ja(a,"http://www.w3.org/XML/1998/namespace","xml:space",w);break;case"is":Sn(a,"is",w);break;case"innerText":case"textContent":break;default:(!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(m=fo.get(m)||m,Sn(a,m,w))}}function yh(a,u,m,w,E,R){switch(m){case"style":Gs(a,w,R);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(Z(61));if(m=w.__html,m!=null){if(E.children!=null)throw Error(Z(60));a.innerHTML=m}}break;case"children":typeof w=="string"?cs(a,w):(typeof w=="number"||typeof w=="bigint")&&cs(a,""+w);break;case"onScroll":w!=null&&$i("scroll",a);break;case"onScrollEnd":w!=null&&$i("scrollend",a);break;case"onClick":w!=null&&(a.onclick=Da);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Pc.hasOwnProperty(m))e:{if(m[0]==="o"&&m[1]==="n"&&(E=m.endsWith("Capture"),u=m.slice(2,E?m.length-7:void 0),R=a[di]||null,R=R!=null?R[m]:null,typeof R=="function"&&a.removeEventListener(u,R,E),typeof w=="function")){typeof R!="function"&&R!==null&&(m in a?a[m]=null:a.hasAttribute(m)&&a.removeAttribute(m)),a.addEventListener(u,w,E);break e}m in a?a[m]=w:w===!0?a.setAttribute(m,""):Sn(a,m,w)}}}function xn(a,u,m){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":$i("error",a),$i("load",a);var w=!1,E=!1,R;for(R in m)if(m.hasOwnProperty(R)){var Y=m[R];if(Y!=null)switch(R){case"src":w=!0;break;case"srcSet":E=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(Z(137,u));default:ur(a,u,R,Y,m,null)}}E&&ur(a,u,"srcSet",m.srcSet,m,null),w&&ur(a,u,"src",m.src,m,null);return;case"input":$i("invalid",a);var te=R=Y=E=null,be=null,Ge=null;for(w in m)if(m.hasOwnProperty(w)){var nt=m[w];if(nt!=null)switch(w){case"name":E=nt;break;case"type":Y=nt;break;case"checked":be=nt;break;case"defaultChecked":Ge=nt;break;case"value":R=nt;break;case"defaultValue":te=nt;break;case"children":case"dangerouslySetInnerHTML":if(nt!=null)throw Error(Z(137,u));break;default:ur(a,u,w,nt,m,null)}}$l(a,R,te,be,Ge,Y,E,!1),ql(a);return;case"select":$i("invalid",a),w=Y=R=null;for(E in m)if(m.hasOwnProperty(E)&&(te=m[E],te!=null))switch(E){case"value":R=te;break;case"defaultValue":Y=te;break;case"multiple":w=te;default:ur(a,u,E,te,m,null)}u=R,m=Y,a.multiple=!!w,u!=null?Jo(a,!!w,u,!1):m!=null&&Jo(a,!!w,m,!0);return;case"textarea":$i("invalid",a),R=E=w=null;for(Y in m)if(m.hasOwnProperty(Y)&&(te=m[Y],te!=null))switch(Y){case"value":w=te;break;case"defaultValue":E=te;break;case"children":R=te;break;case"dangerouslySetInnerHTML":if(te!=null)throw Error(Z(91));break;default:ur(a,u,Y,te,m,null)}Us(a,w,E,R),ql(a);return;case"option":for(be in m)if(m.hasOwnProperty(be)&&(w=m[be],w!=null))switch(be){case"selected":a.selected=w&&typeof w!="function"&&typeof w!="symbol";break;default:ur(a,u,be,w,m,null)}return;case"dialog":$i("beforetoggle",a),$i("toggle",a),$i("cancel",a),$i("close",a);break;case"iframe":case"object":$i("load",a);break;case"video":case"audio":for(w=0;w<mh.length;w++)$i(mh[w],a);break;case"image":$i("error",a),$i("load",a);break;case"details":$i("toggle",a);break;case"embed":case"source":case"link":$i("error",a),$i("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ge in m)if(m.hasOwnProperty(Ge)&&(w=m[Ge],w!=null))switch(Ge){case"children":case"dangerouslySetInnerHTML":throw Error(Z(137,u));default:ur(a,u,Ge,w,m,null)}return;default:if(Tn(u)){for(nt in m)m.hasOwnProperty(nt)&&(w=m[nt],w!==void 0&&yh(a,u,nt,w,m,void 0));return}}for(te in m)m.hasOwnProperty(te)&&(w=m[te],w!=null&&ur(a,u,te,w,m,null))}function Cf(a,u,m,w){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var E=null,R=null,Y=null,te=null,be=null,Ge=null,nt=null;for(Ke in m){var lt=m[Ke];if(m.hasOwnProperty(Ke)&&lt!=null)switch(Ke){case"checked":break;case"value":break;case"defaultValue":be=lt;default:w.hasOwnProperty(Ke)||ur(a,u,Ke,null,w,lt)}}for(var Xe in w){var Ke=w[Xe];if(lt=m[Xe],w.hasOwnProperty(Xe)&&(Ke!=null||lt!=null))switch(Xe){case"type":R=Ke;break;case"name":E=Ke;break;case"checked":Ge=Ke;break;case"defaultChecked":nt=Ke;break;case"value":Y=Ke;break;case"defaultValue":te=Ke;break;case"children":case"dangerouslySetInnerHTML":if(Ke!=null)throw Error(Z(137,u));break;default:Ke!==lt&&ur(a,u,Xe,Ke,w,lt)}}Au(a,Y,te,be,Ge,nt,R,E);return;case"select":Ke=Y=te=Xe=null;for(R in m)if(be=m[R],m.hasOwnProperty(R)&&be!=null)switch(R){case"value":break;case"multiple":Ke=be;default:w.hasOwnProperty(R)||ur(a,u,R,null,w,be)}for(E in w)if(R=w[E],be=m[E],w.hasOwnProperty(E)&&(R!=null||be!=null))switch(E){case"value":Xe=R;break;case"defaultValue":te=R;break;case"multiple":Y=R;default:R!==be&&ur(a,u,E,R,w,be)}u=te,m=Y,w=Ke,Xe!=null?Jo(a,!!m,Xe,!1):!!w!=!!m&&(u!=null?Jo(a,!!m,u,!0):Jo(a,!!m,m?[]:"",!1));return;case"textarea":Ke=Xe=null;for(te in m)if(E=m[te],m.hasOwnProperty(te)&&E!=null&&!w.hasOwnProperty(te))switch(te){case"value":break;case"children":break;default:ur(a,u,te,null,w,E)}for(Y in w)if(E=w[Y],R=m[Y],w.hasOwnProperty(Y)&&(E!=null||R!=null))switch(Y){case"value":Xe=E;break;case"defaultValue":Ke=E;break;case"children":break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(Z(91));break;default:E!==R&&ur(a,u,Y,E,w,R)}tf(a,Xe,Ke);return;case"option":for(var _i in m)if(Xe=m[_i],m.hasOwnProperty(_i)&&Xe!=null&&!w.hasOwnProperty(_i))switch(_i){case"selected":a.selected=!1;break;default:ur(a,u,_i,null,w,Xe)}for(be in w)if(Xe=w[be],Ke=m[be],w.hasOwnProperty(be)&&Xe!==Ke&&(Xe!=null||Ke!=null))switch(be){case"selected":a.selected=Xe&&typeof Xe!="function"&&typeof Xe!="symbol";break;default:ur(a,u,be,Xe,w,Ke)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var fi in m)Xe=m[fi],m.hasOwnProperty(fi)&&Xe!=null&&!w.hasOwnProperty(fi)&&ur(a,u,fi,null,w,Xe);for(Ge in w)if(Xe=w[Ge],Ke=m[Ge],w.hasOwnProperty(Ge)&&Xe!==Ke&&(Xe!=null||Ke!=null))switch(Ge){case"children":case"dangerouslySetInnerHTML":if(Xe!=null)throw Error(Z(137,u));break;default:ur(a,u,Ge,Xe,w,Ke)}return;default:if(Tn(u)){for(var Mr in m)Xe=m[Mr],m.hasOwnProperty(Mr)&&Xe!==void 0&&!w.hasOwnProperty(Mr)&&yh(a,u,Mr,void 0,w,Xe);for(nt in w)Xe=w[nt],Ke=m[nt],!w.hasOwnProperty(nt)||Xe===Ke||Xe===void 0&&Ke===void 0||yh(a,u,nt,Xe,w,Ke);return}}for(var Oe in m)Xe=m[Oe],m.hasOwnProperty(Oe)&&Xe!=null&&!w.hasOwnProperty(Oe)&&ur(a,u,Oe,null,w,Xe);for(lt in w)Xe=w[lt],Ke=m[lt],!w.hasOwnProperty(lt)||Xe===Ke||Xe==null&&Ke==null||ur(a,u,lt,Xe,w,Ke)}var Ud=null,Ef=null;function Gd(a){return a.nodeType===9?a:a.ownerDocument}function up(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function qd(a,u){if(a===0)switch(u){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&u==="foreignObject"?0:a}function co(a,u){return a==="textarea"||a==="noscript"||typeof u.children=="string"||typeof u.children=="number"||typeof u.children=="bigint"||typeof u.dangerouslySetInnerHTML=="object"&&u.dangerouslySetInnerHTML!==null&&u.dangerouslySetInnerHTML.__html!=null}var Zd=null;function td(){var a=window.event;return a&&a.type==="popstate"?a===Zd?!1:(Zd=a,!0):(Zd=null,!1)}var $d=typeof setTimeout=="function"?setTimeout:void 0,hp=typeof clearTimeout=="function"?clearTimeout:void 0,kp=typeof Promise=="function"?Promise:void 0,Rp=typeof queueMicrotask=="function"?queueMicrotask:typeof kp<"u"?function(a){return kp.resolve(null).then(a).catch(zf)}:$d;function zf(a){setTimeout(function(){throw a})}function Cc(a){return a==="head"}function id(a,u){var m=u,w=0,E=0;do{var R=m.nextSibling;if(a.removeChild(m),R&&R.nodeType===8)if(m=R.data,m==="/$"){if(0<w&&8>w){m=w;var Y=a.ownerDocument;if(m&1&&xu(Y.documentElement),m&2&&xu(Y.body),m&4)for(m=Y.head,xu(m),Y=m.firstChild;Y;){var te=Y.nextSibling,be=Y.nodeName;Y[dr]||be==="SCRIPT"||be==="STYLE"||be==="LINK"&&Y.rel.toLowerCase()==="stylesheet"||m.removeChild(Y),Y=te}}if(E===0){a.removeChild(R),Vi(u);return}E--}else m==="$"||m==="$?"||m==="$!"?E++:w=m.charCodeAt(0)-48;else w=0;m=R}while(m);Vi(u)}function Hd(a){var u=a.firstChild;for(u&&u.nodeType===10&&(u=u.nextSibling);u;){var m=u;switch(u=u.nextSibling,m.nodeName){case"HTML":case"HEAD":case"BODY":Hd(m),xt(m);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(m.rel.toLowerCase()==="stylesheet")continue}a.removeChild(m)}}function _h(a,u,m,w){for(;a.nodeType===1;){var E=m;if(a.nodeName.toLowerCase()!==u.toLowerCase()){if(!w&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(w){if(!a[dr])switch(u){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(R=a.getAttribute("rel"),R==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(R!==E.rel||a.getAttribute("href")!==(E.href==null||E.href===""?null:E.href)||a.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin)||a.getAttribute("title")!==(E.title==null?null:E.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(R=a.getAttribute("src"),(R!==(E.src==null?null:E.src)||a.getAttribute("type")!==(E.type==null?null:E.type)||a.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin))&&R&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(u==="input"&&a.type==="hidden"){var R=E.name==null?null:""+E.name;if(E.type==="hidden"&&a.getAttribute("name")===R)return a}else return a;if(a=Yo(a.nextSibling),a===null)break}return null}function xh(a,u,m){if(u==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!m||(a=Yo(a.nextSibling),a===null))return null;return a}function rd(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function dp(a,u){var m=a.ownerDocument;if(a.data!=="$?"||m.readyState==="complete")u();else{var w=function(){u(),m.removeEventListener("DOMContentLoaded",w)};m.addEventListener("DOMContentLoaded",w),a._reactRetry=w}}function Yo(a){for(;a!=null;a=a.nextSibling){var u=a.nodeType;if(u===1||u===3)break;if(u===8){if(u=a.data,u==="$"||u==="$!"||u==="$?"||u==="F!"||u==="F")break;if(u==="/$")return null}}return a}var vh=null;function Ll(a){a=a.previousSibling;for(var u=0;a;){if(a.nodeType===8){var m=a.data;if(m==="$"||m==="$!"||m==="$?"){if(u===0)return a;u--}else m==="/$"&&u++}a=a.previousSibling}return null}function Rn(a,u,m){switch(u=Gd(m),a){case"html":if(a=u.documentElement,!a)throw Error(Z(452));return a;case"head":if(a=u.head,!a)throw Error(Z(453));return a;case"body":if(a=u.body,!a)throw Error(Z(454));return a;default:throw Error(Z(451))}}function xu(a){for(var u=a.attributes;u.length;)a.removeAttributeNode(u[0]);xt(a)}var ts=new Map,Xd=new Set;function bh(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Bl=bt.d;bt.d={f:Ol,r:Dp,D:Yd,C:vu,L:Lp,m:Wd,X:kf,S:If,M:Rf};function Ol(){var a=Bl.f(),u=zd();return a||u}function Dp(a){var u=si(a);u!==null&&u.tag===5&&u.type==="form"?_r(u):Bl.r(a)}var wh=typeof document>"u"?null:document;function Pf(a,u,m){var w=wh;if(w&&typeof u=="string"&&u){var E=wa(u);E='link[rel="'+a+'"][href="'+E+'"]',typeof m=="string"&&(E+='[crossorigin="'+m+'"]'),Xd.has(E)||(Xd.add(E),a={rel:a,crossOrigin:m,href:u},w.querySelector(E)===null&&(u=w.createElement("link"),xn(u,"link",a),or(u),w.head.appendChild(u)))}}function Yd(a){Bl.D(a),Pf("dns-prefetch",a,null)}function vu(a,u){Bl.C(a,u),Pf("preconnect",a,u)}function Lp(a,u,m){Bl.L(a,u,m);var w=wh;if(w&&a&&u){var E='link[rel="preload"][as="'+wa(u)+'"]';u==="image"&&m&&m.imageSrcSet?(E+='[imagesrcset="'+wa(m.imageSrcSet)+'"]',typeof m.imageSizes=="string"&&(E+='[imagesizes="'+wa(m.imageSizes)+'"]')):E+='[href="'+wa(a)+'"]';var R=E;switch(u){case"style":R=Fl(a);break;case"script":R=sd(a)}ts.has(R)||(a=Ce({rel:"preload",href:u==="image"&&m&&m.imageSrcSet?void 0:a,as:u},m),ts.set(R,a),w.querySelector(E)!==null||u==="style"&&w.querySelector(Sh(R))||u==="script"&&w.querySelector(l(R))||(u=w.createElement("link"),xn(u,"link",a),or(u),w.head.appendChild(u)))}}function Wd(a,u){Bl.m(a,u);var m=wh;if(m&&a){var w=u&&typeof u.as=="string"?u.as:"script",E='link[rel="modulepreload"][as="'+wa(w)+'"][href="'+wa(a)+'"]',R=E;switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":R=sd(a)}if(!ts.has(R)&&(a=Ce({rel:"modulepreload",href:a},u),ts.set(R,a),m.querySelector(E)===null)){switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(m.querySelector(l(R)))return}w=m.createElement("link"),xn(w,"link",a),or(w),m.head.appendChild(w)}}}function If(a,u,m){Bl.S(a,u,m);var w=wh;if(w&&a){var E=Oa(w).hoistableStyles,R=Fl(a);u=u||"default";var Y=E.get(R);if(!Y){var te={loading:0,preload:null};if(Y=w.querySelector(Sh(R)))te.loading=5;else{a=Ce({rel:"stylesheet",href:a,"data-precedence":u},m),(m=ts.get(R))&&d(a,m);var be=Y=w.createElement("link");or(be),xn(be,"link",a),be._p=new Promise(function(Ge,nt){be.onload=Ge,be.onerror=nt}),be.addEventListener("load",function(){te.loading|=1}),be.addEventListener("error",function(){te.loading|=2}),te.loading|=4,s(Y,u,w)}Y={type:"stylesheet",instance:Y,count:1,state:te},E.set(R,Y)}}}function kf(a,u){Bl.X(a,u);var m=wh;if(m&&a){var w=Oa(m).hoistableScripts,E=sd(a),R=w.get(E);R||(R=m.querySelector(l(E)),R||(a=Ce({src:a,async:!0},u),(u=ts.get(E))&&_(a,u),R=m.createElement("script"),or(R),xn(R,"link",a),m.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},w.set(E,R))}}function Rf(a,u){Bl.M(a,u);var m=wh;if(m&&a){var w=Oa(m).hoistableScripts,E=sd(a),R=w.get(E);R||(R=m.querySelector(l(E)),R||(a=Ce({src:a,async:!0,type:"module"},u),(u=ts.get(E))&&_(a,u),R=m.createElement("script"),or(R),xn(R,"link",a),m.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},w.set(E,R))}}function nd(a,u,m,w){var E=(E=Zt.current)?bh(E):null;if(!E)throw Error(Z(446));switch(a){case"meta":case"title":return null;case"style":return typeof m.precedence=="string"&&typeof m.href=="string"?(u=Fl(m.href),m=Oa(E).hoistableStyles,w=m.get(u),w||(w={type:"style",instance:null,count:0,state:null},m.set(u,w)),w):{type:"void",instance:null,count:0,state:null};case"link":if(m.rel==="stylesheet"&&typeof m.href=="string"&&typeof m.precedence=="string"){a=Fl(m.href);var R=Oa(E).hoistableStyles,Y=R.get(a);if(Y||(E=E.ownerDocument||E,Y={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},R.set(a,Y),(R=E.querySelector(Sh(a)))&&!R._p&&(Y.instance=R,Y.state.loading=5),ts.has(a)||(m={rel:"preload",as:"style",href:m.href,crossOrigin:m.crossOrigin,integrity:m.integrity,media:m.media,hrefLang:m.hrefLang,referrerPolicy:m.referrerPolicy},ts.set(a,m),R||fp(E,a,m,Y.state))),u&&w===null)throw Error(Z(528,""));return Y}if(u&&w!==null)throw Error(Z(529,""));return null;case"script":return u=m.async,m=m.src,typeof m=="string"&&u&&typeof u!="function"&&typeof u!="symbol"?(u=sd(m),m=Oa(E).hoistableScripts,w=m.get(u),w||(w={type:"script",instance:null,count:0,state:null},m.set(u,w)),w):{type:"void",instance:null,count:0,state:null};default:throw Error(Z(444,a))}}function Fl(a){return'href="'+wa(a)+'"'}function Sh(a){return'link[rel="stylesheet"]['+a+"]"}function ad(a){return Ce({},a,{"data-precedence":a.precedence,precedence:null})}function fp(a,u,m,w){a.querySelector('link[rel="preload"][as="style"]['+u+"]")?w.loading=1:(u=a.createElement("link"),w.preload=u,u.addEventListener("load",function(){return w.loading|=1}),u.addEventListener("error",function(){return w.loading|=2}),xn(u,"link",m),or(u),a.head.appendChild(u))}function sd(a){return'[src="'+wa(a)+'"]'}function l(a){return"script[async]"+a}function i(a,u,m){if(u.count++,u.instance===null)switch(u.type){case"style":var w=a.querySelector('style[data-href~="'+wa(m.href)+'"]');if(w)return u.instance=w,or(w),w;var E=Ce({},m,{"data-href":m.href,"data-precedence":m.precedence,href:null,precedence:null});return w=(a.ownerDocument||a).createElement("style"),or(w),xn(w,"style",E),s(w,m.precedence,a),u.instance=w;case"stylesheet":E=Fl(m.href);var R=a.querySelector(Sh(E));if(R)return u.state.loading|=4,u.instance=R,or(R),R;w=ad(m),(E=ts.get(E))&&d(w,E),R=(a.ownerDocument||a).createElement("link"),or(R);var Y=R;return Y._p=new Promise(function(te,be){Y.onload=te,Y.onerror=be}),xn(R,"link",w),u.state.loading|=4,s(R,m.precedence,a),u.instance=R;case"script":return R=sd(m.src),(E=a.querySelector(l(R)))?(u.instance=E,or(E),E):(w=m,(E=ts.get(R))&&(w=Ce({},m),_(w,E)),a=a.ownerDocument||a,E=a.createElement("script"),or(E),xn(E,"link",w),a.head.appendChild(E),u.instance=E);case"void":return null;default:throw Error(Z(443,u.type))}else u.type==="stylesheet"&&(u.state.loading&4)===0&&(w=u.instance,u.state.loading|=4,s(w,m.precedence,a));return u.instance}function s(a,u,m){for(var w=m.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),E=w.length?w[w.length-1]:null,R=E,Y=0;Y<w.length;Y++){var te=w[Y];if(te.dataset.precedence===u)R=te;else if(R!==E)break}R?R.parentNode.insertBefore(a,R.nextSibling):(u=m.nodeType===9?m.head:m,u.insertBefore(a,u.firstChild))}function d(a,u){a.crossOrigin==null&&(a.crossOrigin=u.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=u.referrerPolicy),a.title==null&&(a.title=u.title)}function _(a,u){a.crossOrigin==null&&(a.crossOrigin=u.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=u.referrerPolicy),a.integrity==null&&(a.integrity=u.integrity)}var T=null;function n(a,u,m){if(T===null){var w=new Map,E=T=new Map;E.set(m,w)}else E=T,w=E.get(m),w||(w=new Map,E.set(m,w));if(w.has(a))return w;for(w.set(a,null),m=m.getElementsByTagName(a),E=0;E<m.length;E++){var R=m[E];if(!(R[dr]||R[Lt]||a==="link"&&R.getAttribute("rel")==="stylesheet")&&R.namespaceURI!=="http://www.w3.org/2000/svg"){var Y=R.getAttribute(u)||"";Y=a+Y;var te=w.get(Y);te?te.push(R):w.set(Y,[R])}}return w}function e(a,u,m){a=a.ownerDocument||a,a.head.insertBefore(m,u==="title"?a.querySelector("head > title"):null)}function r(a,u,m){if(m===1||u.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof u.precedence!="string"||typeof u.href!="string"||u.href==="")break;return!0;case"link":if(typeof u.rel!="string"||typeof u.href!="string"||u.href===""||u.onLoad||u.onError)break;switch(u.rel){case"stylesheet":return a=u.disabled,typeof u.precedence=="string"&&a==null;default:return!0}case"script":if(u.async&&typeof u.async!="function"&&typeof u.async!="symbol"&&!u.onLoad&&!u.onError&&u.src&&typeof u.src=="string")return!0}return!1}function o(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var h=null;function p(){}function g(a,u,m){if(h===null)throw Error(Z(475));var w=h;if(u.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var E=Fl(m.href),R=a.querySelector(Sh(E));if(R){a=R._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(w.count++,w=M.bind(w),a.then(w,w)),u.state.loading|=4,u.instance=R,or(R);return}R=a.ownerDocument||a,m=ad(m),(E=ts.get(E))&&d(m,E),R=R.createElement("link"),or(R);var Y=R;Y._p=new Promise(function(te,be){Y.onload=te,Y.onerror=be}),xn(R,"link",m),u.instance=R}w.stylesheets===null&&(w.stylesheets=new Map),w.stylesheets.set(u,a),(a=u.state.preload)&&(u.state.loading&3)===0&&(w.count++,u=M.bind(w),a.addEventListener("load",u),a.addEventListener("error",u))}}function v(){if(h===null)throw Error(Z(475));var a=h;return a.stylesheets&&a.count===0&&z(a,a.stylesheets),0<a.count?function(u){var m=setTimeout(function(){if(a.stylesheets&&z(a,a.stylesheets),a.unsuspend){var w=a.unsuspend;a.unsuspend=null,w()}},6e4);return a.unsuspend=u,function(){a.unsuspend=null,clearTimeout(m)}}:null}function M(){if(this.count--,this.count===0){if(this.stylesheets)z(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var A=null;function z(a,u){a.stylesheets=null,a.unsuspend!==null&&(a.count++,A=new Map,u.forEach(I,a),A=null,M.call(a))}function I(a,u){if(!(u.state.loading&4)){var m=A.get(a);if(m)var w=m.get(null);else{m=new Map,A.set(a,m);for(var E=a.querySelectorAll("link[data-precedence],style[data-precedence]"),R=0;R<E.length;R++){var Y=E[R];(Y.nodeName==="LINK"||Y.getAttribute("media")!=="not all")&&(m.set(Y.dataset.precedence,Y),w=Y)}w&&m.set(null,w)}E=u.instance,Y=E.getAttribute("data-precedence"),R=m.get(Y)||w,R===w&&m.set(null,E),m.set(Y,E),this.count++,w=M.bind(this),E.addEventListener("load",w),E.addEventListener("error",w),R?R.parentNode.insertBefore(E,R.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(E,a.firstChild)),u.state.loading|=4}}var L={$$typeof:ot,Provider:null,Consumer:null,_currentValue:Be,_currentValue2:Be,_threadCount:0};function B(a,u,m,w,E,R,Y,te){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Dt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Dt(0),this.hiddenUpdates=Dt(null),this.identifierPrefix=w,this.onUncaughtError=E,this.onCaughtError=R,this.onRecoverableError=Y,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=te,this.incompleteTransitions=new Map}function j(a,u,m,w,E,R,Y,te,be,Ge,nt,lt){return a=new B(a,u,m,Y,te,be,Ge,lt),u=1,R===!0&&(u|=24),R=Ma(3,null,null,u),a.current=R,R.stateNode=a,u=Is(),u.refCount++,a.pooledCache=u,u.refCount++,R.memoizedState={element:w,isDehydrated:m,cache:u},qu(R),a}function q(a){return a?(a=ni,a):ni}function X(a,u,m,w,E,R){E=q(E),w.context===null?w.context=E:w.pendingContext=E,w=to(u),w.payload={element:m},R=R===void 0?null:R,R!==null&&(w.callback=R),m=ks(a,w,u),m!==null&&(Bs(m,a,u),Bo(m,a,u))}function J(a,u){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var m=a.retryLane;a.retryLane=m!==0&&m<u?m:u}}function ue(a,u){J(a,u),(a=a.alternate)&&J(a,u)}function le(a){if(a.tag===13){var u=qr(a,67108864);u!==null&&Bs(u,a,67108864),ue(a,67108864)}}var ce=!0;function Te(a,u,m,w){var E=Qe.T;Qe.T=null;var R=bt.p;try{bt.p=2,ve(a,u,m,w)}finally{bt.p=R,Qe.T=E}}function ye(a,u,m,w){var E=Qe.T;Qe.T=null;var R=bt.p;try{bt.p=8,ve(a,u,m,w)}finally{bt.p=R,Qe.T=E}}function ve(a,u,m,w){if(ce){var E=we(w);if(E===null)Nd(a,u,w,Ye,m),Kt(a,w);else if(Fi(E,a,u,m,w))w.stopPropagation();else if(Kt(a,w),u&4&&-1<Wt.indexOf(a)){for(;E!==null;){var R=si(E);if(R!==null)switch(R.tag){case 3:if(R=R.stateNode,R.current.memoizedState.isDehydrated){var Y=Pe(R.pendingLanes);if(Y!==0){var te=R;for(te.pendingLanes|=2,te.entangledLanes|=2;Y;){var be=1<<31-Ee(Y);te.entanglements[1]|=be,Y&=~be}sa(R),(Tr&6)===0&&(ff=sn()+500,Tc(0))}}break;case 13:te=qr(R,2),te!==null&&Bs(te,R,2),zd(),ue(R,2)}if(R=we(w),R===null&&Nd(a,u,w,Ye,m),R===E)break;E=R}E!==null&&w.stopPropagation()}else Nd(a,u,w,null,m)}}function we(a){return a=kc(a),We(a)}var Ye=null;function We(a){if(Ye=null,a=ai(a),a!==null){var u=ie(a);if(u===null)a=null;else{var m=u.tag;if(m===13){if(a=F(u),a!==null)return a;a=null}else if(m===3){if(u.stateNode.current.memoizedState.isDehydrated)return u.tag===3?u.stateNode.containerInfo:null;a=null}else u!==a&&(a=null)}}return Ye=a,null}function et(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Nn()){case ns:return 2;case Wo:return 8;case as:case La:return 32;case Ns:return 268435456;default:return 32}default:return 32}}var Ue=!1,it=null,tt=null,Pt=null,jt=new Map,kt=new Map,vt=[],Wt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Kt(a,u){switch(a){case"focusin":case"focusout":it=null;break;case"dragenter":case"dragleave":tt=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":jt.delete(u.pointerId);break;case"gotpointercapture":case"lostpointercapture":kt.delete(u.pointerId)}}function li(a,u,m,w,E,R){return a===null||a.nativeEvent!==R?(a={blockedOn:u,domEventName:m,eventSystemFlags:w,nativeEvent:R,targetContainers:[E]},u!==null&&(u=si(u),u!==null&&le(u)),a):(a.eventSystemFlags|=w,u=a.targetContainers,E!==null&&u.indexOf(E)===-1&&u.push(E),a)}function Fi(a,u,m,w,E){switch(u){case"focusin":return it=li(it,a,u,m,w,E),!0;case"dragenter":return tt=li(tt,a,u,m,w,E),!0;case"mouseover":return Pt=li(Pt,a,u,m,w,E),!0;case"pointerover":var R=E.pointerId;return jt.set(R,li(jt.get(R)||null,a,u,m,w,E)),!0;case"gotpointercapture":return R=E.pointerId,kt.set(R,li(kt.get(R)||null,a,u,m,w,E)),!0}return!1}function Ki(a){var u=ai(a.target);if(u!==null){var m=ie(u);if(m!==null){if(u=m.tag,u===13){if(u=F(m),u!==null){a.blockedOn=u,er(a.priority,function(){if(m.tag===13){var w=_a();w=hi(w);var E=qr(m,w);E!==null&&Bs(E,m,w),ue(m,w)}});return}}else if(u===3&&m.stateNode.current.memoizedState.isDehydrated){a.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Hi(a){if(a.blockedOn!==null)return!1;for(var u=a.targetContainers;0<u.length;){var m=we(a.nativeEvent);if(m===null){m=a.nativeEvent;var w=new m.constructor(m.type,m);Va=w,m.target.dispatchEvent(w),Va=null}else return u=si(m),u!==null&&le(u),a.blockedOn=m,!1;u.shift()}return!0}function ji(a,u,m){Hi(a)&&m.delete(u)}function gi(){Ue=!1,it!==null&&Hi(it)&&(it=null),tt!==null&&Hi(tt)&&(tt=null),Pt!==null&&Hi(Pt)&&(Pt=null),jt.forEach(ji),kt.forEach(ji)}function Ct(a,u){a.blockedOn===u&&(a.blockedOn=null,Ue||(Ue=!0,D.unstable_scheduleCallback(D.unstable_NormalPriority,gi)))}var Vt=null;function Ni(a){Vt!==a&&(Vt=a,D.unstable_scheduleCallback(D.unstable_NormalPriority,function(){Vt===a&&(Vt=null);for(var u=0;u<a.length;u+=3){var m=a[u],w=a[u+1],E=a[u+2];if(typeof w!="function"){if(We(w||m)===null)continue;break}var R=si(m);R!==null&&(a.splice(u,3),u-=3,jr(R,{pending:!0,data:E,method:m.method,action:w},w,E))}}))}function Vi(a){function u(be){return Ct(be,a)}it!==null&&Ct(it,a),tt!==null&&Ct(tt,a),Pt!==null&&Ct(Pt,a),jt.forEach(u),kt.forEach(u);for(var m=0;m<vt.length;m++){var w=vt[m];w.blockedOn===a&&(w.blockedOn=null)}for(;0<vt.length&&(m=vt[0],m.blockedOn===null);)Ki(m),m.blockedOn===null&&vt.shift();if(m=(a.ownerDocument||a).$$reactFormReplay,m!=null)for(w=0;w<m.length;w+=3){var E=m[w],R=m[w+1],Y=E[di]||null;if(typeof R=="function")Y||Ni(m);else if(Y){var te=null;if(R&&R.hasAttribute("formAction")){if(E=R,Y=R[di]||null)te=Y.formAction;else if(We(E)!==null)continue}else te=Y.action;typeof te=="function"?m[w+1]=te:(m.splice(w,3),w-=3),Ni(m)}}}function Qi(a){this._internalRoot=a}yi.prototype.render=Qi.prototype.render=function(a){var u=this._internalRoot;if(u===null)throw Error(Z(409));var m=u.current,w=_a();X(m,w,a,u,null,null)},yi.prototype.unmount=Qi.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var u=a.containerInfo;X(a.current,2,null,a,null,null),zd(),u[Bi]=null}};function yi(a){this._internalRoot=a}yi.prototype.unstable_scheduleHydration=function(a){if(a){var u=Yi();a={blockedOn:null,target:a,priority:u};for(var m=0;m<vt.length&&u!==0&&u<vt[m].priority;m++);vt.splice(m,0,a),m===0&&Ki(a)}};var Wr=G.version;if(Wr!=="19.1.0")throw Error(Z(527,Wr,"19.1.0"));bt.findDOMNode=function(a){var u=a._reactInternals;if(u===void 0)throw typeof a.render=="function"?Error(Z(188)):(a=Object.keys(a).join(","),Error(Z(268,a)));return a=se(u),a=a!==null?pe(a):null,a=a===null?null:a.stateNode,a};var Kr={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:Qe,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var hr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hr.isDisabled&&hr.supportsFiber)try{ss=hr.inject(Kr),pn=hr}catch{}}return Xp.createRoot=function(a,u){if(!Q(a))throw Error(Z(299));var m=!1,w="",E=jf,R=Cl,Y=Lh,te=null;return u!=null&&(u.unstable_strictMode===!0&&(m=!0),u.identifierPrefix!==void 0&&(w=u.identifierPrefix),u.onUncaughtError!==void 0&&(E=u.onUncaughtError),u.onCaughtError!==void 0&&(R=u.onCaughtError),u.onRecoverableError!==void 0&&(Y=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(te=u.unstable_transitionCallbacks)),u=j(a,1,!1,null,null,m,w,E,R,Y,te,null),a[Bi]=u.current,Tf(a),new Qi(u)},Xp.hydrateRoot=function(a,u,m){if(!Q(a))throw Error(Z(299));var w=!1,E="",R=jf,Y=Cl,te=Lh,be=null,Ge=null;return m!=null&&(m.unstable_strictMode===!0&&(w=!0),m.identifierPrefix!==void 0&&(E=m.identifierPrefix),m.onUncaughtError!==void 0&&(R=m.onUncaughtError),m.onCaughtError!==void 0&&(Y=m.onCaughtError),m.onRecoverableError!==void 0&&(te=m.onRecoverableError),m.unstable_transitionCallbacks!==void 0&&(be=m.unstable_transitionCallbacks),m.formState!==void 0&&(Ge=m.formState)),u=j(a,1,!0,u,m??null,w,E,R,Y,te,be,Ge),u.context=q(null),m=u.current,w=_a(),w=hi(w),E=to(w),E.callback=null,ks(m,E,w),m=w,u.current.lanes=m,ke(u,m),sa(u),a[Bi]=u.current,Tf(a),new yi(u)},Xp.version="19.1.0",Xp}var Um;function Ty(){if(Um)return dm.exports;Um=1;function D(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(D)}catch(G){console.error(G)}}return D(),dm.exports=Sy(),dm.exports}var My=Ty();const Ay="modulepreload",Cy=function(D){return"/"+D},Gm={},Ey=function(G,H,Z){let Q=Promise.resolve();if(H&&H.length>0){let F=function(pe){return Promise.all(pe.map(Ce=>Promise.resolve(Ce).then(Ze=>({status:"fulfilled",value:Ze}),Ze=>({status:"rejected",reason:Ze}))))};document.getElementsByTagName("link");const y=document.querySelector("meta[property=csp-nonce]"),se=(y==null?void 0:y.nonce)||(y==null?void 0:y.getAttribute("nonce"));Q=F(H.map(pe=>{if(pe=Cy(pe),pe in Gm)return;Gm[pe]=!0;const Ce=pe.endsWith(".css"),Ze=Ce?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${pe}"]${Ze}`))return;const Le=document.createElement("link");if(Le.rel=Ce?"stylesheet":Ay,Ce||(Le.as="script"),Le.crossOrigin="",Le.href=pe,se&&Le.setAttribute("nonce",se),document.head.appendChild(Le),Ce)return new Promise((Se,wt)=>{Le.addEventListener("load",Se),Le.addEventListener("error",()=>wt(new Error(`Unable to preload CSS for ${pe}`)))})}))}function ie(F){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=F,window.dispatchEvent(y),!y.defaultPrevented)throw F}return Q.then(F=>{for(const y of F||[])y.status==="rejected"&&ie(y.reason);return G().catch(ie)})},zy=De.createContext(null);function Py(D,G){const H=Array.isArray(D)?D[0]:D?D.x:0,Z=Array.isArray(D)?D[1]:D?D.y:0,Q=Array.isArray(G)?G[0]:G?G.x:0,ie=Array.isArray(G)?G[1]:G?G.y:0;return H===Q&&Z===ie}function jl(D,G){if(D===G)return!0;if(!D||!G)return!1;if(Array.isArray(D)){if(!Array.isArray(G)||D.length!==G.length)return!1;for(let H=0;H<D.length;H++)if(!jl(D[H],G[H]))return!1;return!0}else if(Array.isArray(G))return!1;if(typeof D=="object"&&typeof G=="object"){const H=Object.keys(D),Z=Object.keys(G);if(H.length!==Z.length)return!1;for(const Q of H)if(!G.hasOwnProperty(Q)||!jl(D[Q],G[Q]))return!1;return!0}return!1}function qm(D){return{longitude:D.center.lng,latitude:D.center.lat,zoom:D.zoom,pitch:D.pitch,bearing:D.bearing,padding:D.padding}}function Zm(D,G){const H=G.viewState||G,Z={};if("longitude"in H&&"latitude"in H&&(H.longitude!==D.center.lng||H.latitude!==D.center.lat)){const Q=D.center.constructor;Z.center=new Q(H.longitude,H.latitude)}return"zoom"in H&&H.zoom!==D.zoom&&(Z.zoom=H.zoom),"bearing"in H&&H.bearing!==D.bearing&&(Z.bearing=H.bearing),"pitch"in H&&H.pitch!==D.pitch&&(Z.pitch=H.pitch),H.padding&&D.padding&&!jl(H.padding,D.padding)&&(Z.padding=H.padding),Z}const Iy=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function $m(D){if(!D)return null;if(typeof D=="string"||("toJS"in D&&(D=D.toJS()),!D.layers))return D;const G={};for(const Z of D.layers)G[Z.id]=Z;const H=D.layers.map(Z=>{let Q=null;"interactive"in Z&&(Q=Object.assign({},Z),delete Q.interactive);const ie=G[Z.ref];if(ie){Q=Q||Object.assign({},Z),delete Q.ref;for(const F of Iy)F in ie&&(Q[F]=ie[F])}return Q||Z});return{...D,layers:H}}const Hm={version:8,sources:{},layers:[]},Xm={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Ym={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Wm={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},ky=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Ry=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Op{constructor(G,H,Z){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=Q=>{const ie=this.props[Wm[Q.type]];ie?ie(Q):Q.type==="error"&&console.error(Q.error)},this._onCameraEvent=Q=>{if(this._internalUpdate)return;Q.viewState=this._propsedCameraUpdate||qm(this._map.transform);const ie=this.props[Ym[Q.type]];ie&&ie(Q)},this._onCameraUpdate=Q=>this._internalUpdate?Q:(this._propsedCameraUpdate=qm(Q),Zm(Q,this.props)),this._onPointerEvent=Q=>{(Q.type==="mousemove"||Q.type==="mouseout")&&this._updateHover(Q);const ie=this.props[Xm[Q.type]];ie&&(this.props.interactiveLayerIds&&Q.type!=="mouseover"&&Q.type!=="mouseout"&&(Q.features=this._hoveredFeatures||this._queryRenderedFeatures(Q.point)),ie(Q),delete Q.features)},this._MapClass=G,this.props=H,this._initialize(Z)}get map(){return this._map}setProps(G){const H=this.props;this.props=G;const Z=this._updateSettings(G,H),Q=this._updateSize(G),ie=this._updateViewState(G);this._updateStyle(G,H),this._updateStyleComponents(G),this._updateHandlers(G,H),(Z||Q||ie&&!this._map.isMoving())&&this.redraw()}static reuse(G,H){const Z=Op.savedMaps.pop();if(!Z)return null;const Q=Z.map,ie=Q.getContainer();for(H.className=ie.className;ie.childNodes.length>0;)H.appendChild(ie.childNodes[0]);Q._container=H;const F=Q._resizeObserver;F&&(F.disconnect(),F.observe(H)),Z.setProps({...G,styleDiffing:!1}),Q.resize();const{initialViewState:y}=G;return y&&(y.bounds?Q.fitBounds(y.bounds,{...y.fitBoundsOptions,duration:0}):Z._updateViewState(y)),Q.isStyleLoaded()?Q.fire("load"):Q.once("style.load",()=>Q.fire("load")),Q._update(),Z}_initialize(G){const{props:H}=this,{mapStyle:Z=Hm}=H,Q={...H,...H.initialViewState,container:G,style:$m(Z)},ie=Q.initialViewState||Q.viewState||Q;if(Object.assign(Q,{center:[ie.longitude||0,ie.latitude||0],zoom:ie.zoom||0,pitch:ie.pitch||0,bearing:ie.bearing||0}),H.gl){const y=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=y,H.gl)}const F=new this._MapClass(Q);ie.padding&&F.setPadding(ie.padding),H.cursor&&(F.getCanvas().style.cursor=H.cursor),F.transformCameraUpdate=this._onCameraUpdate,F.on("style.load",()=>{var y;this._styleComponents={light:F.getLight(),sky:F.getSky(),projection:(y=F.getProjection)==null?void 0:y.call(F),terrain:F.getTerrain()},this._updateStyleComponents(this.props)}),F.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const y in Xm)F.on(y,this._onPointerEvent);for(const y in Ym)F.on(y,this._onCameraEvent);for(const y in Wm)F.on(y,this._onEvent);this._map=F}recycle(){const H=this.map.getContainer().querySelector("[mapboxgl-children]");H==null||H.remove(),Op.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const G=this._map;G.style&&(G._frame&&(G._frame.cancel(),G._frame=null),G._render())}_updateSize(G){const{viewState:H}=G;if(H){const Z=this._map;if(H.width!==Z.transform.width||H.height!==Z.transform.height)return Z.resize(),!0}return!1}_updateViewState(G){const H=this._map,Z=H.transform;if(!H.isMoving()){const ie=Zm(Z,G);if(Object.keys(ie).length>0)return this._internalUpdate=!0,H.jumpTo(ie),this._internalUpdate=!1,!0}return!1}_updateSettings(G,H){const Z=this._map;let Q=!1;for(const ie of ky)if(ie in G&&!jl(G[ie],H[ie])){Q=!0;const F=Z[`set${ie[0].toUpperCase()}${ie.slice(1)}`];F==null||F.call(Z,G[ie])}return Q}_updateStyle(G,H){if(G.cursor!==H.cursor&&(this._map.getCanvas().style.cursor=G.cursor||""),G.mapStyle!==H.mapStyle){const{mapStyle:Z=Hm,styleDiffing:Q=!0}=G,ie={diff:Q};"localIdeographFontFamily"in G&&(ie.localIdeographFontFamily=G.localIdeographFontFamily),this._map.setStyle($m(Z),ie)}}_updateStyleComponents({light:G,projection:H,sky:Z,terrain:Q}){var y,se;const ie=this._map,F=this._styleComponents;ie.style._loaded&&(G&&!jl(G,F.light)&&(F.light=G,ie.setLight(G)),H&&!jl(H,F.projection)&&H!==((y=F.projection)==null?void 0:y.type)&&(F.projection=typeof H=="string"?{type:H}:H,(se=ie.setProjection)==null||se.call(ie,F.projection)),Z&&!jl(Z,F.sky)&&(F.sky=Z,ie.setSky(Z)),Q!==void 0&&!jl(Q,F.terrain)&&(!Q||ie.getSource(Q.source))&&(F.terrain=Q,ie.setTerrain(Q)))}_updateHandlers(G,H){const Z=this._map;for(const Q of Ry){const ie=G[Q]??!0,F=H[Q]??!0;jl(ie,F)||(ie?Z[Q].enable(ie):Z[Q].disable())}}_queryRenderedFeatures(G){const H=this._map,{interactiveLayerIds:Z=[]}=this.props;try{return H.queryRenderedFeatures(G,{layers:Z.filter(H.getLayer.bind(H))})}catch{return[]}}_updateHover(G){var Q;const{props:H}=this;if(H.interactiveLayerIds&&(H.onMouseMove||H.onMouseEnter||H.onMouseLeave)){const ie=G.type,F=((Q=this._hoveredFeatures)==null?void 0:Q.length)>0,y=this._queryRenderedFeatures(G.point),se=y.length>0;!se&&F&&(G.type="mouseleave",this._onPointerEvent(G)),this._hoveredFeatures=y,se&&!F&&(G.type="mouseenter",this._onPointerEvent(G)),G.type=ie}else this._hoveredFeatures=null}}Op.savedMaps=[];const Dy=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Ly(D){if(!D)return null;const G=D.map,H={getMap:()=>G};for(const Z of By(G))!(Z in H)&&!Dy.includes(Z)&&(H[Z]=G[Z].bind(G));return H}function By(D){const G=new Set;let H=D;for(;H;){for(const Z of Object.getOwnPropertyNames(H))Z[0]!=="_"&&typeof D[Z]=="function"&&Z!=="fire"&&Z!=="setEventedParent"&&G.add(Z);H=Object.getPrototypeOf(H)}return Array.from(G)}const Oy=typeof document<"u"?De.useLayoutEffect:De.useEffect;function Fy(D,G){const{RTLTextPlugin:H,maxParallelImageRequests:Z,workerCount:Q,workerUrl:ie}=G;if(H&&D.getRTLTextPluginStatus&&D.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:F,lazy:y=!0}=typeof H=="string"?{pluginUrl:H}:H;D.setRTLTextPlugin(F,se=>{se&&console.error(se)},y)}Z!==void 0&&D.setMaxParallelImageRequests(Z),Q!==void 0&&D.setWorkerCount(Q),ie!==void 0&&D.setWorkerUrl(ie)}const Np=De.createContext(null);function jy(D,G){const H=De.useContext(zy),[Z,Q]=De.useState(null),ie=De.useRef(),{current:F}=De.useRef({mapLib:null,map:null});De.useEffect(()=>{const pe=D.mapLib;let Ce=!0,Ze;return Promise.resolve(pe||Ey(()=>Promise.resolve().then(()=>n_),void 0)).then(Le=>{if(!Ce)return;if(!Le)throw new Error("Invalid mapLib");const Se="Map"in Le?Le:Le.default;if(!Se.Map)throw new Error("Invalid mapLib");Fy(Se,D),D.reuseMaps&&(Ze=Op.reuse(D,ie.current)),Ze||(Ze=new Op(Se.Map,D,ie.current)),F.map=Ly(Ze),F.mapLib=Se,Q(Ze),H==null||H.onMapMount(F.map,D.id)}).catch(Le=>{const{onError:Se}=D;Se?Se({type:"error",target:null,originalEvent:null,error:Le}):console.error(Le)}),()=>{Ce=!1,Ze&&(H==null||H.onMapUnmount(D.id),D.reuseMaps?Ze.recycle():Ze.destroy())}},[]),Oy(()=>{Z&&Z.setProps(D)}),De.useImperativeHandle(G,()=>F.map,[Z]);const y=De.useMemo(()=>({position:"relative",width:"100%",height:"100%",...D.style}),[D.style]),se={height:"100%"};return De.createElement("div",{id:D.id,ref:ie,style:y},Z&&De.createElement(Np.Provider,{value:F},De.createElement("div",{"mapboxgl-children":"",style:se},D.children)))}const Ny=De.forwardRef(jy);var _g=yg();const Vy=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Jd(D,G){if(!D||!G)return;const H=D.style;for(const Z in G){const Q=G[Z];Number.isFinite(Q)&&!Vy.test(Z)?H[Z]=`${Q}px`:H[Z]=Q}}function xg(D,G){if(D===G)return null;const H=Km(D),Z=Km(G),Q=[];for(const ie of Z)H.has(ie)||Q.push(ie);for(const ie of H)Z.has(ie)||Q.push(ie);return Q.length===0?null:Q}function Km(D){return new Set(D?D.trim().split(/\s+/):[])}De.memo(De.forwardRef((D,G)=>{const{map:H,mapLib:Z}=De.useContext(Np),Q=De.useRef({props:D}),ie=De.useMemo(()=>{let Yt=!1;De.Children.forEach(D.children,St=>{St&&(Yt=!0)});const Nt={...D,element:Yt?document.createElement("div"):void 0},ot=new Z.Marker(Nt);return ot.setLngLat([D.longitude,D.latitude]),ot.getElement().addEventListener("click",St=>{var Rt,Gt;(Gt=(Rt=Q.current.props).onClick)==null||Gt.call(Rt,{type:"click",target:ot,originalEvent:St})}),ot.on("dragstart",St=>{var Gt,ti;const Rt=St;Rt.lngLat=ie.getLngLat(),(ti=(Gt=Q.current.props).onDragStart)==null||ti.call(Gt,Rt)}),ot.on("drag",St=>{var Gt,ti;const Rt=St;Rt.lngLat=ie.getLngLat(),(ti=(Gt=Q.current.props).onDrag)==null||ti.call(Gt,Rt)}),ot.on("dragend",St=>{var Gt,ti;const Rt=St;Rt.lngLat=ie.getLngLat(),(ti=(Gt=Q.current.props).onDragEnd)==null||ti.call(Gt,Rt)}),ot},[]);De.useEffect(()=>(ie.addTo(H.getMap()),()=>{ie.remove()}),[]);const{longitude:F,latitude:y,offset:se,style:pe,draggable:Ce=!1,popup:Ze=null,rotation:Le=0,rotationAlignment:Se="auto",pitchAlignment:wt="auto"}=D;De.useEffect(()=>{Jd(ie.getElement(),pe)},[pe]),De.useImperativeHandle(G,()=>ie,[]);const Ut=Q.current.props;(ie.getLngLat().lng!==F||ie.getLngLat().lat!==y)&&ie.setLngLat([F,y]),se&&!Py(ie.getOffset(),se)&&ie.setOffset(se),ie.isDraggable()!==Ce&&ie.setDraggable(Ce),ie.getRotation()!==Le&&ie.setRotation(Le),ie.getRotationAlignment()!==Se&&ie.setRotationAlignment(Se),ie.getPitchAlignment()!==wt&&ie.setPitchAlignment(wt),ie.getPopup()!==Ze&&ie.setPopup(Ze);const Et=xg(Ut.className,D.className);if(Et)for(const Yt of Et)ie.toggleClassName(Yt);return Q.current.props=D,_g.createPortal(D.children,ie.getElement())}));const Uy=De.memo(De.forwardRef((D,G)=>{const{map:H,mapLib:Z}=De.useContext(Np),Q=De.useMemo(()=>document.createElement("div"),[]),ie=De.useRef({props:D}),F=De.useMemo(()=>{const y={...D},se=new Z.Popup(y);return se.setLngLat([D.longitude,D.latitude]),se.once("open",pe=>{var Ce,Ze;(Ze=(Ce=ie.current.props).onOpen)==null||Ze.call(Ce,pe)}),se},[]);if(De.useEffect(()=>{const y=se=>{var pe,Ce;(Ce=(pe=ie.current.props).onClose)==null||Ce.call(pe,se)};return F.on("close",y),F.setDOMContent(Q).addTo(H.getMap()),()=>{F.off("close",y),F.isOpen()&&F.remove()}},[]),De.useEffect(()=>{Jd(F.getElement(),D.style)},[D.style]),De.useImperativeHandle(G,()=>F,[]),F.isOpen()){const y=ie.current.props;(F.getLngLat().lng!==D.longitude||F.getLngLat().lat!==D.latitude)&&F.setLngLat([D.longitude,D.latitude]),D.offset&&!jl(y.offset,D.offset)&&F.setOffset(D.offset),(y.anchor!==D.anchor||y.maxWidth!==D.maxWidth)&&(F.options.anchor=D.anchor,F.setMaxWidth(D.maxWidth));const se=xg(y.className,D.className);if(se)for(const pe of se)F.toggleClassName(pe);ie.current.props=D}return _g.createPortal(D.children,Q)}));function yp(D,G,H,Z){const Q=De.useContext(Np),ie=De.useMemo(()=>D(Q),[]);return De.useEffect(()=>{const F=G,y=null,se=typeof G=="function"?G:null,{map:pe}=Q;return pe.hasControl(ie)||(pe.addControl(ie,F==null?void 0:F.position),y&&y(Q)),()=>{se&&se(Q),pe.hasControl(ie)&&pe.removeControl(ie)}},[]),ie}function Gy(D){const G=yp(({mapLib:H})=>new H.AttributionControl(D),{position:D.position});return De.useEffect(()=>{Jd(G._container,D.style)},[D.style]),null}De.memo(Gy);function qy(D){const G=yp(({mapLib:H})=>new H.FullscreenControl({container:D.containerId&&document.getElementById(D.containerId)}),{position:D.position});return De.useEffect(()=>{Jd(G._controlContainer,D.style)},[D.style]),null}De.memo(qy);function Zy(D,G){const H=De.useRef({props:D}),Z=yp(({mapLib:Q})=>{const ie=new Q.GeolocateControl(D),F=ie._setupUI;return ie._setupUI=()=>{ie._container.hasChildNodes()||F()},ie.on("geolocate",y=>{var se,pe;(pe=(se=H.current.props).onGeolocate)==null||pe.call(se,y)}),ie.on("error",y=>{var se,pe;(pe=(se=H.current.props).onError)==null||pe.call(se,y)}),ie.on("outofmaxbounds",y=>{var se,pe;(pe=(se=H.current.props).onOutOfMaxBounds)==null||pe.call(se,y)}),ie.on("trackuserlocationstart",y=>{var se,pe;(pe=(se=H.current.props).onTrackUserLocationStart)==null||pe.call(se,y)}),ie.on("trackuserlocationend",y=>{var se,pe;(pe=(se=H.current.props).onTrackUserLocationEnd)==null||pe.call(se,y)}),ie},{position:D.position});return H.current.props=D,De.useImperativeHandle(G,()=>Z,[]),De.useEffect(()=>{Jd(Z._container,D.style)},[D.style]),null}De.memo(De.forwardRef(Zy));function $y(D){const G=yp(({mapLib:H})=>new H.NavigationControl(D),{position:D.position});return De.useEffect(()=>{Jd(G._container,D.style)},[D.style]),null}De.memo($y);function Hy(D){const G=yp(({mapLib:ie})=>new ie.ScaleControl(D),{position:D.position}),H=De.useRef(D),Z=H.current;H.current=D;const{style:Q}=D;return D.maxWidth!==void 0&&D.maxWidth!==Z.maxWidth&&(G.options.maxWidth=D.maxWidth),D.unit!==void 0&&D.unit!==Z.unit&&G.setUnit(D.unit),De.useEffect(()=>{Jd(G._container,Q)},[Q]),null}De.memo(Hy);function Xy(D){const G=yp(({mapLib:H})=>new H.TerrainControl(D),{position:D.position});return De.useEffect(()=>{Jd(G._container,D.style)},[D.style]),null}De.memo(Xy);function Yy(D){const G=yp(({mapLib:H})=>new H.LogoControl(D),{position:D.position});return De.useEffect(()=>{Jd(G._container,D.style)},[D.style]),null}De.memo(Yy);function rm(D,G){if(!D)throw new Error(G)}let Wy=0;function Ky(D,G,H){if(D.style&&D.style._loaded){const Z={...H};return delete Z.id,delete Z.children,D.addSource(G,Z),D.getSource(G)}return null}function Qy(D,G,H){var F,y,se;rm(G.id===H.id,"source id changed"),rm(G.type===H.type,"source type changed");let Z="",Q=0;for(const pe in G)pe!=="children"&&pe!=="id"&&!jl(H[pe],G[pe])&&(Z=pe,Q++);if(!Q)return;const ie=G.type;if(ie==="geojson")D.setData(G.data);else if(ie==="image")D.updateImage({url:G.url,coordinates:G.coordinates});else switch(Z){case"coordinates":(F=D.setCoordinates)==null||F.call(D,G.coordinates);break;case"url":(y=D.setUrl)==null||y.call(D,G.url);break;case"tiles":(se=D.setTiles)==null||se.call(D,G.tiles);break;default:console.warn(`Unable to update <Source> prop: ${Z}`)}}function Qm(D){const G=De.useContext(Np).map.getMap(),H=De.useRef(D),[,Z]=De.useState(0),Q=De.useMemo(()=>D.id||`jsx-source-${Wy++}`,[]);De.useEffect(()=>{if(G){const F=()=>setTimeout(()=>Z(y=>y+1),0);return G.on("styledata",F),F(),()=>{var y;if(G.off("styledata",F),G.style&&G.style._loaded&&G.getSource(Q)){const se=(y=G.getStyle())==null?void 0:y.layers;if(se)for(const pe of se)pe.source===Q&&G.removeLayer(pe.id);G.removeSource(Q)}}}},[G]);let ie=G&&G.style&&G.getSource(Q);return ie?Qy(ie,D,H.current):ie=Ky(G,Q,D),H.current=D,ie&&De.Children.map(D.children,F=>F&&De.cloneElement(F,{source:Q}))||null}function Jy(D,G,H,Z){if(rm(H.id===Z.id,"layer id changed"),rm(H.type===Z.type,"layer type changed"),H.type==="custom"||Z.type==="custom")return;const{layout:Q={},paint:ie={},filter:F,minzoom:y,maxzoom:se,beforeId:pe}=H;if(pe!==Z.beforeId&&D.moveLayer(G,pe),Q!==Z.layout){const Ce=Z.layout||{};for(const Ze in Q)jl(Q[Ze],Ce[Ze])||D.setLayoutProperty(G,Ze,Q[Ze]);for(const Ze in Ce)Q.hasOwnProperty(Ze)||D.setLayoutProperty(G,Ze,void 0)}if(ie!==Z.paint){const Ce=Z.paint||{};for(const Ze in ie)jl(ie[Ze],Ce[Ze])||D.setPaintProperty(G,Ze,ie[Ze]);for(const Ze in Ce)ie.hasOwnProperty(Ze)||D.setPaintProperty(G,Ze,void 0)}jl(F,Z.filter)||D.setFilter(G,F),(y!==Z.minzoom||se!==Z.maxzoom)&&D.setLayerZoomRange(G,y,se)}function e_(D,G,H){if(D.style&&D.style._loaded&&(!("source"in H)||D.getSource(H.source))){const Z={...H,id:G};delete Z.beforeId,D.addLayer(Z,H.beforeId)}}let t_=0;function Jm(D){const G=De.useContext(Np).map.getMap(),H=De.useRef(D),[,Z]=De.useState(0),Q=De.useMemo(()=>D.id||`jsx-layer-${t_++}`,[]);if(De.useEffect(()=>{if(G){const F=()=>Z(y=>y+1);return G.on("styledata",F),F(),()=>{G.off("styledata",F),G.style&&G.style._loaded&&G.getLayer(Q)&&G.removeLayer(Q)}}},[G]),G&&G.style&&G.getLayer(Q))try{Jy(G,Q,D,H.current)}catch(F){console.warn(F)}else e_(G,Q,D);return H.current=D,null}var im={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.7.0/LICENSE.txt
 */var i_=im.exports,eg;function r_(){return eg||(eg=1,function(D,G){(function(H,Z){D.exports=Z()})(i_,function(){var H={},Z={};function Q(F,y,se){if(Z[F]=se,F==="index"){var pe="var sharedModule = {}; ("+Z.shared+")(sharedModule); ("+Z.worker+")(sharedModule);",Ce={};return Z.shared(Ce),Z.index(H,Ce),typeof window<"u"&&H.setWorkerUrl(window.URL.createObjectURL(new Blob([pe],{type:"text/javascript"}))),H}}Q("shared",["exports"],function(F){function y(l,i,s,d){return new(s||(s=Promise))(function(_,T){function n(o){try{r(d.next(o))}catch(h){T(h)}}function e(o){try{r(d.throw(o))}catch(h){T(h)}}function r(o){var h;o.done?_(o.value):(h=o.value,h instanceof s?h:new s(function(p){p(h)})).then(n,e)}r((d=d.apply(l,i||[])).next())})}function se(l,i){this.x=l,this.y=i}function pe(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Ce,Ze;typeof SuppressedError=="function"&&SuppressedError,se.prototype={clone(){return new se(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,i){return this.clone()._rotateAround(l,i)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){const i=l.x-this.x,s=l.y-this.y;return i*i+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,i){return Math.atan2(this.x*i-this.y*l,this.x*l+this.y*i)},_matMult(l){const i=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=i,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){const l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){const i=Math.cos(l),s=Math.sin(l),d=s*this.x+i*this.y;return this.x=i*this.x-s*this.y,this.y=d,this},_rotateAround(l,i){const s=Math.cos(l),d=Math.sin(l),_=i.y+d*(this.x-i.x)+s*(this.y-i.y);return this.x=i.x+s*(this.x-i.x)-d*(this.y-i.y),this.y=_,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:se},se.convert=function(l){if(l instanceof se)return l;if(Array.isArray(l))return new se(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new se(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};var Le=function(){if(Ze)return Ce;function l(i,s,d,_){this.cx=3*i,this.bx=3*(d-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(_-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=s,this.p2x=d,this.p2y=_}return Ze=1,Ce=l,l.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,s){if(s===void 0&&(s=1e-6),i<0)return 0;if(i>1)return 1;for(var d=i,_=0;_<8;_++){var T=this.sampleCurveX(d)-i;if(Math.abs(T)<s)return d;var n=this.sampleCurveDerivativeX(d);if(Math.abs(n)<1e-6)break;d-=T/n}var e=0,r=1;for(d=i,_=0;_<20&&(T=this.sampleCurveX(d),!(Math.abs(T-i)<s));_++)i>T?e=d:r=d,d=.5*(r-e)+e;return d},solve:function(i,s){return this.sampleCurveY(this.solveCurveX(i,s))}},Ce}(),Se=pe(Le);let wt,Ut;function Et(){return wt==null&&(wt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),wt}function Yt(){if(Ut==null&&(Ut=!1,Et())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let d=0;d<5*5;d++){const _=4*d;i.fillStyle=`rgb(${_},${_+1},${_+2})`,i.fillRect(d%5,Math.floor(d/5),1,1)}const s=i.getImageData(0,0,5,5).data;for(let d=0;d<5*5*4;d++)if(d%4!=3&&s[d]!==d){Ut=!0;break}}}return Ut||!1}var Nt=1e-6,ot=typeof Float32Array<"u"?Float32Array:Array;function St(){var l=new ot(9);return ot!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function Rt(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Gt(){var l=new ot(3);return ot!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function ti(l){var i=l[0],s=l[1],d=l[2];return Math.sqrt(i*i+s*s+d*d)}function zt(l,i,s){var d=new ot(3);return d[0]=l,d[1]=i,d[2]=s,d}function ui(l,i,s){return l[0]=i[0]+s[0],l[1]=i[1]+s[1],l[2]=i[2]+s[2],l}function Pi(l,i,s){return l[0]=i[0]*s,l[1]=i[1]*s,l[2]=i[2]*s,l}function $e(l,i,s){var d=i[0],_=i[1],T=i[2],n=s[0],e=s[1],r=s[2];return l[0]=_*r-T*e,l[1]=T*n-d*r,l[2]=d*e-_*n,l}var Ji,ft=ti;function fn(l,i,s){var d=i[0],_=i[1],T=i[2],n=i[3];return l[0]=s[0]*d+s[4]*_+s[8]*T+s[12]*n,l[1]=s[1]*d+s[5]*_+s[9]*T+s[13]*n,l[2]=s[2]*d+s[6]*_+s[10]*T+s[14]*n,l[3]=s[3]*d+s[7]*_+s[11]*T+s[15]*n,l}function Ri(){var l=new ot(4);return ot!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function Qe(l,i,s,d){var _=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",T=Math.PI/360;i*=T,d*=T,s*=T;var n=Math.sin(i),e=Math.cos(i),r=Math.sin(s),o=Math.cos(s),h=Math.sin(d),p=Math.cos(d);switch(_){case"xyz":l[0]=n*o*p+e*r*h,l[1]=e*r*p-n*o*h,l[2]=e*o*h+n*r*p,l[3]=e*o*p-n*r*h;break;case"xzy":l[0]=n*o*p-e*r*h,l[1]=e*r*p-n*o*h,l[2]=e*o*h+n*r*p,l[3]=e*o*p+n*r*h;break;case"yxz":l[0]=n*o*p+e*r*h,l[1]=e*r*p-n*o*h,l[2]=e*o*h-n*r*p,l[3]=e*o*p+n*r*h;break;case"yzx":l[0]=n*o*p+e*r*h,l[1]=e*r*p+n*o*h,l[2]=e*o*h-n*r*p,l[3]=e*o*p-n*r*h;break;case"zxy":l[0]=n*o*p-e*r*h,l[1]=e*r*p+n*o*h,l[2]=e*o*h+n*r*p,l[3]=e*o*p-n*r*h;break;case"zyx":l[0]=n*o*p-e*r*h,l[1]=e*r*p+n*o*h,l[2]=e*o*h-n*r*p,l[3]=e*o*p+n*r*h;break;default:throw new Error("Unknown angle order "+_)}return l}function bt(){var l=new ot(2);return ot!=Float32Array&&(l[0]=0,l[1]=0),l}function Be(l,i){var s=new ot(2);return s[0]=l,s[1]=i,s}Gt(),Ji=new ot(4),ot!=Float32Array&&(Ji[0]=0,Ji[1]=0,Ji[2]=0,Ji[3]=0),Gt(),zt(1,0,0),zt(0,1,0),Ri(),Ri(),St(),bt();const _t=8192;function _e(l,i,s){return i*(_t/(l.tileSize*Math.pow(2,s-l.tileID.overscaledZ)))}function rt(l,i){return(l%i+i)%i}function It(l,i,s){return l*(1-s)+i*s}function mt(l){if(l<=0)return 0;if(l>=1)return 1;const i=l*l,s=i*l;return 4*(l<.5?s:3*(l-i)+s-.75)}function ut(l,i,s,d){const _=new Se(l,i,s,d);return T=>_.solve(T)}const bi=ut(.25,.1,.25,1);function Zt(l,i,s){return Math.min(s,Math.max(i,l))}function Di(l,i,s){const d=s-i,_=((l-i)%d+d)%d+i;return _===i?s:_}function Ei(l,...i){for(const s of i)for(const d in s)l[d]=s[d];return l}let kr=1;function jn(l,i,s){const d={};for(const _ in l)d[_]=i.call(this,l[_],_,l);return d}function Hn(l,i,s){const d={};for(const _ in l)i.call(this,l[_],_,l)&&(d[_]=l[_]);return d}function sr(l){return Array.isArray(l)?l.map(sr):typeof l=="object"&&l?jn(l,sr):l}const xi={};function Qr(l){xi[l]||(typeof console<"u"&&console.warn(l),xi[l]=!0)}function oa(l,i,s){return(s.y-l.y)*(i.x-l.x)>(i.y-l.y)*(s.x-l.x)}function rs(l){return typeof WorkerGlobalScope<"u"&&l!==void 0&&l instanceof WorkerGlobalScope}let sn=null;function Nn(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}const ns="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Wo(l,i,s,d,_){return y(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const T=new VideoFrame(l,{timestamp:0});try{const n=T==null?void 0:T.format;if(!n||!n.startsWith("BGR")&&!n.startsWith("RGB"))throw new Error(`Unrecognized format ${n}`);const e=n.startsWith("BGR"),r=new Uint8ClampedArray(d*_*4);if(yield T.copyTo(r,function(o,h,p,g,v){const M=4*Math.max(-h,0),A=(Math.max(0,p)-p)*g*4+M,z=4*g,I=Math.max(0,h),L=Math.max(0,p);return{rect:{x:I,y:L,width:Math.min(o.width,h+g)-I,height:Math.min(o.height,p+v)-L},layout:[{offset:A,stride:z}]}}(l,i,s,d,_)),e)for(let o=0;o<r.length;o+=4){const h=r[o];r[o]=r[o+2],r[o+2]=h}return r}finally{T.close()}})}let as,La;function Ns(l,i,s,d){return l.addEventListener(i,s,d),{unsubscribe:()=>{l.removeEventListener(i,s,d)}}}function Vl(l){return l*Math.PI/180}function Ko(l){return l/Math.PI*180}const ss={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},pn={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},ba="AbortError";function Ee(){return new Error(ba)}const K={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ee(l){return K.REGISTERED_PROTOCOLS[l.substring(0,l.indexOf("://"))]}const re="global-dispatcher";class me extends Error{constructor(i,s,d,_){super(`AJAXError: ${s} (${i}): ${d}`),this.status=i,this.statusText=s,this.url=d,this.body=_}}const Ae=()=>rs(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Pe=function(l,i){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){const d=ee(l.url);if(d)return d(l,i);if(rs(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,targetMapId:re},i)}if(!(/^file:/.test(s=l.url)||/^file:/.test(Ae())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(d,_){return y(this,void 0,void 0,function*(){const T=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,cache:d.cache,referrer:Ae(),signal:_.signal});let n,e;d.type!=="json"||T.headers.has("Accept")||T.headers.set("Accept","application/json");try{n=yield fetch(T)}catch(o){throw new me(0,o.message,d.url,new Blob)}if(!n.ok){const o=yield n.blob();throw new me(n.status,n.statusText,d.url,o)}e=d.type==="arrayBuffer"||d.type==="image"?n.arrayBuffer():d.type==="json"?n.json():n.text();const r=yield e;if(_.signal.aborted)throw Ee();return{data:r,cacheControl:n.headers.get("Cache-Control"),expires:n.headers.get("Expires")}})}(l,i);if(rs(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,mustQueue:!0,targetMapId:re},i)}var s;return function(d,_){return new Promise((T,n)=>{var e;const r=new XMLHttpRequest;r.open(d.method||"GET",d.url,!0),d.type!=="arrayBuffer"&&d.type!=="image"||(r.responseType="arraybuffer");for(const o in d.headers)r.setRequestHeader(o,d.headers[o]);d.type==="json"&&(r.responseType="text",!((e=d.headers)===null||e===void 0)&&e.Accept||r.setRequestHeader("Accept","application/json")),r.withCredentials=d.credentials==="include",r.onerror=()=>{n(new Error(r.statusText))},r.onload=()=>{if(!_.signal.aborted)if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){let o=r.response;if(d.type==="json")try{o=JSON.parse(r.response)}catch(h){return void n(h)}T({data:o,cacheControl:r.getResponseHeader("Cache-Control"),expires:r.getResponseHeader("Expires")})}else{const o=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});n(new me(r.status,r.statusText,d.url,o))}},_.signal.addEventListener("abort",()=>{r.abort(),n(Ee())}),r.send(d.body)})}(l,i)};function je(l){if(!l||l.indexOf("://")<=0||l.indexOf("data:image/")===0||l.indexOf("blob:")===0)return!0;const i=new URL(l),s=window.location;return i.protocol===s.protocol&&i.host===s.host}function Re(l,i,s){s[l]&&s[l].indexOf(i)!==-1||(s[l]=s[l]||[],s[l].push(i))}function Je(l,i,s){if(s&&s[l]){const d=s[l].indexOf(i);d!==-1&&s[l].splice(d,1)}}class ht{constructor(i,s={}){Ei(this,s),this.type=i}}class at extends ht{constructor(i,s={}){super("error",Ei({error:i},s))}}class Dt{on(i,s){return this._listeners=this._listeners||{},Re(i,s,this._listeners),{unsubscribe:()=>{this.off(i,s)}}}off(i,s){return Je(i,s,this._listeners),Je(i,s,this._oneTimeListeners),this}once(i,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Re(i,s,this._oneTimeListeners),this):new Promise(d=>this.once(i,d))}fire(i,s){typeof i=="string"&&(i=new ht(i,s||{}));const d=i.type;if(this.listens(d)){i.target=this;const _=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const e of _)e.call(this,i);const T=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const e of T)Je(d,e,this._oneTimeListeners),e.call(this,i);const n=this._eventedParent;n&&(Ei(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),n.fire(i))}else i instanceof at&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,s){return this._eventedParent=i,this._eventedParentData=s,this}}var ke={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Tt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ti(l,i){const s={};for(const d in l)d!=="ref"&&(s[d]=l[d]);return Tt.forEach(d=>{d in i&&(s[d]=i[d])}),s}function $t(l,i){if(Array.isArray(l)){if(!Array.isArray(i)||l.length!==i.length)return!1;for(let s=0;s<l.length;s++)if(!$t(l[s],i[s]))return!1;return!0}if(typeof l=="object"&&l!==null&&i!==null){if(typeof i!="object"||Object.keys(l).length!==Object.keys(i).length)return!1;for(const s in l)if(!$t(l[s],i[s]))return!1;return!0}return l===i}function hi(l,i){l.push(i)}function Ii(l,i,s){hi(s,{command:"addSource",args:[l,i[l]]})}function Yi(l,i,s){hi(i,{command:"removeSource",args:[l]}),s[l]=!0}function er(l,i,s,d){Yi(l,s,d),Ii(l,i,s)}function Mi(l,i,s){let d;for(d in l[s])if(Object.prototype.hasOwnProperty.call(l[s],d)&&d!=="data"&&!$t(l[s][d],i[s][d]))return!1;for(d in i[s])if(Object.prototype.hasOwnProperty.call(i[s],d)&&d!=="data"&&!$t(l[s][d],i[s][d]))return!1;return!0}function Lt(l,i,s,d,_,T){l=l||{},i=i||{};for(const n in l)Object.prototype.hasOwnProperty.call(l,n)&&($t(l[n],i[n])||s.push({command:T,args:[d,n,i[n],_]}));for(const n in i)Object.prototype.hasOwnProperty.call(i,n)&&!Object.prototype.hasOwnProperty.call(l,n)&&($t(l[n],i[n])||s.push({command:T,args:[d,n,i[n],_]}))}function di(l){return l.id}function Bi(l,i){return l[i.id]=i,l}class pt{constructor(i,s,d,_){this.message=(i?`${i}: `:"")+d,_&&(this.identifier=_),s!=null&&s.__line__&&(this.line=s.__line__)}}function Ar(l,...i){for(const s of i)for(const d in s)l[d]=s[d];return l}class Ur extends Error{constructor(i,s){super(s),this.message=s,this.key=i}}class Ba{constructor(i,s=[]){this.parent=i,this.bindings={};for(const[d,_]of s)this.bindings[d]=_}concat(i){return new Ba(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const dr={kind:"null"},xt={kind:"number"},ai={kind:"string"},si={kind:"boolean"},lr={kind:"color"},Oa={kind:"projectionDefinition"},or={kind:"object"},wi={kind:"value"},Pc={kind:"collator"},Vn={kind:"formatted"},os={kind:"padding"},Fa={kind:"colorArray"},ho={kind:"numberArray"},Br={kind:"resolvedImage"},Ul={kind:"variableAnchorOffsetCollection"};function Sn(l,i){return{kind:"array",itemType:l,N:i}}function tr(l){if(l.kind==="array"){const i=tr(l.itemType);return typeof l.N=="number"?`array<${i}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${i}>`}return l.kind}const ja=[dr,xt,ai,si,lr,Oa,Vn,or,Sn(wi),os,ho,Fa,Br,Ul];function Vs(l,i){if(i.kind==="error")return null;if(l.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Vs(l.itemType,i.itemType))&&(typeof l.N!="number"||l.N===i.N))return null}else{if(l.kind===i.kind)return null;if(l.kind==="value"){for(const s of ja)if(!Vs(s,i))return null}}return`Expected ${tr(l)} but found ${tr(i)} instead.`}function Qo(l,i){return i.some(s=>s.kind===l.kind)}function Na(l,i){return i.some(s=>s==="null"?l===null:s==="array"?Array.isArray(l):s==="object"?l&&!Array.isArray(l)&&typeof l=="object":s===typeof l)}function ls(l,i){return l.kind==="array"&&i.kind==="array"?l.itemType.kind===i.itemType.kind&&typeof l.N=="number":l.kind===i.kind}const Ic=.96422,ef=.82521,hd=4/29,br=6/29,Mu=3*br*br,Gl=br*br*br,ql=Math.PI/180,dd=180/Math.PI;function Zl(l){return(l%=360)<0&&(l+=360),l}function Ss([l,i,s,d]){let _,T;const n=Au((.2225045*(l=wa(l))+.7168786*(i=wa(i))+.0606169*(s=wa(s)))/1);l===i&&i===s?_=T=n:(_=Au((.4360747*l+.3850649*i+.1430804*s)/Ic),T=Au((.0139322*l+.0971045*i+.7141733*s)/ef));const e=116*n-16;return[e<0?0:e,500*(_-n),200*(n-T),d]}function wa(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Au(l){return l>Gl?Math.pow(l,1/3):l/Mu+hd}function $l([l,i,s,d]){let _=(l+16)/116,T=isNaN(i)?_:_+i/500,n=isNaN(s)?_:_-s/200;return _=1*Jo(_),T=Ic*Jo(T),n=ef*Jo(n),[Cu(3.1338561*T-1.6168667*_-.4906146*n),Cu(-.9787684*T+1.9161415*_+.033454*n),Cu(.0719453*T-.2289914*_+1.4052427*n),d]}function Cu(l){return(l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055)<0?0:l>1?1:l}function Jo(l){return l>br?l*l*l:Mu*(l-hd)}const tf=Object.hasOwn||function(l,i){return Object.prototype.hasOwnProperty.call(l,i)};function Us(l,i){return tf(l,i)?l[i]:void 0}function cs(l){return parseInt(l.padEnd(2,l),16)/255}function Sa(l,i){return Ai(i?l/100:l,0,1)}function Ai(l,i,s){return Math.min(Math.max(i,l),s)}function Gs(l){return!l.some(Number.isNaN)}const Tn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function fo(l,i,s){return l+s*(i-l)}function po(l,i,s){return l.map((d,_)=>fo(d,i[_],s))}class pi{constructor(i,s,d,_=1,T=!0){this.r=i,this.g=s,this.b=d,this.a=_,T||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[i,s,d,_]))}static parse(i){if(i instanceof pi)return i;if(typeof i!="string")return;const s=function(d){if((d=d.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=Us(Tn,d);if(_){const[n,e,r]=_;return[n/255,e/255,r/255,1]}if(d.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(d)){const n=d.length<6?1:2;let e=1;return[cs(d.slice(e,e+=n)),cs(d.slice(e,e+=n)),cs(d.slice(e,e+=n)),cs(d.slice(e,e+n)||"ff")]}if(d.startsWith("rgb")){const n=d.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(n){const[e,r,o,h,p,g,v,M,A,z,I,L]=n,B=[h||" ",v||" ",z].join("");if(B==="  "||B==="  /"||B===",,"||B===",,,"){const j=[o,g,A].join(""),q=j==="%%%"?100:j===""?255:0;if(q){const X=[Ai(+r/q,0,1),Ai(+p/q,0,1),Ai(+M/q,0,1),I?Sa(+I,L):1];if(Gs(X))return X}}return}}const T=d.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[n,e,r,o,h,p,g,v,M]=T,A=[r||" ",h||" ",g].join("");if(A==="  "||A==="  /"||A===",,"||A===",,,"){const z=[+e,Ai(+o,0,100),Ai(+p,0,100),v?Sa(+v,M):1];if(Gs(z))return function([I,L,B,j]){function q(X){const J=(X+I/30)%12,ue=L*Math.min(B,1-B);return B-ue*Math.max(-1,Math.min(J-3,9-J,1))}return I=Zl(I),L/=100,B/=100,[q(0),q(8),q(4),j]}(z)}}}(i);return s?new pi(...s,!1):void 0}get rgb(){const{r:i,g:s,b:d,a:_}=this,T=_||1/0;return this.overwriteGetter("rgb",[i/T,s/T,d/T,_])}get hcl(){return this.overwriteGetter("hcl",function(i){const[s,d,_,T]=Ss(i),n=Math.sqrt(d*d+_*_);return[Math.round(1e4*n)?Zl(Math.atan2(_,d)*dd):NaN,n,s,T]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ss(this.rgb))}overwriteGetter(i,s){return Object.defineProperty(this,i,{value:s}),s}toString(){const[i,s,d,_]=this.rgb;return`rgba(${[i,s,d].map(T=>Math.round(255*T)).join(",")},${_})`}static interpolate(i,s,d,_="rgb"){switch(_){case"rgb":{const[T,n,e,r]=po(i.rgb,s.rgb,d);return new pi(T,n,e,r,!1)}case"hcl":{const[T,n,e,r]=i.hcl,[o,h,p,g]=s.hcl;let v,M;if(isNaN(T)||isNaN(o))isNaN(T)?isNaN(o)?v=NaN:(v=o,e!==1&&e!==0||(M=h)):(v=T,p!==1&&p!==0||(M=n));else{let B=o-T;o>T&&B>180?B-=360:o<T&&T-o>180&&(B+=360),v=T+d*B}const[A,z,I,L]=function([B,j,q,X]){return B=isNaN(B)?0:B*ql,$l([q,Math.cos(B)*j,Math.sin(B)*j,X])}([v,M??fo(n,h,d),fo(e,p,d),fo(r,g,d)]);return new pi(A,z,I,L,!1)}case"lab":{const[T,n,e,r]=$l(po(i.lab,s.lab,d));return new pi(T,n,e,r,!1)}}}}pi.black=new pi(0,0,0,1),pi.white=new pi(1,1,1,1),pi.transparent=new pi(0,0,0,0),pi.red=new pi(1,0,0,1);class Va{constructor(i,s,d){this.sensitivity=i?s?"variant":"case":s?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,s){return this.collator.compare(i,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const kc=["bottom","center","top"];class mo{constructor(i,s,d,_,T,n){this.text=i,this.image=s,this.scale=d,this.fontStack=_,this.textColor=T,this.verticalAlign=n}}class Jr{constructor(i){this.sections=i}static fromString(i){return new Jr([new mo(i,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Jr?i:Jr.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class Mn{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Mn)return i;if(typeof i=="number")return new Mn([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const s of i)if(typeof s!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new Mn(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,s,d){return new Mn(po(i.values,s.values,d))}}class on{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof on)return i;if(typeof i=="number")return new on([i]);if(Array.isArray(i)){for(const s of i)if(typeof s!="number")return;return new on(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,s,d){return new on(po(i.values,s.values,d))}}class mn{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof mn)return i;if(typeof i=="string"){const d=pi.parse(i);return d?new mn([d]):void 0}if(!Array.isArray(i))return;const s=[];for(const d of i){if(typeof d!="string")return;const _=pi.parse(d);if(!_)return;s.push(_)}return new mn(s)}toString(){return JSON.stringify(this.values)}static interpolate(i,s,d,_="rgb"){const T=[];if(i.values.length!=s.values.length)throw new Error(`colorArray: Arrays have mismatched length (${i.values.length} vs. ${s.values.length}), cannot interpolate.`);for(let n=0;n<i.values.length;n++)T.push(pi.interpolate(i.values[n],s.values[n],d,_));return new mn(T)}}class ir extends Error{constructor(i){super(i),this.name="RuntimeError"}toJSON(){return this.message}}const qs=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Dn{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Dn)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let s=0;s<i.length;s+=2){const d=i[s],_=i[s+1];if(typeof d!="string"||!qs.has(d)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new Dn(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,s,d){const _=i.values,T=s.values;if(_.length!==T.length)throw new ir(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${s.toString()}`);const n=[];for(let e=0;e<_.length;e+=2){if(_[e]!==T[e])throw new ir(`Cannot interpolate values containing mismatched anchors. from[${e}]: ${_[e]}, to[${e}]: ${T[e]}`);n.push(_[e]);const[r,o]=_[e+1],[h,p]=T[e+1];n.push([fo(r,h,d),fo(o,p,d)])}return new Dn(n)}}class An{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new An({name:i,available:!1}):null}}class Gr{constructor(i,s,d){this.from=i,this.to=s,this.transition=d}static interpolate(i,s,d){return new Gr(i,s,d)}static parse(i){return i instanceof Gr?i:Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number"?new Gr(i[0],i[1],i[2]):typeof i=="object"&&typeof i.from=="string"&&typeof i.to=="string"&&typeof i.transition=="number"?new Gr(i.from,i.to,i.transition):typeof i=="string"?new Gr(i,i,1):void 0}}function wr(l,i,s,d){return typeof l=="number"&&l>=0&&l<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof s=="number"&&s>=0&&s<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[l,i,s,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[l,i,s,d]:[l,i,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ts(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Gr||l instanceof pi||l instanceof Va||l instanceof Jr||l instanceof Mn||l instanceof on||l instanceof mn||l instanceof Dn||l instanceof An)return!0;if(Array.isArray(l)){for(const i of l)if(!Ts(i))return!1;return!0}if(typeof l=="object"){for(const i in l)if(!Ts(l[i]))return!1;return!0}return!1}function ii(l){if(l===null)return dr;if(typeof l=="string")return ai;if(typeof l=="boolean")return si;if(typeof l=="number")return xt;if(l instanceof pi)return lr;if(l instanceof Gr)return Oa;if(l instanceof Va)return Pc;if(l instanceof Jr)return Vn;if(l instanceof Mn)return os;if(l instanceof on)return ho;if(l instanceof mn)return Fa;if(l instanceof Dn)return Ul;if(l instanceof An)return Br;if(Array.isArray(l)){const i=l.length;let s;for(const d of l){const _=ii(d);if(s){if(s===_)continue;s=wi;break}s=_}return Sn(s||wi,i)}return or}function ri(l){const i=typeof l;return l===null?"":i==="string"||i==="number"||i==="boolean"?String(l):l instanceof pi||l instanceof Gr||l instanceof Jr||l instanceof Mn||l instanceof on||l instanceof mn||l instanceof Dn||l instanceof An?l.toString():JSON.stringify(l)}class Ua{constructor(i,s){this.type=i,this.value=s}static parse(i,s){if(i.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Ts(i[1]))return s.error("invalid value");const d=i[1];let _=ii(d);const T=s.expectedType;return _.kind!=="array"||_.N!==0||!T||T.kind!=="array"||typeof T.N=="number"&&T.N!==0||(_=T),new Ua(_,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Li={string:ai,number:xt,boolean:si,object:or};class fr{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");let d,_=1;const T=i[0];if(T==="array"){let e,r;if(i.length>2){const o=i[1];if(typeof o!="string"||!(o in Li)||o==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);e=Li[o],_++}else e=wi;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return s.error('The length argument to "array" must be a positive integer literal',2);r=i[2],_++}d=Sn(e,r)}else{if(!Li[T])throw new Error(`Types doesn't contain name = ${T}`);d=Li[T]}const n=[];for(;_<i.length;_++){const e=s.parse(i[_],_,wi);if(!e)return null;n.push(e)}return new fr(d,n)}evaluate(i){for(let s=0;s<this.args.length;s++){const d=this.args[s].evaluate(i);if(!Vs(this.type,ii(d)))return d;if(s===this.args.length-1)throw new ir(`Expected value to be of type ${tr(this.type)}, but found ${tr(ii(d))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const Xn={"to-boolean":si,"to-color":lr,"to-number":xt,"to-string":ai};class Yn{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const d=i[0];if(!Xn[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if((d==="to-boolean"||d==="to-string")&&i.length!==2)return s.error("Expected one argument.");const _=Xn[d],T=[];for(let n=1;n<i.length;n++){const e=s.parse(i[n],n,wi);if(!e)return null;T.push(e)}return new Yn(_,T)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let s,d;for(const _ of this.args){if(s=_.evaluate(i),d=null,s instanceof pi)return s;if(typeof s=="string"){const T=i.parseColor(s);if(T)return T}else if(Array.isArray(s)&&(d=s.length<3||s.length>4?`Invalid rgba value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:wr(s[0],s[1],s[2],s[3]),!d))return new pi(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new ir(d||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const d of this.args){s=d.evaluate(i);const _=Mn.parse(s);if(_)return _}throw new ir(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"numberArray":{let s;for(const d of this.args){s=d.evaluate(i);const _=on.parse(s);if(_)return _}throw new ir(`Could not parse numberArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"colorArray":{let s;for(const d of this.args){s=d.evaluate(i);const _=mn.parse(s);if(_)return _}throw new ir(`Could not parse colorArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const d of this.args){s=d.evaluate(i);const _=Dn.parse(s);if(_)return _}throw new ir(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const d of this.args){if(s=d.evaluate(i),s===null)return 0;const _=Number(s);if(!isNaN(_))return _}throw new ir(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return Jr.fromString(ri(this.args[0].evaluate(i)));case"resolvedImage":return An.fromString(ri(this.args[0].evaluate(i)));case"projectionDefinition":return this.args[0].evaluate(i);default:return ri(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const el=["Unknown","Point","LineString","Polygon"];class fd{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?el[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let s=this._parseColorCache.get(i);return s||(s=pi.parse(i),this._parseColorCache.set(i,s)),s}}class go{constructor(i,s,d=[],_,T=new Ba,n=[]){this.registry=i,this.path=d,this.key=d.map(e=>`[${e}]`).join(""),this.scope=T,this.errors=n,this.expectedType=_,this._isConstant=s}parse(i,s,d,_,T={}){return s?this.concat(s,d,_)._parse(i,T):this._parse(i,T)}_parse(i,s){function d(_,T,n){return n==="assert"?new fr(T,[_]):n==="coerce"?new Yn(T,[_]):_}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=i[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const T=this.registry[_];if(T){let n=T.parse(i,this);if(!n)return null;if(this.expectedType){const e=this.expectedType,r=n.type;if(e.kind!=="string"&&e.kind!=="number"&&e.kind!=="boolean"&&e.kind!=="object"&&e.kind!=="array"||r.kind!=="value"){if(e.kind==="projectionDefinition"&&["string","array"].includes(r.kind)||["color","formatted","resolvedImage"].includes(e.kind)&&["value","string"].includes(r.kind)||["padding","numberArray"].includes(e.kind)&&["value","number","array"].includes(r.kind)||e.kind==="colorArray"&&["value","string","array"].includes(r.kind)||e.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(r.kind))n=d(n,e,s.typeAnnotation||"coerce");else if(this.checkSubtype(e,r))return null}else n=d(n,e,s.typeAnnotation||"assert")}if(!(n instanceof Ua)&&n.type.kind!=="resolvedImage"&&this._isConstant(n)){const e=new fd;try{n=new Ua(n.type,n.evaluate(e))}catch(r){return this.error(r.message),null}}return n}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,s,d){const _=typeof i=="number"?this.path.concat(i):this.path,T=d?this.scope.concat(d):this.scope;return new go(this.registry,this._isConstant,_,s||null,T,this.errors)}error(i,...s){const d=`${this.key}${s.map(_=>`[${_}]`).join("")}`;this.errors.push(new Ur(d,i))}checkSubtype(i,s){const d=Vs(i,s);return d&&this.error(d),d}}class tl{constructor(i,s){this.type=s.type,this.bindings=[].concat(i),this.result=s}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const s of this.bindings)i(s[1]);i(this.result)}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const d=[];for(let T=1;T<i.length-1;T+=2){const n=i[T];if(typeof n!="string")return s.error(`Expected string, but found ${typeof n} instead.`,T);if(/[^a-zA-Z0-9_]/.test(n))return s.error("Variable names must contain only alphanumeric characters or '_'.",T);const e=s.parse(i[T+1],T+1);if(!e)return null;d.push([n,e])}const _=s.parse(i[i.length-1],i.length-1,s.expectedType,d);return _?new tl(d,_):null}outputDefined(){return this.result.outputDefined()}}class yo{constructor(i,s){this.type=s.type,this.name=i,this.boundExpression=s}static parse(i,s){if(i.length!==2||typeof i[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const d=i[1];return s.scope.has(d)?new yo(d,s.scope.get(d)):s.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class _o{constructor(i,s,d){this.type=i,this.index=s,this.input=d}static parse(i,s){if(i.length!==3)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=s.parse(i[1],1,xt),_=s.parse(i[2],2,Sn(s.expectedType||wi));return d&&_?new _o(_.type.itemType,d,_):null}evaluate(i){const s=this.index.evaluate(i),d=this.input.evaluate(i);if(s<0)throw new ir(`Array index out of bounds: ${s} < 0.`);if(s>=d.length)throw new ir(`Array index out of bounds: ${s} > ${d.length-1}.`);if(s!==Math.floor(s))throw new ir(`Array index must be an integer, but found ${s} instead.`);return d[s]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class Rc{constructor(i,s){this.type=si,this.needle=i,this.haystack=s}static parse(i,s){if(i.length!==3)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=s.parse(i[1],1,wi),_=s.parse(i[2],2,wi);return d&&_?Qo(d.type,[si,ai,xt,dr,wi])?new Rc(d,_):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${tr(d.type)} instead`):null}evaluate(i){const s=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!d)return!1;if(!Na(s,["boolean","string","number","null"]))throw new ir(`Expected first argument to be of type boolean, string, number or null, but found ${tr(ii(s))} instead.`);if(!Na(d,["string","array"]))throw new ir(`Expected second argument to be of type array or string, but found ${tr(ii(d))} instead.`);return d.indexOf(s)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class Ta{constructor(i,s,d){this.type=xt,this.needle=i,this.haystack=s,this.fromIndex=d}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=s.parse(i[1],1,wi),_=s.parse(i[2],2,wi);if(!d||!_)return null;if(!Qo(d.type,[si,ai,xt,dr,wi]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${tr(d.type)} instead`);if(i.length===4){const T=s.parse(i[3],3,xt);return T?new Ta(d,_,T):null}return new Ta(d,_)}evaluate(i){const s=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!Na(s,["boolean","string","number","null"]))throw new ir(`Expected first argument to be of type boolean, string, number or null, but found ${tr(ii(s))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(i)),Na(d,["string"])){const T=d.indexOf(s,_);return T===-1?-1:[...d.slice(0,T)].length}if(Na(d,["array"]))return d.indexOf(s,_);throw new ir(`Expected second argument to be of type array or string, but found ${tr(ii(d))} instead.`)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class Rr{constructor(i,s,d,_,T,n){this.inputType=i,this.type=s,this.input=d,this.cases=_,this.outputs=T,this.otherwise=n}static parse(i,s){if(i.length<5)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return s.error("Expected an even number of arguments.");let d,_;s.expectedType&&s.expectedType.kind!=="value"&&(_=s.expectedType);const T={},n=[];for(let o=2;o<i.length-1;o+=2){let h=i[o];const p=i[o+1];Array.isArray(h)||(h=[h]);const g=s.concat(o);if(h.length===0)return g.error("Expected at least one branch label.");for(const M of h){if(typeof M!="number"&&typeof M!="string")return g.error("Branch labels must be numbers or strings.");if(typeof M=="number"&&Math.abs(M)>Number.MAX_SAFE_INTEGER)return g.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof M=="number"&&Math.floor(M)!==M)return g.error("Numeric branch labels must be integer values.");if(d){if(g.checkSubtype(d,ii(M)))return null}else d=ii(M);if(T[String(M)]!==void 0)return g.error("Branch labels must be unique.");T[String(M)]=n.length}const v=s.parse(p,o,_);if(!v)return null;_=_||v.type,n.push(v)}const e=s.parse(i[1],1,wi);if(!e)return null;const r=s.parse(i[i.length-1],i.length-1,_);return r?e.type.kind!=="value"&&s.concat(1).checkSubtype(d,e.type)?null:new Rr(d,_,e,T,n,r):null}evaluate(i){const s=this.input.evaluate(i);return(ii(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class il{constructor(i,s,d){this.type=i,this.branches=s,this.otherwise=d}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return s.error("Expected an odd number of arguments.");let d;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);const _=[];for(let n=1;n<i.length-1;n+=2){const e=s.parse(i[n],n,si);if(!e)return null;const r=s.parse(i[n+1],n+1,d);if(!r)return null;_.push([e,r]),d=d||r.type}const T=s.parse(i[i.length-1],i.length-1,d);if(!T)return null;if(!d)throw new Error("Can't infer output type");return new il(d,_,T)}evaluate(i){for(const[s,d]of this.branches)if(s.evaluate(i))return d.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[s,d]of this.branches)i(s),i(d);i(this.otherwise)}outputDefined(){return this.branches.every(([i,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class xo{constructor(i,s,d,_){this.type=i,this.input=s,this.beginIndex=d,this.endIndex=_}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=s.parse(i[1],1,wi),_=s.parse(i[2],2,xt);if(!d||!_)return null;if(!Qo(d.type,[Sn(wi),ai,wi]))return s.error(`Expected first argument to be of type array or string, but found ${tr(d.type)} instead`);if(i.length===4){const T=s.parse(i[3],3,xt);return T?new xo(d.type,d,_,T):null}return new xo(d.type,d,_)}evaluate(i){const s=this.input.evaluate(i),d=this.beginIndex.evaluate(i);let _;if(this.endIndex&&(_=this.endIndex.evaluate(i)),Na(s,["string"]))return[...s].slice(d,_).join("");if(Na(s,["array"]))return s.slice(d,_);throw new ir(`Expected first argument to be of type array or string, but found ${tr(ii(s))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function vo(l,i){const s=l.length-1;let d,_,T=0,n=s,e=0;for(;T<=n;)if(e=Math.floor((T+n)/2),d=l[e],_=l[e+1],d<=i){if(e===s||i<_)return e;T=e+1}else{if(!(d>i))throw new ir("Input is not a number.");n=e-1}return 0}class en{constructor(i,s,d){this.type=i,this.input=s,this.labels=[],this.outputs=[];for(const[_,T]of d)this.labels.push(_),this.outputs.push(T)}static parse(i,s){if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");const d=s.parse(i[1],1,xt);if(!d)return null;const _=[];let T=null;s.expectedType&&s.expectedType.kind!=="value"&&(T=s.expectedType);for(let n=1;n<i.length;n+=2){const e=n===1?-1/0:i[n],r=i[n+1],o=n,h=n+1;if(typeof e!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(_.length&&_[_.length-1][0]>=e)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',o);const p=s.parse(r,h,T);if(!p)return null;T=T||p.type,_.push([e,p])}return new en(T,d,_)}evaluate(i){const s=this.labels,d=this.outputs;if(s.length===1)return d[0].evaluate(i);const _=this.input.evaluate(i);if(_<=s[0])return d[0].evaluate(i);const T=s.length;return _>=s[T-1]?d[T-1].evaluate(i):d[vo(s,_)].evaluate(i)}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Mh(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Ms,Eu,rf=function(){if(Eu)return Ms;function l(i,s,d,_){this.cx=3*i,this.bx=3*(d-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(_-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=s,this.p2x=d,this.p2y=_}return Eu=1,Ms=l,l.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,s){if(s===void 0&&(s=1e-6),i<0)return 0;if(i>1)return 1;for(var d=i,_=0;_<8;_++){var T=this.sampleCurveX(d)-i;if(Math.abs(T)<s)return d;var n=this.sampleCurveDerivativeX(d);if(Math.abs(n)<1e-6)break;d-=T/n}var e=0,r=1;for(d=i,_=0;_<20&&(T=this.sampleCurveX(d),!(Math.abs(T-i)<s));_++)i>T?e=d:r=d,d=.5*(r-e)+e;return d},solve:function(i,s){return this.sampleCurveY(this.solveCurveX(i,s))}},Ms}(),Dc=Mh(rf);class Un{constructor(i,s,d,_,T){this.type=i,this.operator=s,this.interpolation=d,this.input=_,this.labels=[],this.outputs=[];for(const[n,e]of T)this.labels.push(n),this.outputs.push(e)}static interpolationFactor(i,s,d,_){let T=0;if(i.name==="exponential")T=zu(s,i.base,d,_);else if(i.name==="linear")T=zu(s,1,d,_);else if(i.name==="cubic-bezier"){const n=i.controlPoints;T=new Dc(n[0],n[1],n[2],n[3]).solve(zu(s,1,d,_))}return T}static parse(i,s){let[d,_,T,...n]=i;if(!Array.isArray(_)||_.length===0)return s.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const o=_[1];if(typeof o!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:o}}else{if(_[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const o=_.slice(1);if(o.length!==4||o.some(h=>typeof h!="number"||h<0||h>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:o}}}if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(T=s.parse(T,2,xt),!T)return null;const e=[];let r=null;d!=="interpolate-hcl"&&d!=="interpolate-lab"||s.expectedType==Fa?s.expectedType&&s.expectedType.kind!=="value"&&(r=s.expectedType):r=lr;for(let o=0;o<n.length;o+=2){const h=n[o],p=n[o+1],g=o+3,v=o+4;if(typeof h!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',g);if(e.length&&e[e.length-1][0]>=h)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',g);const M=s.parse(p,v,r);if(!M)return null;r=r||M.type,e.push([h,M])}return ls(r,xt)||ls(r,Oa)||ls(r,lr)||ls(r,os)||ls(r,ho)||ls(r,Fa)||ls(r,Ul)||ls(r,Sn(xt))?new Un(r,d,_,T,e):s.error(`Type ${tr(r)} is not interpolatable.`)}evaluate(i){const s=this.labels,d=this.outputs;if(s.length===1)return d[0].evaluate(i);const _=this.input.evaluate(i);if(_<=s[0])return d[0].evaluate(i);const T=s.length;if(_>=s[T-1])return d[T-1].evaluate(i);const n=vo(s,_),e=Un.interpolationFactor(this.interpolation,_,s[n],s[n+1]),r=d[n].evaluate(i),o=d[n+1].evaluate(i);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return fo(r,o,e);case"color":return pi.interpolate(r,o,e);case"padding":return Mn.interpolate(r,o,e);case"colorArray":return mn.interpolate(r,o,e);case"numberArray":return on.interpolate(r,o,e);case"variableAnchorOffsetCollection":return Dn.interpolate(r,o,e);case"array":return po(r,o,e);case"projectionDefinition":return Gr.interpolate(r,o,e)}case"interpolate-hcl":switch(this.type.kind){case"color":return pi.interpolate(r,o,e,"hcl");case"colorArray":return mn.interpolate(r,o,e,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return pi.interpolate(r,o,e,"lab");case"colorArray":return mn.interpolate(r,o,e,"lab")}}}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function zu(l,i,s,d){const _=d-s,T=l-s;return _===0?0:i===1?T/_:(Math.pow(i,T)-1)/(Math.pow(i,_)-1)}const As={color:pi.interpolate,number:fo,padding:Mn.interpolate,numberArray:on.interpolate,colorArray:mn.interpolate,variableAnchorOffsetCollection:Dn.interpolate,array:po};class Hl{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");let d=null;const _=s.expectedType;_&&_.kind!=="value"&&(d=_);const T=[];for(const e of i.slice(1)){const r=s.parse(e,1+T.length,d,void 0,{typeAnnotation:"omit"});if(!r)return null;d=d||r.type,T.push(r)}if(!d)throw new Error("No output type");const n=_&&T.some(e=>Vs(_,e.type));return new Hl(n?wi:d,T)}evaluate(i){let s,d=null,_=0;for(const T of this.args)if(_++,d=T.evaluate(i),d&&d instanceof An&&!d.available&&(s||(s=d.name),d=null,_===this.args.length&&(d=s)),d!==null)break;return d}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}function Lc(l,i){return l==="=="||l==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function rl(l,i,s,d){return d.compare(i,s)===0}function Cn(l,i,s){const d=l!=="=="&&l!=="!=";return class vg{constructor(T,n,e){this.type=si,this.lhs=T,this.rhs=n,this.collator=e,this.hasUntypedArgument=T.type.kind==="value"||n.type.kind==="value"}static parse(T,n){if(T.length!==3&&T.length!==4)return n.error("Expected two or three arguments.");const e=T[0];let r=n.parse(T[1],1,wi);if(!r)return null;if(!Lc(e,r.type))return n.concat(1).error(`"${e}" comparisons are not supported for type '${tr(r.type)}'.`);let o=n.parse(T[2],2,wi);if(!o)return null;if(!Lc(e,o.type))return n.concat(2).error(`"${e}" comparisons are not supported for type '${tr(o.type)}'.`);if(r.type.kind!==o.type.kind&&r.type.kind!=="value"&&o.type.kind!=="value")return n.error(`Cannot compare types '${tr(r.type)}' and '${tr(o.type)}'.`);d&&(r.type.kind==="value"&&o.type.kind!=="value"?r=new fr(o.type,[r]):r.type.kind!=="value"&&o.type.kind==="value"&&(o=new fr(r.type,[o])));let h=null;if(T.length===4){if(r.type.kind!=="string"&&o.type.kind!=="string"&&r.type.kind!=="value"&&o.type.kind!=="value")return n.error("Cannot use collator to compare non-string types.");if(h=n.parse(T[3],3,Pc),!h)return null}return new vg(r,o,h)}evaluate(T){const n=this.lhs.evaluate(T),e=this.rhs.evaluate(T);if(d&&this.hasUntypedArgument){const r=ii(n),o=ii(e);if(r.kind!==o.kind||r.kind!=="string"&&r.kind!=="number")throw new ir(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${r.kind}, ${o.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const r=ii(n),o=ii(e);if(r.kind!=="string"||o.kind!=="string")return i(T,n,e)}return this.collator?s(T,n,e,this.collator.evaluate(T)):i(T,n,e)}eachChild(T){T(this.lhs),T(this.rhs),this.collator&&T(this.collator)}outputDefined(){return!0}}}const Bc=Cn("==",function(l,i,s){return i===s},rl),Oc=Cn("!=",function(l,i,s){return i!==s},function(l,i,s,d){return!rl(0,i,s,d)}),Xl=Cn("<",function(l,i,s){return i<s},function(l,i,s,d){return d.compare(i,s)<0}),Yl=Cn(">",function(l,i,s){return i>s},function(l,i,s,d){return d.compare(i,s)>0}),Fc=Cn("<=",function(l,i,s){return i<=s},function(l,i,s,d){return d.compare(i,s)<=0}),us=Cn(">=",function(l,i,s){return i>=s},function(l,i,s,d){return d.compare(i,s)>=0});class Pu{constructor(i,s,d){this.type=Pc,this.locale=d,this.caseSensitive=i,this.diacriticSensitive=s}static parse(i,s){if(i.length!==2)return s.error("Expected one argument.");const d=i[1];if(typeof d!="object"||Array.isArray(d))return s.error("Collator options argument must be an object.");const _=s.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,si);if(!_)return null;const T=s.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,si);if(!T)return null;let n=null;return d.locale&&(n=s.parse(d.locale,1,ai),!n)?null:new Pu(_,T,n)}evaluate(i){return new Va(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}class Ah{constructor(i,s,d,_,T){this.type=ai,this.number=i,this.locale=s,this.currency=d,this.minFractionDigits=_,this.maxFractionDigits=T}static parse(i,s){if(i.length!==3)return s.error("Expected two arguments.");const d=s.parse(i[1],1,xt);if(!d)return null;const _=i[2];if(typeof _!="object"||Array.isArray(_))return s.error("NumberFormat options argument must be an object.");let T=null;if(_.locale&&(T=s.parse(_.locale,1,ai),!T))return null;let n=null;if(_.currency&&(n=s.parse(_.currency,1,ai),!n))return null;let e=null;if(_["min-fraction-digits"]&&(e=s.parse(_["min-fraction-digits"],1,xt),!e))return null;let r=null;return _["max-fraction-digits"]&&(r=s.parse(_["max-fraction-digits"],1,xt),!r)?null:new Ah(d,T,n,e,r)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class bo{constructor(i){this.type=Vn,this.sections=i}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const d=i[1];if(!Array.isArray(d)&&typeof d=="object")return s.error("First argument must be an image or text section.");const _=[];let T=!1;for(let n=1;n<=i.length-1;++n){const e=i[n];if(T&&typeof e=="object"&&!Array.isArray(e)){T=!1;let r=null;if(e["font-scale"]&&(r=s.parse(e["font-scale"],1,xt),!r))return null;let o=null;if(e["text-font"]&&(o=s.parse(e["text-font"],1,Sn(ai)),!o))return null;let h=null;if(e["text-color"]&&(h=s.parse(e["text-color"],1,lr),!h))return null;let p=null;if(e["vertical-align"]){if(typeof e["vertical-align"]=="string"&&!kc.includes(e["vertical-align"]))return s.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${e["vertical-align"]}' instead.`);if(p=s.parse(e["vertical-align"],1,ai),!p)return null}const g=_[_.length-1];g.scale=r,g.font=o,g.textColor=h,g.verticalAlign=p}else{const r=s.parse(i[n],1,wi);if(!r)return null;const o=r.type.kind;if(o!=="string"&&o!=="value"&&o!=="null"&&o!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");T=!0,_.push({content:r,scale:null,font:null,textColor:null,verticalAlign:null})}}return new bo(_)}evaluate(i){return new Jr(this.sections.map(s=>{const d=s.content.evaluate(i);return ii(d)===Br?new mo("",d,null,null,null,s.verticalAlign?s.verticalAlign.evaluate(i):null):new mo(ri(d),null,s.scale?s.scale.evaluate(i):null,s.font?s.font.evaluate(i).join(","):null,s.textColor?s.textColor.evaluate(i):null,s.verticalAlign?s.verticalAlign.evaluate(i):null)}))}eachChild(i){for(const s of this.sections)i(s.content),s.scale&&i(s.scale),s.font&&i(s.font),s.textColor&&i(s.textColor),s.verticalAlign&&i(s.verticalAlign)}outputDefined(){return!1}}class wo{constructor(i){this.type=Br,this.input=i}static parse(i,s){if(i.length!==2)return s.error("Expected two arguments.");const d=s.parse(i[1],1,ai);return d?new wo(d):s.error("No image name provided.")}evaluate(i){const s=this.input.evaluate(i),d=An.fromString(s);return d&&i.availableImages&&(d.available=i.availableImages.indexOf(s)>-1),d}eachChild(i){i(this.input)}outputDefined(){return!1}}class So{constructor(i){this.type=xt,this.input=i}static parse(i,s){if(i.length!==2)return s.error(`Expected 1 argument, but found ${i.length-1} instead.`);const d=s.parse(i[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${tr(d.type)} instead.`):new So(d):null}evaluate(i){const s=this.input.evaluate(i);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new ir(`Expected value to be of type string or array, but found ${tr(ii(s))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const Ln=8192;function Iu(l,i){const s=(180+l[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,_=Math.pow(2,i.z);return[Math.round(s*_*Ln),Math.round(d*_*Ln)]}function nl(l,i){const s=Math.pow(2,i.z);return[(_=(l[0]/Ln+i.x)/s,360*_-180),(d=(l[1]/Ln+i.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90)];var d,_}function Wl(l,i){l[0]=Math.min(l[0],i[0]),l[1]=Math.min(l[1],i[1]),l[2]=Math.max(l[2],i[0]),l[3]=Math.max(l[3],i[1])}function Cs(l,i){return!(l[0]<=i[0]||l[2]>=i[2]||l[1]<=i[1]||l[3]>=i[3])}function Kl(l,i,s){const d=l[0]-i[0],_=l[1]-i[1],T=l[0]-s[0],n=l[1]-s[1];return d*n-T*_==0&&d*T<=0&&_*n<=0}function jc(l,i,s,d){return(_=[d[0]-s[0],d[1]-s[1]])[0]*(T=[i[0]-l[0],i[1]-l[1]])[1]-_[1]*T[0]!=0&&!(!Ql(l,i,s,d)||!Ql(s,d,l,i));var _,T}function al(l,i,s){for(const d of s)for(let _=0;_<d.length-1;++_)if(jc(l,i,d[_],d[_+1]))return!0;return!1}function Si(l,i,s=!1){let d=!1;for(const e of i)for(let r=0;r<e.length-1;r++){if(Kl(l,e[r],e[r+1]))return s;(T=e[r])[1]>(_=l)[1]!=(n=e[r+1])[1]>_[1]&&_[0]<(n[0]-T[0])*(_[1]-T[1])/(n[1]-T[1])+T[0]&&(d=!d)}var _,T,n;return d}function ku(l,i){for(const s of i)if(Si(l,s))return!0;return!1}function pd(l,i){for(const s of l)if(!Si(s,i))return!1;for(let s=0;s<l.length-1;++s)if(al(l[s],l[s+1],i))return!1;return!0}function md(l,i){for(const s of i)if(pd(l,s))return!0;return!1}function Ql(l,i,s,d){const _=d[0]-s[0],T=d[1]-s[1],n=(l[0]-s[0])*T-_*(l[1]-s[1]),e=(i[0]-s[0])*T-_*(i[1]-s[1]);return n>0&&e<0||n<0&&e>0}function Jl(l,i,s){const d=[];for(let _=0;_<l.length;_++){const T=[];for(let n=0;n<l[_].length;n++){const e=Iu(l[_][n],s);Wl(i,e),T.push(e)}d.push(T)}return d}function Nc(l,i,s){const d=[];for(let _=0;_<l.length;_++){const T=Jl(l[_],i,s);d.push(T)}return d}function Ru(l,i,s,d){if(l[0]<s[0]||l[0]>s[2]){const _=.5*d;let T=l[0]-s[0]>_?-d:s[0]-l[0]>_?d:0;T===0&&(T=l[0]-s[2]>_?-d:s[2]-l[0]>_?d:0),l[0]+=T}Wl(i,l)}function Du(l,i,s,d){const _=Math.pow(2,d.z)*Ln,T=[d.x*Ln,d.y*Ln],n=[];for(const e of l)for(const r of e){const o=[r.x+T[0],r.y+T[1]];Ru(o,i,s,_),n.push(o)}return n}function Lu(l,i,s,d){const _=Math.pow(2,d.z)*Ln,T=[d.x*Ln,d.y*Ln],n=[];for(const r of l){const o=[];for(const h of r){const p=[h.x+T[0],h.y+T[1]];Wl(i,p),o.push(p)}n.push(o)}if(i[2]-i[0]<=_/2){(e=i)[0]=e[1]=1/0,e[2]=e[3]=-1/0;for(const r of n)for(const o of r)Ru(o,i,s,_)}var e;return n}class Es{constructor(i,s){this.type=si,this.geojson=i,this.geometries=s}static parse(i,s){if(i.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Ts(i[1])){const d=i[1];if(d.type==="FeatureCollection"){const _=[];for(const T of d.features){const{type:n,coordinates:e}=T.geometry;n==="Polygon"&&_.push(e),n==="MultiPolygon"&&_.push(...e)}if(_.length)return new Es(d,{type:"MultiPolygon",coordinates:_})}else if(d.type==="Feature"){const _=d.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Es(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new Es(d,d)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(s,d){const _=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],n=s.canonicalID();if(d.type==="Polygon"){const e=Jl(d.coordinates,T,n),r=Du(s.geometry(),_,T,n);if(!Cs(_,T))return!1;for(const o of r)if(!Si(o,e))return!1}if(d.type==="MultiPolygon"){const e=Nc(d.coordinates,T,n),r=Du(s.geometry(),_,T,n);if(!Cs(_,T))return!1;for(const o of r)if(!ku(o,e))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(s,d){const _=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],n=s.canonicalID();if(d.type==="Polygon"){const e=Jl(d.coordinates,T,n),r=Lu(s.geometry(),_,T,n);if(!Cs(_,T))return!1;for(const o of r)if(!pd(o,e))return!1}if(d.type==="MultiPolygon"){const e=Nc(d.coordinates,T,n),r=Lu(s.geometry(),_,T,n);if(!Cs(_,T))return!1;for(const o of r)if(!md(o,e))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Zs=class{constructor(l=[],i=(s,d)=>s<d?-1:s>d?1:0){if(this.data=l,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:i,compare:s}=this,d=i[l];for(;l>0;){const _=l-1>>1,T=i[_];if(s(d,T)>=0)break;i[l]=T,l=_}i[l]=d}_down(l){const{data:i,compare:s}=this,d=this.length>>1,_=i[l];for(;l<d;){let T=1+(l<<1);const n=T+1;if(n<this.length&&s(i[n],i[T])<0&&(T=n),s(i[T],_)>=0)break;i[l]=i[T],l=T}i[l]=_}};function sl(l,i,s=0,d=l.length-1,_=gd){for(;d>s;){if(d-s>600){const r=d-s+1,o=i-s+1,h=Math.log(r),p=.5*Math.exp(2*h/3),g=.5*Math.sqrt(h*p*(r-p)/r)*(o-r/2<0?-1:1);sl(l,i,Math.max(s,Math.floor(i-o*p/r+g)),Math.min(d,Math.floor(i+(r-o)*p/r+g)),_)}const T=l[i];let n=s,e=d;for(ol(l,s,i),_(l[d],T)>0&&ol(l,s,d);n<e;){for(ol(l,n,e),n++,e--;_(l[n],T)<0;)n++;for(;_(l[e],T)>0;)e--}_(l[s],T)===0?ol(l,s,e):(e++,ol(l,e,d)),e<=i&&(s=e+1),i<=e&&(d=e-1)}}function ol(l,i,s){const d=l[i];l[i]=l[s],l[s]=d}function gd(l,i){return l<i?-1:l>i?1:0}function To(l,i){if(l.length<=1)return[l];const s=[];let d,_;for(const T of l){const n=Ch(T);n!==0&&(T.area=Math.abs(n),_===void 0&&(_=n<0),_===n<0?(d&&s.push(d),d=[T]):d.push(T))}if(d&&s.push(d),i>1)for(let T=0;T<s.length;T++)s[T].length<=i||(sl(s[T],i,1,s[T].length-1,Bu),s[T]=s[T].slice(0,i));return s}function Bu(l,i){return i.area-l.area}function Ch(l){let i=0;for(let s,d,_=0,T=l.length,n=T-1;_<T;n=_++)s=l[_],d=l[n],i+=(d.x-s.x)*(s.y+d.y);return i}const Eh=1/298.257223563,nf=Eh*(2-Eh),ec=Math.PI/180;class la{constructor(i){const s=6378.137*ec*1e3,d=Math.cos(i*ec),_=1/(1-nf*(1-d*d)),T=Math.sqrt(_);this.kx=s*T*d,this.ky=s*T*_*(1-nf)}distance(i,s){const d=this.wrap(i[0]-s[0])*this.kx,_=(i[1]-s[1])*this.ky;return Math.sqrt(d*d+_*_)}pointOnLine(i,s){let d,_,T,n,e=1/0;for(let r=0;r<i.length-1;r++){let o=i[r][0],h=i[r][1],p=this.wrap(i[r+1][0]-o)*this.kx,g=(i[r+1][1]-h)*this.ky,v=0;p===0&&g===0||(v=(this.wrap(s[0]-o)*this.kx*p+(s[1]-h)*this.ky*g)/(p*p+g*g),v>1?(o=i[r+1][0],h=i[r+1][1]):v>0&&(o+=p/this.kx*v,h+=g/this.ky*v)),p=this.wrap(s[0]-o)*this.kx,g=(s[1]-h)*this.ky;const M=p*p+g*g;M<e&&(e=M,d=o,_=h,T=r,n=v)}return{point:[d,_],index:T,t:Math.max(0,Math.min(1,n))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}}function tc(l,i){return i[0]-l[0]}function ll(l){return l[1]-l[0]+1}function hs(l,i){return l[1]>=l[0]&&l[1]<i}function Ui(l,i){if(l[0]>l[1])return[null,null];const s=ll(l);if(i){if(s===2)return[l,null];const _=Math.floor(s/2);return[[l[0],l[0]+_],[l[0]+_,l[1]]]}if(s===1)return[l,null];const d=Math.floor(s/2)-1;return[[l[0],l[0]+d],[l[0]+d+1,l[1]]]}function Ou(l,i){if(!hs(i,l.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let d=i[0];d<=i[1];++d)Wl(s,l[d]);return s}function cl(l){const i=[1/0,1/0,-1/0,-1/0];for(const s of l)for(const d of s)Wl(i,d);return i}function zh(l){return l[0]!==-1/0&&l[1]!==-1/0&&l[2]!==1/0&&l[3]!==1/0}function ul(l,i,s){if(!zh(l)||!zh(i))return NaN;let d=0,_=0;return l[2]<i[0]&&(d=i[0]-l[2]),l[0]>i[2]&&(d=l[0]-i[2]),l[1]>i[3]&&(_=l[1]-i[3]),l[3]<i[1]&&(_=i[1]-l[3]),s.distance([0,0],[d,_])}function $s(l,i,s){const d=s.pointOnLine(i,l);return s.distance(l,d.point)}function Sr(l,i,s,d,_){const T=Math.min($s(l,[s,d],_),$s(i,[s,d],_)),n=Math.min($s(s,[l,i],_),$s(d,[l,i],_));return Math.min(T,n)}function Mo(l,i,s,d,_){if(!hs(i,l.length)||!hs(d,s.length))return 1/0;let T=1/0;for(let n=i[0];n<i[1];++n){const e=l[n],r=l[n+1];for(let o=d[0];o<d[1];++o){const h=s[o],p=s[o+1];if(jc(e,r,h,p))return 0;T=Math.min(T,Sr(e,r,h,p,_))}}return T}function Ga(l,i,s,d,_){if(!hs(i,l.length)||!hs(d,s.length))return NaN;let T=1/0;for(let n=i[0];n<=i[1];++n)for(let e=d[0];e<=d[1];++e)if(T=Math.min(T,_.distance(l[n],s[e])),T===0)return T;return T}function Ao(l,i,s){if(Si(l,i,!0))return 0;let d=1/0;for(const _ of i){const T=_[0],n=_[_.length-1];if(T!==n&&(d=Math.min(d,$s(l,[n,T],s)),d===0))return d;const e=s.pointOnLine(_,l);if(d=Math.min(d,s.distance(l,e.point)),d===0)return d}return d}function Co(l,i,s,d){if(!hs(i,l.length))return NaN;for(let T=i[0];T<=i[1];++T)if(Si(l[T],s,!0))return 0;let _=1/0;for(let T=i[0];T<i[1];++T){const n=l[T],e=l[T+1];for(const r of s)for(let o=0,h=r.length,p=h-1;o<h;p=o++){const g=r[p],v=r[o];if(jc(n,e,g,v))return 0;_=Math.min(_,Sr(n,e,g,v,d))}}return _}function Fu(l,i){for(const s of l)for(const d of s)if(Si(d,i,!0))return!0;return!1}function ic(l,i,s,d=1/0){const _=cl(l),T=cl(i);if(d!==1/0&&ul(_,T,s)>=d)return d;if(Cs(_,T)){if(Fu(l,i))return 0}else if(Fu(i,l))return 0;let n=1/0;for(const e of l)for(let r=0,o=e.length,h=o-1;r<o;h=r++){const p=e[h],g=e[r];for(const v of i)for(let M=0,A=v.length,z=A-1;M<A;z=M++){const I=v[z],L=v[M];if(jc(p,g,I,L))return 0;n=Math.min(n,Sr(p,g,I,L,s))}}return n}function Hs(l,i,s,d,_,T){if(!T)return;const n=ul(Ou(d,T),_,s);n<i&&l.push([n,T,[0,0]])}function Eo(l,i,s,d,_,T,n){if(!T||!n)return;const e=ul(Ou(d,T),Ou(_,n),s);e<i&&l.push([e,T,n])}function rc(l,i,s,d,_=1/0){let T=Math.min(d.distance(l[0],s[0][0]),_);if(T===0)return T;const n=new Zs([[0,[0,l.length-1],[0,0]]],tc),e=cl(s);for(;n.length>0;){const r=n.pop();if(r[0]>=T)continue;const o=r[1],h=i?50:100;if(ll(o)<=h){if(!hs(o,l.length))return NaN;if(i){const p=Co(l,o,s,d);if(isNaN(p)||p===0)return p;T=Math.min(T,p)}else for(let p=o[0];p<=o[1];++p){const g=Ao(l[p],s,d);if(T=Math.min(T,g),T===0)return 0}}else{const p=Ui(o,i);Hs(n,T,d,l,e,p[0]),Hs(n,T,d,l,e,p[1])}}return T}function Vc(l,i,s,d,_,T=1/0){let n=Math.min(T,_.distance(l[0],s[0]));if(n===0)return n;const e=new Zs([[0,[0,l.length-1],[0,s.length-1]]],tc);for(;e.length>0;){const r=e.pop();if(r[0]>=n)continue;const o=r[1],h=r[2],p=i?50:100,g=d?50:100;if(ll(o)<=p&&ll(h)<=g){if(!hs(o,l.length)&&hs(h,s.length))return NaN;let v;if(i&&d)v=Mo(l,o,s,h,_),n=Math.min(n,v);else if(i&&!d){const M=l.slice(o[0],o[1]+1);for(let A=h[0];A<=h[1];++A)if(v=$s(s[A],M,_),n=Math.min(n,v),n===0)return n}else if(!i&&d){const M=s.slice(h[0],h[1]+1);for(let A=o[0];A<=o[1];++A)if(v=$s(l[A],M,_),n=Math.min(n,v),n===0)return n}else v=Ga(l,o,s,h,_),n=Math.min(n,v)}else{const v=Ui(o,i),M=Ui(h,d);Eo(e,n,_,l,s,v[0],M[0]),Eo(e,n,_,l,s,v[0],M[1]),Eo(e,n,_,l,s,v[1],M[0]),Eo(e,n,_,l,s,v[1],M[1])}}return n}function Ph(l){return l.type==="MultiPolygon"?l.coordinates.map(i=>({type:"Polygon",coordinates:i})):l.type==="MultiLineString"?l.coordinates.map(i=>({type:"LineString",coordinates:i})):l.type==="MultiPoint"?l.coordinates.map(i=>({type:"Point",coordinates:i})):[l]}class hl{constructor(i,s){this.type=xt,this.geojson=i,this.geometries=s}static parse(i,s){if(i.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Ts(i[1])){const d=i[1];if(d.type==="FeatureCollection")return new hl(d,d.features.map(_=>Ph(_.geometry)).flat());if(d.type==="Feature")return new hl(d,Ph(d.geometry));if("type"in d&&"coordinates"in d)return new hl(d,Ph(d))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(s,d){const _=s.geometry(),T=_.flat().map(r=>nl([r.x,r.y],s.canonical));if(_.length===0)return NaN;const n=new la(T[0][1]);let e=1/0;for(const r of d){switch(r.type){case"Point":e=Math.min(e,Vc(T,!1,[r.coordinates],!1,n,e));break;case"LineString":e=Math.min(e,Vc(T,!1,r.coordinates,!0,n,e));break;case"Polygon":e=Math.min(e,rc(T,!1,r.coordinates,n,e))}if(e===0)return e}return e}(i,this.geometries);if(i.geometryType()==="LineString")return function(s,d){const _=s.geometry(),T=_.flat().map(r=>nl([r.x,r.y],s.canonical));if(_.length===0)return NaN;const n=new la(T[0][1]);let e=1/0;for(const r of d){switch(r.type){case"Point":e=Math.min(e,Vc(T,!0,[r.coordinates],!1,n,e));break;case"LineString":e=Math.min(e,Vc(T,!0,r.coordinates,!0,n,e));break;case"Polygon":e=Math.min(e,rc(T,!0,r.coordinates,n,e))}if(e===0)return e}return e}(i,this.geometries);if(i.geometryType()==="Polygon")return function(s,d){const _=s.geometry();if(_.length===0||_[0].length===0)return NaN;const T=To(_,0).map(r=>r.map(o=>o.map(h=>nl([h.x,h.y],s.canonical)))),n=new la(T[0][0][0][1]);let e=1/0;for(const r of d)for(const o of T){switch(r.type){case"Point":e=Math.min(e,rc([r.coordinates],!1,o,n,e));break;case"LineString":e=Math.min(e,rc(r.coordinates,!0,o,n,e));break;case"Polygon":e=Math.min(e,ic(o,r.coordinates,n,e))}if(e===0)return e}return e}(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Uc{constructor(i){this.type=wi,this.key=i}static parse(i,s){if(i.length!==2)return s.error(`Expected 1 argument, but found ${i.length-1} instead.`);const d=i[1];return d==null?s.error("Global state property must be defined."):typeof d!="string"?s.error(`Global state property must be string, but found ${typeof i[1]} instead.`):new Uc(d)}evaluate(i){var s;const d=(s=i.globals)===null||s===void 0?void 0:s.globalState;return d&&Object.keys(d).length!==0?Us(d,this.key):null}eachChild(){}outputDefined(){return!1}}const dl={"==":Bc,"!=":Oc,">":Yl,"<":Xl,">=":us,"<=":Fc,array:fr,at:_o,boolean:fr,case:il,coalesce:Hl,collator:Pu,format:bo,image:wo,in:Rc,"index-of":Ta,interpolate:Un,"interpolate-hcl":Un,"interpolate-lab":Un,length:So,let:tl,literal:Ua,match:Rr,number:fr,"number-format":Ah,object:fr,slice:xo,step:en,string:fr,"to-boolean":Yn,"to-color":Yn,"to-number":Yn,"to-string":Yn,var:yo,within:Es,distance:hl,"global-state":Uc};class En{constructor(i,s,d,_){this.name=i,this.type=s,this._evaluate=d,this.args=_}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,s){const d=i[0],_=En.definitions[d];if(!_)return s.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const T=Array.isArray(_)?_[0]:_.type,n=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,e=n.filter(([o])=>!Array.isArray(o)||o.length===i.length-1);let r=null;for(const[o,h]of e){r=new go(s.registry,Wn,s.path,null,s.scope);const p=[];let g=!1;for(let v=1;v<i.length;v++){const M=i[v],A=Array.isArray(o)?o[v-1]:o.type,z=r.parse(M,1+p.length,A);if(!z){g=!0;break}p.push(z)}if(!g)if(Array.isArray(o)&&o.length!==p.length)r.error(`Expected ${o.length} arguments, but found ${p.length} instead.`);else{for(let v=0;v<p.length;v++){const M=Array.isArray(o)?o[v]:o.type,A=p[v];r.concat(v+1).checkSubtype(M,A.type)}if(r.errors.length===0)return new En(d,T,h,p)}}if(e.length===1)s.errors.push(...r.errors);else{const o=(e.length?e:n).map(([p])=>{return g=p,Array.isArray(g)?`(${g.map(tr).join(", ")})`:`(${tr(g.type)}...)`;var g}).join(" | "),h=[];for(let p=1;p<i.length;p++){const g=s.parse(i[p],1+h.length);if(!g)return null;h.push(tr(g.type))}s.error(`Expected arguments of type ${o}, but found (${h.join(", ")}) instead.`)}return null}static register(i,s){En.definitions=s;for(const d in s)i[d]=En}}function ju(l,[i,s,d,_]){i=i.evaluate(l),s=s.evaluate(l),d=d.evaluate(l);const T=_?_.evaluate(l):1,n=wr(i,s,d,T);if(n)throw new ir(n);return new pi(i/255,s/255,d/255,T,!1)}function qa(l,i){return l in i}function Nu(l,i){const s=i[l];return s===void 0?null:s}function zn(l){return{type:l}}function Wn(l){if(l instanceof yo)return Wn(l.boundExpression);if(l instanceof En&&l.name==="error"||l instanceof Pu||l instanceof Es||l instanceof hl||l instanceof Uc)return!1;const i=l instanceof Yn||l instanceof fr;let s=!0;return l.eachChild(d=>{s=i?s&&Wn(d):s&&d instanceof Ua}),!!s&&Xs(l)&&pl(l,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Xs(l){if(l instanceof En&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Es||l instanceof hl)return!1;let i=!0;return l.eachChild(s=>{i&&!Xs(s)&&(i=!1)}),i}function fl(l){if(l instanceof En&&l.name==="feature-state")return!1;let i=!0;return l.eachChild(s=>{i&&!fl(s)&&(i=!1)}),i}function pl(l,i){if(l instanceof En&&i.indexOf(l.name)>=0)return!1;let s=!0;return l.eachChild(d=>{s&&!pl(d,i)&&(s=!1)}),s}function ml(l){return{result:"success",value:l}}function zo(l){return{result:"error",value:l}}function qr(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function Za(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function nc(l){return!!l.expression&&l.expression.interpolated}function ni(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function Gc(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)&&ii(l)===or}function Ma(l){return l}function qc(l,i){const s=l.stops&&typeof l.stops[0][0]=="object",d=s||!(s||l.property!==void 0),_=l.type||(nc(i)?"exponential":"interval"),T=function(h){switch(h.type){case"color":return pi.parse;case"padding":return Mn.parse;case"numberArray":return on.parse;case"colorArray":return mn.parse;default:return null}}(i);if(T&&((l=Ar({},l)).stops&&(l.stops=l.stops.map(h=>[h[0],T(h[1])])),l.default=T(l.default?l.default:i.default)),l.colorSpace&&(n=l.colorSpace)!=="rgb"&&n!=="hcl"&&n!=="lab")throw new Error(`Unknown color space: "${l.colorSpace}"`);var n;const e=function(h){switch(h){case"exponential":return zs;case"interval":return Vu;case"categorical":return yd;case"identity":return Ih;default:throw new Error(`Unknown function type "${h}"`)}}(_);let r,o;if(_==="categorical"){r=Object.create(null);for(const h of l.stops)r[h[0]]=h[1];o=typeof l.stops[0][0]}if(s){const h={},p=[];for(let M=0;M<l.stops.length;M++){const A=l.stops[M],z=A[0].zoom;h[z]===void 0&&(h[z]={zoom:z,type:l.type,property:l.property,default:l.default,stops:[]},p.push(z)),h[z].stops.push([A[0].value,A[1]])}const g=[];for(const M of p)g.push([h[M].zoom,qc(h[M],i)]);const v={name:"linear"};return{kind:"composite",interpolationType:v,interpolationFactor:Un.interpolationFactor.bind(void 0,v),zoomStops:g.map(M=>M[0]),evaluate:({zoom:M},A)=>zs({stops:g,base:l.base},i,M).evaluate(M,A)}}if(d){const h=_==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:h,interpolationFactor:Un.interpolationFactor.bind(void 0,h),zoomStops:l.stops.map(p=>p[0]),evaluate:({zoom:p})=>e(l,i,p,r,o)}}return{kind:"source",evaluate(h,p){const g=p&&p.properties?p.properties[l.property]:void 0;return g===void 0?Kn(l.default,i.default):e(l,i,g,r,o)}}}function Kn(l,i,s){return l!==void 0?l:i!==void 0?i:s!==void 0?s:void 0}function yd(l,i,s,d,_){return Kn(typeof s===_?d[s]:void 0,l.default,i.default)}function Vu(l,i,s){if(ni(s)!=="number")return Kn(l.default,i.default);const d=l.stops.length;if(d===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[d-1][0])return l.stops[d-1][1];const _=vo(l.stops.map(T=>T[0]),s);return l.stops[_][1]}function zs(l,i,s){const d=l.base!==void 0?l.base:1;if(ni(s)!=="number")return Kn(l.default,i.default);const _=l.stops.length;if(_===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[_-1][0])return l.stops[_-1][1];const T=vo(l.stops.map(h=>h[0]),s),n=function(h,p,g,v){const M=v-g,A=h-g;return M===0?0:p===1?A/M:(Math.pow(p,A)-1)/(Math.pow(p,M)-1)}(s,d,l.stops[T][0],l.stops[T+1][0]),e=l.stops[T][1],r=l.stops[T+1][1],o=As[i.type]||Ma;return typeof e.evaluate=="function"?{evaluate(...h){const p=e.evaluate.apply(void 0,h),g=r.evaluate.apply(void 0,h);if(p!==void 0&&g!==void 0)return o(p,g,n,l.colorSpace)}}:o(e,r,n,l.colorSpace)}function Ih(l,i,s){switch(i.type){case"color":s=pi.parse(s);break;case"formatted":s=Jr.fromString(s.toString());break;case"resolvedImage":s=An.fromString(s.toString());break;case"padding":s=Mn.parse(s);break;case"colorArray":s=mn.parse(s);break;case"numberArray":s=on.parse(s);break;default:ni(s)===i.type||i.type==="enum"&&i.values[s]||(s=void 0)}return Kn(s,l.default,i.default)}En.register(dl,{error:[{kind:"error"},[ai],(l,[i])=>{throw new ir(i.evaluate(l))}],typeof:[ai,[wi],(l,[i])=>tr(ii(i.evaluate(l)))],"to-rgba":[Sn(xt,4),[lr],(l,[i])=>{const[s,d,_,T]=i.evaluate(l).rgb;return[255*s,255*d,255*_,T]}],rgb:[lr,[xt,xt,xt],ju],rgba:[lr,[xt,xt,xt,xt],ju],has:{type:si,overloads:[[[ai],(l,[i])=>qa(i.evaluate(l),l.properties())],[[ai,or],(l,[i,s])=>qa(i.evaluate(l),s.evaluate(l))]]},get:{type:wi,overloads:[[[ai],(l,[i])=>Nu(i.evaluate(l),l.properties())],[[ai,or],(l,[i,s])=>Nu(i.evaluate(l),s.evaluate(l))]]},"feature-state":[wi,[ai],(l,[i])=>Nu(i.evaluate(l),l.featureState||{})],properties:[or,[],l=>l.properties()],"geometry-type":[ai,[],l=>l.geometryType()],id:[wi,[],l=>l.id()],zoom:[xt,[],l=>l.globals.zoom],"heatmap-density":[xt,[],l=>l.globals.heatmapDensity||0],elevation:[xt,[],l=>l.globals.elevation||0],"line-progress":[xt,[],l=>l.globals.lineProgress||0],accumulated:[wi,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[xt,zn(xt),(l,i)=>{let s=0;for(const d of i)s+=d.evaluate(l);return s}],"*":[xt,zn(xt),(l,i)=>{let s=1;for(const d of i)s*=d.evaluate(l);return s}],"-":{type:xt,overloads:[[[xt,xt],(l,[i,s])=>i.evaluate(l)-s.evaluate(l)],[[xt],(l,[i])=>-i.evaluate(l)]]},"/":[xt,[xt,xt],(l,[i,s])=>i.evaluate(l)/s.evaluate(l)],"%":[xt,[xt,xt],(l,[i,s])=>i.evaluate(l)%s.evaluate(l)],ln2:[xt,[],()=>Math.LN2],pi:[xt,[],()=>Math.PI],e:[xt,[],()=>Math.E],"^":[xt,[xt,xt],(l,[i,s])=>Math.pow(i.evaluate(l),s.evaluate(l))],sqrt:[xt,[xt],(l,[i])=>Math.sqrt(i.evaluate(l))],log10:[xt,[xt],(l,[i])=>Math.log(i.evaluate(l))/Math.LN10],ln:[xt,[xt],(l,[i])=>Math.log(i.evaluate(l))],log2:[xt,[xt],(l,[i])=>Math.log(i.evaluate(l))/Math.LN2],sin:[xt,[xt],(l,[i])=>Math.sin(i.evaluate(l))],cos:[xt,[xt],(l,[i])=>Math.cos(i.evaluate(l))],tan:[xt,[xt],(l,[i])=>Math.tan(i.evaluate(l))],asin:[xt,[xt],(l,[i])=>Math.asin(i.evaluate(l))],acos:[xt,[xt],(l,[i])=>Math.acos(i.evaluate(l))],atan:[xt,[xt],(l,[i])=>Math.atan(i.evaluate(l))],min:[xt,zn(xt),(l,i)=>Math.min(...i.map(s=>s.evaluate(l)))],max:[xt,zn(xt),(l,i)=>Math.max(...i.map(s=>s.evaluate(l)))],abs:[xt,[xt],(l,[i])=>Math.abs(i.evaluate(l))],round:[xt,[xt],(l,[i])=>{const s=i.evaluate(l);return s<0?-Math.round(-s):Math.round(s)}],floor:[xt,[xt],(l,[i])=>Math.floor(i.evaluate(l))],ceil:[xt,[xt],(l,[i])=>Math.ceil(i.evaluate(l))],"filter-==":[si,[ai,wi],(l,[i,s])=>l.properties()[i.value]===s.value],"filter-id-==":[si,[wi],(l,[i])=>l.id()===i.value],"filter-type-==":[si,[ai],(l,[i])=>l.geometryType()===i.value],"filter-<":[si,[ai,wi],(l,[i,s])=>{const d=l.properties()[i.value],_=s.value;return typeof d==typeof _&&d<_}],"filter-id-<":[si,[wi],(l,[i])=>{const s=l.id(),d=i.value;return typeof s==typeof d&&s<d}],"filter->":[si,[ai,wi],(l,[i,s])=>{const d=l.properties()[i.value],_=s.value;return typeof d==typeof _&&d>_}],"filter-id->":[si,[wi],(l,[i])=>{const s=l.id(),d=i.value;return typeof s==typeof d&&s>d}],"filter-<=":[si,[ai,wi],(l,[i,s])=>{const d=l.properties()[i.value],_=s.value;return typeof d==typeof _&&d<=_}],"filter-id-<=":[si,[wi],(l,[i])=>{const s=l.id(),d=i.value;return typeof s==typeof d&&s<=d}],"filter->=":[si,[ai,wi],(l,[i,s])=>{const d=l.properties()[i.value],_=s.value;return typeof d==typeof _&&d>=_}],"filter-id->=":[si,[wi],(l,[i])=>{const s=l.id(),d=i.value;return typeof s==typeof d&&s>=d}],"filter-has":[si,[wi],(l,[i])=>i.value in l.properties()],"filter-has-id":[si,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[si,[Sn(ai)],(l,[i])=>i.value.indexOf(l.geometryType())>=0],"filter-id-in":[si,[Sn(wi)],(l,[i])=>i.value.indexOf(l.id())>=0],"filter-in-small":[si,[ai,Sn(wi)],(l,[i,s])=>s.value.indexOf(l.properties()[i.value])>=0],"filter-in-large":[si,[ai,Sn(wi)],(l,[i,s])=>function(d,_,T,n){for(;T<=n;){const e=T+n>>1;if(_[e]===d)return!0;_[e]>d?n=e-1:T=e+1}return!1}(l.properties()[i.value],s.value,0,s.value.length-1)],all:{type:si,overloads:[[[si,si],(l,[i,s])=>i.evaluate(l)&&s.evaluate(l)],[zn(si),(l,i)=>{for(const s of i)if(!s.evaluate(l))return!1;return!0}]]},any:{type:si,overloads:[[[si,si],(l,[i,s])=>i.evaluate(l)||s.evaluate(l)],[zn(si),(l,i)=>{for(const s of i)if(s.evaluate(l))return!0;return!1}]]},"!":[si,[si],(l,[i])=>!i.evaluate(l)],"is-supported-script":[si,[ai],(l,[i])=>{const s=l.globals&&l.globals.isSupportedScript;return!s||s(i.evaluate(l))}],upcase:[ai,[ai],(l,[i])=>i.evaluate(l).toUpperCase()],downcase:[ai,[ai],(l,[i])=>i.evaluate(l).toLowerCase()],concat:[ai,zn(wi),(l,i)=>i.map(s=>ri(s.evaluate(l))).join("")],"resolved-locale":[ai,[Pc],(l,[i])=>i.evaluate(l).resolvedLocale()]});class Zc{constructor(i,s){this.expression=i,this._warningHistory={},this._evaluator=new fd,this._defaultValue=s?function(d){if(d.type==="color"&&Gc(d.default))return new pi(0,0,0,0);switch(d.type){case"color":return pi.parse(d.default)||null;case"padding":return Mn.parse(d.default)||null;case"numberArray":return on.parse(d.default)||null;case"colorArray":return mn.parse(d.default)||null;case"variableAnchorOffsetCollection":return Dn.parse(d.default)||null;case"projectionDefinition":return Gr.parse(d.default)||null;default:return d.default===void 0?null:d.default}}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(i,s,d,_,T,n){return this._evaluator.globals=i,this._evaluator.feature=s,this._evaluator.featureState=d,this._evaluator.canonical=_,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=n,this.expression.evaluate(this._evaluator)}evaluate(i,s,d,_,T,n){this._evaluator.globals=i,this._evaluator.feature=s||null,this._evaluator.featureState=d||null,this._evaluator.canonical=_,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=n||null;try{const e=this.expression.evaluate(this._evaluator);if(e==null||typeof e=="number"&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new ir(`Expected value to be one of ${Object.keys(this._enumValues).map(r=>JSON.stringify(r)).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,typeof console<"u"&&console.warn(e.message)),this._defaultValue}}}function Gn(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in dl}function Mt(l,i){const s=new go(dl,Wn,[],i?function(_){const T={color:lr,string:ai,number:xt,enum:ai,boolean:si,formatted:Vn,padding:os,numberArray:ho,colorArray:Fa,projectionDefinition:Oa,resolvedImage:Br,variableAnchorOffsetCollection:Ul};return _.type==="array"?Sn(T[_.value]||wi,_.length):T[_.type]}(i):void 0),d=s.parse(l,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?ml(new Zc(d,i)):zo(s.errors)}class Po{constructor(i,s){this.kind=i,this._styleExpression=s,this.isStateDependent=i!=="constant"&&!fl(s.expression),this.globalStateRefs=$a(s.expression)}evaluateWithoutErrorHandling(i,s,d,_,T,n){return this._styleExpression.evaluateWithoutErrorHandling(i,s,d,_,T,n)}evaluate(i,s,d,_,T,n){return this._styleExpression.evaluate(i,s,d,_,T,n)}}class gl{constructor(i,s,d,_){this.kind=i,this.zoomStops=d,this._styleExpression=s,this.isStateDependent=i!=="camera"&&!fl(s.expression),this.globalStateRefs=$a(s.expression),this.interpolationType=_}evaluateWithoutErrorHandling(i,s,d,_,T,n){return this._styleExpression.evaluateWithoutErrorHandling(i,s,d,_,T,n)}evaluate(i,s,d,_,T,n){return this._styleExpression.evaluate(i,s,d,_,T,n)}interpolationFactor(i,s,d){return this.interpolationType?Un.interpolationFactor(this.interpolationType,i,s,d):0}}function Aa(l,i){const s=Mt(l,i);if(s.result==="error")return s;const d=s.value.expression,_=Xs(d);if(!_&&!qr(i))return zo([new Ur("","data expressions not supported")]);const T=pl(d,["zoom"]);if(!T&&!Za(i))return zo([new Ur("","zoom expressions not supported")]);const n=ca(d);return n||T?n instanceof Ur?zo([n]):n instanceof Un&&!nc(i)?zo([new Ur("",'"interpolate" expressions cannot be used with this property')]):ml(n?new gl(_?"camera":"composite",s.value,n.labels,n instanceof Un?n.interpolation:void 0):new Po(_?"constant":"source",s.value)):zo([new Ur("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class vn{constructor(i,s){this._parameters=i,this._specification=s,Ar(this,qc(this._parameters,this._specification))}static deserialize(i){return new vn(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function ca(l){let i=null;if(l instanceof tl)i=ca(l.result);else if(l instanceof Hl){for(const s of l.args)if(i=ca(s),i)break}else(l instanceof en||l instanceof Un)&&l.input instanceof En&&l.input.name==="zoom"&&(i=l);return i instanceof Ur||l.eachChild(s=>{const d=ca(s);d instanceof Ur?i=d:!i&&d?i=new Ur("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&d&&i!==d&&(i=new Ur("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function $a(l,i=new Set){return l instanceof Uc&&i.add(l.key),l.eachChild(s=>{$a(s,i)}),i}function ds(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const i of l.slice(1))if(!ds(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const Io={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ko(l){if(l==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ds(l)||(l=ln(l));const i=Mt(l,Io);if(i.result==="error")throw new Error(i.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,d,_)=>i.value.evaluate(s,d,{},_),needGeometry:sc(l),getGlobalStateRefs:()=>$a(i.value.expression)}}function ac(l,i){return l<i?-1:l>i?1:0}function sc(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let i=1;i<l.length;i++)if(sc(l[i]))return!0;return!1}function ln(l){if(!l)return!0;const i=l[0];return l.length<=1?i!=="any":i==="=="?Zr(l[1],l[2],"=="):i==="!="?Ha(Zr(l[1],l[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Zr(l[1],l[2],i):i==="any"?(s=l.slice(1),["any"].concat(s.map(ln))):i==="all"?["all"].concat(l.slice(1).map(ln)):i==="none"?["all"].concat(l.slice(1).map(ln).map(Ha)):i==="in"?Wi(l[1],l.slice(2)):i==="!in"?Ha(Wi(l[1],l.slice(2))):i==="has"?yl(l[1]):i!=="!has"||Ha(yl(l[1]));var s}function Zr(l,i,s){switch(l){case"$type":return[`filter-type-${s}`,i];case"$id":return[`filter-id-${s}`,i];default:return[`filter-${s}`,l,i]}}function Wi(l,i){if(i.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(s=>typeof s!=typeof i[0])?["filter-in-large",l,["literal",i.sort(ac)]]:["filter-in-small",l,["literal",i]]}}function yl(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Ha(l){return["!",l]}function $c(l){const i=typeof l;if(i==="number"||i==="boolean"||i==="string"||l==null)return JSON.stringify(l);if(Array.isArray(l)){let _="[";for(const T of l)_+=`${$c(T)},`;return`${_}]`}const s=Object.keys(l).sort();let d="{";for(let _=0;_<s.length;_++)d+=`${JSON.stringify(s[_])}:${$c(l[s[_]])},`;return`${d}}`}function _l(l){let i="";for(const s of Tt)i+=`/${$c(l[s])}`;return i}function Hc(l){const i=l.value;return i?[new pt(l.key,i,"constants have been deprecated as of v8")]:[]}function Or(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function ua(l){if(Array.isArray(l))return l.map(ua);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const i={};for(const s in l)i[s]=ua(l[s]);return i}return Or(l)}function qn(l){const i=l.key,s=l.value,d=l.valueSpec||{},_=l.objectElementValidators||{},T=l.style,n=l.styleSpec,e=l.validateSpec;let r=[];const o=ni(s);if(o!=="object")return[new pt(i,s,`object expected, ${o} found`)];for(const h in s){const p=h.split(".")[0],g=Us(d,p)||d["*"];let v;if(Us(_,p))v=_[p];else if(Us(d,p))v=e;else if(_["*"])v=_["*"];else{if(!d["*"]){r.push(new pt(i,s[h],`unknown property "${h}"`));continue}v=e}r=r.concat(v({key:(i&&`${i}.`)+h,value:s[h],valueSpec:g,style:T,styleSpec:n,object:s,objectKey:h,validateSpec:e},s))}for(const h in d)_[h]||d[h].required&&d[h].default===void 0&&s[h]===void 0&&r.push(new pt(i,s,`missing required property "${h}"`));return r}function Xc(l){const i=l.value,s=l.valueSpec,d=l.style,_=l.styleSpec,T=l.key,n=l.arrayElementValidator||l.validateSpec;if(ni(i)!=="array")return[new pt(T,i,`array expected, ${ni(i)} found`)];if(s.length&&i.length!==s.length)return[new pt(T,i,`array length ${s.length} expected, length ${i.length} found`)];if(s["min-length"]&&i.length<s["min-length"])return[new pt(T,i,`array length at least ${s["min-length"]} expected, length ${i.length} found`)];let e={type:s.value,values:s.values};_.$version<7&&(e.function=s.function),ni(s.value)==="object"&&(e=s.value);let r=[];for(let o=0;o<i.length;o++)r=r.concat(n({array:i,arrayIndex:o,value:i[o],valueSpec:e,validateSpec:l.validateSpec,style:d,styleSpec:_,key:`${T}[${o}]`}));return r}function Ys(l){const i=l.key,s=l.value,d=l.valueSpec;let _=ni(s);return _==="number"&&s!=s&&(_="NaN"),_!=="number"?[new pt(i,s,`number expected, ${_} found`)]:"minimum"in d&&s<d.minimum?[new pt(i,s,`${s} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&s>d.maximum?[new pt(i,s,`${s} is greater than the maximum value ${d.maximum}`)]:[]}function Yc(l){const i=l.valueSpec,s=Or(l.value.type);let d,_,T,n={};const e=s!=="categorical"&&l.value.property===void 0,r=!e,o=ni(l.value.stops)==="array"&&ni(l.value.stops[0])==="array"&&ni(l.value.stops[0][0])==="object",h=qn({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(v){if(s==="identity")return[new pt(v.key,v.value,'identity function may not have a "stops" property')];let M=[];const A=v.value;return M=M.concat(Xc({key:v.key,value:A,valueSpec:v.valueSpec,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec,arrayElementValidator:p})),ni(A)==="array"&&A.length===0&&M.push(new pt(v.key,A,"array must have at least one stop")),M},default:function(v){return v.validateSpec({key:v.key,value:v.value,valueSpec:i,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec})}}});return s==="identity"&&e&&h.push(new pt(l.key,l.value,'missing required property "property"')),s==="identity"||l.value.stops||h.push(new pt(l.key,l.value,'missing required property "stops"')),s==="exponential"&&l.valueSpec.expression&&!nc(l.valueSpec)&&h.push(new pt(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(r&&!qr(l.valueSpec)?h.push(new pt(l.key,l.value,"property functions not supported")):e&&!Za(l.valueSpec)&&h.push(new pt(l.key,l.value,"zoom functions not supported"))),s!=="categorical"&&!o||l.value.property!==void 0||h.push(new pt(l.key,l.value,'"property" property is required')),h;function p(v){let M=[];const A=v.value,z=v.key;if(ni(A)!=="array")return[new pt(z,A,`array expected, ${ni(A)} found`)];if(A.length!==2)return[new pt(z,A,`array length 2 expected, length ${A.length} found`)];if(o){if(ni(A[0])!=="object")return[new pt(z,A,`object expected, ${ni(A[0])} found`)];if(A[0].zoom===void 0)return[new pt(z,A,"object stop key must have zoom")];if(A[0].value===void 0)return[new pt(z,A,"object stop key must have value")];if(T&&T>Or(A[0].zoom))return[new pt(z,A[0].zoom,"stop zoom values must appear in ascending order")];Or(A[0].zoom)!==T&&(T=Or(A[0].zoom),_=void 0,n={}),M=M.concat(qn({key:`${z}[0]`,value:A[0],valueSpec:{zoom:{}},validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{zoom:Ys,value:g}}))}else M=M.concat(g({key:`${z}[0]`,value:A[0],validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec},A));return Gn(ua(A[1]))?M.concat([new pt(`${z}[1]`,A[1],"expressions are not allowed in function stops.")]):M.concat(v.validateSpec({key:`${z}[1]`,value:A[1],valueSpec:i,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec}))}function g(v,M){const A=ni(v.value),z=Or(v.value),I=v.value!==null?v.value:M;if(d){if(A!==d)return[new pt(v.key,I,`${A} stop domain type must match previous stop domain type ${d}`)]}else d=A;if(A!=="number"&&A!=="string"&&A!=="boolean")return[new pt(v.key,I,"stop domain value must be a number, string, or boolean")];if(A!=="number"&&s!=="categorical"){let L=`number expected, ${A} found`;return qr(i)&&s===void 0&&(L+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new pt(v.key,I,L)]}return s!=="categorical"||A!=="number"||isFinite(z)&&Math.floor(z)===z?s!=="categorical"&&A==="number"&&_!==void 0&&z<_?[new pt(v.key,I,"stop domain values must appear in ascending order")]:(_=z,s==="categorical"&&z in n?[new pt(v.key,I,"stop domain values must be unique")]:(n[z]=!0,[])):[new pt(v.key,I,`integer expected, found ${z}`)]}}function Ca(l){const i=(l.expressionContext==="property"?Aa:Mt)(ua(l.value),l.valueSpec);if(i.result==="error")return i.value.map(d=>new pt(`${l.key}${d.key}`,l.value,d.message));const s=i.value.expression||i.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!s.outputDefined())return[new pt(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!fl(s))return[new pt(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!fl(s))return[new pt(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!pl(s,["zoom","feature-state"]))return[new pt(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!Xs(s))return[new pt(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ea(l){const i=l.key,s=l.value,d=ni(s);return d!=="string"?[new pt(i,s,`color expected, ${d} found`)]:pi.parse(String(s))?[]:[new pt(i,s,`color expected, "${s}" found`)]}function Bn(l){const i=l.key,s=l.value,d=l.valueSpec,_=[];return Array.isArray(d.values)?d.values.indexOf(Or(s))===-1&&_.push(new pt(i,s,`expected one of [${d.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(d.values).indexOf(Or(s))===-1&&_.push(new pt(i,s,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(s)} found`)),_}function Ps(l){return ds(ua(l.value))?Ca(Ar({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Wc(l)}function Wc(l){const i=l.value,s=l.key;if(ni(i)!=="array")return[new pt(s,i,`array expected, ${ni(i)} found`)];const d=l.styleSpec;let _,T=[];if(i.length<1)return[new pt(s,i,"filter array must have at least 1 element")];switch(T=T.concat(Bn({key:`${s}[0]`,value:i[0],valueSpec:d.filter_operator,style:l.style,styleSpec:l.styleSpec})),Or(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&Or(i[1])==="$type"&&T.push(new pt(s,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&T.push(new pt(s,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(_=ni(i[1]),_!=="string"&&T.push(new pt(`${s}[1]`,i[1],`string expected, ${_} found`)));for(let n=2;n<i.length;n++)_=ni(i[n]),Or(i[1])==="$type"?T=T.concat(Bn({key:`${s}[${n}]`,value:i[n],valueSpec:d.geometry_type,style:l.style,styleSpec:l.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&T.push(new pt(`${s}[${n}]`,i[n],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let n=1;n<i.length;n++)T=T.concat(Wc({key:`${s}[${n}]`,value:i[n],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":_=ni(i[1]),i.length!==2?T.push(new pt(s,i,`filter array for "${i[0]}" operator must have 2 elements`)):_!=="string"&&T.push(new pt(`${s}[1]`,i[1],`string expected, ${_} found`))}return T}function kh(l,i){const s=l.key,d=l.validateSpec,_=l.style,T=l.styleSpec,n=l.value,e=l.objectKey,r=T[`${i}_${l.layerType}`];if(!r)return[];const o=e.match(/^(.*)-transition$/);if(i==="paint"&&o&&r[o[1]]&&r[o[1]].transition)return d({key:s,value:n,valueSpec:T.transition,style:_,styleSpec:T});const h=l.valueSpec||r[e];if(!h)return[new pt(s,n,`unknown property "${e}"`)];let p;if(ni(n)==="string"&&qr(h)&&!h.tokens&&(p=/^{([^}]+)}$/.exec(n)))return[new pt(s,n,`"${e}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(p[1])} }\`.`)];const g=[];return l.layerType==="symbol"&&(e==="text-field"&&_&&!_.glyphs&&g.push(new pt(s,n,'use of "text-field" requires a style "glyphs" property')),e==="text-font"&&Gc(ua(n))&&Or(n.type)==="identity"&&g.push(new pt(s,n,'"text-font" does not support identity functions'))),g.concat(d({key:l.key,value:n,valueSpec:h,style:_,styleSpec:T,expressionContext:"property",propertyType:i,propertyKey:e}))}function Kc(l){return kh(l,"paint")}function Qc(l){return kh(l,"layout")}function Ws(l){let i=[];const s=l.value,d=l.key,_=l.style,T=l.styleSpec;if(ni(s)!=="object")return[new pt(d,s,`object expected, ${ni(s)} found`)];s.type||s.ref||i.push(new pt(d,s,'either "type" or "ref" is required'));let n=Or(s.type);const e=Or(s.ref);if(s.id){const r=Or(s.id);for(let o=0;o<l.arrayIndex;o++){const h=_.layers[o];Or(h.id)===r&&i.push(new pt(d,s.id,`duplicate layer id "${s.id}", previously used at line ${h.id.__line__}`))}}if("ref"in s){let r;["type","source","source-layer","filter","layout"].forEach(o=>{o in s&&i.push(new pt(d,s[o],`"${o}" is prohibited for ref layers`))}),_.layers.forEach(o=>{Or(o.id)===e&&(r=o)}),r?r.ref?i.push(new pt(d,s.ref,"ref cannot reference another ref layer")):n=Or(r.type):i.push(new pt(d,s.ref,`ref layer "${e}" not found`))}else if(n!=="background")if(s.source){const r=_.sources&&_.sources[s.source],o=r&&Or(r.type);r?o==="vector"&&n==="raster"?i.push(new pt(d,s.source,`layer "${s.id}" requires a raster source`)):o!=="raster-dem"&&n==="hillshade"||o!=="raster-dem"&&n==="color-relief"?i.push(new pt(d,s.source,`layer "${s.id}" requires a raster-dem source`)):o==="raster"&&n!=="raster"?i.push(new pt(d,s.source,`layer "${s.id}" requires a vector source`)):o!=="vector"||s["source-layer"]?o==="raster-dem"&&n!=="hillshade"&&n!=="color-relief"?i.push(new pt(d,s.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):n!=="line"||!s.paint||!s.paint["line-gradient"]||o==="geojson"&&r.lineMetrics||i.push(new pt(d,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new pt(d,s,`layer "${s.id}" must specify a "source-layer"`)):i.push(new pt(d,s.source,`source "${s.source}" not found`))}else i.push(new pt(d,s,'missing required property "source"'));return i=i.concat(qn({key:d,value:s,valueSpec:T.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${d}.type`,value:s.type,valueSpec:T.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:s,objectKey:"type"}),filter:Ps,layout:r=>qn({layer:s,key:r.key,value:r.value,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":o=>Qc(Ar({layerType:n},o))}}),paint:r=>qn({layer:s,key:r.key,value:r.value,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":o=>Kc(Ar({layerType:n},o))}})}})),i}function Cr(l){const i=l.value,s=l.key,d=ni(i);return d!=="string"?[new pt(s,i,`string expected, ${d} found`)]:[]}const Ro={promoteId:function({key:l,value:i}){if(ni(i)==="string")return Cr({key:l,value:i});{const s=[];for(const d in i)s.push(...Cr({key:`${l}.${d}`,value:i[d]}));return s}}};function Qn(l){const i=l.value,s=l.key,d=l.styleSpec,_=l.style,T=l.validateSpec;if(!i.type)return[new pt(s,i,'"type" is required')];const n=Or(i.type);let e;switch(n){case"vector":case"raster":return e=qn({key:s,value:i,valueSpec:d[`source_${n.replace("-","_")}`],style:l.style,styleSpec:d,objectElementValidators:Ro,validateSpec:T}),e;case"raster-dem":return e=function(r){var o;const h=(o=r.sourceName)!==null&&o!==void 0?o:"",p=r.value,g=r.styleSpec,v=g.source_raster_dem,M=r.style;let A=[];const z=ni(p);if(p===void 0)return A;if(z!=="object")return A.push(new pt("source_raster_dem",p,`object expected, ${z} found`)),A;const I=Or(p.encoding)==="custom",L=["redFactor","greenFactor","blueFactor","baseShift"],B=r.value.encoding?`"${r.value.encoding}"`:"Default";for(const j in p)!I&&L.includes(j)?A.push(new pt(j,p[j],`In "${h}": "${j}" is only valid when "encoding" is set to "custom". ${B} encoding found`)):v[j]?A=A.concat(r.validateSpec({key:j,value:p[j],valueSpec:v[j],validateSpec:r.validateSpec,style:M,styleSpec:g})):A.push(new pt(j,p[j],`unknown property "${j}"`));return A}({sourceName:s,value:i,style:l.style,styleSpec:d,validateSpec:T}),e;case"geojson":if(e=qn({key:s,value:i,valueSpec:d.source_geojson,style:_,styleSpec:d,validateSpec:T,objectElementValidators:Ro}),i.cluster)for(const r in i.clusterProperties){const[o,h]=i.clusterProperties[r],p=typeof o=="string"?[o,["accumulated"],["get",r]]:o;e.push(...Ca({key:`${s}.${r}.map`,value:h,expressionContext:"cluster-map"})),e.push(...Ca({key:`${s}.${r}.reduce`,value:p,expressionContext:"cluster-reduce"}))}return e;case"video":return qn({key:s,value:i,valueSpec:d.source_video,style:_,validateSpec:T,styleSpec:d});case"image":return qn({key:s,value:i,valueSpec:d.source_image,style:_,validateSpec:T,styleSpec:d});case"canvas":return[new pt(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Bn({key:`${s}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Jc(l){const i=l.value,s=l.styleSpec,d=s.light,_=l.style;let T=[];const n=ni(i);if(i===void 0)return T;if(n!=="object")return T=T.concat([new pt("light",i,`object expected, ${n} found`)]),T;for(const e in i){const r=e.match(/^(.*)-transition$/);T=T.concat(r&&d[r[1]]&&d[r[1]].transition?l.validateSpec({key:e,value:i[e],valueSpec:s.transition,validateSpec:l.validateSpec,style:_,styleSpec:s}):d[e]?l.validateSpec({key:e,value:i[e],valueSpec:d[e],validateSpec:l.validateSpec,style:_,styleSpec:s}):[new pt(e,i[e],`unknown property "${e}"`)])}return T}function _d(l){const i=l.value,s=l.styleSpec,d=s.sky,_=l.style,T=ni(i);if(i===void 0)return[];if(T!=="object")return[new pt("sky",i,`object expected, ${T} found`)];let n=[];for(const e in i)n=n.concat(d[e]?l.validateSpec({key:e,value:i[e],valueSpec:d[e],style:_,styleSpec:s}):[new pt(e,i[e],`unknown property "${e}"`)]);return n}function Ks(l){const i=l.value,s=l.styleSpec,d=s.terrain,_=l.style;let T=[];const n=ni(i);if(i===void 0)return T;if(n!=="object")return T=T.concat([new pt("terrain",i,`object expected, ${n} found`)]),T;for(const e in i)T=T.concat(d[e]?l.validateSpec({key:e,value:i[e],valueSpec:d[e],validateSpec:l.validateSpec,style:_,styleSpec:s}):[new pt(e,i[e],`unknown property "${e}"`)]);return T}function vi(l){let i=[];const s=l.value,d=l.key;if(Array.isArray(s)){const _=[],T=[];for(const n in s)s[n].id&&_.includes(s[n].id)&&i.push(new pt(d,s,`all the sprites' ids must be unique, but ${s[n].id} is duplicated`)),_.push(s[n].id),s[n].url&&T.includes(s[n].url)&&i.push(new pt(d,s,`all the sprites' URLs must be unique, but ${s[n].url} is duplicated`)),T.push(s[n].url),i=i.concat(qn({key:`${d}[${n}]`,value:s[n],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return i}return Cr({key:d,value:s})}function Is(l){return i=l.value,i&&i.constructor===Object?[]:[new pt(l.key,l.value,`object expected, ${ni(l.value)} found`)];var i}const Do={"*":()=>[],array:Xc,boolean:function(l){const i=l.value,s=l.key,d=ni(i);return d!=="boolean"?[new pt(s,i,`boolean expected, ${d} found`)]:[]},number:Ys,color:Ea,constants:Hc,enum:Bn,filter:Ps,function:Yc,layer:Ws,object:qn,source:Qn,light:Jc,sky:_d,terrain:Ks,projection:function(l){const i=l.value,s=l.styleSpec,d=s.projection,_=l.style,T=ni(i);if(i===void 0)return[];if(T!=="object")return[new pt("projection",i,`object expected, ${T} found`)];let n=[];for(const e in i)n=n.concat(d[e]?l.validateSpec({key:e,value:i[e],valueSpec:d[e],style:_,styleSpec:s}):[new pt(e,i[e],`unknown property "${e}"`)]);return n},projectionDefinition:function(l){const i=l.key;let s=l.value;s=s instanceof String?s.valueOf():s;const d=ni(s);return d!=="array"||function(_){return Array.isArray(_)&&_.length===3&&typeof _[0]=="string"&&typeof _[1]=="string"&&typeof _[2]=="number"}(s)||function(_){return!!["interpolate","step","literal"].includes(_[0])}(s)?["array","string"].includes(d)?[]:[new pt(i,s,`projection expected, invalid type "${d}" found`)]:[new pt(i,s,`projection expected, invalid array ${JSON.stringify(s)} found`)]},string:Cr,formatted:function(l){return Cr(l).length===0?[]:Ca(l)},resolvedImage:function(l){return Cr(l).length===0?[]:Ca(l)},padding:function(l){const i=l.key,s=l.value;if(ni(s)==="array"){if(s.length<1||s.length>4)return[new pt(i,s,`padding requires 1 to 4 values; ${s.length} values found`)];const d={type:"number"};let _=[];for(let T=0;T<s.length;T++)_=_.concat(l.validateSpec({key:`${i}[${T}]`,value:s[T],validateSpec:l.validateSpec,valueSpec:d}));return _}return Ys({key:i,value:s,valueSpec:{}})},numberArray:function(l){const i=l.key,s=l.value;if(ni(s)==="array"){const d={type:"number"};if(s.length<1)return[new pt(i,s,"array length at least 1 expected, length 0 found")];let _=[];for(let T=0;T<s.length;T++)_=_.concat(l.validateSpec({key:`${i}[${T}]`,value:s[T],validateSpec:l.validateSpec,valueSpec:d}));return _}return Ys({key:i,value:s,valueSpec:{}})},colorArray:function(l){const i=l.key,s=l.value;if(ni(s)==="array"){if(s.length<1)return[new pt(i,s,"array length at least 1 expected, length 0 found")];let d=[];for(let _=0;_<s.length;_++)d=d.concat(Ea({key:`${i}[${_}]`,value:s[_]}));return d}return Ea({key:i,value:s})},variableAnchorOffsetCollection:function(l){const i=l.key,s=l.value,d=ni(s),_=l.styleSpec;if(d!=="array"||s.length<1||s.length%2!=0)return[new pt(i,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let T=[];for(let n=0;n<s.length;n+=2)T=T.concat(Bn({key:`${i}[${n}]`,value:s[n],valueSpec:_.layout_symbol["text-anchor"]})),T=T.concat(Xc({key:`${i}[${n+1}]`,value:s[n+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:_}));return T},sprite:vi,state:Is};function Qs(l){const i=l.value,s=l.valueSpec,d=l.styleSpec;return l.validateSpec=Qs,s.expression&&Gc(Or(i))?Yc(l):s.expression&&Gn(ua(i))?Ca(l):s.type&&Do[s.type]?Do[s.type](l):qn(Ar({},l,{valueSpec:s.type?d[s.type]:s}))}function Uu(l){const i=l.value,s=l.key,d=Cr(l);return d.length||(i.indexOf("{fontstack}")===-1&&d.push(new pt(s,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&d.push(new pt(s,i,'"glyphs" url must include a "{range}" token'))),d}function bn(l,i=ke){let s=[];return s=s.concat(Qs({key:"",value:l,valueSpec:i.$root,styleSpec:i,style:l,validateSpec:Qs,objectElementValidators:{glyphs:Uu,"*":()=>[]}})),l.constants&&(s=s.concat(Hc({key:"constants",value:l.constants}))),ha(s)}function Jn(l){return function(i){return l({...i,validateSpec:Qs})}}function ha(l){return[].concat(l).sort((i,s)=>i.line-s.line)}function da(l){return function(...i){return ha(l.apply(this,i))}}bn.source=da(Jn(Qn)),bn.sprite=da(Jn(vi)),bn.glyphs=da(Jn(Uu)),bn.light=da(Jn(Jc)),bn.sky=da(Jn(_d)),bn.terrain=da(Jn(Ks)),bn.state=da(Jn(Is)),bn.layer=da(Jn(Ws)),bn.filter=da(Jn(Ps)),bn.paintProperty=da(Jn(Kc)),bn.layoutProperty=da(Jn(Qc));const Ft=bn,Qt=Ft.light,za=Ft.sky,Gu=Ft.paintProperty,oc=Ft.layoutProperty;function Pn(l,i){let s=!1;if(i&&i.length)for(const d of i)l.fire(new at(new Error(d.message))),s=!0;return s}class Js{constructor(i,s,d){const _=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const n=new Int32Array(this.arrayBuffer);i=n[0],this.d=(s=n[1])+2*(d=n[2]);for(let r=0;r<this.d*this.d;r++){const o=n[3+r],h=n[3+r+1];_.push(o===h?null:n.subarray(o,h))}const e=n[3+_.length+1];this.keys=n.subarray(n[3+_.length],e),this.bboxes=n.subarray(e),this.insert=this._insertReadonly}else{this.d=s+2*d;for(let n=0;n<this.d*this.d;n++)_.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=d,this.scale=s/i,this.uid=0;const T=d/s*i;this.min=-T,this.max=i+T}insert(i,s,d,_,T){this._forEachCell(s,d,_,T,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(T)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,s,d,_,T,n){this.cells[T].push(n)}query(i,s,d,_,T){const n=this.min,e=this.max;if(i<=n&&s<=n&&e<=d&&e<=_&&!T)return Array.prototype.slice.call(this.keys);{const r=[];return this._forEachCell(i,s,d,_,this._queryCell,r,{},T),r}}_queryCell(i,s,d,_,T,n,e,r){const o=this.cells[T];if(o!==null){const h=this.keys,p=this.bboxes;for(let g=0;g<o.length;g++){const v=o[g];if(e[v]===void 0){const M=4*v;(r?r(p[M+0],p[M+1],p[M+2],p[M+3]):i<=p[M+2]&&s<=p[M+3]&&d>=p[M+0]&&_>=p[M+1])?(e[v]=!0,n.push(h[v])):e[v]=!1}}}}_forEachCell(i,s,d,_,T,n,e,r){const o=this._convertToCellCoord(i),h=this._convertToCellCoord(s),p=this._convertToCellCoord(d),g=this._convertToCellCoord(_);for(let v=o;v<=p;v++)for(let M=h;M<=g;M++){const A=this.d*M+v;if((!r||r(this._convertFromCellCoord(v),this._convertFromCellCoord(M),this._convertFromCellCoord(v+1),this._convertFromCellCoord(M+1)))&&T.call(this,i,s,d,_,A,n,e,r))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,s=3+this.cells.length+1+1;let d=0;for(let n=0;n<this.cells.length;n++)d+=this.cells[n].length;const _=new Int32Array(s+d+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let T=s;for(let n=0;n<i.length;n++){const e=i[n];_[3+n]=T,_.set(e,T),T+=e.length}return _[3+i.length]=T,_.set(this.keys,T),T+=this.keys.length,_[3+i.length+1]=T,_.set(this.bboxes,T),T+=this.bboxes.length,_.buffer}static serialize(i,s){const d=i.toArrayBuffer();return s&&s.push(d),{buffer:d}}static deserialize(i){return new Js(i.buffer)}}const cn={};function At(l,i,s={}){if(cn[l])throw new Error(`${l} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:l,writeable:!1}),cn[l]={klass:i,omit:s.omit||[],shallow:s.shallow||[]}}At("Object",Object),At("Set",Set),At("TransferableGridIndex",Js),At("Color",pi),At("Error",Error),At("AJAXError",me),At("ResolvedImage",An),At("StylePropertyFunction",vn),At("StyleExpression",Zc,{omit:["_evaluator"]}),At("ZoomDependentExpression",gl),At("ZoomConstantExpression",Po),At("CompoundExpression",En,{omit:["_evaluate"]});for(const l in dl)dl[l]._classRegistryKey||At(`Expression_${l}`,dl[l]);function Lo(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function Er(l){return l.$name||l.constructor._classRegistryKey}function Fr(l){return!function(i){if(i===null||typeof i!="object")return!1;const s=Er(i);return!(!s||s==="Object")}(l)&&(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||l instanceof Error||Lo(l)||Nn(l)||ArrayBuffer.isView(l)||l instanceof ImageData)}function xl(l,i){if(Fr(l))return(Lo(l)||Nn(l))&&i&&i.push(l),ArrayBuffer.isView(l)&&i&&i.push(l.buffer),l instanceof ImageData&&i&&i.push(l.data.buffer),l;if(Array.isArray(l)){const T=[];for(const n of l)T.push(xl(n,i));return T}if(typeof l!="object")throw new Error("can't serialize object of type "+typeof l);const s=Er(l);if(!s)throw new Error(`can't serialize object of unregistered class ${l.constructor.name}`);if(!cn[s])throw new Error(`${s} is not registered.`);const{klass:d}=cn[s],_=d.serialize?d.serialize(l,i):{};if(d.serialize){if(i&&_===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const T in l){if(!l.hasOwnProperty(T)||cn[s].omit.indexOf(T)>=0)continue;const n=l[T];_[T]=cn[s].shallow.indexOf(T)>=0?n:xl(n,i)}l instanceof Error&&(_.message=l.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(_.$name=s),_}function fa(l){if(Fr(l))return l;if(Array.isArray(l))return l.map(fa);if(typeof l!="object")throw new Error("can't deserialize object of type "+typeof l);const i=Er(l)||"Object";if(!cn[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:s}=cn[i];if(!s)throw new Error(`can't deserialize unregistered class ${i}`);if(s.deserialize)return s.deserialize(l);const d=Object.create(s.prototype);for(const _ of Object.keys(l)){if(_==="$name")continue;const T=l[_];d[_]=cn[i].shallow.indexOf(_)>=0?T:fa(T)}return d}class lc{constructor(){this.first=!0}update(i,s){const d=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=s),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=d,!0))}}const ki={"Latin-1 Supplement":l=>l>=128&&l<=255,"Hangul Jamo":l=>l>=4352&&l<=4607,Khmer:l=>l>=6016&&l<=6143,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Kanbun:l=>l>=12688&&l<=12703,"CJK Strokes":l=>l>=12736&&l<=12783,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Hangul Syllables":l=>l>=44032&&l<=55215,"Private Use Area":l=>l>=57344&&l<=63743,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519};function Xa(l){for(const i of l)if(cc(i.charCodeAt(0)))return!0;return!1}function qu(l){for(const i of l)if(!ks(i.charCodeAt(0)))return!1;return!0}function eo(l){const i=l.map(s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}}).filter(s=>s);return new RegExp(i.join("|"),"u")}const to=eo(["Arab","Dupl","Mong","Ougr","Syrc"]);function ks(l){return!to.test(String.fromCodePoint(l))}const Bo=eo(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function cc(l){return!(l!==746&&l!==747&&(l<4352||!(ki["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||ki["CJK Compatibility"](l)||ki["CJK Strokes"](l)||!(!ki["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||ki["Enclosed CJK Letters and Months"](l)||ki["Ideographic Description Characters"](l)||ki.Kanbun(l)||ki.Katakana(l)&&l!==12540||!(!ki["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!ki["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||ki["Vertical Forms"](l)||ki["Yijing Hexagram Symbols"](l)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(l))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(l))||Bo.test(String.fromCodePoint(l)))))}function eu(l){return!(cc(l)||function(i){return!!(ki["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||ki["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||ki["Letterlike Symbols"](i)||ki["Number Forms"](i)||ki["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||ki["Control Pictures"](i)&&i!==9251||ki["Optical Character Recognition"](i)||ki["Enclosed Alphanumerics"](i)||ki["Geometric Shapes"](i)||ki["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||ki["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||ki["CJK Symbols and Punctuation"](i)||ki.Katakana(i)||ki["Private Use Area"](i)||ki["CJK Compatibility Forms"](i)||ki["Small Form Variants"](i)||ki["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(l))}const vl=eo(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function bl(l){return vl.test(String.fromCodePoint(l))}function Zu(l,i){return!(!i&&bl(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||ki.Khmer(l))}function $u(l){for(const i of l)if(bl(i.charCodeAt(0)))return!0;return!1}const On=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(l){this.pluginStatus=l.pluginStatus,this.pluginURL=l.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(l){if(On.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=l.applyArabicShaping,this.processBidirectionalText=l.processBidirectionalText,this.processStyledBidirectionalText=l.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(l,i){return y(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(l.pluginStatus!=="loading")return this.setState(l),l;const s=l.pluginURL,d=new Promise(T=>{this.loadScriptResolve=T});i(s);const _=new Promise(T=>setTimeout(()=>T(),this.TIMEOUT));if(yield Promise.race([d,_]),this.isParsed()){const T={pluginStatus:"loaded",pluginURL:s};return this.setState(T),T}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${s}`)})}};class rr{constructor(i,s){this.zoom=i,s?(this.now=s.now||0,this.fadeDuration=s.fadeDuration||0,this.zoomHistory=s.zoomHistory||new lc,this.transition=s.transition||{},this.globalState=s.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new lc,this.transition={},this.globalState={})}isSupportedScript(i){return function(s,d){for(const _ of s)if(!Zu(_.charCodeAt(0),d))return!1;return!0}(i,On.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,s=i-Math.floor(i),d=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*s}}}class io{constructor(i,s){this.property=i,this.value=s,this.expression=function(d,_){if(Gc(d))return new vn(d,_);if(Gn(d)){const T=Aa(d,_);if(T.result==="error")throw new Error(T.value.map(n=>`${n.key}: ${n.message}`).join(", "));return T.value}{let T=d;return _.type==="color"&&typeof d=="string"?T=pi.parse(d):_.type!=="padding"||typeof d!="number"&&!Array.isArray(d)?_.type!=="numberArray"||typeof d!="number"&&!Array.isArray(d)?_.type!=="colorArray"||typeof d!="string"&&!Array.isArray(d)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(d)?T=Dn.parse(d):_.type==="projectionDefinition"&&typeof d=="string"&&(T=Gr.parse(d)):T=mn.parse(d):T=on.parse(d):T=Mn.parse(d),{globalStateRefs:new Set,kind:"constant",evaluate:()=>T}}}(s===void 0?i.specification.default:s,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(i,s,d){return this.property.possiblyEvaluate(this,i,s,d)}}class uc{constructor(i){this.property=i,this.value=new io(i,void 0)}transitioned(i,s){return new fs(this.property,this.value,s,Ei({},i.transition,this.transition),i.now)}untransitioned(){return new fs(this.property,this.value,null,{},0)}}class tu{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return sr(this._values[i].value.value)}setValue(i,s){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new uc(this._values[i].property)),this._values[i].value=new io(this._values[i].property,s===null?void 0:sr(s))}getTransition(i){return sr(this._values[i].transition)}setTransition(i,s){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new uc(this._values[i].property)),this._values[i].transition=sr(s)||void 0}serialize(){const i={};for(const s of Object.keys(this._values)){const d=this.getValue(s);d!==void 0&&(i[s]=d);const _=this.getTransition(s);_!==void 0&&(i[`${s}-transition`]=_)}return i}transitioned(i,s){const d=new zi(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].transitioned(i,s._values[_]);return d}untransitioned(){const i=new zi(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].untransitioned();return i}}class fs{constructor(i,s,d,_,T){this.property=i,this.value=s,this.begin=T+_.delay||0,this.end=this.begin+_.duration||0,i.specification.transition&&(_.delay||_.duration)&&(this.prior=d)}possiblyEvaluate(i,s,d){const _=i.now||0,T=this.value.possiblyEvaluate(i,s,d),n=this.prior;if(n){if(_>this.end)return this.prior=null,T;if(this.value.isDataDriven())return this.prior=null,T;if(_<this.begin)return n.possiblyEvaluate(i,s,d);{const e=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(n.possiblyEvaluate(i,s,d),T,mt(e))}}return T}}class zi{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,s,d){const _=new wl(this._properties);for(const T of Object.keys(this._values))_._values[T]=this._values[T].possiblyEvaluate(i,s,d);return _}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class cr{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return sr(this._values[i].value)}setValue(i,s){this._values[i]=new io(this._values[i].property,s===null?void 0:sr(s))}serialize(){const i={};for(const s of Object.keys(this._values)){const d=this.getValue(s);d!==void 0&&(i[s]=d)}return i}possiblyEvaluate(i,s,d){const _=new wl(this._properties);for(const T of Object.keys(this._values))_._values[T]=this._values[T].possiblyEvaluate(i,s,d);return _}}class pr{constructor(i,s,d){this.property=i,this.value=s,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,s,d,_){return this.property.evaluate(this.value,this.parameters,i,s,d,_)}}class wl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Ot{constructor(i){this.specification=i}possiblyEvaluate(i,s){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(s)}interpolate(i,s,d){const _=As[this.specification.type];return _?_(i,s,d):i}}class Ht{constructor(i,s){this.specification=i,this.overrides=s}possiblyEvaluate(i,s,d,_){return new pr(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(s,null,{},d,_)}:i.expression,s)}interpolate(i,s,d){if(i.value.kind!=="constant"||s.value.kind!=="constant")return i;if(i.value.value===void 0||s.value.value===void 0)return new pr(this,{kind:"constant",value:void 0},i.parameters);const _=As[this.specification.type];if(_){const T=_(i.value.value,s.value.value,d);return new pr(this,{kind:"constant",value:T},i.parameters)}return i}evaluate(i,s,d,_,T,n){return i.kind==="constant"?i.value:i.evaluate(s,d,_,T,n)}}class Sl extends Ht{possiblyEvaluate(i,s,d,_){if(i.value===void 0)return new pr(this,{kind:"constant",value:void 0},s);if(i.expression.kind==="constant"){const T=i.expression.evaluate(s,null,{},d,_),n=i.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,e=this._calculate(n,n,n,s);return new pr(this,{kind:"constant",value:e},s)}if(i.expression.kind==="camera"){const T=this._calculate(i.expression.evaluate({zoom:s.zoom-1}),i.expression.evaluate({zoom:s.zoom}),i.expression.evaluate({zoom:s.zoom+1}),s);return new pr(this,{kind:"constant",value:T},s)}return new pr(this,i.expression,s)}evaluate(i,s,d,_,T,n){if(i.kind==="source"){const e=i.evaluate(s,d,_,T,n);return this._calculate(e,e,e,s)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(s.zoom)-1},d,_),i.evaluate({zoom:Math.floor(s.zoom)},d,_),i.evaluate({zoom:Math.floor(s.zoom)+1},d,_),s):i.value}_calculate(i,s,d,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:i,to:s}:{from:d,to:s}}interpolate(i){return i}}class Ya{constructor(i){this.specification=i}possiblyEvaluate(i,s,d,_){if(i.value!==void 0){if(i.expression.kind==="constant"){const T=i.expression.evaluate(s,null,{},d,_);return this._calculate(T,T,T,s)}return this._calculate(i.expression.evaluate(new rr(Math.floor(s.zoom-1),s)),i.expression.evaluate(new rr(Math.floor(s.zoom),s)),i.expression.evaluate(new rr(Math.floor(s.zoom+1),s)),s)}}_calculate(i,s,d,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:i,to:s}:{from:d,to:s}}interpolate(i){return i}}class ro{constructor(i){this.specification=i}possiblyEvaluate(i,s,d,_){return!!i.expression.evaluate(s,null,{},d,_)}interpolate(){return!1}}class ea{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in i){const d=i[s];d.specification.overridable&&this.overridableProperties.push(s);const _=this.defaultPropertyValues[s]=new io(d,void 0),T=this.defaultTransitionablePropertyValues[s]=new uc(d);this.defaultTransitioningPropertyValues[s]=T.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=_.possiblyEvaluate({})}}}At("DataDrivenProperty",Ht),At("DataConstantProperty",Ot),At("CrossFadedDataDrivenProperty",Sl),At("CrossFadedProperty",Ya),At("ColorRampProperty",ro);const tn="-transition";class pa extends Dt{constructor(i,s){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter,this._featureFilter=ko(i.filter)),s.layout&&(this._unevaluatedLayout=new cr(s.layout)),s.paint)){this._transitionablePaint=new tu(s.paint);for(const d in i.paint)this.setPaintProperty(d,i.paint[d],{validate:!1});for(const d in i.layout)this.setLayoutProperty(d,i.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wl(s.paint)}}setFilter(i){this.filter=i,this._featureFilter=ko(i)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}getLayoutAffectingGlobalStateRefs(){const i=new Set;if(this._unevaluatedLayout)for(const s in this._unevaluatedLayout._values){const d=this._unevaluatedLayout._values[s];for(const _ of d.getGlobalStateRefs())i.add(_)}for(const s of this._featureFilter.getGlobalStateRefs())i.add(s);return i}getPaintAffectingGlobalStateRefs(){var i;const s=new globalThis.Map;if(this._transitionablePaint)for(const d in this._transitionablePaint._values){const _=this._transitionablePaint._values[d].value;for(const T of _.getGlobalStateRefs()){const n=(i=s.get(T))!==null&&i!==void 0?i:[];n.push({name:d,value:_.value}),s.set(T,n)}}return s}setLayoutProperty(i,s,d={}){s!=null&&this._validate(oc,`layers.${this.id}.layout.${i}`,i,s,d)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,s):this.visibility=s)}getPaintProperty(i){return i.endsWith(tn)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,s,d={}){if(s!=null&&this._validate(Gu,`layers.${this.id}.paint.${i}`,i,s,d))return!1;if(i.endsWith(tn))return this._transitionablePaint.setTransition(i.slice(0,-11),s||void 0),!1;{const _=this._transitionablePaint._values[i],T=_.property.specification["property-type"]==="cross-faded-data-driven",n=_.value.isDataDriven(),e=_.value;this._transitionablePaint.setValue(i,s),this._handleSpecialPaintPropertyUpdate(i);const r=this._transitionablePaint._values[i].value;return r.isDataDriven()||n||T||this._handleOverridablePaintPropertyUpdate(i,e,r)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,s,d){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,s){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,s)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Hn(i,(s,d)=>!(s===void 0||d==="layout"&&!Object.keys(s).length||d==="paint"&&!Object.keys(s).length))}_validate(i,s,d,_,T={}){return(!T||T.validate!==!1)&&Pn(this,i.call(Ft,{key:s,layerType:this.type,objectKey:d,value:_,styleSpec:ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const s=this.paint.get(i);if(s instanceof pr&&qr(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const Rh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class hc{constructor(i,s){this._structArray=i,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,s){return i._trim(),s&&(i.isTransferred=!0,s.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const s=Object.create(this.prototype);return s.arrayBuffer=i.arrayBuffer,s.length=i.length,s.capacity=i.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function un(l,i=1){let s=0,d=0;return{members:l.map(_=>{const T=Rh[_.type].BYTES_PER_ELEMENT,n=s=iu(s,Math.max(i,T)),e=_.components||1;return d=Math.max(d,T),s+=T*e,{name:_.name,type:_.type,components:e,offset:n}}),size:iu(s,Math.max(d,i)),alignment:i}}function iu(l,i){return Math.ceil(l/i)*i}class Tl extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s){const d=this.length;return this.resize(d+1),this.emplace(d,i,s)}emplace(i,s,d){const _=2*i;return this.int16[_+0]=s,this.int16[_+1]=d,i}}Tl.prototype.bytesPerElement=4,At("StructArrayLayout2i4",Tl);class Ml extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,d){const _=this.length;return this.resize(_+1),this.emplace(_,i,s,d)}emplace(i,s,d,_){const T=3*i;return this.int16[T+0]=s,this.int16[T+1]=d,this.int16[T+2]=_,i}}Ml.prototype.bytesPerElement=6,At("StructArrayLayout3i6",Ml);class ta extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,d,_){const T=this.length;return this.resize(T+1),this.emplace(T,i,s,d,_)}emplace(i,s,d,_,T){const n=4*i;return this.int16[n+0]=s,this.int16[n+1]=d,this.int16[n+2]=_,this.int16[n+3]=T,i}}ta.prototype.bytesPerElement=8,At("StructArrayLayout4i8",ta);class gr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,d,_,T,n){const e=this.length;return this.resize(e+1),this.emplace(e,i,s,d,_,T,n)}emplace(i,s,d,_,T,n,e){const r=6*i;return this.int16[r+0]=s,this.int16[r+1]=d,this.int16[r+2]=_,this.int16[r+3]=T,this.int16[r+4]=n,this.int16[r+5]=e,i}}gr.prototype.bytesPerElement=12,At("StructArrayLayout2i4i12",gr);class Oo extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,d,_,T,n){const e=this.length;return this.resize(e+1),this.emplace(e,i,s,d,_,T,n)}emplace(i,s,d,_,T,n,e){const r=4*i,o=8*i;return this.int16[r+0]=s,this.int16[r+1]=d,this.uint8[o+4]=_,this.uint8[o+5]=T,this.uint8[o+6]=n,this.uint8[o+7]=e,i}}Oo.prototype.bytesPerElement=8,At("StructArrayLayout2i4ub8",Oo);class Fo extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s){const d=this.length;return this.resize(d+1),this.emplace(d,i,s)}emplace(i,s,d){const _=2*i;return this.float32[_+0]=s,this.float32[_+1]=d,i}}Fo.prototype.bytesPerElement=8,At("StructArrayLayout2f8",Fo);class dc extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,d,_,T,n,e,r,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,i,s,d,_,T,n,e,r,o,h)}emplace(i,s,d,_,T,n,e,r,o,h,p){const g=10*i;return this.uint16[g+0]=s,this.uint16[g+1]=d,this.uint16[g+2]=_,this.uint16[g+3]=T,this.uint16[g+4]=n,this.uint16[g+5]=e,this.uint16[g+6]=r,this.uint16[g+7]=o,this.uint16[g+8]=h,this.uint16[g+9]=p,i}}dc.prototype.bytesPerElement=20,At("StructArrayLayout10ui20",dc);class no extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,d,_,T,n,e,r,o,h,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,s,d,_,T,n,e,r,o,h,p,g)}emplace(i,s,d,_,T,n,e,r,o,h,p,g,v){const M=12*i;return this.int16[M+0]=s,this.int16[M+1]=d,this.int16[M+2]=_,this.int16[M+3]=T,this.uint16[M+4]=n,this.uint16[M+5]=e,this.uint16[M+6]=r,this.uint16[M+7]=o,this.int16[M+8]=h,this.int16[M+9]=p,this.int16[M+10]=g,this.int16[M+11]=v,i}}no.prototype.bytesPerElement=24,At("StructArrayLayout4i4ui4i24",no);class Rs extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d){const _=this.length;return this.resize(_+1),this.emplace(_,i,s,d)}emplace(i,s,d,_){const T=3*i;return this.float32[T+0]=s,this.float32[T+1]=d,this.float32[T+2]=_,i}}Rs.prototype.bytesPerElement=12,At("StructArrayLayout3f12",Rs);class ao extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint32[1*i+0]=s,i}}ao.prototype.bytesPerElement=4,At("StructArrayLayout1ul4",ao);class Al extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,d,_,T,n,e,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,i,s,d,_,T,n,e,r,o)}emplace(i,s,d,_,T,n,e,r,o,h){const p=10*i,g=5*i;return this.int16[p+0]=s,this.int16[p+1]=d,this.int16[p+2]=_,this.int16[p+3]=T,this.int16[p+4]=n,this.int16[p+5]=e,this.uint32[g+3]=r,this.uint16[p+8]=o,this.uint16[p+9]=h,i}}Al.prototype.bytesPerElement=20,At("StructArrayLayout6i1ul2ui20",Al);class Hu extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,d,_,T,n){const e=this.length;return this.resize(e+1),this.emplace(e,i,s,d,_,T,n)}emplace(i,s,d,_,T,n,e){const r=6*i;return this.int16[r+0]=s,this.int16[r+1]=d,this.int16[r+2]=_,this.int16[r+3]=T,this.int16[r+4]=n,this.int16[r+5]=e,i}}Hu.prototype.bytesPerElement=12,At("StructArrayLayout2i2i2i12",Hu);class b extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,d,_,T){const n=this.length;return this.resize(n+1),this.emplace(n,i,s,d,_,T)}emplace(i,s,d,_,T,n){const e=4*i,r=8*i;return this.float32[e+0]=s,this.float32[e+1]=d,this.float32[e+2]=_,this.int16[r+6]=T,this.int16[r+7]=n,i}}b.prototype.bytesPerElement=16,At("StructArrayLayout2f1f2i16",b);class t extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,d,_,T,n){const e=this.length;return this.resize(e+1),this.emplace(e,i,s,d,_,T,n)}emplace(i,s,d,_,T,n,e){const r=16*i,o=4*i,h=8*i;return this.uint8[r+0]=s,this.uint8[r+1]=d,this.float32[o+1]=_,this.float32[o+2]=T,this.int16[h+6]=n,this.int16[h+7]=e,i}}t.prototype.bytesPerElement=16,At("StructArrayLayout2ub2f2i16",t);class c extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,d){const _=this.length;return this.resize(_+1),this.emplace(_,i,s,d)}emplace(i,s,d,_){const T=3*i;return this.uint16[T+0]=s,this.uint16[T+1]=d,this.uint16[T+2]=_,i}}c.prototype.bytesPerElement=6,At("StructArrayLayout3ui6",c);class f extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d,_,T,n,e,r,o,h,p,g,v,M,A,z,I){const L=this.length;return this.resize(L+1),this.emplace(L,i,s,d,_,T,n,e,r,o,h,p,g,v,M,A,z,I)}emplace(i,s,d,_,T,n,e,r,o,h,p,g,v,M,A,z,I,L){const B=24*i,j=12*i,q=48*i;return this.int16[B+0]=s,this.int16[B+1]=d,this.uint16[B+2]=_,this.uint16[B+3]=T,this.uint32[j+2]=n,this.uint32[j+3]=e,this.uint32[j+4]=r,this.uint16[B+10]=o,this.uint16[B+11]=h,this.uint16[B+12]=p,this.float32[j+7]=g,this.float32[j+8]=v,this.uint8[q+36]=M,this.uint8[q+37]=A,this.uint8[q+38]=z,this.uint32[j+10]=I,this.int16[B+22]=L,i}}f.prototype.bytesPerElement=48,At("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",f);class x extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d,_,T,n,e,r,o,h,p,g,v,M,A,z,I,L,B,j,q,X,J,ue,le,ce,Te,ye){const ve=this.length;return this.resize(ve+1),this.emplace(ve,i,s,d,_,T,n,e,r,o,h,p,g,v,M,A,z,I,L,B,j,q,X,J,ue,le,ce,Te,ye)}emplace(i,s,d,_,T,n,e,r,o,h,p,g,v,M,A,z,I,L,B,j,q,X,J,ue,le,ce,Te,ye,ve){const we=32*i,Ye=16*i;return this.int16[we+0]=s,this.int16[we+1]=d,this.int16[we+2]=_,this.int16[we+3]=T,this.int16[we+4]=n,this.int16[we+5]=e,this.int16[we+6]=r,this.int16[we+7]=o,this.uint16[we+8]=h,this.uint16[we+9]=p,this.uint16[we+10]=g,this.uint16[we+11]=v,this.uint16[we+12]=M,this.uint16[we+13]=A,this.uint16[we+14]=z,this.uint16[we+15]=I,this.uint16[we+16]=L,this.uint16[we+17]=B,this.uint16[we+18]=j,this.uint16[we+19]=q,this.uint16[we+20]=X,this.uint16[we+21]=J,this.uint16[we+22]=ue,this.uint32[Ye+12]=le,this.float32[Ye+13]=ce,this.float32[Ye+14]=Te,this.uint16[we+30]=ye,this.uint16[we+31]=ve,i}}x.prototype.bytesPerElement=64,At("StructArrayLayout8i15ui1ul2f2ui64",x);class S extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.float32[1*i+0]=s,i}}S.prototype.bytesPerElement=4,At("StructArrayLayout1f4",S);class C extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d){const _=this.length;return this.resize(_+1),this.emplace(_,i,s,d)}emplace(i,s,d,_){const T=3*i;return this.uint16[6*i+0]=s,this.float32[T+1]=d,this.float32[T+2]=_,i}}C.prototype.bytesPerElement=12,At("StructArrayLayout1ui2f12",C);class P extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,d){const _=this.length;return this.resize(_+1),this.emplace(_,i,s,d)}emplace(i,s,d,_){const T=4*i;return this.uint32[2*i+0]=s,this.uint16[T+2]=d,this.uint16[T+3]=_,i}}P.prototype.bytesPerElement=8,At("StructArrayLayout1ul2ui8",P);class k extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s){const d=this.length;return this.resize(d+1),this.emplace(d,i,s)}emplace(i,s,d){const _=2*i;return this.uint16[_+0]=s,this.uint16[_+1]=d,i}}k.prototype.bytesPerElement=4,At("StructArrayLayout2ui4",k);class O extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint16[1*i+0]=s,i}}O.prototype.bytesPerElement=2,At("StructArrayLayout1ui2",O);class N extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,d,_){const T=this.length;return this.resize(T+1),this.emplace(T,i,s,d,_)}emplace(i,s,d,_,T){const n=4*i;return this.float32[n+0]=s,this.float32[n+1]=d,this.float32[n+2]=_,this.float32[n+3]=T,i}}N.prototype.bytesPerElement=16,At("StructArrayLayout4f16",N);class U extends hc{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new se(this.anchorPointX,this.anchorPointY)}}U.prototype.size=20;class V extends Al{get(i){return new U(this,i)}}At("CollisionBoxArray",V);class $ extends hc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}$.prototype.size=48;class W extends f{get(i){return new $(this,i)}}At("PlacedSymbolArray",W);class ae extends hc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ae.prototype.size=64;class ne extends x{get(i){return new ae(this,i)}}At("SymbolInstanceArray",ne);class oe extends S{getoffsetX(i){return this.float32[1*i+0]}}At("GlyphOffsetArray",oe);class he extends Ml{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}At("SymbolLineVertexArray",he);class ge extends hc{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ge.prototype.size=12;class de extends C{get(i){return new ge(this,i)}}At("TextAnchorOffsetArray",de);class xe extends hc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}xe.prototype.size=8;class Me extends P{get(i){return new xe(this,i)}}At("FeatureIndexArray",Me);class fe extends Tl{}class ze extends Tl{}class Ve extends Tl{}class Ne extends gr{}class Fe extends Oo{}class He extends Fo{}class gt extends dc{}class yt extends no{}class st extends Rs{}class Bt extends ao{}class oi extends Hu{}class Gi extends t{}class yr extends c{}class nr extends k{}const $r=un([{name:"a_pos",components:2,type:"Int16"}],4),{members:jr}=$r;class mi{constructor(i=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=i}prepareSegment(i,s,d,_){const T=this.segments[this.segments.length-1];return i>mi.MAX_VERTEX_ARRAY_LENGTH&&Qr(`Max vertices per segment is ${mi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${mi.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!T||T.vertexLength+i>mi.MAX_VERTEX_ARRAY_LENGTH||T.sortKey!==_?this.createNewSegment(s,d,_):T}createNewSegment(i,s,d){const _={vertexOffset:i.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0,vaos:{}};return d!==void 0&&(_.sortKey=d),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(_),_}getOrCreateLatestSegment(i,s,d){return this.prepareSegment(0,i,s,d)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const i of this.segments)for(const s in i.vaos)i.vaos[s].destroy()}static simpleSegment(i,s,d,_){return new mi([{vertexOffset:i,primitiveOffset:s,vertexLength:d,primitiveLength:_,vaos:{},sortKey:0}])}}function _r(l,i){return 256*(l=Zt(Math.floor(l),0,255))+Zt(Math.floor(i),0,255)}mi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,At("SegmentVector",mi);const Hr=un([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var wn,gn,ia,ps={exports:{}},Pa={exports:{}},ms={exports:{}},gs=function(){if(ia)return ps.exports;ia=1;var l=(wn||(wn=1,Pa.exports=function(s,d){var _,T,n,e,r,o,h,p;for(T=s.length-(_=3&s.length),n=d,r=3432918353,o=461845907,p=0;p<T;)h=255&s.charCodeAt(p)|(255&s.charCodeAt(++p))<<8|(255&s.charCodeAt(++p))<<16|(255&s.charCodeAt(++p))<<24,++p,n=27492+(65535&(e=5*(65535&(n=(n^=h=(65535&(h=(h=(65535&h)*r+(((h>>>16)*r&65535)<<16)&4294967295)<<15|h>>>17))*o+(((h>>>16)*o&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(e>>>16)&65535)<<16);switch(h=0,_){case 3:h^=(255&s.charCodeAt(p+2))<<16;case 2:h^=(255&s.charCodeAt(p+1))<<8;case 1:n^=h=(65535&(h=(h=(65535&(h^=255&s.charCodeAt(p)))*r+(((h>>>16)*r&65535)<<16)&4294967295)<<15|h>>>17))*o+(((h>>>16)*o&65535)<<16)&4294967295}return n^=s.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}),Pa.exports),i=(gn||(gn=1,ms.exports=function(s,d){for(var _,T=s.length,n=d^T,e=0;T>=4;)_=1540483477*(65535&(_=255&s.charCodeAt(e)|(255&s.charCodeAt(++e))<<8|(255&s.charCodeAt(++e))<<16|(255&s.charCodeAt(++e))<<24))+((1540483477*(_>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),T-=4,++e;switch(T){case 3:n^=(255&s.charCodeAt(e+2))<<16;case 2:n^=(255&s.charCodeAt(e+1))<<8;case 1:n=1540483477*(65535&(n^=255&s.charCodeAt(e)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}),ms.exports);return ps.exports=l,ps.exports.murmur3=l,ps.exports.murmur2=i,ps.exports}(),ys=pe(gs);class Ds{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,s,d,_){this.ids.push(jo(i)),this.positions.push(s,d,_)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=jo(i);let d=0,_=this.ids.length-1;for(;d<_;){const n=d+_>>1;this.ids[n]>=s?_=n:d=n+1}const T=[];for(;this.ids[d]===s;)T.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return T}static serialize(i,s){const d=new Float64Array(i.ids),_=new Uint32Array(i.positions);return Fn(d,_,0,d.length-1),s&&s.push(d.buffer,_.buffer),{ids:d,positions:_}}static deserialize(i){const s=new Ds;return s.ids=i.ids,s.positions=i.positions,s.indexed=!0,s}}function jo(l){const i=+l;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:ys(String(l))}function Fn(l,i,s,d){for(;s<d;){const _=l[s+d>>1];let T=s-1,n=d+1;for(;;){do T++;while(l[T]<_);do n--;while(l[n]>_);if(T>=n)break;_s(l,T,n),_s(i,3*T,3*n),_s(i,3*T+1,3*n+1),_s(i,3*T+2,3*n+2)}n-s<d-n?(Fn(l,i,s,n),s=n+1):(Fn(l,i,n+1,d),d=n)}}function _s(l,i,s){const d=l[i];l[i]=l[s],l[s]=d}At("FeaturePositionMap",Ds);class ra{constructor(i,s){this.gl=i.gl,this.location=s}}class No extends ra{constructor(i,s){super(i,s),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Dr extends ra{constructor(i,s){super(i,s),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class Xr extends ra{constructor(i,s){super(i,s),this.current=pi.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const ma=new Float32Array(16);function Lr(l){return[_r(255*l.r,255*l.g),_r(255*l.b,255*l.a)]}class Vo{constructor(i,s,d){this.value=i,this.uniformNames=s.map(_=>`u_${_}`),this.type=d}setUniform(i,s,d){i.set(d.constantOr(this.value))}getBinding(i,s,d){return this.type==="color"?new Xr(i,s):new No(i,s)}}class Uo{constructor(i,s){this.uniformNames=s.map(d=>`u_${d}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=i.tlbr}setUniform(i,s,d,_){const T=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;T&&i.set(T)}getBinding(i,s,d){return d.substr(0,9)==="u_pattern"?new Dr(i,s):new No(i,s)}}class Ia{constructor(i,s,d,_){this.expression=i,this.type=d,this.maxValue=0,this.paintVertexAttributes=s.map(T=>({name:`a_${T}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(i,s,d){const _=this.paintVertexArray.length,T=this.expression.evaluate(new rr(0,d),s,{},d.canonical,[],d.formattedSection);this.paintVertexArray.resize(i),this._setPaintValue(_,i,T)}updatePaintArray(i,s,d,_,T){const n=this.expression.evaluate(new rr(0,T),d,_);this._setPaintValue(i,s,n)}_setPaintValue(i,s,d){if(this.type==="color"){const _=Lr(d);for(let T=i;T<s;T++)this.paintVertexArray.emplace(T,_[0],_[1])}else{for(let _=i;_<s;_++)this.paintVertexArray.emplace(_,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xr{constructor(i,s,d,_,T,n){this.expression=i,this.uniformNames=s.map(e=>`u_${e}_t`),this.type=d,this.useIntegerZoom=_,this.zoom=T,this.maxValue=0,this.paintVertexAttributes=s.map(e=>({name:`a_${e}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new n}populatePaintArray(i,s,d){const _=this.expression.evaluate(new rr(this.zoom,d),s,{},d.canonical,[],d.formattedSection),T=this.expression.evaluate(new rr(this.zoom+1,d),s,{},d.canonical,[],d.formattedSection),n=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(n,i,_,T)}updatePaintArray(i,s,d,_,T){const n=this.expression.evaluate(new rr(this.zoom,T),d,_),e=this.expression.evaluate(new rr(this.zoom+1,T),d,_);this._setPaintValue(i,s,n,e)}_setPaintValue(i,s,d,_){if(this.type==="color"){const T=Lr(d),n=Lr(_);for(let e=i;e<s;e++)this.paintVertexArray.emplace(e,T[0],T[1],n[0],n[1])}else{for(let T=i;T<s;T++)this.paintVertexArray.emplace(T,d,_);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(_))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,s){const d=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,_=Zt(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);i.set(_)}getBinding(i,s,d){return new No(i,s)}}class so{constructor(i,s,d,_,T,n){this.expression=i,this.type=s,this.useIntegerZoom=d,this.zoom=_,this.layerId=n,this.zoomInPaintVertexArray=new T,this.zoomOutPaintVertexArray=new T}populatePaintArray(i,s,d){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(_,i,s.patterns&&s.patterns[this.layerId],d.imagePositions)}updatePaintArray(i,s,d,_,T){this._setPaintValues(i,s,d.patterns&&d.patterns[this.layerId],T.imagePositions)}_setPaintValues(i,s,d,_){if(!_||!d)return;const{min:T,mid:n,max:e}=d,r=_[T],o=_[n],h=_[e];if(r&&o&&h)for(let p=i;p<s;p++)this.zoomInPaintVertexArray.emplace(p,o.tl[0],o.tl[1],o.br[0],o.br[1],r.tl[0],r.tl[1],r.br[0],r.br[1],o.pixelRatio,r.pixelRatio),this.zoomOutPaintVertexArray.emplace(p,o.tl[0],o.tl[1],o.br[0],o.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],o.pixelRatio,h.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,Hr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,Hr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Wa{constructor(i,s,d){this.binders={},this._buffers=[];const _=[];for(const T in i.paint._values){if(!d(T))continue;const n=i.paint.get(T);if(!(n instanceof pr&&qr(n.property.specification)))continue;const e=Go(T,i.type),r=n.value,o=n.property.specification.type,h=n.property.useIntegerZoom,p=n.property.specification["property-type"],g=p==="cross-faded"||p==="cross-faded-data-driven";if(r.kind==="constant")this.binders[T]=g?new Uo(r.value,e):new Vo(r.value,e,o),_.push(`/u_${T}`);else if(r.kind==="source"||g){const v=Dh(T,o,"source");this.binders[T]=g?new so(r,o,h,s,v,i.id):new Ia(r,e,o,v),_.push(`/a_${T}`)}else{const v=Dh(T,o,"composite");this.binders[T]=new xr(r,e,o,h,s,v),_.push(`/z_${T}`)}}this.cacheKey=_.sort().join("")}getMaxValue(i){const s=this.binders[i];return s instanceof Ia||s instanceof xr?s.maxValue:0}populatePaintArrays(i,s,d){for(const _ in this.binders){const T=this.binders[_];(T instanceof Ia||T instanceof xr||T instanceof so)&&T.populatePaintArray(i,s,d)}}setConstantPatternPositions(i,s){for(const d in this.binders){const _=this.binders[d];_ instanceof Uo&&_.setConstantPatternPositions(i,s)}}updatePaintArrays(i,s,d,_,T){let n=!1;for(const e in i){const r=s.getPositions(e);for(const o of r){const h=d.feature(o.index);for(const p in this.binders){const g=this.binders[p];if((g instanceof Ia||g instanceof xr||g instanceof so)&&g.expression.isStateDependent===!0){const v=_.paint.get(p);g.expression=v.value,g.updatePaintArray(o.start,o.end,h,i[e],T),n=!0}}}}return n}defines(){const i=[];for(const s in this.binders){const d=this.binders[s];(d instanceof Vo||d instanceof Uo)&&i.push(...d.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return i}getBinderAttributes(){const i=[];for(const s in this.binders){const d=this.binders[s];if(d instanceof Ia||d instanceof xr)for(let _=0;_<d.paintVertexAttributes.length;_++)i.push(d.paintVertexAttributes[_].name);else if(d instanceof so)for(let _=0;_<Hr.members.length;_++)i.push(Hr.members[_].name)}return i}getBinderUniforms(){const i=[];for(const s in this.binders){const d=this.binders[s];if(d instanceof Vo||d instanceof Uo||d instanceof xr)for(const _ of d.uniformNames)i.push(_)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,s){const d=[];for(const _ in this.binders){const T=this.binders[_];if(T instanceof Vo||T instanceof Uo||T instanceof xr){for(const n of T.uniformNames)if(s[n]){const e=T.getBinding(i,s[n],n);d.push({name:n,property:_,binding:e})}}}return d}setUniforms(i,s,d,_){for(const{name:T,property:n,binding:e}of s)this.binders[n].setUniform(e,_,d.get(n),T)}updatePaintBuffers(i){this._buffers=[];for(const s in this.binders){const d=this.binders[s];if(i&&d instanceof so){const _=i.fromScale===2?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(d instanceof Ia||d instanceof xr)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(i){for(const s in this.binders){const d=this.binders[s];(d instanceof Ia||d instanceof xr||d instanceof so)&&d.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const s=this.binders[i];(s instanceof Ia||s instanceof xr||s instanceof so)&&s.destroy()}}}class rn{constructor(i,s,d=()=>!0){this.programConfigurations={};for(const _ of i)this.programConfigurations[_.id]=new Wa(_,s,d);this.needsUpload=!1,this._featureMap=new Ds,this._bufferOffset=0}populatePaintArrays(i,s,d,_){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(i,s,_);s.id!==void 0&&this._featureMap.add(s.id,d,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,s,d,_){for(const T of d)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(i,this._featureMap,s,T,_)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function Go(l,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${i}-`,"").replace(/-/g,"_")]}function Dh(l,i,s){const d={color:{source:Fo,composite:N},number:{source:S,composite:Fo}},_=function(T){return{"line-pattern":{source:gt,composite:gt},"fill-pattern":{source:gt,composite:gt},"fill-extrusion-pattern":{source:gt,composite:gt}}[T]}(l);return _&&_[s]||d[i][s]}At("ConstantBinder",Vo),At("CrossFadedConstantBinder",Uo),At("SourceExpressionBinder",Ia),At("CrossFadedCompositeBinder",so),At("CompositeExpressionBinder",xr),At("ProgramConfiguration",Wa,{omit:["_buffers"]}),At("ProgramConfigurationSet",rn);const xs=Math.pow(2,14)-1,vs=-xs-1;function zr(l){const i=_t/l.extent,s=l.loadGeometry();for(let d=0;d<s.length;d++){const _=s[d];for(let T=0;T<_.length;T++){const n=_[T],e=Math.round(n.x*i),r=Math.round(n.y*i);n.x=Zt(e,vs,xs),n.y=Zt(r,vs,xs),(e<n.x||e>n.x+1||r<n.y||r>n.y+1)&&Qr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Ka(l,i){return{type:l.type,id:l.id,properties:l.properties,geometry:i?zr(l):[]}}const xd=-32768;function Of(l,i,s,d,_){l.emplaceBack(xd+8*i+d,xd+8*s+_)}class af{constructor(i){this.zoom=i.zoom,this.globalState=i.globalState,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new ze,this.indexArray=new yr,this.segments=new mi,this.programConfigurations=new rn(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(i,s,d){const _=this.layers[0],T=[];let n=null,e=!1,r=_.type==="heatmap";if(_.type==="circle"){const h=_;n=h.layout.get("circle-sort-key"),e=!n.isConstant(),r=r||h.paint.get("circle-pitch-alignment")==="map"}const o=r?s.subdivisionGranularity.circle:1;for(const{feature:h,id:p,index:g,sourceLayerIndex:v}of i){const M=this.layers[0]._featureFilter.needGeometry,A=Ka(h,M);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom,{globalState:this.globalState}),A,d))continue;const z=e?n.evaluate(A,{},d):void 0,I={id:p,properties:h.properties,type:h.type,sourceLayerIndex:v,index:g,geometry:M?A.geometry:zr(h),patterns:{},sortKey:z};T.push(I)}e&&T.sort((h,p)=>h.sortKey-p.sortKey);for(const h of T){const{geometry:p,index:g,sourceLayerIndex:v}=h,M=i[g].feature;this.addFeature(h,p,g,d,o),s.featureIndex.insert(M,p,g,v,this.index)}}update(i,s,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,{imagePositions:d,globalState:this.globalState})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,jr),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,s,d,_,T=1){let n;switch(T){case 1:n=[0,7];break;case 3:n=[0,2,5,7];break;case 5:n=[0,1,3,4,6,7];break;case 7:n=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${T}; valid values are 1, 3, 5, 7.`)}const e=n.length;for(const r of s)for(const o of r){const h=o.x,p=o.y;if(h<0||h>=_t||p<0||p>=_t)continue;const g=this.segments.prepareSegment(e*e,this.layoutVertexArray,this.indexArray,i.sortKey),v=g.vertexLength;for(let M=0;M<e;M++)for(let A=0;A<e;A++)Of(this.layoutVertexArray,h,p,n[A],n[M]);for(let M=0;M<e-1;M++)for(let A=0;A<e-1;A++){const z=v+M*e+A,I=v+(M+1)*e+A;this.indexArray.emplaceBack(z,I+1,z+1),this.indexArray.emplaceBack(z,I,I+1)}g.vertexLength+=e*e,g.primitiveLength+=(e-1)*(e-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,{imagePositions:{},canonical:_,globalState:this.globalState})}}function Ff(l,i){for(let s=0;s<l.length;s++)if(Yu(i,l[s]))return!0;for(let s=0;s<i.length;s++)if(Yu(l,i[s]))return!0;return!!Cl(l,i)}function fc(l,i,s){return!!Yu(l,i)||!!Bh(i,l,s)}function Xu(l,i){if(l.length===1)return sf(i,l[0]);for(let s=0;s<i.length;s++){const d=i[s];for(let _=0;_<d.length;_++)if(Yu(l,d[_]))return!0}for(let s=0;s<l.length;s++)if(sf(i,l[s]))return!0;for(let s=0;s<i.length;s++)if(Cl(l,i[s]))return!0;return!1}function jf(l,i,s){if(l.length>1){if(Cl(l,i))return!0;for(let d=0;d<i.length;d++)if(Bh(i[d],l,s))return!0}for(let d=0;d<l.length;d++)if(Bh(l[d],i,s))return!0;return!1}function Cl(l,i){if(l.length===0||i.length===0)return!1;for(let s=0;s<l.length-1;s++){const d=l[s],_=l[s+1];for(let T=0;T<i.length-1;T++)if(Lh(d,_,i[T],i[T+1]))return!0}return!1}function Lh(l,i,s,d){return oa(l,s,d)!==oa(i,s,d)&&oa(l,i,s)!==oa(l,i,d)}function Bh(l,i,s){const d=s*s;if(i.length===1)return l.distSqr(i[0])<d;for(let _=1;_<i.length;_++)if(Nf(l,i[_-1],i[_])<d)return!0;return!1}function Nf(l,i,s){const d=i.distSqr(s);if(d===0)return l.distSqr(i);const _=((l.x-i.x)*(s.x-i.x)+(l.y-i.y)*(s.y-i.y))/d;return l.distSqr(_<0?i:_>1?s:s.sub(i)._mult(_)._add(i))}function sf(l,i){let s,d,_,T=!1;for(let n=0;n<l.length;n++){s=l[n];for(let e=0,r=s.length-1;e<s.length;r=e++)d=s[e],_=s[r],d.y>i.y!=_.y>i.y&&i.x<(_.x-d.x)*(i.y-d.y)/(_.y-d.y)+d.x&&(T=!T)}return T}function Yu(l,i){let s=!1;for(let d=0,_=l.length-1;d<l.length;_=d++){const T=l[d],n=l[_];T.y>i.y!=n.y>i.y&&i.x<(n.x-T.x)*(i.y-T.y)/(n.y-T.y)+T.x&&(s=!s)}return s}function _p(l,i,s){const d=s[0],_=s[2];if(l.x<d.x&&i.x<d.x||l.x>_.x&&i.x>_.x||l.y<d.y&&i.y<d.y||l.y>_.y&&i.y>_.y)return!1;const T=oa(l,i,s[0]);return T!==oa(l,i,s[1])||T!==oa(l,i,s[2])||T!==oa(l,i,s[3])}function vd(l,i,s){const d=i.paint.get(l).value;return d.kind==="constant"?d.value:s.programConfigurations.get(i.id).getMaxValue(l)}function bd(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function yn(l,i,s,d,_){if(!i[0]&&!i[1])return l;const T=se.convert(i)._mult(_);s==="viewport"&&T._rotate(-d);const n=[];for(let e=0;e<l.length;e++)n.push(l[e].sub(T));return n}let na,of;At("CircleBucket",af,{omit:["layers"]});var Oh={get paint(){return of=of||new ea({"circle-radius":new Ht(ke.paint_circle["circle-radius"]),"circle-color":new Ht(ke.paint_circle["circle-color"]),"circle-blur":new Ht(ke.paint_circle["circle-blur"]),"circle-opacity":new Ht(ke.paint_circle["circle-opacity"]),"circle-translate":new Ot(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new Ot(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ot(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ot(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ht(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ht(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ht(ke.paint_circle["circle-stroke-opacity"])})},get layout(){return na=na||new ea({"circle-sort-key":new Ht(ke.layout_circle["circle-sort-key"])})}};class xp extends pa{constructor(i){super(i,Oh)}createBucket(i){return new af(i)}queryRadius(i){const s=i;return vd("circle-radius",this,s)+vd("circle-stroke-width",this,s)+bd(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:i,feature:s,featureState:d,geometry:_,transform:T,pixelsToTileUnits:n,unwrappedTileID:e,getElevation:r}){const o=yn(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-T.bearingInRadians,n),h=this.paint.get("circle-radius").evaluate(s,d)+this.paint.get("circle-stroke-width").evaluate(s,d),p=this.paint.get("circle-pitch-alignment")==="map",g=p?o:function(M,A,z,I){return M.map(L=>nn(L,A,z,I))}(o,T,e,r),v=p?h*n:h;for(const M of _)for(const A of M){const z=p?A:nn(A,T,e,r);let I=v;const L=T.projectTileCoordinates(A.x,A.y,e,r).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?I*=L/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(I*=T.cameraToCenterDistance/L),fc(g,z,I))return!0}return!1}}function nn(l,i,s,d){const _=i.projectTileCoordinates(l.x,l.y,s,d).point;return new se((.5*_.x+.5)*i.width,(.5*-_.y+.5)*i.height)}class ru extends af{}let Fh;At("HeatmapBucket",ru,{omit:["layers"]});var jh={get paint(){return Fh=Fh||new ea({"heatmap-radius":new Ht(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ht(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ot(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ro(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ot(ke.paint_heatmap["heatmap-opacity"])})}};function Wu(l,{width:i,height:s},d,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==i*s*d)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${i*s*d}`)}else _=new Uint8Array(i*s*d);return l.width=i,l.height=s,l.data=_,l}function Ku(l,{width:i,height:s},d){if(i===l.width&&s===l.height)return;const _=Wu({},{width:i,height:s},d);wd(l,_,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,i),height:Math.min(l.height,s)},d),l.width=i,l.height=s,l.data=_.data}function wd(l,i,s,d,_,T){if(_.width===0||_.height===0)return i;if(_.width>l.width||_.height>l.height||s.x>l.width-_.width||s.y>l.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>i.width||_.height>i.height||d.x>i.width-_.width||d.y>i.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const n=l.data,e=i.data;if(n===e)throw new Error("srcData equals dstData, so image is already copied");for(let r=0;r<_.height;r++){const o=((s.y+r)*l.width+s.x)*T,h=((d.y+r)*i.width+d.x)*T;for(let p=0;p<_.width*T;p++)e[h+p]=n[o+p]}return i}class nu{constructor(i,s){Wu(this,i,1,s)}resize(i){Ku(this,i,1)}clone(){return new nu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,d,_,T){wd(i,s,d,_,T,1)}}class In{constructor(i,s){Wu(this,i,4,s)}resize(i){Ku(this,i,4)}replace(i,s){s?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new In({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,d,_,T){wd(i,s,d,_,T,4)}setPixel(i,s,d){const _=4*(i*this.width+s);this.data[_+0]=Math.round(255*d.r/d.a),this.data[_+1]=Math.round(255*d.g/d.a),this.data[_+2]=Math.round(255*d.b/d.a),this.data[_+3]=Math.round(255*d.a)}}function Nh(l){const i={},s=l.resolution||256,d=l.clips?l.clips.length:1,_=l.image||new In({width:s,height:d});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const T=(n,e,r)=>{i[l.evaluationKey]=r;const o=l.expression.evaluate(i);_.setPixel(n/4/s,e/4,o)};if(l.clips)for(let n=0,e=0;n<d;++n,e+=4*s)for(let r=0,o=0;r<s;r++,o+=4){const h=r/(s-1),{start:p,end:g}=l.clips[n];T(e,o,p*(1-h)+g*h)}else for(let n=0,e=0;n<s;n++,e+=4)T(0,e,n/(s-1));return _}At("AlphaImage",nu),At("RGBAImage",In);const au="big-fb";class Sd extends pa{createBucket(i){return new ru(i)}constructor(i){super(i,jh),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Nh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(au)&&this.heatmapFbos.delete(au)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let pc;var Vh={get paint(){return pc=pc||new ea({"hillshade-illumination-direction":new Ot(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ot(ke.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ot(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ot(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ot(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ot(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ot(ke.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ot(ke.paint_hillshade["hillshade-method"])})}};class vp extends pa{constructor(i){super(i,Vh),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let i=this.paint.get("hillshade-illumination-direction").values,s=this.paint.get("hillshade-illumination-altitude").values,d=this.paint.get("hillshade-highlight-color").values,_=this.paint.get("hillshade-shadow-color").values;const T=Math.max(i.length,s.length,d.length,_.length);i=i.concat(Array(T-i.length).fill(i.at(-1))),s=s.concat(Array(T-s.length).fill(s.at(-1))),d=d.concat(Array(T-d.length).fill(d.at(-1))),_=_.concat(Array(T-_.length).fill(_.at(-1)));const n=s.map(Vl);return{directionRadians:i.map(Vl),altitudeRadians:n,shadowColor:_,highlightColor:d}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Td;var su={get paint(){return Td=Td||new ea({"color-relief-opacity":new Ot(ke["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new ro(ke["paint_color-relief"]["color-relief-color"])})}};class qo{constructor(i,s,d,_){this.context=i,this.format=d,this.texture=i.gl.createTexture(),this.update(s,_)}update(i,s,d){const{width:_,height:T}=i,n=!(this.size&&this.size[0]===_&&this.size[1]===T||d),{context:e}=this,{gl:r}=e;if(this.useMipmap=!!(s&&s.useMipmap),r.bindTexture(r.TEXTURE_2D,this.texture),e.pixelStoreUnpackFlipY.set(!1),e.pixelStoreUnpack.set(1),e.pixelStoreUnpackPremultiplyAlpha.set(this.format===r.RGBA&&(!s||s.premultiply!==!1)),n)this.size=[_,T],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||Nn(i)?r.texImage2D(r.TEXTURE_2D,0,this.format,this.format,r.UNSIGNED_BYTE,i):r.texImage2D(r.TEXTURE_2D,0,this.format,_,T,0,this.format,r.UNSIGNED_BYTE,i.data);else{const{x:o,y:h}=d||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||Nn(i)?r.texSubImage2D(r.TEXTURE_2D,0,o,h,r.RGBA,r.UNSIGNED_BYTE,i):r.texSubImage2D(r.TEXTURE_2D,0,o,h,_,T,r.RGBA,r.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&r.generateMipmap(r.TEXTURE_2D),e.pixelStoreUnpackFlipY.setDefault(),e.pixelStoreUnpack.setDefault(),e.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(i,s,d){const{context:_}=this,{gl:T}=_;T.bindTexture(T.TEXTURE_2D,this.texture),d!==T.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=T.LINEAR),i!==this.filter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,i),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,d||i),this.filter=i),s!==this.wrap&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,s),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class Md{constructor(i,s,d,_=1,T=1,n=1,e=0){if(this.uid=i,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(d&&!["mapbox","terrarium","custom"].includes(d))return void Qr(`"${d}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const r=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),d){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=T,this.blueFactor=n,this.baseShift=e;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let o=0;o<r;o++)this.data[this._idx(-1,o)]=this.data[this._idx(0,o)],this.data[this._idx(r,o)]=this.data[this._idx(r-1,o)],this.data[this._idx(o,-1)]=this.data[this._idx(o,0)],this.data[this._idx(o,r)]=this.data[this._idx(o,r-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(r,-1)]=this.data[this._idx(r-1,0)],this.data[this._idx(-1,r)]=this.data[this._idx(0,r-1)],this.data[this._idx(r,r)]=this.data[this._idx(r-1,r-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let o=0;o<r;o++)for(let h=0;h<r;h++){const p=this.get(o,h);p>this.max&&(this.max=p),p<this.min&&(this.min=p)}}get(i,s){const d=new Uint8Array(this.data.buffer),_=4*this._idx(i,s);return this.unpack(d[_],d[_+1],d[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,s){if(i<-1||i>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(i+1)}unpack(i,s,d){return i*this.redFactor+s*this.greenFactor+d*this.blueFactor-this.baseShift}pack(i){return Uh(i,this.getUnpackVector())}getPixels(){return new In({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,s,d){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let _=s*this.dim,T=s*this.dim+this.dim,n=d*this.dim,e=d*this.dim+this.dim;switch(s){case-1:_=T-1;break;case 1:T=_+1}switch(d){case-1:n=e-1;break;case 1:e=n+1}const r=-s*this.dim,o=-d*this.dim;for(let h=n;h<e;h++)for(let p=_;p<T;p++)this.data[this._idx(p,h)]=i.data[this._idx(p+r,h+o)]}}function Uh(l,i){const s=i[0],d=i[1],_=i[2],T=i[3],n=Math.min(s,d,_),e=Math.round((l+T)/n);return{r:Math.floor(e*n/s)%256,g:Math.floor(e*n/d)%256,b:Math.floor(e*n/_)%256}}At("DEMData",Md);class lf extends pa{constructor(i){super(i,su)}_createColorRamp(i){const s={elevationStops:[],colorStops:[]},d=this._transitionablePaint._values["color-relief-color"].value.expression;if(d instanceof Po&&d._styleExpression.expression instanceof Un){this.colorRampExpression=d;const n=d._styleExpression.expression;s.elevationStops=n.labels,s.colorStops=[];for(const e of s.elevationStops)s.colorStops.push(n.evaluate({globals:{elevation:e}}))}if(s.elevationStops.length<1&&(s.elevationStops=[0],s.colorStops=[pi.transparent]),s.elevationStops.length<2&&(s.elevationStops.push(s.elevationStops[0]+1),s.colorStops.push(s.colorStops[0])),s.elevationStops.length<=i)return s;const _={elevationStops:[],colorStops:[]},T=(s.elevationStops.length-1)/(i-1);for(let n=0;n<s.elevationStops.length-.5;n+=T)_.elevationStops.push(s.elevationStops[Math.round(n)]),_.colorStops.push(s.colorStops[Math.round(n)]);return Qr(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),_}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(i,s,d){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const _=this._createColorRamp(s),T=new In({width:_.colorStops.length,height:1}),n=new In({width:_.colorStops.length,height:1});for(let e=0;e<_.elevationStops.length;e++){const r=Uh(_.elevationStops[e],d);n.setPixel(0,e,new pi(r.r/255,r.g/255,r.b/255,1)),T.setPixel(0,e,_.colorStops[e])}return this.colorRampTextures={elevationTexture:new qo(i,n,i.gl.RGBA),colorTexture:new qo(i,T,i.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const El=un([{name:"a_pos",components:2,type:"Int16"}],4),{members:Vf}=El;function Gh(l,i,s){const d=s.patternDependencies;let _=!1;for(const T of i){const n=T.paint.get(`${l}-pattern`);n.isConstant()||(_=!0);const e=n.constantOr(null);e&&(_=!0,d[e.to]=!0,d[e.from]=!0)}return _}function Qu(l,i,s,d,_){const T=_.patternDependencies;for(const n of i){const e=n.paint.get(`${l}-pattern`).value;if(e.kind!=="constant"){let r=e.evaluate({zoom:d-1},s,{},_.availableImages),o=e.evaluate({zoom:d},s,{},_.availableImages),h=e.evaluate({zoom:d+1},s,{},_.availableImages);r=r&&r.name?r.name:r,o=o&&o.name?o.name:o,h=h&&h.name?h.name:h,T[r]=!0,T[o]=!0,T[h]=!0,s.patterns[n.id]={min:r,mid:o,max:h}}}return s}function hn(l,i,s,d,_){let T;if(_===function(n,e,r,o){let h=0;for(let p=e,g=r-o;p<r;p+=o)h+=(n[g]-n[p])*(n[p+1]+n[g+1]),g=p;return h}(l,i,s,d)>0)for(let n=i;n<s;n+=d)T=wp(n/d|0,l[n],l[n+1],T);else for(let n=s-d;n>=i;n-=d)T=wp(n/d|0,l[n],l[n+1],T);return T&&lu(T,T.next)&&($h(T),T=T.next),T}function Ju(l,i){if(!l)return l;i||(i=l);let s,d=l;do if(s=!1,d.steiner||!lu(d,d.next)&&Nr(d.prev,d,d.next)!==0)d=d.next;else{if($h(d),d=i=d.prev,d===d.next)break;s=!0}while(s||d!==i);return i}function Ad(l,i,s,d,_,T,n){if(!l)return;!n&&T&&function(r,o,h,p){let g=r;do g.z===0&&(g.z=Zh(g.x,g.y,o,h,p)),g.prevZ=g.prev,g.nextZ=g.next,g=g.next;while(g!==r);g.prevZ.nextZ=null,g.prevZ=null,function(v){let M,A=1;do{let z,I=v;v=null;let L=null;for(M=0;I;){M++;let B=I,j=0;for(let X=0;X<A&&(j++,B=B.nextZ,B);X++);let q=A;for(;j>0||q>0&&B;)j!==0&&(q===0||!B||I.z<=B.z)?(z=I,I=I.nextZ,j--):(z=B,B=B.nextZ,q--),L?L.nextZ=z:v=z,z.prevZ=L,L=z;I=B}L.nextZ=null,A*=2}while(M>1)}(g)}(l,d,_,T);let e=l;for(;l.prev!==l.next;){const r=l.prev,o=l.next;if(T?Cd(l,d,_,T):eh(l))i.push(r.i,l.i,o.i),$h(l),l=o.next,e=o.next;else if((l=o)===e){n?n===1?Ad(l=ou(Ju(l),i),i,s,d,_,T,2):n===2&&Uf(l,i,s,d,_,T):Ad(Ju(l),i,s,d,_,T,1);break}}}function eh(l){const i=l.prev,s=l,d=l.next;if(Nr(i,s,d)>=0)return!1;const _=i.x,T=s.x,n=d.x,e=i.y,r=s.y,o=d.y,h=Math.min(_,T,n),p=Math.min(e,r,o),g=Math.max(_,T,n),v=Math.max(e,r,o);let M=d.next;for(;M!==i;){if(M.x>=h&&M.x<=g&&M.y>=p&&M.y<=v&&ih(_,e,T,r,n,o,M.x,M.y)&&Nr(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function Cd(l,i,s,d){const _=l.prev,T=l,n=l.next;if(Nr(_,T,n)>=0)return!1;const e=_.x,r=T.x,o=n.x,h=_.y,p=T.y,g=n.y,v=Math.min(e,r,o),M=Math.min(h,p,g),A=Math.max(e,r,o),z=Math.max(h,p,g),I=Zh(v,M,i,s,d),L=Zh(A,z,i,s,d);let B=l.prevZ,j=l.nextZ;for(;B&&B.z>=I&&j&&j.z<=L;){if(B.x>=v&&B.x<=A&&B.y>=M&&B.y<=z&&B!==_&&B!==n&&ih(e,h,r,p,o,g,B.x,B.y)&&Nr(B.prev,B,B.next)>=0||(B=B.prevZ,j.x>=v&&j.x<=A&&j.y>=M&&j.y<=z&&j!==_&&j!==n&&ih(e,h,r,p,o,g,j.x,j.y)&&Nr(j.prev,j,j.next)>=0))return!1;j=j.nextZ}for(;B&&B.z>=I;){if(B.x>=v&&B.x<=A&&B.y>=M&&B.y<=z&&B!==_&&B!==n&&ih(e,h,r,p,o,g,B.x,B.y)&&Nr(B.prev,B,B.next)>=0)return!1;B=B.prevZ}for(;j&&j.z<=L;){if(j.x>=v&&j.x<=A&&j.y>=M&&j.y<=z&&j!==_&&j!==n&&ih(e,h,r,p,o,g,j.x,j.y)&&Nr(j.prev,j,j.next)>=0)return!1;j=j.nextZ}return!0}function ou(l,i){let s=l;do{const d=s.prev,_=s.next.next;!lu(d,_)&&Pl(d,s,s.next,_)&&rh(d,_)&&rh(_,d)&&(i.push(d.i,s.i,_.i),$h(s),$h(s.next),s=l=_),s=s.next}while(s!==l);return Ju(s)}function Uf(l,i,s,d,_,T){let n=l;do{let e=n.next.next;for(;e!==n.prev;){if(n.i!==e.i&&Gf(n,e)){let r=Zn(n,e);return n=Ju(n,n.next),r=Ju(r,r.next),Ad(n,i,s,d,_,T,0),void Ad(r,i,s,d,_,T,0)}e=e.next}n=n.next}while(n!==l)}function bp(l,i){let s=l.x-i.x;return s===0&&(s=l.y-i.y,s===0)&&(s=(l.next.y-l.y)/(l.next.x-l.x)-(i.next.y-i.y)/(i.next.x-i.x)),s}function qh(l,i){const s=function(_,T){let n=T;const e=_.x,r=_.y;let o,h=-1/0;if(lu(_,n))return n;do{if(lu(_,n.next))return n.next;if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const A=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(A<=e&&A>h&&(h=A,o=n.x<n.next.x?n:n.next,A===e))return o}n=n.next}while(n!==T);if(!o)return null;const p=o,g=o.x,v=o.y;let M=1/0;n=o;do{if(e>=n.x&&n.x>=g&&e!==n.x&&Ed(r<v?e:h,r,g,v,r<v?h:e,r,n.x,n.y)){const A=Math.abs(r-n.y)/(e-n.x);rh(n,_)&&(A<M||A===M&&(n.x>o.x||n.x===o.x&&zl(o,n)))&&(o=n,M=A)}n=n.next}while(n!==p);return o}(l,i);if(!s)return i;const d=Zn(s,l);return Ju(d,d.next),Ju(s,s.next)}function zl(l,i){return Nr(l.prev,l,i.prev)<0&&Nr(i.next,l,l.next)<0}function Zh(l,i,s,d,_){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-s)*_|0)|l<<8))|l<<4))|l<<2))|l<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-d)*_|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function th(l){let i=l,s=l;do(i.x<s.x||i.x===s.x&&i.y<s.y)&&(s=i),i=i.next;while(i!==l);return s}function Ed(l,i,s,d,_,T,n,e){return(_-n)*(i-e)>=(l-n)*(T-e)&&(l-n)*(d-e)>=(s-n)*(i-e)&&(s-n)*(T-e)>=(_-n)*(d-e)}function ih(l,i,s,d,_,T,n,e){return!(l===n&&i===e)&&Ed(l,i,s,d,_,T,n,e)}function Gf(l,i){return l.next.i!==i.i&&l.prev.i!==i.i&&!function(s,d){let _=s;do{if(_.i!==s.i&&_.next.i!==s.i&&_.i!==d.i&&_.next.i!==d.i&&Pl(_,_.next,s,d))return!0;_=_.next}while(_!==s);return!1}(l,i)&&(rh(l,i)&&rh(i,l)&&function(s,d){let _=s,T=!1;const n=(s.x+d.x)/2,e=(s.y+d.y)/2;do _.y>e!=_.next.y>e&&_.next.y!==_.y&&n<(_.next.x-_.x)*(e-_.y)/(_.next.y-_.y)+_.x&&(T=!T),_=_.next;while(_!==s);return T}(l,i)&&(Nr(l.prev,l,i.prev)||Nr(l,i.prev,i))||lu(l,i)&&Nr(l.prev,l,l.next)>0&&Nr(i.prev,i,i.next)>0)}function Nr(l,i,s){return(i.y-l.y)*(s.x-i.x)-(i.x-l.x)*(s.y-i.y)}function lu(l,i){return l.x===i.x&&l.y===i.y}function Pl(l,i,s,d){const _=Il(Nr(l,i,s)),T=Il(Nr(l,i,d)),n=Il(Nr(s,d,l)),e=Il(Nr(s,d,i));return _!==T&&n!==e||!(_!==0||!dn(l,s,i))||!(T!==0||!dn(l,d,i))||!(n!==0||!dn(s,l,d))||!(e!==0||!dn(s,i,d))}function dn(l,i,s){return i.x<=Math.max(l.x,s.x)&&i.x>=Math.min(l.x,s.x)&&i.y<=Math.max(l.y,s.y)&&i.y>=Math.min(l.y,s.y)}function Il(l){return l>0?1:l<0?-1:0}function rh(l,i){return Nr(l.prev,l,l.next)<0?Nr(l,i,l.next)>=0&&Nr(l,l.prev,i)>=0:Nr(l,i,l.prev)<0||Nr(l,l.next,i)<0}function Zn(l,i){const s=cf(l.i,l.x,l.y),d=cf(i.i,i.x,i.y),_=l.next,T=i.prev;return l.next=i,i.prev=l,s.next=_,_.prev=s,d.next=s,s.prev=d,T.next=d,d.prev=T,d}function wp(l,i,s,d){const _=cf(l,i,s);return d?(_.next=d.next,_.prev=d,d.next.prev=_,d.next=_):(_.prev=_,_.next=_),_}function $h(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function cf(l,i,s){return{i:l,x:i,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Pr{constructor(i,s){if(s>i)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=i,this._minGranularity=s}getGranularityForZoomLevel(i){return Math.max(Math.floor(this._baseZoomGranularity/(1<<i)),this._minGranularity,1)}}class aa{constructor(i){this.fill=i.fill,this.line=i.line,this.tile=i.tile,this.stencil=i.stencil,this.circle=i.circle}}aa.noSubdivision=new aa({fill:new Pr(0,0),line:new Pr(0,0),tile:new Pr(0,0),stencil:new Pr(0,0),circle:1}),At("SubdivisionGranularityExpression",Pr),At("SubdivisionGranularitySetting",aa);const ka=-32768,nh=32767;class qf{constructor(i,s){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=i,this._granularityCellSize=_t/i,this._canonical=s}_getKey(i,s){return(i+=32768)<<16|s+32768}_vertexToIndex(i,s){if(i<-32768||s<-32768||i>32767||s>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const d=0|Math.round(i),_=0|Math.round(s),T=this._getKey(d,_);if(this._vertexDictionary.has(T))return this._vertexDictionary.get(T);const n=this._vertexBuffer.length/2;return this._vertexDictionary.set(T,n),this._vertexBuffer.push(d,_),n}_subdivideTrianglesScanline(i){if(this._granularity<2)return function(_,T){const n=[];for(let e=0;e<T.length;e+=3){const r=T[e],o=T[e+1],h=T[e+2],p=_[2*r],g=_[2*r+1];(_[2*o]-p)*(_[2*h+1]-g)-(_[2*o+1]-g)*(_[2*h]-p)>0?(n.push(r),n.push(h),n.push(o)):(n.push(r),n.push(o),n.push(h))}return n}(this._vertexBuffer,i);const s=[],d=i.length;for(let _=0;_<d;_+=3){const T=[i[_+0],i[_+1],i[_+2]],n=[this._vertexBuffer[2*i[_+0]+0],this._vertexBuffer[2*i[_+0]+1],this._vertexBuffer[2*i[_+1]+0],this._vertexBuffer[2*i[_+1]+1],this._vertexBuffer[2*i[_+2]+0],this._vertexBuffer[2*i[_+2]+1]];let e=1/0,r=1/0,o=-1/0,h=-1/0;for(let A=0;A<3;A++){const z=n[2*A],I=n[2*A+1];e=Math.min(e,z),o=Math.max(o,z),r=Math.min(r,I),h=Math.max(h,I)}if(e===o||r===h)continue;const p=Math.floor(e/this._granularityCellSize),g=Math.ceil(o/this._granularityCellSize),v=Math.floor(r/this._granularityCellSize),M=Math.ceil(h/this._granularityCellSize);if(p!==g||v!==M)for(let A=v;A<M;A++){const z=this._scanlineGenerateVertexRingForCellRow(A,n,T);Ra(this._vertexBuffer,z,s)}else s.push(...T)}return s}_scanlineGenerateVertexRingForCellRow(i,s,d){const _=i*this._granularityCellSize,T=_+this._granularityCellSize,n=[];for(let e=0;e<3;e++){const r=s[2*e],o=s[2*e+1],h=s[2*(e+1)%6],p=s[(2*(e+1)+1)%6],g=s[2*(e+2)%6],v=s[(2*(e+2)+1)%6],M=h-r,A=p-o,z=M===0,I=A===0,L=(_-o)/A,B=(T-o)/A,j=Math.min(L,B),q=Math.max(L,B);if(!I&&(j>=1||q<=0)||I&&(o<_||o>T)){p>=_&&p<=T&&n.push(d[(e+1)%3]);continue}!I&&j>0&&n.push(this._vertexToIndex(r+M*j,o+A*j));const X=r+M*Math.max(j,0),J=r+M*Math.min(q,1);z||this._generateIntraEdgeVertices(n,r,o,h,p,X,J),!I&&q<1&&n.push(this._vertexToIndex(r+M*q,o+A*q)),(I||p>=_&&p<=T)&&n.push(d[(e+1)%3]),!I&&(p<=_||p>=T)&&this._generateInterEdgeVertices(n,r,o,h,p,g,v,J,_,T)}return n}_generateIntraEdgeVertices(i,s,d,_,T,n,e){const r=_-s,o=T-d,h=o===0,p=h?Math.min(s,_):Math.min(n,e),g=h?Math.max(s,_):Math.max(n,e),v=Math.floor(p/this._granularityCellSize)+1,M=Math.ceil(g/this._granularityCellSize)-1;if(h?s<_:n<e)for(let A=v;A<=M;A++){const z=A*this._granularityCellSize;i.push(this._vertexToIndex(z,d+o*(z-s)/r))}else for(let A=M;A>=v;A--){const z=A*this._granularityCellSize;i.push(this._vertexToIndex(z,d+o*(z-s)/r))}}_generateInterEdgeVertices(i,s,d,_,T,n,e,r,o,h){const p=T-d,g=n-_,v=e-T,M=(o-T)/v,A=(h-T)/v,z=Math.min(M,A),I=Math.max(M,A),L=_+g*z;let B=Math.floor(Math.min(L,r)/this._granularityCellSize)+1,j=Math.ceil(Math.max(L,r)/this._granularityCellSize)-1,q=r<L;const X=v===0;if(X&&(e===o||e===h))return;if(X||z>=1||I<=0){const ue=d-e,le=n+(s-n)*Math.min((o-e)/ue,(h-e)/ue);B=Math.floor(Math.min(le,r)/this._granularityCellSize)+1,j=Math.ceil(Math.max(le,r)/this._granularityCellSize)-1,q=r<le}const J=p>0?h:o;if(q)for(let ue=B;ue<=j;ue++)i.push(this._vertexToIndex(ue*this._granularityCellSize,J));else for(let ue=j;ue>=B;ue--)i.push(this._vertexToIndex(ue*this._granularityCellSize,J))}_generateOutline(i){const s=[];for(const d of i){const _=mc(d,this._granularity,!0),T=this._pointArrayToIndices(_),n=[];for(let e=1;e<T.length;e++)n.push(T[e-1]),n.push(T[e]);s.push(n)}return s}_handlePoles(i){let s=!1,d=!1;this._canonical&&(this._canonical.y===0&&(s=!0),this._canonical.y===(1<<this._canonical.z)-1&&(d=!0)),(s||d)&&this._fillPoles(i,s,d)}_ensureNoPoleVertices(){const i=this._vertexBuffer;for(let s=0;s<i.length;s+=2){const d=i[s+1];d===ka&&(i[s+1]=-32767),d===nh&&(i[s+1]=32766)}}_generatePoleQuad(i,s,d,_,T,n){_>T!=(n===ka)?(i.push(s),i.push(d),i.push(this._vertexToIndex(_,n)),i.push(d),i.push(this._vertexToIndex(T,n)),i.push(this._vertexToIndex(_,n))):(i.push(d),i.push(s),i.push(this._vertexToIndex(_,n)),i.push(this._vertexToIndex(T,n)),i.push(d),i.push(this._vertexToIndex(_,n)))}_fillPoles(i,s,d){const _=this._vertexBuffer,T=_t,n=i.length;for(let e=2;e<n;e+=3){const r=i[e-2],o=i[e-1],h=i[e],p=_[2*r],g=_[2*r+1],v=_[2*o],M=_[2*o+1],A=_[2*h],z=_[2*h+1];s&&(g===0&&M===0&&this._generatePoleQuad(i,r,o,p,v,ka),M===0&&z===0&&this._generatePoleQuad(i,o,h,v,A,ka),z===0&&g===0&&this._generatePoleQuad(i,h,r,A,p,ka)),d&&(g===T&&M===T&&this._generatePoleQuad(i,r,o,p,v,nh),M===T&&z===T&&this._generatePoleQuad(i,o,h,v,A,nh),z===T&&g===T&&this._generatePoleQuad(i,h,r,A,p,nh))}}_initializeVertices(i){for(let s=0;s<i.length;s+=2)this._vertexToIndex(i[s],i[s+1])}subdividePolygonInternal(i,s){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:d,holeIndices:_}=function(e){const r=[],o=[];for(const h of e)if(h.length!==0){h!==e[0]&&r.push(o.length/2);for(let p=0;p<h.length;p++)o.push(h[p].x),o.push(h[p].y)}return{flattened:o,holeIndices:r}}(i);let T;this._initializeVertices(d);try{const e=function(o,h,p=2){const g=h&&h.length,v=g?h[0]*p:o.length;let M=hn(o,0,v,p,!0);const A=[];if(!M||M.next===M.prev)return A;let z,I,L;if(g&&(M=function(B,j,q,X){const J=[];for(let ue=0,le=j.length;ue<le;ue++){const ce=hn(B,j[ue]*X,ue<le-1?j[ue+1]*X:B.length,X,!1);ce===ce.next&&(ce.steiner=!0),J.push(th(ce))}J.sort(bp);for(let ue=0;ue<J.length;ue++)q=qh(J[ue],q);return q}(o,h,M,p)),o.length>80*p){z=o[0],I=o[1];let B=z,j=I;for(let q=p;q<v;q+=p){const X=o[q],J=o[q+1];X<z&&(z=X),J<I&&(I=J),X>B&&(B=X),J>j&&(j=J)}L=Math.max(B-z,j-I),L=L!==0?32767/L:0}return Ad(M,A,p,z,I,L,0),A}(d,_),r=this._convertIndices(d,e);T=this._subdivideTrianglesScanline(r)}catch(e){console.error(e)}let n=[];return s&&(n=this._generateOutline(i)),this._ensureNoPoleVertices(),this._handlePoles(T),{verticesFlattened:this._vertexBuffer,indicesTriangles:T,indicesLineList:n}}_convertIndices(i,s){const d=[];for(let _=0;_<s.length;_++)d.push(this._vertexToIndex(i[2*s[_]],i[2*s[_]+1]));return d}_pointArrayToIndices(i){const s=[];for(let d=0;d<i.length;d++){const _=i[d];s.push(this._vertexToIndex(_.x,_.y))}return s}}function Zf(l,i,s,d=!0){return new qf(s,i).subdividePolygonInternal(l,d)}function mc(l,i,s=!1){if(!l||l.length<1)return[];if(l.length<2)return[];const d=l[0],_=l[l.length-1],T=s&&(d.x!==_.x||d.y!==_.y);if(i<2)return T?[...l,l[0]]:[...l];const n=Math.floor(_t/i),e=[];e.push(new se(l[0].x,l[0].y));const r=l.length,o=T?r:r-1;for(let h=0;h<o;h++){const p=l[h],g=h<r-1?l[h+1]:l[0],v=p.x,M=p.y,A=g.x,z=g.y,I=v!==A,L=M!==z;if(!I&&!L)continue;const B=A-v,j=z-M,q=Math.abs(B),X=Math.abs(j);let J=v,ue=M;for(;;){const ce=B>0?(Math.floor(J/n)+1)*n:(Math.ceil(J/n)-1)*n,Te=j>0?(Math.floor(ue/n)+1)*n:(Math.ceil(ue/n)-1)*n,ye=Math.abs(J-ce),ve=Math.abs(ue-Te),we=Math.abs(J-A),Ye=Math.abs(ue-z),We=I?ye/q:Number.POSITIVE_INFINITY,et=L?ve/X:Number.POSITIVE_INFINITY;if((we<=ye||!I)&&(Ye<=ve||!L))break;if(We<et&&I||!L){J=ce,ue+=j*We;const Ue=new se(J,Math.round(ue));e[e.length-1].x===Ue.x&&e[e.length-1].y===Ue.y||e.push(Ue)}else{J+=B*et,ue=Te;const Ue=new se(Math.round(J),ue);e[e.length-1].x===Ue.x&&e[e.length-1].y===Ue.y||e.push(Ue)}}const le=new se(A,z);e[e.length-1].x===le.x&&e[e.length-1].y===le.y||e.push(le)}return e}function Ra(l,i,s){if(i.length===0)throw new Error("Subdivision vertex ring is empty.");let d=0,_=l[2*i[0]];for(let r=1;r<i.length;r++){const o=l[2*i[r]];o<_&&(_=o,d=r)}const T=i.length;let n=d,e=(n+1)%T;for(;;){const r=n-1>=0?n-1:T-1,o=(e+1)%T,h=l[2*i[r]],p=l[2*i[o]],g=l[2*i[n]],v=l[2*i[n]+1],M=l[2*i[e]+1];let A=!1;if(h<p)A=!0;else if(h>p)A=!1;else{const z=M-v,I=-(l[2*i[e]]-g),L=v<M?1:-1;((h-g)*z+(l[2*i[r]+1]-v)*I)*L>((p-g)*z+(l[2*i[o]+1]-v)*I)*L&&(A=!0)}if(A){const z=i[r],I=i[n],L=i[e];z!==I&&z!==L&&I!==L&&s.push(L,I,z),n--,n<0&&(n=T-1)}else{const z=i[o],I=i[n],L=i[e];z!==I&&z!==L&&I!==L&&s.push(L,I,z),e++,e>=T&&(e=0)}if(r===o)break}}function oo(l,i,s,d,_,T,n,e,r){const o=_.length/2,h=n&&e&&r;if(o<mi.MAX_VERTEX_ARRAY_LENGTH){const p=i.prepareSegment(o,s,d),g=p.vertexLength;for(let A=0;A<T.length;A+=3)d.emplaceBack(g+T[A],g+T[A+1],g+T[A+2]);let v,M;p.vertexLength+=o,p.primitiveLength+=T.length/3,h&&(M=n.prepareSegment(o,s,e),v=M.vertexLength,M.vertexLength+=o);for(let A=0;A<_.length;A+=2)l(_[A],_[A+1]);if(h)for(let A=0;A<r.length;A++){const z=r[A];for(let I=1;I<z.length;I+=2)e.emplaceBack(v+z[I-1],v+z[I]);M.primitiveLength+=z.length/2}}else(function(p,g,v,M,A,z){const I=[];for(let X=0;X<M.length/2;X++)I.push(-1);const L={count:0};let B=0,j=p.getOrCreateLatestSegment(g,v),q=j.vertexLength;for(let X=2;X<A.length;X+=3){const J=A[X-2],ue=A[X-1],le=A[X];let ce=I[J]<B,Te=I[ue]<B,ye=I[le]<B;j.vertexLength+((ce?1:0)+(Te?1:0)+(ye?1:0))>mi.MAX_VERTEX_ARRAY_LENGTH&&(j=p.createNewSegment(g,v),B=L.count,ce=!0,Te=!0,ye=!0,q=0);const ve=ah(I,M,z,L,J,ce,j),we=ah(I,M,z,L,ue,Te,j),Ye=ah(I,M,z,L,le,ye,j);v.emplaceBack(q+ve-B,q+we-B,q+Ye-B),j.primitiveLength++}})(i,s,d,_,T,l),h&&function(p,g,v,M,A,z){const I=[];for(let X=0;X<M.length/2;X++)I.push(-1);const L={count:0};let B=0,j=p.getOrCreateLatestSegment(g,v),q=j.vertexLength;for(let X=0;X<A.length;X++){const J=A[X];for(let ue=1;ue<A[X].length;ue+=2){const le=J[ue-1],ce=J[ue];let Te=I[le]<B,ye=I[ce]<B;j.vertexLength+((Te?1:0)+(ye?1:0))>mi.MAX_VERTEX_ARRAY_LENGTH&&(j=p.createNewSegment(g,v),B=L.count,Te=!0,ye=!0,q=0);const ve=ah(I,M,z,L,le,Te,j),we=ah(I,M,z,L,ce,ye,j);v.emplaceBack(q+ve-B,q+we-B),j.primitiveLength++}}}(n,s,e,_,r,l),i.forceNewSegmentOnNextPrepare(),n==null||n.forceNewSegmentOnNextPrepare()}function ah(l,i,s,d,_,T,n){if(T){const e=d.count;return s(i[2*_],i[2*_+1]),l[_]=d.count,d.count++,n.vertexLength++,e}return l[_]}class Qa{constructor(i){this.zoom=i.zoom,this.globalState=i.globalState,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ve,this.indexArray=new yr,this.indexArray2=new nr,this.programConfigurations=new rn(i.layers,i.zoom),this.segments=new mi,this.segments2=new mi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(i,s,d){this.hasPattern=Gh("fill",this.layers,s);const _=this.layers[0].layout.get("fill-sort-key"),T=!_.isConstant(),n=[];for(const{feature:e,id:r,index:o,sourceLayerIndex:h}of i){const p=this.layers[0]._featureFilter.needGeometry,g=Ka(e,p);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom,{globalState:this.globalState}),g,d))continue;const v=T?_.evaluate(g,{},d,s.availableImages):void 0,M={id:r,properties:e.properties,type:e.type,sourceLayerIndex:h,index:o,geometry:p?g.geometry:zr(e),patterns:{},sortKey:v};n.push(M)}T&&n.sort((e,r)=>e.sortKey-r.sortKey);for(const e of n){const{geometry:r,index:o,sourceLayerIndex:h}=e;if(this.hasPattern){const p=Qu("fill",this.layers,e,this.zoom,s);this.patternFeatures.push(p)}else this.addFeature(e,r,o,d,{},s.subdivisionGranularity);s.featureIndex.insert(i[o].feature,r,o,h,this.index)}}update(i,s,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,{imagePositions:d,globalState:this.globalState})}addFeatures(i,s,d){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,s,d,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Vf),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,s,d,_,T,n){for(const e of To(s,500)){const r=Zf(e,_,n.fill.getGranularityForZoomLevel(_.z)),o=this.layoutVertexArray;oo((h,p)=>{o.emplaceBack(h,p)},this.segments,this.layoutVertexArray,this.indexArray,r.verticesFlattened,r.indicesTriangles,this.segments2,this.indexArray2,r.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,{imagePositions:T,canonical:_,globalState:this.globalState})}}let $f,gc;At("FillBucket",Qa,{omit:["layers","patternFeatures"]});var cu={get paint(){return gc=gc||new ea({"fill-antialias":new Ot(ke.paint_fill["fill-antialias"]),"fill-opacity":new Ht(ke.paint_fill["fill-opacity"]),"fill-color":new Ht(ke.paint_fill["fill-color"]),"fill-outline-color":new Ht(ke.paint_fill["fill-outline-color"]),"fill-translate":new Ot(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new Ot(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new Sl(ke.paint_fill["fill-pattern"])})},get layout(){return $f=$f||new ea({"fill-sort-key":new Ht(ke.layout_fill["fill-sort-key"])})}};class uu extends pa{constructor(i){super(i,cu)}recalculate(i,s){super.recalculate(i,s);const d=this.paint._values["fill-outline-color"];d.value.kind==="constant"&&d.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Qa(i)}queryRadius(){return bd(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:i,geometry:s,transform:d,pixelsToTileUnits:_}){return Xu(yn(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-d.bearingInRadians,_),s)}isTileClipped(){return!0}}const sh=un([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),kn=un([{name:"a_centroid",components:2,type:"Int16"}],4),{members:lo}=sh;class hu{constructor(i,s,d,_,T){this.properties={},this.extent=d,this.type=0,this.id=void 0,this._pbf=i,this._geometry=-1,this._keys=_,this._values=T,i.readFields(oh,this,s)}loadGeometry(){const i=this._pbf;i.pos=this._geometry;const s=i.readVarint()+i.pos,d=[];let _,T=1,n=0,e=0,r=0;for(;i.pos<s;){if(n<=0){const o=i.readVarint();T=7&o,n=o>>3}if(n--,T===1||T===2)e+=i.readSVarint(),r+=i.readSVarint(),T===1&&(_&&d.push(_),_=[]),_&&_.push(new se(e,r));else{if(T!==7)throw new Error(`unknown command ${T}`);_&&_.push(_[0].clone())}}return _&&d.push(_),d}bbox(){const i=this._pbf;i.pos=this._geometry;const s=i.readVarint()+i.pos;let d=1,_=0,T=0,n=0,e=1/0,r=-1/0,o=1/0,h=-1/0;for(;i.pos<s;){if(_<=0){const p=i.readVarint();d=7&p,_=p>>3}if(_--,d===1||d===2)T+=i.readSVarint(),n+=i.readSVarint(),T<e&&(e=T),T>r&&(r=T),n<o&&(o=n),n>h&&(h=n);else if(d!==7)throw new Error(`unknown command ${d}`)}return[e,o,r,h]}toGeoJSON(i,s,d){const _=this.extent*Math.pow(2,d),T=this.extent*i,n=this.extent*s,e=this.loadGeometry();function r(g){return[360*(g.x+T)/_-180,360/Math.PI*Math.atan(Math.exp((1-2*(g.y+n)/_)*Math.PI))-90]}function o(g){return g.map(r)}let h;if(this.type===1){const g=[];for(const M of e)g.push(M[0]);const v=o(g);h=g.length===1?{type:"Point",coordinates:v[0]}:{type:"MultiPoint",coordinates:v}}else if(this.type===2){const g=e.map(o);h=g.length===1?{type:"LineString",coordinates:g[0]}:{type:"MultiLineString",coordinates:g}}else{if(this.type!==3)throw new Error("unknown feature type");{const g=function(M){const A=M.length;if(A<=1)return[M];const z=[];let I,L;for(let B=0;B<A;B++){const j=yc(M[B]);j!==0&&(L===void 0&&(L=j<0),L===j<0?(I&&z.push(I),I=[M[B]]):I&&I.push(M[B]))}return I&&z.push(I),z}(e),v=[];for(const M of g)v.push(M.map(o));h=v.length===1?{type:"Polygon",coordinates:v[0]}:{type:"MultiPolygon",coordinates:v}}}const p={type:"Feature",geometry:h,properties:this.properties};return this.id!=null&&(p.id=this.id),p}}function oh(l,i,s){l===1?i.id=s.readVarint():l===2?function(d,_){const T=d.readVarint()+d.pos;for(;d.pos<T;){const n=_._keys[d.readVarint()],e=_._values[d.readVarint()];_.properties[n]=e}}(s,i):l===3?i.type=s.readVarint():l===4&&(i._geometry=s.pos)}function yc(l){let i=0;for(let s,d,_=0,T=l.length,n=T-1;_<T;n=_++)s=l[_],d=l[n],i+=(d.x-s.x)*(s.y+d.y);return i}hu.types=["Unknown","Point","LineString","Polygon"];class Zo{constructor(i,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(lh,this,s),this.length=this._features.length}feature(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];const s=this._pbf.readVarint()+this._pbf.pos;return new hu(this._pbf,s,this.extent,this._keys,this._values)}}function lh(l,i,s){l===15?i.version=s.readVarint():l===1?i.name=s.readString():l===5?i.extent=s.readVarint():l===2?i._features.push(s.pos):l===3?i._keys.push(s.readString()):l===4&&i._values.push(function(d){let _=null;const T=d.readVarint()+d.pos;for(;d.pos<T;){const n=d.readVarint()>>3;_=n===1?d.readString():n===2?d.readFloat():n===3?d.readDouble():n===4?d.readVarint64():n===5?d.readVarint():n===6?d.readSVarint():n===7?d.readBoolean():null}if(_==null)throw new Error("unknown feature value");return _}(s))}class Hf{constructor(i,s){this.layers=i.readFields(Sp,{},s)}}function Sp(l,i,s){if(l===3){const d=new Zo(s,s.readVarint()+s.pos);d.length&&(i[d.name]=d)}}const ch=Math.pow(2,13);function Hh(l,i,s,d,_,T,n,e){l.emplaceBack(i,s,2*Math.floor(d*ch)+n,_*ch*2,T*ch*2,Math.round(e))}class Xh{constructor(i){this.zoom=i.zoom,this.globalState=i.globalState,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Ne,this.centroidVertexArray=new fe,this.indexArray=new yr,this.programConfigurations=new rn(i.layers,i.zoom),this.segments=new mi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(i,s,d){this.features=[],this.hasPattern=Gh("fill-extrusion",this.layers,s);for(const{feature:_,id:T,index:n,sourceLayerIndex:e}of i){const r=this.layers[0]._featureFilter.needGeometry,o=Ka(_,r);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom,{globalState:this.globalState}),o,d))continue;const h={id:T,sourceLayerIndex:e,index:n,geometry:r?o.geometry:zr(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(Qu("fill-extrusion",this.layers,h,this.zoom,s)):this.addFeature(h,h.geometry,n,d,{},s.subdivisionGranularity),s.featureIndex.insert(_,h.geometry,n,e,this.index,!0)}}addFeatures(i,s,d){for(const _ of this.features){const{geometry:T}=_;this.addFeature(_,T,_.index,s,d,i.subdivisionGranularity)}}update(i,s,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,{imagePositions:d,globalState:this.globalState})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,lo),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,kn.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,s,d,_,T,n){for(const e of To(s,500)){const r={x:0,y:0,sampleCount:0},o=this.layoutVertexArray.length;this.processPolygon(r,_,i,e,n);const h=this.layoutVertexArray.length-o,p=Math.floor(r.x/r.sampleCount),g=Math.floor(r.y/r.sampleCount);for(let v=0;v<h;v++)this.centroidVertexArray.emplaceBack(p,g)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,{imagePositions:T,canonical:_,globalState:this.globalState})}processPolygon(i,s,d,_,T){if(_.length<1||Mp(_[0]))return;for(const p of _)p.length!==0&&Tp(i,p);const n={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},e=T.fill.getGranularityForZoomLevel(s.z),r=hu.types[d.type]==="Polygon";for(const p of _){if(p.length===0||Mp(p))continue;const g=mc(p,e,r);this._generateSideFaces(g,n)}if(!r)return;const o=Zf(_,s,e,!1),h=this.layoutVertexArray;oo((p,g)=>{Hh(h,p,g,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,o.verticesFlattened,o.indicesTriangles)}_generateSideFaces(i,s){let d=0;for(let _=1;_<i.length;_++){const T=i[_],n=i[_-1];if(qp(T,n))continue;s.segment.vertexLength+4>mi.MAX_VERTEX_ARRAY_LENGTH&&(s.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const e=T.sub(n)._perp()._unit(),r=n.dist(T);d+r>32768&&(d=0),Hh(this.layoutVertexArray,T.x,T.y,e.x,e.y,0,0,d),Hh(this.layoutVertexArray,T.x,T.y,e.x,e.y,0,1,d),d+=r,Hh(this.layoutVertexArray,n.x,n.y,e.x,e.y,0,0,d),Hh(this.layoutVertexArray,n.x,n.y,e.x,e.y,0,1,d);const o=s.segment.vertexLength;this.indexArray.emplaceBack(o,o+2,o+1),this.indexArray.emplaceBack(o+1,o+2,o+3),s.segment.vertexLength+=4,s.segment.primitiveLength+=2}}}function Tp(l,i){for(let s=0;s<i.length;s++){const d=i[s];s===i.length-1&&i[0].x===d.x&&i[0].y===d.y||(l.x+=d.x,l.y+=d.y,l.sampleCount++)}}function qp(l,i){return l.x===i.x&&(l.x<0||l.x>_t)||l.y===i.y&&(l.y<0||l.y>_t)}function Mp(l){return l.every(i=>i.x<0)||l.every(i=>i.x>_t)||l.every(i=>i.y<0)||l.every(i=>i.y>_t)}let Tr;At("FillExtrusionBucket",Xh,{omit:["layers","features"]});var Vr={get paint(){return Tr=Tr||new ea({"fill-extrusion-opacity":new Ot(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ht(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ot(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ot(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Sl(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ht(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ht(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ot(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class qi extends pa{constructor(i){super(i,Vr)}createBucket(i){return new Xh(i)}queryRadius(){return bd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:i,feature:s,featureState:d,geometry:_,transform:T,pixelsToTileUnits:n,pixelPosMatrix:e}){const r=yn(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-T.bearingInRadians,n),o=this.paint.get("fill-extrusion-height").evaluate(s,d),h=this.paint.get("fill-extrusion-base").evaluate(s,d),p=function(v,M){const A=[];for(const z of v){const I=[z.x,z.y,0,1];fn(I,I,M),A.push(new se(I[0]/I[3],I[1]/I[3]))}return A}(r,e),g=function(v,M,A,z){const I=[],L=[],B=z[8]*M,j=z[9]*M,q=z[10]*M,X=z[11]*M,J=z[8]*A,ue=z[9]*A,le=z[10]*A,ce=z[11]*A;for(const Te of v){const ye=[],ve=[];for(const we of Te){const Ye=we.x,We=we.y,et=z[0]*Ye+z[4]*We+z[12],Ue=z[1]*Ye+z[5]*We+z[13],it=z[2]*Ye+z[6]*We+z[14],tt=z[3]*Ye+z[7]*We+z[15],Pt=it+q,jt=tt+X,kt=et+J,vt=Ue+ue,Wt=it+le,Kt=tt+ce,li=new se((et+B)/jt,(Ue+j)/jt);li.z=Pt/jt,ye.push(li);const Fi=new se(kt/Kt,vt/Kt);Fi.z=Wt/Kt,ve.push(Fi)}I.push(ye),L.push(ve)}return[I,L]}(_,h,o,e);return function(v,M,A){let z=1/0;Xu(A,M)&&(z=Ci(A,M[0]));for(let I=0;I<M.length;I++){const L=M[I],B=v[I];for(let j=0;j<L.length-1;j++){const q=L[j],X=[q,L[j+1],B[j+1],B[j],q];Ff(A,X)&&(z=Math.min(z,Ci(A,X)))}}return z!==1/0&&z}(g[0],g[1],p)}}function Oi(l,i){return l.x*i.x+l.y*i.y}function Ci(l,i){if(l.length===1){let s=0;const d=i[s++];let _;for(;!_||d.equals(_);)if(_=i[s++],!_)return 1/0;for(;s<i.length;s++){const T=i[s],n=l[0],e=_.sub(d),r=T.sub(d),o=n.sub(d),h=Oi(e,e),p=Oi(e,r),g=Oi(r,r),v=Oi(o,e),M=Oi(o,r),A=h*g-p*p,z=(g*v-p*M)/A,I=(h*M-p*v)/A,L=d.z*(1-z-I)+_.z*z+T.z*I;if(isFinite(L))return L}return 1/0}{let s=1/0;for(const d of i)s=Math.min(s,d.z);return s}}const ga=un([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ls}=ga,_c=un([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Yh}=_c,xc=Math.cos(Math.PI/180*37.5),_n=Math.pow(2,14)/.5;class $o{constructor(i){this.zoom=i.zoom,this.globalState=i.globalState,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Fe,this.layoutVertexArray2=new He,this.indexArray=new yr,this.programConfigurations=new rn(i.layers,i.zoom),this.segments=new mi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(i,s,d){this.hasPattern=Gh("line",this.layers,s);const _=this.layers[0].layout.get("line-sort-key"),T=!_.isConstant(),n=[];for(const{feature:e,id:r,index:o,sourceLayerIndex:h}of i){const p=this.layers[0]._featureFilter.needGeometry,g=Ka(e,p);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom,{globalState:this.globalState}),g,d))continue;const v=T?_.evaluate(g,{},d):void 0,M={id:r,properties:e.properties,type:e.type,sourceLayerIndex:h,index:o,geometry:p?g.geometry:zr(e),patterns:{},sortKey:v};n.push(M)}T&&n.sort((e,r)=>e.sortKey-r.sortKey);for(const e of n){const{geometry:r,index:o,sourceLayerIndex:h}=e;if(this.hasPattern){const p=Qu("line",this.layers,e,this.zoom,s);this.patternFeatures.push(p)}else this.addFeature(e,r,o,d,{},s.subdivisionGranularity);s.featureIndex.insert(i[o].feature,r,o,h,this.index)}}update(i,s,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,{imagePositions:d,globalState:this.globalState})}addFeatures(i,s,d){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,s,d,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Yh)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Ls),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,s,d,_,T,n){const e=this.layers[0].layout,r=e.get("line-join").evaluate(i,{}),o=e.get("line-cap"),h=e.get("line-miter-limit"),p=e.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const g of s)this.addLine(g,i,r,o,h,p,_,n);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,{imagePositions:T,canonical:_,globalState:this.globalState})}addLine(i,s,d,_,T,n,e,r){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,i=mc(i,e?r.line.getGranularityForZoomLevel(e.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let B=0;B<i.length-1;B++)this.totalDistance+=i[B].dist(i[B+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const o=hu.types[s.type]==="Polygon";let h=i.length;for(;h>=2&&i[h-1].equals(i[h-2]);)h--;let p=0;for(;p<h-1&&i[p].equals(i[p+1]);)p++;if(h<(o?3:2))return;d==="bevel"&&(T=1.05);const g=this.overscaling<=16?122880/(512*this.overscaling):0,v=this.segments.prepareSegment(10*h,this.layoutVertexArray,this.indexArray);let M,A,z,I,L;this.e1=this.e2=-1,o&&(M=i[h-2],L=i[p].sub(M)._unit()._perp());for(let B=p;B<h;B++){if(z=B===h-1?o?i[p+1]:void 0:i[B+1],z&&i[B].equals(z))continue;L&&(I=L),M&&(A=M),M=i[B],L=z?z.sub(M)._unit()._perp():I,I=I||L;let j=I.add(L);j.x===0&&j.y===0||j._unit();const q=I.x*L.x+I.y*L.y,X=j.x*L.x+j.y*L.y,J=X!==0?1/X:1/0,ue=2*Math.sqrt(2-2*X),le=X<xc&&A&&z,ce=I.x*L.y-I.y*L.x>0;if(le&&B>p){const ve=M.dist(A);if(ve>2*g){const we=M.sub(M.sub(A)._mult(g/ve)._round());this.updateDistance(A,we),this.addCurrentVertex(we,I,0,0,v),A=we}}const Te=A&&z;let ye=Te?d:o?"butt":_;if(Te&&ye==="round"&&(J<n?ye="miter":J<=2&&(ye="fakeround")),ye==="miter"&&J>T&&(ye="bevel"),ye==="bevel"&&(J>2&&(ye="flipbevel"),J<T&&(ye="miter")),A&&this.updateDistance(A,M),ye==="miter")j._mult(J),this.addCurrentVertex(M,j,0,0,v);else if(ye==="flipbevel"){if(J>100)j=L.mult(-1);else{const ve=J*I.add(L).mag()/I.sub(L).mag();j._perp()._mult(ve*(ce?-1:1))}this.addCurrentVertex(M,j,0,0,v),this.addCurrentVertex(M,j.mult(-1),0,0,v)}else if(ye==="bevel"||ye==="fakeround"){const ve=-Math.sqrt(J*J-1),we=ce?ve:0,Ye=ce?0:ve;if(A&&this.addCurrentVertex(M,I,we,Ye,v),ye==="fakeround"){const We=Math.round(180*ue/Math.PI/20);for(let et=1;et<We;et++){let Ue=et/We;if(Ue!==.5){const tt=Ue-.5;Ue+=Ue*tt*(Ue-1)*((1.0904+q*(q*(3.55645-1.43519*q)-3.2452))*tt*tt+(.848013+q*(.215638*q-1.06021)))}const it=L.sub(I)._mult(Ue)._add(I)._unit()._mult(ce?-1:1);this.addHalfVertex(M,it.x,it.y,!1,ce,0,v)}}z&&this.addCurrentVertex(M,L,-we,-Ye,v)}else if(ye==="butt")this.addCurrentVertex(M,j,0,0,v);else if(ye==="square"){const ve=A?1:-1;this.addCurrentVertex(M,j,ve,ve,v)}else ye==="round"&&(A&&(this.addCurrentVertex(M,I,0,0,v),this.addCurrentVertex(M,I,1,1,v,!0)),z&&(this.addCurrentVertex(M,L,-1,-1,v,!0),this.addCurrentVertex(M,L,0,0,v)));if(le&&B<h-1){const ve=M.dist(z);if(ve>2*g){const we=M.add(z.sub(M)._mult(g/ve)._round());this.updateDistance(M,we),this.addCurrentVertex(we,L,0,0,v),M=we}}}}addCurrentVertex(i,s,d,_,T,n=!1){const e=s.y*_-s.x,r=-s.y-s.x*_;this.addHalfVertex(i,s.x+s.y*d,s.y-s.x*d,n,!1,d,T),this.addHalfVertex(i,e,r,n,!0,-_,T),this.distance>_n/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,s,d,_,T,n))}addHalfVertex({x:i,y:s},d,_,T,n,e,r){const o=.5*(this.lineClips?this.scaledDistance*(_n-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(T?1:0),(s<<1)+(n?1:0),Math.round(63*d)+128,Math.round(63*_)+128,1+(e===0?0:e<0?-1:1)|(63&o)<<2,o>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const h=r.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,h,this.e2),r.primitiveLength++),n?this.e2=h:this.e1=h}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,s){this.distance+=i.dist(s),this.updateScaledDistance()}}let vc,uf;At("LineBucket",$o,{omit:["layers","patternFeatures"]});var bs={get paint(){return uf=uf||new ea({"line-opacity":new Ht(ke.paint_line["line-opacity"]),"line-color":new Ht(ke.paint_line["line-color"]),"line-translate":new Ot(ke.paint_line["line-translate"]),"line-translate-anchor":new Ot(ke.paint_line["line-translate-anchor"]),"line-width":new Ht(ke.paint_line["line-width"]),"line-gap-width":new Ht(ke.paint_line["line-gap-width"]),"line-offset":new Ht(ke.paint_line["line-offset"]),"line-blur":new Ht(ke.paint_line["line-blur"]),"line-dasharray":new Ya(ke.paint_line["line-dasharray"]),"line-pattern":new Sl(ke.paint_line["line-pattern"]),"line-gradient":new ro(ke.paint_line["line-gradient"])})},get layout(){return vc=vc||new ea({"line-cap":new Ot(ke.layout_line["line-cap"]),"line-join":new Ht(ke.layout_line["line-join"]),"line-miter-limit":new Ot(ke.layout_line["line-miter-limit"]),"line-round-limit":new Ot(ke.layout_line["line-round-limit"]),"line-sort-key":new Ht(ke.layout_line["line-sort-key"])})}};class uh extends Ht{possiblyEvaluate(i,s){return s=new rr(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(i,s)}evaluate(i,s,d,_){return s=Ei({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(i,s,d,_)}}let kl;class Ja extends pa{constructor(i){super(i,bs),this.gradientVersion=0,kl||(kl=new uh(bs.paint.properties["line-width"].specification),kl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(d){return d._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof en,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,s){super.recalculate(i,s),this.paint._values["line-floorwidth"]=kl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new $o(i)}queryRadius(i){const s=i,d=hf(vd("line-width",this,s),vd("line-gap-width",this,s)),_=vd("line-offset",this,s);return d/2+Math.abs(_)+bd(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:i,feature:s,featureState:d,geometry:_,transform:T,pixelsToTileUnits:n}){const e=yn(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-T.bearingInRadians,n),r=n/2*hf(this.paint.get("line-width").evaluate(s,d),this.paint.get("line-gap-width").evaluate(s,d)),o=this.paint.get("line-offset").evaluate(s,d);return o&&(_=function(h,p){const g=[];for(let v=0;v<h.length;v++){const M=h[v],A=[];for(let z=0;z<M.length;z++){const I=M[z-1],L=M[z],B=M[z+1],j=z===0?new se(0,0):L.sub(I)._unit()._perp(),q=z===M.length-1?new se(0,0):B.sub(L)._unit()._perp(),X=j._add(q)._unit(),J=X.x*q.x+X.y*q.y;J!==0&&X._mult(1/J),A.push(X._mult(p)._add(L))}g.push(A)}return g}(_,o*n)),function(h,p,g){for(let v=0;v<p.length;v++){const M=p[v];if(h.length>=3){for(let A=0;A<M.length;A++)if(Yu(h,M[A]))return!0}if(jf(h,M,g))return!0}return!1}(e,_,r)}isTileClipped(){return!0}}function hf(l,i){return i>0?i+2*l:l}const df=un([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ff=un([{name:"a_projected_pos",components:3,type:"Float32"}],4);un([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const pf=un([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);un([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const bc=un([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ya=un([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function du(l,i,s){return l.sections.forEach(d=>{d.text=function(_,T,n){const e=T.layout.get("text-transform").evaluate(n,{});return e==="uppercase"?_=_.toLocaleUpperCase():e==="lowercase"&&(_=_.toLocaleLowerCase()),On.applyArabicShaping&&(_=On.applyArabicShaping(_)),_}(d.text,i,s)}),l}un([{name:"triangle",components:3,type:"Uint16"}]),un([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),un([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),un([{type:"Float32",name:"offsetX"}]),un([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),un([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ho={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Yr=24;const Rl=4294967296,Xo=1/Rl,mf=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class fu{constructor(i=new Uint8Array(16)){this.buf=ArrayBuffer.isView(i)?i:new Uint8Array(i),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(i,s,d=this.length){for(;this.pos<d;){const _=this.readVarint(),T=_>>3,n=this.pos;this.type=7&_,i(T,s,this),this.pos===n&&this.skip(_)}return s}readMessage(i,s){return this.readFields(i,s,this.readVarint()+this.pos)}readFixed32(){const i=this.dataView.getUint32(this.pos,!0);return this.pos+=4,i}readSFixed32(){const i=this.dataView.getInt32(this.pos,!0);return this.pos+=4,i}readFixed64(){const i=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Rl;return this.pos+=8,i}readSFixed64(){const i=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Rl;return this.pos+=8,i}readFloat(){const i=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,i}readDouble(){const i=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,i}readVarint(i){const s=this.buf;let d,_;return _=s[this.pos++],d=127&_,_<128?d:(_=s[this.pos++],d|=(127&_)<<7,_<128?d:(_=s[this.pos++],d|=(127&_)<<14,_<128?d:(_=s[this.pos++],d|=(127&_)<<21,_<128?d:(_=s[this.pos],d|=(15&_)<<28,function(T,n,e){const r=e.buf;let o,h;if(h=r[e.pos++],o=(112&h)>>4,h<128||(h=r[e.pos++],o|=(127&h)<<3,h<128)||(h=r[e.pos++],o|=(127&h)<<10,h<128)||(h=r[e.pos++],o|=(127&h)<<17,h<128)||(h=r[e.pos++],o|=(127&h)<<24,h<128)||(h=r[e.pos++],o|=(1&h)<<31,h<128))return pu(T,o,n);throw new Error("Expected varint not more than 10 bytes")}(d,i,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const i=this.readVarint();return i%2==1?(i+1)/-2:i/2}readBoolean(){return!!this.readVarint()}readString(){const i=this.readVarint()+this.pos,s=this.pos;return this.pos=i,i-s>=12&&mf?mf.decode(this.buf.subarray(s,i)):function(d,_,T){let n="",e=_;for(;e<T;){const r=d[e];let o,h,p,g=null,v=r>239?4:r>223?3:r>191?2:1;if(e+v>T)break;v===1?r<128&&(g=r):v===2?(o=d[e+1],(192&o)==128&&(g=(31&r)<<6|63&o,g<=127&&(g=null))):v===3?(o=d[e+1],h=d[e+2],(192&o)==128&&(192&h)==128&&(g=(15&r)<<12|(63&o)<<6|63&h,(g<=2047||g>=55296&&g<=57343)&&(g=null))):v===4&&(o=d[e+1],h=d[e+2],p=d[e+3],(192&o)==128&&(192&h)==128&&(192&p)==128&&(g=(15&r)<<18|(63&o)<<12|(63&h)<<6|63&p,(g<=65535||g>=1114112)&&(g=null))),g===null?(g=65533,v=1):g>65535&&(g-=65536,n+=String.fromCharCode(g>>>10&1023|55296),g=56320|1023&g),n+=String.fromCharCode(g),e+=v}return n}(this.buf,s,i)}readBytes(){const i=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,i);return this.pos=i,s}readPackedVarint(i=[],s){const d=this.readPackedEnd();for(;this.pos<d;)i.push(this.readVarint(s));return i}readPackedSVarint(i=[]){const s=this.readPackedEnd();for(;this.pos<s;)i.push(this.readSVarint());return i}readPackedBoolean(i=[]){const s=this.readPackedEnd();for(;this.pos<s;)i.push(this.readBoolean());return i}readPackedFloat(i=[]){const s=this.readPackedEnd();for(;this.pos<s;)i.push(this.readFloat());return i}readPackedDouble(i=[]){const s=this.readPackedEnd();for(;this.pos<s;)i.push(this.readDouble());return i}readPackedFixed32(i=[]){const s=this.readPackedEnd();for(;this.pos<s;)i.push(this.readFixed32());return i}readPackedSFixed32(i=[]){const s=this.readPackedEnd();for(;this.pos<s;)i.push(this.readSFixed32());return i}readPackedFixed64(i=[]){const s=this.readPackedEnd();for(;this.pos<s;)i.push(this.readFixed64());return i}readPackedSFixed64(i=[]){const s=this.readPackedEnd();for(;this.pos<s;)i.push(this.readSFixed64());return i}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(i){const s=7&i;if(s===0)for(;this.buf[this.pos++]>127;);else if(s===2)this.pos=this.readVarint()+this.pos;else if(s===5)this.pos+=4;else{if(s!==1)throw new Error(`Unimplemented type: ${s}`);this.pos+=8}}writeTag(i,s){this.writeVarint(i<<3|s)}realloc(i){let s=this.length||16;for(;s<this.pos+i;)s*=2;if(s!==this.length){const d=new Uint8Array(s);d.set(this.buf),this.buf=d,this.dataView=new DataView(d.buffer),this.length=s}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(i){this.realloc(4),this.dataView.setInt32(this.pos,i,!0),this.pos+=4}writeSFixed32(i){this.realloc(4),this.dataView.setInt32(this.pos,i,!0),this.pos+=4}writeFixed64(i){this.realloc(8),this.dataView.setInt32(this.pos,-1&i,!0),this.dataView.setInt32(this.pos+4,Math.floor(i*Xo),!0),this.pos+=8}writeSFixed64(i){this.realloc(8),this.dataView.setInt32(this.pos,-1&i,!0),this.dataView.setInt32(this.pos+4,Math.floor(i*Xo),!0),this.pos+=8}writeVarint(i){(i=+i||0)>268435455||i<0?function(s,d){let _,T;if(s>=0?(_=s%4294967296|0,T=s/4294967296|0):(_=~(-s%4294967296),T=~(-s/4294967296),4294967295^_?_=_+1|0:(_=0,T=T+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");d.realloc(10),function(n,e,r){r.buf[r.pos++]=127&n|128,n>>>=7,r.buf[r.pos++]=127&n|128,n>>>=7,r.buf[r.pos++]=127&n|128,n>>>=7,r.buf[r.pos++]=127&n|128,r.buf[r.pos]=127&(n>>>=7)}(_,0,d),function(n,e){const r=(7&n)<<4;e.buf[e.pos++]|=r|((n>>>=3)?128:0),n&&(e.buf[e.pos++]=127&n|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=127&n|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=127&n|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=127&n|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=127&n)))))}(T,d)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))}writeSVarint(i){this.writeVarint(i<0?2*-i-1:2*i)}writeBoolean(i){this.writeVarint(+i)}writeString(i){i=String(i),this.realloc(4*i.length),this.pos++;const s=this.pos;this.pos=function(_,T,n){for(let e,r,o=0;o<T.length;o++){if(e=T.charCodeAt(o),e>55295&&e<57344){if(!r){e>56319||o+1===T.length?(_[n++]=239,_[n++]=191,_[n++]=189):r=e;continue}if(e<56320){_[n++]=239,_[n++]=191,_[n++]=189,r=e;continue}e=r-55296<<10|e-56320|65536,r=null}else r&&(_[n++]=239,_[n++]=191,_[n++]=189,r=null);e<128?_[n++]=e:(e<2048?_[n++]=e>>6|192:(e<65536?_[n++]=e>>12|224:(_[n++]=e>>18|240,_[n++]=e>>12&63|128),_[n++]=e>>6&63|128),_[n++]=63&e|128)}return n}(this.buf,i,this.pos);const d=this.pos-s;d>=128&&_a(s,d,this),this.pos=s-1,this.writeVarint(d),this.pos+=d}writeFloat(i){this.realloc(4),this.dataView.setFloat32(this.pos,i,!0),this.pos+=4}writeDouble(i){this.realloc(8),this.dataView.setFloat64(this.pos,i,!0),this.pos+=8}writeBytes(i){const s=i.length;this.writeVarint(s),this.realloc(s);for(let d=0;d<s;d++)this.buf[this.pos++]=i[d]}writeRawMessage(i,s){this.pos++;const d=this.pos;i(s,this);const _=this.pos-d;_>=128&&_a(d,_,this),this.pos=d-1,this.writeVarint(_),this.pos+=_}writeMessage(i,s,d){this.writeTag(i,2),this.writeRawMessage(s,d)}writePackedVarint(i,s){s.length&&this.writeMessage(i,Xf,s)}writePackedSVarint(i,s){s.length&&this.writeMessage(i,Bs,s)}writePackedBoolean(i,s){s.length&&this.writeMessage(i,Wh,s)}writePackedFloat(i,s){s.length&&this.writeMessage(i,gf,s)}writePackedDouble(i,s){s.length&&this.writeMessage(i,yf,s)}writePackedFixed32(i,s){s.length&&this.writeMessage(i,wc,s)}writePackedSFixed32(i,s){s.length&&this.writeMessage(i,zd,s)}writePackedFixed64(i,s){s.length&&this.writeMessage(i,Pd,s)}writePackedSFixed64(i,s){s.length&&this.writeMessage(i,hh,s)}writeBytesField(i,s){this.writeTag(i,2),this.writeBytes(s)}writeFixed32Field(i,s){this.writeTag(i,5),this.writeFixed32(s)}writeSFixed32Field(i,s){this.writeTag(i,5),this.writeSFixed32(s)}writeFixed64Field(i,s){this.writeTag(i,1),this.writeFixed64(s)}writeSFixed64Field(i,s){this.writeTag(i,1),this.writeSFixed64(s)}writeVarintField(i,s){this.writeTag(i,0),this.writeVarint(s)}writeSVarintField(i,s){this.writeTag(i,0),this.writeSVarint(s)}writeStringField(i,s){this.writeTag(i,2),this.writeString(s)}writeFloatField(i,s){this.writeTag(i,5),this.writeFloat(s)}writeDoubleField(i,s){this.writeTag(i,1),this.writeDouble(s)}writeBooleanField(i,s){this.writeVarintField(i,+s)}}function pu(l,i,s){return s?4294967296*i+(l>>>0):4294967296*(i>>>0)+(l>>>0)}function _a(l,i,s){const d=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));s.realloc(d);for(let _=s.pos-1;_>=l;_--)s.buf[_+d]=s.buf[_]}function Xf(l,i){for(let s=0;s<l.length;s++)i.writeVarint(l[s])}function Bs(l,i){for(let s=0;s<l.length;s++)i.writeSVarint(l[s])}function gf(l,i){for(let s=0;s<l.length;s++)i.writeFloat(l[s])}function yf(l,i){for(let s=0;s<l.length;s++)i.writeDouble(l[s])}function Wh(l,i){for(let s=0;s<l.length;s++)i.writeBoolean(l[s])}function wc(l,i){for(let s=0;s<l.length;s++)i.writeFixed32(l[s])}function zd(l,i){for(let s=0;s<l.length;s++)i.writeSFixed32(l[s])}function Pd(l,i){for(let s=0;s<l.length;s++)i.writeFixed64(l[s])}function hh(l,i){for(let s=0;s<l.length;s++)i.writeSFixed64(l[s])}function Id(l,i,s){l===1&&s.readMessage(Yf,i)}function Yf(l,i,s){if(l===3){const{id:d,bitmap:_,width:T,height:n,left:e,top:r,advance:o}=s.readMessage(Ap,{});i.push({id:d,bitmap:new nu({width:T+6,height:n+6},_),metrics:{width:T,height:n,left:e,top:r,advance:o}})}}function Ap(l,i,s){l===1?i.id=s.readVarint():l===2?i.bitmap=s.readBytes():l===3?i.width=s.readVarint():l===4?i.height=s.readVarint():l===5?i.left=s.readSVarint():l===6?i.top=s.readSVarint():l===7&&(i.advance=s.readVarint())}function _f(l){let i=0,s=0;for(const n of l)i+=n.w*n.h,s=Math.max(s,n.w);l.sort((n,e)=>e.h-n.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),s),h:1/0}];let _=0,T=0;for(const n of l)for(let e=d.length-1;e>=0;e--){const r=d[e];if(!(n.w>r.w||n.h>r.h)){if(n.x=r.x,n.y=r.y,T=Math.max(T,n.y+n.h),_=Math.max(_,n.x+n.w),n.w===r.w&&n.h===r.h){const o=d.pop();o&&e<d.length&&(d[e]=o)}else n.h===r.h?(r.x+=n.w,r.w-=n.w):n.w===r.w?(r.y+=n.h,r.h-=n.h):(d.push({x:r.x+n.w,y:r.y,w:r.w-n.w,h:n.h}),r.y+=n.h,r.h-=n.h);break}}return{w:_,h:T,fill:i/(_*T)||0}}class Kh{constructor(i,{pixelRatio:s,version:d,stretchX:_,stretchY:T,content:n,textFitWidth:e,textFitHeight:r}){this.paddedRect=i,this.pixelRatio=s,this.stretchX=_,this.stretchY=T,this.content=n,this.version=d,this.textFitWidth=e,this.textFitHeight=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class xf{constructor(i,s){const d={},_={};this.haveRenderCallbacks=[];const T=[];this.addImages(i,d,T),this.addImages(s,_,T);const{w:n,h:e}=_f(T),r=new In({width:n||1,height:e||1});for(const o in i){const h=i[o],p=d[o].paddedRect;In.copy(h.data,r,{x:0,y:0},{x:p.x+1,y:p.y+1},h.data)}for(const o in s){const h=s[o],p=_[o].paddedRect,g=p.x+1,v=p.y+1,M=h.data.width,A=h.data.height;In.copy(h.data,r,{x:0,y:0},{x:g,y:v},h.data),In.copy(h.data,r,{x:0,y:A-1},{x:g,y:v-1},{width:M,height:1}),In.copy(h.data,r,{x:0,y:0},{x:g,y:v+A},{width:M,height:1}),In.copy(h.data,r,{x:M-1,y:0},{x:g-1,y:v},{width:1,height:A}),In.copy(h.data,r,{x:0,y:0},{x:g+M,y:v},{width:1,height:A})}this.image=r,this.iconPositions=d,this.patternPositions=_}addImages(i,s,d){for(const _ in i){const T=i[_],n={x:0,y:0,w:T.data.width+2,h:T.data.height+2};d.push(n),s[_]=new Kh(n,T),T.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(i,s){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in i.updatedImages)this.patchUpdatedImage(this.iconPositions[d],i.getImage(d),s),this.patchUpdatedImage(this.patternPositions[d],i.getImage(d),s)}patchUpdatedImage(i,s,d){if(!i||!s||i.version===s.version)return;i.version=s.version;const[_,T]=i.tl;d.update(s.data,void 0,{x:_,y:T})}}var mu;At("ImagePosition",Kh),At("ImageAtlas",xf),F.ao=void 0,(mu=F.ao||(F.ao={}))[mu.none=0]="none",mu[mu.horizontal=1]="horizontal",mu[mu.vertical=2]="vertical",mu[mu.horizontalOnly=3]="horizontalOnly";class kd{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(i,s,d){const _=new kd;return _.scale=i||1,_.fontStack=s,_.verticalAlign=d||"bottom",_}static forImage(i,s){const d=new kd;return d.imageName=i,d.verticalAlign=s||"bottom",d}}class dh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,s){const d=new dh;for(let _=0;_<i.sections.length;_++){const T=i.sections[_];T.image?d.addImageSection(T):d.addTextSection(T,s)}return d}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let s="";for(let d=0;d<i.length;d++){const _=i.charCodeAt(d+1)||null,T=i.charCodeAt(d-1)||null;s+=_&&eu(_)&&!Ho[i[d+1]]||T&&eu(T)&&!Ho[i[d-1]]||!Ho[i[d]]?i[d]:Ho[i[d]]}return s}(this.text)}trim(){let i=0;for(let d=0;d<this.text.length&&Sc[this.text.charCodeAt(d)];d++)i++;let s=this.text.length;for(let d=this.text.length-1;d>=0&&d>=i&&Sc[this.text.charCodeAt(d)];d--)s--;this.text=this.text.substring(i,s),this.sectionIndex=this.sectionIndex.slice(i,s)}substring(i,s){const d=new dh;return d.text=this.text.substring(i,s),d.sectionIndex=this.sectionIndex.slice(i,s),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,s)=>Math.max(i,this.sections[s].scale),0)}getMaxImageSize(i){let s=0,d=0;for(let _=0;_<this.length();_++){const T=this.getSection(_);if(T.imageName){const n=i[T.imageName];if(!n)continue;const e=n.displaySize;s=Math.max(s,e[0]),d=Math.max(d,e[1])}}return{maxImageWidth:s,maxImageHeight:d}}addTextSection(i,s){this.text+=i.text,this.sections.push(kd.forText(i.scale,i.fontStack||s,i.verticalAlign));const d=this.sections.length-1;for(let _=0;_<i.text.length;++_)this.sectionIndex.push(d)}addImageSection(i){const s=i.image?i.image.name:"";if(s.length===0)return void Qr("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(kd.forImage(s,i.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Qr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Rd(l,i,s,d,_,T,n,e,r,o,h,p,g,v,M){const A=dh.fromFeature(l,_);let z;p===F.ao.vertical&&A.verticalizePunctuation();const{processBidirectionalText:I,processStyledBidirectionalText:L}=On;if(I&&A.sections.length===1){z=[];const q=I(A.toString(),fh(A,o,T,i,d,v));for(const X of q){const J=new dh;J.text=X,J.sections=A.sections;for(let ue=0;ue<X.length;ue++)J.sectionIndex.push(0);z.push(J)}}else if(L){z=[];const q=L(A.text,A.sectionIndex,fh(A,o,T,i,d,v));for(const X of q){const J=new dh;J.text=X[0],J.sectionIndex=X[1],J.sections=A.sections,z.push(J)}}else z=function(q,X){const J=[],ue=q.text;let le=0;for(const ce of X)J.push(q.substring(le,ce)),le=ce;return le<ue.length&&J.push(q.substring(le,ue.length)),J}(A,fh(A,o,T,i,d,v));const B=[],j={positionedLines:B,text:A.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:p,iconsInText:!1,verticalizable:!1};return function(q,X,J,ue,le,ce,Te,ye,ve,we,Ye,We){let et=0,Ue=0,it=0,tt=0;const Pt=ye==="right"?1:ye==="left"?0:.5,jt=Yr/We;let kt=0;for(const Kt of le){Kt.trim();const li=Kt.getMaxScale(),Fi={positionedGlyphs:[],lineOffset:0};q.positionedLines[kt]=Fi;const Ki=Fi.positionedGlyphs;let Hi=0;if(!Kt.length()){Ue+=ce,++kt;continue}const ji=Qf(ue,Kt,jt);for(let Ct=0;Ct<Kt.length();Ct++){const Vt=Kt.getSection(Ct),Ni=Kt.getSectionIndex(Ct),Vi=Kt.getCharCode(Ct),Qi=Jf(ve,Ye,Vi);let yi;if(Vt.imageName){if(q.iconsInText=!0,Vt.scale=Vt.scale*jt,yi=ep(Vt,Qi,li,ji,ue),!yi)continue;Hi=Math.max(Hi,yi.imageOffset)}else if(yi=Zp(Vt,Vi,Qi,ji,X,J),!yi)continue;const{rect:Wr,metrics:Kr,baselineOffset:hr}=yi;Ki.push({glyph:Vi,imageName:Vt.imageName,x:et,y:Ue+hr+-17,vertical:Qi,scale:Vt.scale,fontStack:Vt.fontStack,sectionIndex:Ni,metrics:Kr,rect:Wr}),Qi?(q.verticalizable=!0,et+=(Vt.imageName?Kr.advance:Yr)*Vt.scale+we):et+=Kr.advance*Vt.scale+we}Ki.length!==0&&(it=Math.max(et-we,it),Ep(Ki,0,Ki.length-1,Pt)),et=0,Fi.lineOffset=Math.max(Hi,(li-1)*Yr);const gi=ce*li+Hi;Ue+=gi,tt=Math.max(gi,tt),++kt}const{horizontalAlign:vt,verticalAlign:Wt}=Ld(Te);(function(Kt,li,Fi,Ki,Hi,ji,gi,Ct,Vt){const Ni=(li-Fi)*Hi;let Vi=0;Vi=ji!==gi?-Ct*Ki- -17:-Ki*Vt*gi+.5*gi;for(const Qi of Kt)for(const yi of Qi.positionedGlyphs)yi.x+=Ni,yi.y+=Vi})(q.positionedLines,Pt,vt,Wt,it,tt,ce,Ue,le.length),q.top+=-Wt*Ue,q.bottom=q.top+Ue,q.left+=-vt*it,q.right=q.left+it}(j,i,s,d,z,n,e,r,p,o,g,M),!function(q){for(const X of q)if(X.positionedGlyphs.length!==0)return!1;return!0}(B)&&j}const Sc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Dd={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Cp={40:!0};function gu(l,i,s,d,_,T){if(i.imageName){const n=d[i.imageName];return n?n.displaySize[0]*i.scale*Yr/T+_:0}{const n=s[i.fontStack],e=n&&n[l];return e?e.metrics.advance*i.scale+_:0}}function vf(l,i,s,d){const _=Math.pow(l-i,2);return d?l<i?_/2:2*_:_+Math.abs(s)*s}function Wf(l,i,s){let d=0;return l===10&&(d-=1e4),s&&(d+=150),l!==40&&l!==65288||(d+=50),i!==41&&i!==65289||(d+=50),d}function Kf(l,i,s,d,_,T){let n=null,e=vf(i,s,_,T);for(const r of d){const o=vf(i-r.x,s,_,T)+r.badness;o<=e&&(n=r,e=o)}return{index:l,x:i,priorBreak:n,badness:e}}function Dl(l){return l?Dl(l.priorBreak).concat(l.index):[]}function fh(l,i,s,d,_,T){if(!l)return[];const n=[],e=function(p,g,v,M,A,z){let I=0;for(let L=0;L<p.length();L++){const B=p.getSection(L);I+=gu(p.getCharCode(L),B,M,A,g,z)}return I/Math.max(1,Math.ceil(I/v))}(l,i,s,d,_,T),r=l.text.indexOf("")>=0;let o=0;for(let p=0;p<l.length();p++){const g=l.getSection(p),v=l.getCharCode(p);if(Sc[v]||(o+=gu(v,g,d,_,i,T)),p<l.length()-1){const M=!((h=v)<11904)&&(!!ki["CJK Compatibility Forms"](h)||!!ki["CJK Compatibility"](h)||!!ki["CJK Strokes"](h)||!!ki["CJK Symbols and Punctuation"](h)||!!ki["Enclosed CJK Letters and Months"](h)||!!ki["Halfwidth and Fullwidth Forms"](h)||!!ki["Ideographic Description Characters"](h)||!!ki["Vertical Forms"](h)||Bo.test(String.fromCodePoint(h)));(Dd[v]||M||g.imageName||p!==l.length()-2&&Cp[l.getCharCode(p+1)])&&n.push(Kf(p+1,o,e,n,Wf(v,l.getCharCode(p+1),M&&r),!1))}}var h;return Dl(Kf(l.length(),o,e,n,0,!0))}function Ld(l){let i=.5,s=.5;switch(l){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:i,verticalAlign:s}}function Qf(l,i,s){const d=i.getMaxScale()*Yr,{maxImageWidth:_,maxImageHeight:T}=i.getMaxImageSize(l),n=Math.max(d,T*s);return{verticalLineContentWidth:Math.max(d,_*s),horizontalLineContentHeight:n}}function Ir(l){switch(l){case"top":return 0;case"center":return .5;default:return 1}}function Jf(l,i,s){return!(l===F.ao.horizontal||!i&&!cc(s)||i&&(Sc[s]||(d=s,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(d)))));var d}function Zp(l,i,s,d,_,T){const n=T[l.fontStack],e=function(o,h,p,g){if(o&&o.rect)return o;const v=h[p.fontStack],M=v&&v[g];return M?{rect:null,metrics:M.metrics}:null}(n&&n[i],_,l,i);if(e===null)return null;let r;if(s)r=d.verticalLineContentWidth-l.scale*Yr;else{const o=Ir(l.verticalAlign);r=(d.horizontalLineContentHeight-l.scale*Yr)*o}return{rect:e.rect,metrics:e.metrics,baselineOffset:r}}function ep(l,i,s,d,_){const T=_[l.imageName];if(!T)return null;const n=T.paddedRect,e=T.displaySize,r={width:e[0],height:e[1],left:1,top:-3,advance:i?e[1]:e[0]};let o;if(i)o=d.verticalLineContentWidth-e[1]*l.scale;else{const h=Ir(l.verticalAlign);o=(d.horizontalLineContentHeight-e[1]*l.scale)*h}return{rect:n,metrics:r,baselineOffset:o,imageOffset:(i?e[0]:e[1])*l.scale-Yr*s}}function Ep(l,i,s,d){if(d===0)return;const _=l[s],T=(l[s].x+_.metrics.advance*_.scale)*d;for(let n=i;n<=s;n++)l[n].x-=T}function bf(l,i,s){const{horizontalAlign:d,verticalAlign:_}=Ld(s),T=i[0]-l.displaySize[0]*d,n=i[1]-l.displaySize[1]*_;return{image:l,top:n,bottom:n+l.displaySize[1],left:T,right:T+l.displaySize[0]}}function tp(l){var i,s;let d=l.left,_=l.top,T=l.right-d,n=l.bottom-_;const e=(i=l.image.textFitWidth)!==null&&i!==void 0?i:"stretchOrShrink",r=(s=l.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",o=(l.image.content[2]-l.image.content[0])/(l.image.content[3]-l.image.content[1]);if(r==="proportional"){if(e==="stretchOnly"&&T/n<o||e==="proportional"){const h=Math.ceil(n*o);d*=h/T,T=h}}else if(e==="proportional"&&r==="stretchOnly"&&o!==0&&T/n>o){const h=Math.ceil(T/o);_*=h/n,n=h}return{x1:d,y1:_,x2:d+T,y2:_+n}}function yu(l,i,s,d,_,T){const n=l.image;let e;if(n.content){const z=n.content,I=n.pixelRatio||1;e=[z[0]/I,z[1]/I,n.displaySize[0]-z[2]/I,n.displaySize[1]-z[3]/I]}const r=i.left*T,o=i.right*T;let h,p,g,v;s==="width"||s==="both"?(v=_[0]+r-d[3],p=_[0]+o+d[1]):(v=_[0]+(r+o-n.displaySize[0])/2,p=v+n.displaySize[0]);const M=i.top*T,A=i.bottom*T;return s==="height"||s==="both"?(h=_[1]+M-d[0],g=_[1]+A+d[2]):(h=_[1]+(M+A-n.displaySize[1])/2,g=h+n.displaySize[1]),{image:n,top:h,right:p,bottom:g,left:v,collisionPadding:e}}const xa=128,Os=32640;function Bd(l,i){const{expression:s}=i;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new rr(l+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:_}=s;let T=0;for(;T<d.length&&d[T]<=l;)T++;T=Math.max(0,T-1);let n=T;for(;n<d.length&&d[n]<l+1;)n++;n=Math.min(d.length-1,n);const e=d[T],r=d[n];return s.kind==="composite"?{kind:"composite",minZoom:e,maxZoom:r,interpolationType:_}:{kind:"camera",minZoom:e,maxZoom:r,minSize:s.evaluate(new rr(e)),maxSize:s.evaluate(new rr(r)),interpolationType:_}}}function Od(l,i,s){let d="never";const _=l.get(i);return _?d=_:l.get(s)&&(d="always"),d}const ph=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sa(l,i,s,d,_,T,n,e,r,o,h,p,g){const v=e?Math.min(Os,Math.round(e[0])):0,M=e?Math.min(Os,Math.round(e[1])):0;l.emplaceBack(i,s,Math.round(32*d),Math.round(32*_),T,n,(v<<1)+(r?1:0),M,16*o,16*h,256*p,256*g)}function Tc(l,i,s){l.emplaceBack(i.x,i.y,s),l.emplaceBack(i.x,i.y,s),l.emplaceBack(i.x,i.y,s),l.emplaceBack(i.x,i.y,s)}function zp(l){for(const i of l.sections)if($u(i.text))return!0;return!1}class Fd{constructor(i){this.layoutVertexArray=new yt,this.indexArray=new yr,this.programConfigurations=i,this.segments=new mi,this.dynamicLayoutVertexArray=new st,this.opacityVertexArray=new Bt,this.hasVisibleVertices=!1,this.placedSymbolArray=new W}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,s,d,_){this.isEmpty()||(d&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,df.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,ff.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,ph,!0),this.opacityVertexBuffer.itemSize=1),(d||_)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}At("SymbolBuffers",Fd);class wf{constructor(i,s,d){this.layoutVertexArray=new i,this.layoutAttributes=s,this.indexArray=new d,this.segments=new mi,this.collisionVertexArray=new Gi}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,pf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}At("CollisionBuffers",wf);class _u{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.globalState=i.globalState,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(n=>n.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bd(this.zoom,s["text-size"]),this.iconSizeData=Bd(this.zoom,s["icon-size"]);const d=this.layers[0].layout,_=d.get("symbol-sort-key"),T=d.get("symbol-z-order");this.canOverlap=Od(d,"text-overlap","text-allow-overlap")!=="never"||Od(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=T!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(T==="viewport-y"||T==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map(n=>F.ao[n])),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.sourceID=i.sourceID}createArrays(){this.text=new Fd(new rn(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Fd(new rn(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new oe,this.lineVertexArray=new he,this.symbolInstances=new ne,this.textAnchorOffsets=new de}calculateGlyphDependencies(i,s,d,_,T){for(let n=0;n<i.length;n++)if(s[i.charCodeAt(n)]=!0,(d||_)&&T){const e=Ho[i.charAt(n)];e&&(s[e.charCodeAt(0)]=!0)}}populate(i,s,d){const _=this.layers[0],T=_.layout,n=T.get("text-font"),e=T.get("text-field"),r=T.get("icon-image"),o=(e.value.kind!=="constant"||e.value.value instanceof Jr&&!e.value.value.isEmpty()||e.value.value.toString().length>0)&&(n.value.kind!=="constant"||n.value.value.length>0),h=r.value.kind!=="constant"||!!r.value.value||Object.keys(r.parameters).length>0,p=T.get("symbol-sort-key");if(this.features=[],!o&&!h)return;const g=s.iconDependencies,v=s.glyphDependencies,M=s.availableImages,A=new rr(this.zoom,{globalState:this.globalState});for(const{feature:z,id:I,index:L,sourceLayerIndex:B}of i){const j=_._featureFilter.needGeometry,q=Ka(z,j);if(!_._featureFilter.filter(A,q,d))continue;let X,J;if(j||(q.geometry=zr(z)),o){const le=_.getValueAndResolveTokens("text-field",q,d,M),ce=Jr.factory(le),Te=this.hasRTLText=this.hasRTLText||zp(ce);(!Te||On.getRTLTextPluginStatus()==="unavailable"||Te&&On.isParsed())&&(X=du(ce,_,q))}if(h){const le=_.getValueAndResolveTokens("icon-image",q,d,M);J=le instanceof An?le:An.fromString(le)}if(!X&&!J)continue;const ue=this.sortFeaturesByKey?p.evaluate(q,{},d):void 0;if(this.features.push({id:I,text:X,icon:J,index:L,sourceLayerIndex:B,geometry:q.geometry,properties:z.properties,type:hu.types[z.type],sortKey:ue}),J&&(g[J.name]=!0),X){const le=n.evaluate(q,{},d).join(","),ce=T.get("text-rotation-alignment")!=="viewport"&&T.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(F.ao.vertical)>=0;for(const Te of X.sections)if(Te.image)g[Te.image.name]=!0;else{const ye=Xa(X.toString()),ve=Te.fontStack||le,we=v[ve]=v[ve]||{};this.calculateGlyphDependencies(Te.text,we,ce,this.allowVerticalPlacement,ye)}}}T.get("symbol-placement")==="line"&&(this.features=function(z){const I={},L={},B=[];let j=0;function q(le){B.push(z[le]),j++}function X(le,ce,Te){const ye=L[le];return delete L[le],L[ce]=ye,B[ye].geometry[0].pop(),B[ye].geometry[0]=B[ye].geometry[0].concat(Te[0]),ye}function J(le,ce,Te){const ye=I[ce];return delete I[ce],I[le]=ye,B[ye].geometry[0].shift(),B[ye].geometry[0]=Te[0].concat(B[ye].geometry[0]),ye}function ue(le,ce,Te){const ye=Te?ce[0][ce[0].length-1]:ce[0][0];return`${le}:${ye.x}:${ye.y}`}for(let le=0;le<z.length;le++){const ce=z[le],Te=ce.geometry,ye=ce.text?ce.text.toString():null;if(!ye){q(le);continue}const ve=ue(ye,Te),we=ue(ye,Te,!0);if(ve in L&&we in I&&L[ve]!==I[we]){const Ye=J(ve,we,Te),We=X(ve,we,B[Ye].geometry);delete I[ve],delete L[we],L[ue(ye,B[We].geometry,!0)]=We,B[Ye].geometry=null}else ve in L?X(ve,we,Te):we in I?J(ve,we,Te):(q(le),I[ve]=j-1,L[we]=j-1)}return B.filter(le=>le.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((z,I)=>z.sortKey-I.sortKey)}update(i,s,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,s,this.layers,{imagePositions:d,globalState:this.globalState}),this.icon.programConfigurations.updatePaintArrays(i,s,this.layers,{imagePositions:d,globalState:this.globalState}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,s){const d=this.lineVertexArray.length;if(i.segment!==void 0){let _=i.dist(s[i.segment+1]),T=i.dist(s[i.segment]);const n={};for(let e=i.segment+1;e<s.length;e++)n[e]={x:s[e].x,y:s[e].y,tileUnitDistanceFromAnchor:_},e<s.length-1&&(_+=s[e+1].dist(s[e]));for(let e=i.segment||0;e>=0;e--)n[e]={x:s[e].x,y:s[e].y,tileUnitDistanceFromAnchor:T},e>0&&(T+=s[e-1].dist(s[e]));for(let e=0;e<s.length;e++){const r=n[e];this.lineVertexArray.emplaceBack(r.x,r.y,r.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(i,s,d,_,T,n,e,r,o,h,p,g){const v=i.indexArray,M=i.layoutVertexArray,A=i.segments.prepareSegment(4*s.length,M,v,this.canOverlap?n.sortKey:void 0),z=this.glyphOffsetArray.length,I=A.vertexLength,L=this.allowVerticalPlacement&&e===F.ao.vertical?Math.PI/2:0,B=n.text&&n.text.sections;for(let j=0;j<s.length;j++){const{tl:q,tr:X,bl:J,br:ue,tex:le,pixelOffsetTL:ce,pixelOffsetBR:Te,minFontScaleX:ye,minFontScaleY:ve,glyphOffset:we,isSDF:Ye,sectionIndex:We}=s[j],et=A.vertexLength,Ue=we[1];sa(M,r.x,r.y,q.x,Ue+q.y,le.x,le.y,d,Ye,ce.x,ce.y,ye,ve),sa(M,r.x,r.y,X.x,Ue+X.y,le.x+le.w,le.y,d,Ye,Te.x,ce.y,ye,ve),sa(M,r.x,r.y,J.x,Ue+J.y,le.x,le.y+le.h,d,Ye,ce.x,Te.y,ye,ve),sa(M,r.x,r.y,ue.x,Ue+ue.y,le.x+le.w,le.y+le.h,d,Ye,Te.x,Te.y,ye,ve),Tc(i.dynamicLayoutVertexArray,r,L),v.emplaceBack(et,et+2,et+1),v.emplaceBack(et+1,et+2,et+3),A.vertexLength+=4,A.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(we[0]),j!==s.length-1&&We===s[j+1].sectionIndex||i.programConfigurations.populatePaintArrays(M.length,n,n.index,{imagePositions:{},canonical:g,formattedSection:B&&B[We],globalState:this.globalState})}i.placedSymbolArray.emplaceBack(r.x,r.y,z,this.glyphOffsetArray.length-z,I,o,h,r.segment,d?d[0]:0,d?d[1]:0,_[0],_[1],e,0,!1,0,p)}_addCollisionDebugVertex(i,s,d,_,T,n){return s.emplaceBack(0,0),i.emplaceBack(d.x,d.y,_,T,Math.round(n.x),Math.round(n.y))}addCollisionDebugVertices(i,s,d,_,T,n,e){const r=T.segments.prepareSegment(4,T.layoutVertexArray,T.indexArray),o=r.vertexLength,h=T.layoutVertexArray,p=T.collisionVertexArray,g=e.anchorX,v=e.anchorY;this._addCollisionDebugVertex(h,p,n,g,v,new se(i,s)),this._addCollisionDebugVertex(h,p,n,g,v,new se(d,s)),this._addCollisionDebugVertex(h,p,n,g,v,new se(d,_)),this._addCollisionDebugVertex(h,p,n,g,v,new se(i,_)),r.vertexLength+=4;const M=T.indexArray;M.emplaceBack(o,o+1),M.emplaceBack(o+1,o+2),M.emplaceBack(o+2,o+3),M.emplaceBack(o+3,o),r.primitiveLength+=4}addDebugCollisionBoxes(i,s,d,_){for(let T=i;T<s;T++){const n=this.collisionBoxArray.get(T);this.addCollisionDebugVertices(n.x1,n.y1,n.x2,n.y2,_?this.textCollisionBox:this.iconCollisionBox,n.anchorPoint,d)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new wf(oi,bc.members,nr),this.iconCollisionBox=new wf(oi,bc.members,nr);for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(i,s,d,_,T,n,e,r,o){const h={};for(let p=s;p<d;p++){const g=i.get(p);h.textBox={x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2,anchorPointX:g.anchorPointX,anchorPointY:g.anchorPointY},h.textFeatureIndex=g.featureIndex;break}for(let p=_;p<T;p++){const g=i.get(p);h.verticalTextBox={x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2,anchorPointX:g.anchorPointX,anchorPointY:g.anchorPointY},h.verticalTextFeatureIndex=g.featureIndex;break}for(let p=n;p<e;p++){const g=i.get(p);h.iconBox={x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2,anchorPointX:g.anchorPointX,anchorPointY:g.anchorPointY},h.iconFeatureIndex=g.featureIndex;break}for(let p=r;p<o;p++){const g=i.get(p);h.verticalIconBox={x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2,anchorPointX:g.anchorPointX,anchorPointY:g.anchorPointY},h.verticalIconFeatureIndex=g.featureIndex;break}return h}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const d=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,s){const d=i.placedSymbolArray.get(s),_=d.vertexStartIndex+4*d.numGlyphs;for(let T=d.vertexStartIndex;T<_;T+=4)i.indexArray.emplaceBack(T,T+2,T+1),i.indexArray.emplaceBack(T+1,T+2,T+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(i),d=Math.cos(i),_=[],T=[],n=[];for(let e=0;e<this.symbolInstances.length;++e){n.push(e);const r=this.symbolInstances.get(e);_.push(0|Math.round(s*r.anchorX+d*r.anchorY)),T.push(r.featureIndex)}return n.sort((e,r)=>_[e]-_[r]||T[r]-T[e]),n}addToSortKeyRanges(i,s){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===s?d.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const d=this.symbolInstances.get(s);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((_,T,n)=>{_>=0&&n.indexOf(_)===T&&this.addIndicesForPlacedSymbol(this.text,_)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ip,rp;At("SymbolBucket",_u,{omit:["layers","collisionBoxArray","features","compareText"]}),_u.MAX_GLYPHS=65535,_u.addDynamicAttributes=Tc;var Qh={get paint(){return rp=rp||new ea({"icon-opacity":new Ht(ke.paint_symbol["icon-opacity"]),"icon-color":new Ht(ke.paint_symbol["icon-color"]),"icon-halo-color":new Ht(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ht(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ht(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new Ot(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ot(ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ht(ke.paint_symbol["text-opacity"]),"text-color":new Ht(ke.paint_symbol["text-color"],{runtimeType:lr,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Ht(ke.paint_symbol["text-halo-color"]),"text-halo-width":new Ht(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new Ht(ke.paint_symbol["text-halo-blur"]),"text-translate":new Ot(ke.paint_symbol["text-translate"]),"text-translate-anchor":new Ot(ke.paint_symbol["text-translate-anchor"])})},get layout(){return ip=ip||new ea({"symbol-placement":new Ot(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new Ot(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ot(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ht(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ot(ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ot(ke.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ot(ke.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ot(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ot(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ot(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ht(ke.layout_symbol["icon-size"]),"icon-text-fit":new Ot(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ot(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ht(ke.layout_symbol["icon-image"]),"icon-rotate":new Ht(ke.layout_symbol["icon-rotate"]),"icon-padding":new Ht(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new Ot(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new Ht(ke.layout_symbol["icon-offset"]),"icon-anchor":new Ht(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ot(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ot(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ot(ke.layout_symbol["text-rotation-alignment"]),"text-field":new Ht(ke.layout_symbol["text-field"]),"text-font":new Ht(ke.layout_symbol["text-font"]),"text-size":new Ht(ke.layout_symbol["text-size"]),"text-max-width":new Ht(ke.layout_symbol["text-max-width"]),"text-line-height":new Ot(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new Ht(ke.layout_symbol["text-letter-spacing"]),"text-justify":new Ht(ke.layout_symbol["text-justify"]),"text-radial-offset":new Ht(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ot(ke.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ht(ke.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ht(ke.layout_symbol["text-anchor"]),"text-max-angle":new Ot(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new Ot(ke.layout_symbol["text-writing-mode"]),"text-rotate":new Ht(ke.layout_symbol["text-rotate"]),"text-padding":new Ot(ke.layout_symbol["text-padding"]),"text-keep-upright":new Ot(ke.layout_symbol["text-keep-upright"]),"text-transform":new Ht(ke.layout_symbol["text-transform"]),"text-offset":new Ht(ke.layout_symbol["text-offset"]),"text-allow-overlap":new Ot(ke.layout_symbol["text-allow-overlap"]),"text-overlap":new Ot(ke.layout_symbol["text-overlap"]),"text-ignore-placement":new Ot(ke.layout_symbol["text-ignore-placement"]),"text-optional":new Ot(ke.layout_symbol["text-optional"])})}};class np{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:dr,this.defaultValue=i}evaluate(i){if(i.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(i.formattedSection))return s.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}At("FormatSectionOverride",np,{omit:["defaultValue"]});class Jh extends pa{constructor(i){super(i,Qh)}recalculate(i,s){if(super.recalculate(i,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const d=this.layout.get("text-writing-mode");if(d){const _=[];for(const T of d)_.indexOf(T)<0&&_.push(T);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,s,d,_){const T=this.layout.get(i).evaluate(s,{},d,_),n=this._unevaluatedLayout._values[i];return n.isDataDriven()||Gn(n.value)||!T?T:function(e,r){return r.replace(/{([^{}]+)}/g,(o,h)=>e&&h in e?String(e[h]):"")}(s.properties,T)}createBucket(i){return new _u(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of Qh.paint.overridableProperties){if(!Jh.hasPaintOverride(this.layout,i))continue;const s=this.paint.get(i),d=new np(s),_=new Zc(d,s.property.specification);let T=null;T=s.value.kind==="constant"||s.value.kind==="source"?new Po("source",_):new gl("composite",_,s.value.zoomStops),this.paint._values[i]=new pr(s.property,T,s.parameters)}}_handleOverridablePaintPropertyUpdate(i,s,d){return!(!this.layout||s.isDataDriven()||d.isDataDriven())&&Jh.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,s){const d=i.get("text-field"),_=Qh.paint.properties[s];let T=!1;const n=e=>{for(const r of e)if(_.overrides&&_.overrides.hasOverride(r))return void(T=!0)};if(d.value.kind==="constant"&&d.value.value instanceof Jr)n(d.value.value.sections);else if(d.value.kind==="source"){const e=o=>{T||(o instanceof Ua&&ii(o.value)===Vn?n(o.value.sections):o instanceof bo?n(o.sections):o.eachChild(e))},r=d.value;r._styleExpression&&e(r._styleExpression.expression)}return T}}let ap;var Sf={get paint(){return ap=ap||new ea({"background-color":new Ot(ke.paint_background["background-color"]),"background-pattern":new Ya(ke.paint_background["background-pattern"]),"background-opacity":new Ot(ke.paint_background["background-opacity"])})}};class Mc extends pa{constructor(i){super(i,Sf)}}let sp;var Pp={get paint(){return sp=sp||new ea({"raster-opacity":new Ot(ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ot(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ot(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ot(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new Ot(ke.paint_raster["raster-saturation"]),"raster-contrast":new Ot(ke.paint_raster["raster-contrast"]),"raster-resampling":new Ot(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new Ot(ke.paint_raster["raster-fade-duration"])})}};class mh extends pa{constructor(i){super(i,Pp)}}class op extends pa{constructor(i){super(i,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class lp{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const $i={once:!0},va=63710088e-1;class es{constructor(i,s){if(isNaN(i)||isNaN(s))throw new Error(`Invalid LngLat object: (${i}, ${s})`);if(this.lng=+i,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new es(Di(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const s=Math.PI/180,d=this.lat*s,_=i.lat*s,T=Math.sin(d)*Math.sin(_)+Math.cos(d)*Math.cos(_)*Math.cos((i.lng-this.lng)*s);return va*Math.acos(Math.min(T,1))}static convert(i){if(i instanceof es)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new es(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new es(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Tf=2*Math.PI*va;function jd(l){return Tf*Math.cos(l*Math.PI/180)}function Nd(l){return(180+l)/360}function gh(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function ed(l,i){return l/jd(i)}function Ac(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Mf(l,i){return l*jd(Ac(i))}class Vd{constructor(i,s,d=0){this.x=+i,this.y=+s,this.z=+d}static fromLngLat(i,s=0){const d=es.convert(i);return new Vd(Nd(d.lng),gh(d.lat),ed(s,d.lat))}toLngLat(){return new es(360*this.x-180,Ac(this.y))}toAltitude(){return Mf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Tf*(i=Ac(this.y),1/Math.cos(i*Math.PI/180));var i}}function Ip(l,i,s){var d=2*Math.PI*6378137/256/Math.pow(2,s);return[l*d-2*Math.PI*6378137/2,i*d-2*Math.PI*6378137/2]}class Af{constructor(i,s,d){if(!function(_,T,n){return!(_<0||_>25||n<0||n>=Math.pow(2,_)||T<0||T>=Math.pow(2,_))}(i,s,d))throw new Error(`x=${s}, y=${d}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=s,this.y=d,this.key=ur(0,i,i,s,d)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,s,d){const _=(n=this.y,e=this.z,r=Ip(256*(T=this.x),256*(n=Math.pow(2,e)-n-1),e),o=Ip(256*(T+1),256*(n+1),e),r[0]+","+r[1]+","+o[0]+","+o[1]);var T,n,e,r,o;const h=function(p,g,v){let M,A="";for(let z=p;z>0;z--)M=1<<z-1,A+=(g&M?1:0)+(v&M?2:0);return A}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,h).replace(/{bbox-epsg-3857}/g,_)}isChildOf(i){const s=this.z-i.z;return s>0&&i.x===this.x>>s&&i.y===this.y>>s}getTilePoint(i){const s=Math.pow(2,this.z);return new se((i.x*s-this.x)*_t,(i.y*s-this.y)*_t)}toString(){return`${this.z}/${this.x}/${this.y}`}}class cp{constructor(i,s){this.wrap=i,this.canonical=s,this.key=ur(i,s.z,s.z,s.x,s.y)}}class Da{constructor(i,s,d,_,T){if(this.terrainRttPosMatrix32f=null,i<d)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${d}`);this.overscaledZ=i,this.wrap=s,this.canonical=new Af(d,+_,+T),this.key=ur(s,i,d,_,T)}clone(){return new Da(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-i;return i>this.canonical.z?new Da(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Da(i,this.wrap,i,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(i,s){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-i;return i>this.canonical.z?ur(this.wrap*+s,i,this.canonical.z,this.canonical.x,this.canonical.y):ur(this.wrap*+s,i,i,this.canonical.x>>d,this.canonical.y>>d)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const s=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>s&&i.canonical.y===this.canonical.y>>s}children(i){if(this.overscaledZ>=i)return[new Da(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,d=2*this.canonical.x,_=2*this.canonical.y;return[new Da(s,this.wrap,s,d,_),new Da(s,this.wrap,s,d+1,_),new Da(s,this.wrap,s,d,_+1),new Da(s,this.wrap,s,d+1,_+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Da(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Da(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new cp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new Vd(i.x-this.wrap,i.y))}}function ur(l,i,s,d,_){(l*=2)<0&&(l=-1*l-1);const T=1<<s;return(T*T*l+T*_+d).toString(36)+s.toString(36)+i.toString(36)}function yh(l,i){return i?l.properties[i]:l.id}At("CanonicalTileID",Af),At("OverscaledTileID",Da,{omit:["terrainRttPosMatrix32f"]});class xn{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(i){return this.minX=Math.min(this.minX,i.x),this.minY=Math.min(this.minY,i.y),this.maxX=Math.max(this.maxX,i.x),this.maxY=Math.max(this.maxY,i.y),this}expandBy(i){return this.minX-=i,this.minY-=i,this.maxX+=i,this.maxY+=i,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(i){return this.expandBy(-i)}map(i){const s=new xn;return s.extend(i(new se(this.minX,this.minY))),s.extend(i(new se(this.maxX,this.minY))),s.extend(i(new se(this.minX,this.maxY))),s.extend(i(new se(this.maxX,this.maxY))),s}static fromPoints(i){const s=new xn;for(const d of i)s.extend(d);return s}contains(i){return i.x>=this.minX&&i.x<=this.maxX&&i.y>=this.minY&&i.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(i){return!this.empty()&&!i.empty()&&i.minX>=this.minX&&i.maxX<=this.maxX&&i.minY>=this.minY&&i.maxY<=this.maxY}intersects(i){return!this.empty()&&!i.empty()&&i.minX<=this.maxX&&i.maxX>=this.minX&&i.minY<=this.maxY&&i.maxY>=this.minY}}class Cf{constructor(i){this._stringToNumber={},this._numberToString=[];for(let s=0;s<i.length;s++){const d=i[s];this._stringToNumber[d]=s,this._numberToString[s]=d}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class Ud{constructor(i,s,d,_,T){this.type="Feature",this._vectorTileFeature=i,i._z=s,i._x=d,i._y=_,this.properties=i.properties,this.id=T}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(i[s]=this[s]);return i}}class Ef{constructor(i,s){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Js(_t,16,0),this.grid3D=new Js(_t,16,0),this.featureIndexArray=new Me,this.promoteId=s}insert(i,s,d,_,T,n){const e=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,_,T);const r=n?this.grid3D:this.grid;for(let o=0;o<s.length;o++){const h=s[o],p=[1/0,1/0,-1/0,-1/0];for(let g=0;g<h.length;g++){const v=h[g];p[0]=Math.min(p[0],v.x),p[1]=Math.min(p[1],v.y),p[2]=Math.max(p[2],v.x),p[3]=Math.max(p[3],v.y)}p[0]<_t&&p[1]<_t&&p[2]>=0&&p[3]>=0&&r.insert(e,p[0],p[1],p[2],p[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Hf(new fu(this.rawTileData)).layers,this.sourceLayerCoder=new Cf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,s,d,_){this.loadVTLayers();const T=i.params,n=_t/i.tileSize/i.scale,e=ko(T.filter),r=i.queryGeometry,o=i.queryPadding*n,h=xn.fromPoints(r),p=this.grid.query(h.minX-o,h.minY-o,h.maxX+o,h.maxY+o),g=xn.fromPoints(i.cameraQueryGeometry).expandBy(o),v=this.grid3D.query(g.minX,g.minY,g.maxX,g.maxY,(z,I,L,B)=>function(j,q,X,J,ue){for(const ce of j)if(q<=ce.x&&X<=ce.y&&J>=ce.x&&ue>=ce.y)return!0;const le=[new se(q,X),new se(q,ue),new se(J,ue),new se(J,X)];if(j.length>2){for(const ce of le)if(Yu(j,ce))return!0}for(let ce=0;ce<j.length-1;ce++)if(_p(j[ce],j[ce+1],le))return!0;return!1}(i.cameraQueryGeometry,z-o,I-o,L+o,B+o));for(const z of v)p.push(z);p.sort(up);const M={};let A;for(let z=0;z<p.length;z++){const I=p[z];if(I===A)continue;A=I;const L=this.featureIndexArray.get(I);let B=null;this.loadMatchingFeature(M,L.bucketIndex,L.sourceLayerIndex,L.featureIndex,e,T.layers,T.availableImages,s,d,_,(j,q,X)=>(B||(B=zr(j)),q.queryIntersectsFeature({queryGeometry:r,feature:j,featureState:X,geometry:B,zoom:this.z,transform:i.transform,pixelsToTileUnits:n,pixelPosMatrix:i.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:i.getElevation})))}return M}loadMatchingFeature(i,s,d,_,T,n,e,r,o,h,p){const g=this.bucketLayerIDs[s];if(n&&!g.some(z=>n.has(z)))return;const v=this.sourceLayerCoder.decode(d),M=this.vtLayers[v].feature(_);if(T.needGeometry){const z=Ka(M,!0);if(!T.filter(new rr(this.tileID.overscaledZ),z,this.tileID.canonical))return}else if(!T.filter(new rr(this.tileID.overscaledZ),M))return;const A=this.getId(M,v);for(let z=0;z<g.length;z++){const I=g[z];if(n&&!n.has(I))continue;const L=r[I];if(!L)continue;let B={};A&&h&&(B=h.getState(L.sourceLayer||"_geojsonTileLayer",A));const j=Ei({},o[I]);j.paint=Gd(j.paint,L.paint,M,B,e),j.layout=Gd(j.layout,L.layout,M,B,e);const q=!p||p(M,L,B);if(!q)continue;const X=new Ud(M,this.z,this.x,this.y,A);X.layer=j;let J=i[I];J===void 0&&(J=i[I]=[]),J.push({featureIndex:_,feature:X,intersectionZ:q})}}lookupSymbolFeatures(i,s,d,_,T,n,e,r){const o={};this.loadVTLayers();const h=ko(T);for(const p of i)this.loadMatchingFeature(o,d,_,p,h,n,e,r,s);return o}hasLayer(i){for(const s of this.bucketLayerIDs)for(const d of s)if(i===d)return!0;return!1}getId(i,s){var d;let _=i.id;return this.promoteId&&(_=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof _=="boolean"&&(_=Number(_)),_===void 0&&(!((d=i.properties)===null||d===void 0)&&d.cluster)&&this.promoteId&&(_=Number(i.properties.cluster_id))),_}}function Gd(l,i,s,d,_){return jn(l,(T,n)=>{const e=i instanceof wl?i.get(n):null;return e&&e.evaluate?e.evaluate(s,d,_):e})}function up(l,i){return i-l}function qd(l,i,s,d,_){const T=[];for(let n=0;n<l.length;n++){const e=l[n];let r;for(let o=0;o<e.length-1;o++){let h=e[o],p=e[o+1];h.x<i&&p.x<i||(h.x<i?h=new se(i,h.y+(i-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x<i&&(p=new se(i,h.y+(i-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y<s&&p.y<s||(h.y<s?h=new se(h.x+(s-h.y)/(p.y-h.y)*(p.x-h.x),s)._round():p.y<s&&(p=new se(h.x+(s-h.y)/(p.y-h.y)*(p.x-h.x),s)._round()),h.x>=d&&p.x>=d||(h.x>=d?h=new se(d,h.y+(d-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x>=d&&(p=new se(d,h.y+(d-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y>=_&&p.y>=_||(h.y>=_?h=new se(h.x+(_-h.y)/(p.y-h.y)*(p.x-h.x),_)._round():p.y>=_&&(p=new se(h.x+(_-h.y)/(p.y-h.y)*(p.x-h.x),_)._round()),r&&h.equals(r[r.length-1])||(r=[h],T.push(r)),r.push(p)))))}}return T}At("FeatureIndex",Ef,{omit:["rawTileData","sourceLayerCoder"]});class co extends se{constructor(i,s,d,_){super(i,s),this.angle=d,_!==void 0&&(this.segment=_)}clone(){return new co(this.x,this.y,this.angle,this.segment)}}function Zd(l,i,s,d,_){if(i.segment===void 0||s===0)return!0;let T=i,n=i.segment+1,e=0;for(;e>-s/2;){if(n--,n<0)return!1;e-=l[n].dist(T),T=l[n]}e+=l[n].dist(l[n+1]),n++;const r=[];let o=0;for(;e<s/2;){const h=l[n],p=l[n+1];if(!p)return!1;let g=l[n-1].angleTo(h)-h.angleTo(p);for(g=Math.abs((g+3*Math.PI)%(2*Math.PI)-Math.PI),r.push({distance:e,angleDelta:g}),o+=g;e-r[0].distance>d;)o-=r.shift().angleDelta;if(o>_)return!1;n++,e+=h.dist(p)}return!0}function td(l){let i=0;for(let s=0;s<l.length-1;s++)i+=l[s].dist(l[s+1]);return i}function $d(l,i,s){return l?.6*i*s:0}function hp(l,i){return Math.max(l?l.right-l.left:0,i?i.right-i.left:0)}function kp(l,i,s,d,_,T){const n=$d(s,_,T),e=hp(s,d)*T;let r=0;const o=td(l)/2;for(let h=0;h<l.length-1;h++){const p=l[h],g=l[h+1],v=p.dist(g);if(r+v>o){const M=(o-r)/v,A=As.number(p.x,g.x,M),z=As.number(p.y,g.y,M),I=new co(A,z,g.angleTo(p),h);return I._round(),!n||Zd(l,I,e,n,i)?I:void 0}r+=v}}function Rp(l,i,s,d,_,T,n,e,r){const o=$d(d,T,n),h=hp(d,_),p=h*n,g=l[0].x===0||l[0].x===r||l[0].y===0||l[0].y===r;return i-p<i/4&&(i=p+i/4),zf(l,g?i/2*e%i:(h/2+2*T)*n*e%i,i,o,s,p,g,!1,r)}function zf(l,i,s,d,_,T,n,e,r){const o=T/2,h=td(l);let p=0,g=i-s,v=[];for(let M=0;M<l.length-1;M++){const A=l[M],z=l[M+1],I=A.dist(z),L=z.angleTo(A);for(;g+s<p+I;){g+=s;const B=(g-p)/I,j=As.number(A.x,z.x,B),q=As.number(A.y,z.y,B);if(j>=0&&j<r&&q>=0&&q<r&&g-o>=0&&g+o<=h){const X=new co(j,q,L,M);X._round(),d&&!Zd(l,X,T,d,_)||v.push(X)}}p+=I}return e||v.length||n||(v=zf(l,p/2,s,d,_,T,n,!0,r)),v}function Cc(l,i,s,d){const _=[],T=l.image,n=T.pixelRatio,e=T.paddedRect.w-2,r=T.paddedRect.h-2;let o={x1:l.left,y1:l.top,x2:l.right,y2:l.bottom};const h=T.stretchX||[[0,e]],p=T.stretchY||[[0,r]],g=(we,Ye)=>we+Ye[1]-Ye[0],v=h.reduce(g,0),M=p.reduce(g,0),A=e-v,z=r-M;let I=0,L=v,B=0,j=M,q=0,X=A,J=0,ue=z;if(T.content&&d){const we=T.content,Ye=we[2]-we[0],We=we[3]-we[1];(T.textFitWidth||T.textFitHeight)&&(o=tp(l)),I=id(h,0,we[0]),B=id(p,0,we[1]),L=id(h,we[0],we[2]),j=id(p,we[1],we[3]),q=we[0]-I,J=we[1]-B,X=Ye-L,ue=We-j}const le=o.x1,ce=o.y1,Te=o.x2-le,ye=o.y2-ce,ve=(we,Ye,We,et)=>{const Ue=_h(we.stretch-I,L,Te,le),it=xh(we.fixed-q,X,we.stretch,v),tt=_h(Ye.stretch-B,j,ye,ce),Pt=xh(Ye.fixed-J,ue,Ye.stretch,M),jt=_h(We.stretch-I,L,Te,le),kt=xh(We.fixed-q,X,We.stretch,v),vt=_h(et.stretch-B,j,ye,ce),Wt=xh(et.fixed-J,ue,et.stretch,M),Kt=new se(Ue,tt),li=new se(jt,tt),Fi=new se(jt,vt),Ki=new se(Ue,vt),Hi=new se(it/n,Pt/n),ji=new se(kt/n,Wt/n),gi=i*Math.PI/180;if(gi){const Ni=Math.sin(gi),Vi=Math.cos(gi),Qi=[Vi,-Ni,Ni,Vi];Kt._matMult(Qi),li._matMult(Qi),Ki._matMult(Qi),Fi._matMult(Qi)}const Ct=we.stretch+we.fixed,Vt=Ye.stretch+Ye.fixed;return{tl:Kt,tr:li,bl:Ki,br:Fi,tex:{x:T.paddedRect.x+1+Ct,y:T.paddedRect.y+1+Vt,w:We.stretch+We.fixed-Ct,h:et.stretch+et.fixed-Vt},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Hi,pixelOffsetBR:ji,minFontScaleX:X/n/Te,minFontScaleY:ue/n/ye,isSDF:s}};if(d&&(T.stretchX||T.stretchY)){const we=Hd(h,A,v),Ye=Hd(p,z,M);for(let We=0;We<we.length-1;We++){const et=we[We],Ue=we[We+1];for(let it=0;it<Ye.length-1;it++)_.push(ve(et,Ye[it],Ue,Ye[it+1]))}}else _.push(ve({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:e+1},{fixed:0,stretch:r+1}));return _}function id(l,i,s){let d=0;for(const _ of l)d+=Math.max(i,Math.min(s,_[1]))-Math.max(i,Math.min(s,_[0]));return d}function Hd(l,i,s){const d=[{fixed:-1,stretch:0}];for(const[_,T]of l){const n=d[d.length-1];d.push({fixed:_-n.stretch,stretch:n.stretch}),d.push({fixed:_-n.stretch,stretch:n.stretch+(T-_)})}return d.push({fixed:i+1,stretch:s}),d}function _h(l,i,s,d){return l/i*s+d}function xh(l,i,s,d){return l-i*s/d}At("Anchor",co);class rd{constructor(i,s,d,_,T,n,e,r,o,h){var p;if(this.boxStartIndex=i.length,o){let g=n.top,v=n.bottom;const M=n.collisionPadding;M&&(g-=M[1],v+=M[3]);let A=v-g;A>0&&(A=Math.max(10,A),this.circleDiameter=A)}else{const g=!((p=n.image)===null||p===void 0)&&p.content&&(n.image.textFitWidth||n.image.textFitHeight)?tp(n):{x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};g.y1=g.y1*e-r[0],g.y2=g.y2*e+r[2],g.x1=g.x1*e-r[3],g.x2=g.x2*e+r[1];const v=n.collisionPadding;if(v&&(g.x1-=v[0]*e,g.y1-=v[1]*e,g.x2+=v[2]*e,g.y2+=v[3]*e),h){const M=new se(g.x1,g.y1),A=new se(g.x2,g.y1),z=new se(g.x1,g.y2),I=new se(g.x2,g.y2),L=h*Math.PI/180;M._rotate(L),A._rotate(L),z._rotate(L),I._rotate(L),g.x1=Math.min(M.x,A.x,z.x,I.x),g.x2=Math.max(M.x,A.x,z.x,I.x),g.y1=Math.min(M.y,A.y,z.y,I.y),g.y2=Math.max(M.y,A.y,z.y,I.y)}i.emplaceBack(s.x,s.y,g.x1,g.y1,g.x2,g.y2,d,_,T)}this.boxEndIndex=i.length}}class dp{constructor(i=[],s=(d,_)=>d<_?-1:d>_?1:0){if(this.data=i,this.length=this.data.length,this.compare=s,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:s,compare:d}=this,_=s[i];for(;i>0;){const T=i-1>>1,n=s[T];if(d(_,n)>=0)break;s[i]=n,i=T}s[i]=_}_down(i){const{data:s,compare:d}=this,_=this.length>>1,T=s[i];for(;i<_;){let n=1+(i<<1);const e=n+1;if(e<this.length&&d(s[e],s[n])<0&&(n=e),d(s[n],T)>=0)break;s[i]=s[n],i=n}s[i]=T}}function Yo(l,i=1,s=!1){const d=xn.fromPoints(l[0]),_=Math.min(d.width(),d.height());let T=_/2;const n=new dp([],vh),{minX:e,minY:r,maxX:o,maxY:h}=d;if(_===0)return new se(e,r);for(let v=e;v<o;v+=_)for(let M=r;M<h;M+=_)n.push(new Ll(v+T,M+T,T,l));let p=function(v){let M=0,A=0,z=0;const I=v[0];for(let L=0,B=I.length,j=B-1;L<B;j=L++){const q=I[L],X=I[j],J=q.x*X.y-X.x*q.y;A+=(q.x+X.x)*J,z+=(q.y+X.y)*J,M+=3*J}return new Ll(A/M,z/M,0,v)}(l),g=n.length;for(;n.length;){const v=n.pop();(v.d>p.d||!p.d)&&(p=v,s&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,g)),v.max-p.d<=i||(T=v.h/2,n.push(new Ll(v.p.x-T,v.p.y-T,T,l)),n.push(new Ll(v.p.x+T,v.p.y-T,T,l)),n.push(new Ll(v.p.x-T,v.p.y+T,T,l)),n.push(new Ll(v.p.x+T,v.p.y+T,T,l)),g+=4)}return s&&(console.log(`num probes: ${g}`),console.log(`best distance: ${p.d}`)),p.p}function vh(l,i){return i.max-l.max}function Ll(l,i,s,d){this.p=new se(l,i),this.h=s,this.d=function(_,T){let n=!1,e=1/0;for(let r=0;r<T.length;r++){const o=T[r];for(let h=0,p=o.length,g=p-1;h<p;g=h++){const v=o[h],M=o[g];v.y>_.y!=M.y>_.y&&_.x<(M.x-v.x)*(_.y-v.y)/(M.y-v.y)+v.x&&(n=!n),e=Math.min(e,Nf(_,v,M))}}return(n?1:-1)*Math.sqrt(e)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}var Rn;F.aE=void 0,(Rn=F.aE||(F.aE={}))[Rn.center=1]="center",Rn[Rn.left=2]="left",Rn[Rn.right=3]="right",Rn[Rn.top=4]="top",Rn[Rn.bottom=5]="bottom",Rn[Rn["top-left"]=6]="top-left",Rn[Rn["top-right"]=7]="top-right",Rn[Rn["bottom-left"]=8]="bottom-left",Rn[Rn["bottom-right"]=9]="bottom-right";const xu=Number.POSITIVE_INFINITY;function ts(l,i){return i[1]!==xu?function(s,d,_){let T=0,n=0;switch(d=Math.abs(d),_=Math.abs(_),s){case"top-right":case"top-left":case"top":n=_-7;break;case"bottom-right":case"bottom-left":case"bottom":n=7-_}switch(s){case"top-right":case"bottom-right":case"right":T=-d;break;case"top-left":case"bottom-left":case"left":T=d}return[T,n]}(l,i[0],i[1]):function(s,d){let _=0,T=0;d<0&&(d=0);const n=d/Math.SQRT2;switch(s){case"top-right":case"top-left":T=n-7;break;case"bottom-right":case"bottom-left":T=7-n;break;case"bottom":T=7-d;break;case"top":T=d-7}switch(s){case"top-right":case"bottom-right":_=-n;break;case"top-left":case"bottom-left":_=n;break;case"left":_=d;break;case"right":_=-d}return[_,T]}(l,i[0])}function Xd(l,i,s){var d;const _=l.layout,T=(d=_.get("text-variable-anchor-offset"))===null||d===void 0?void 0:d.evaluate(i,{},s);if(T){const e=T.values,r=[];for(let o=0;o<e.length;o+=2){const h=r[o]=e[o],p=e[o+1].map(g=>g*Yr);h.startsWith("top")?p[1]-=7:h.startsWith("bottom")&&(p[1]+=7),r[o+1]=p}return new Dn(r)}const n=_.get("text-variable-anchor");if(n){let e;e=l._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(i,{},s)*Yr,xu]:_.get("text-offset").evaluate(i,{},s).map(o=>o*Yr);const r=[];for(const o of n)r.push(o,ts(o,e));return new Dn(r)}return null}function bh(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Bl(l,i,s,d,_,T,n,e,r,o,h,p){let g=T.textMaxSize.evaluate(i,{});g===void 0&&(g=n);const v=l.layers[0].layout,M=v.get("icon-offset").evaluate(i,{},h),A=Dp(s.horizontal),z=n/24,I=l.tilePixelRatio*z,L=l.tilePixelRatio*g/24,B=l.tilePixelRatio*e,j=l.tilePixelRatio*v.get("symbol-spacing"),q=v.get("text-padding")*l.tilePixelRatio,X=function(We,et,Ue,it=1){const tt=We.get("icon-padding").evaluate(et,{},Ue),Pt=tt&&tt.values;return[Pt[0]*it,Pt[1]*it,Pt[2]*it,Pt[3]*it]}(v,i,h,l.tilePixelRatio),J=v.get("text-max-angle")/180*Math.PI,ue=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point",le=v.get("icon-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point",ce=v.get("symbol-placement"),Te=j/2,ye=v.get("icon-text-fit");let ve;d&&ye!=="none"&&(l.allowVerticalPlacement&&s.vertical&&(ve=yu(d,s.vertical,ye,v.get("icon-text-fit-padding"),M,z)),A&&(d=yu(d,A,ye,v.get("icon-text-fit-padding"),M,z)));const we=h?p.line.getGranularityForZoomLevel(h.z):1,Ye=(We,et)=>{et.x<0||et.x>=_t||et.y<0||et.y>=_t||function(Ue,it,tt,Pt,jt,kt,vt,Wt,Kt,li,Fi,Ki,Hi,ji,gi,Ct,Vt,Ni,Vi,Qi,yi,Wr,Kr,hr,a){const u=Ue.addToLineVertexArray(it,tt);let m,w,E,R,Y=0,te=0,be=0,Ge=0,nt=-1,lt=-1;const Xe={};let Ke=ys("");if(Ue.allowVerticalPlacement&&Pt.vertical){const an=Wt.layout.get("text-rotate").evaluate(yi,{},hr)+90;E=new rd(Kt,it,li,Fi,Ki,Pt.vertical,Hi,ji,gi,an),vt&&(R=new rd(Kt,it,li,Fi,Ki,vt,Vt,Ni,gi,an))}if(jt){const an=Wt.layout.get("icon-rotate").evaluate(yi,{}),ws=Wt.layout.get("icon-text-fit")!=="none",od=Cc(jt,an,Kr,ws),Ec=vt?Cc(vt,an,Kr,ws):void 0;w=new rd(Kt,it,li,Fi,Ki,jt,Vt,Ni,!1,an),Y=4*od.length;const Kd=Ue.iconSizeData;let wu=null;Kd.kind==="source"?(wu=[xa*Wt.layout.get("icon-size").evaluate(yi,{})],wu[0]>Os&&Qr(`${Ue.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Kd.kind==="composite"&&(wu=[xa*Wr.compositeIconSizes[0].evaluate(yi,{},hr),xa*Wr.compositeIconSizes[1].evaluate(yi,{},hr)],(wu[0]>Os||wu[1]>Os)&&Qr(`${Ue.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ue.addSymbols(Ue.icon,od,wu,Qi,Vi,yi,F.ao.none,it,u.lineStartIndex,u.lineLength,-1,hr),nt=Ue.icon.placedSymbolArray.length-1,Ec&&(te=4*Ec.length,Ue.addSymbols(Ue.icon,Ec,wu,Qi,Vi,yi,F.ao.vertical,it,u.lineStartIndex,u.lineLength,-1,hr),lt=Ue.icon.placedSymbolArray.length-1)}const _i=Object.keys(Pt.horizontal);for(const an of _i){const ws=Pt.horizontal[an];if(!m){Ke=ys(ws.text);const Ec=Wt.layout.get("text-rotate").evaluate(yi,{},hr);m=new rd(Kt,it,li,Fi,Ki,ws,Hi,ji,gi,Ec)}const od=ws.positionedLines.length===1;if(be+=Ol(Ue,it,ws,kt,Wt,gi,yi,Ct,u,Pt.vertical?F.ao.horizontal:F.ao.horizontalOnly,od?_i:[an],Xe,nt,Wr,hr),od)break}Pt.vertical&&(Ge+=Ol(Ue,it,Pt.vertical,kt,Wt,gi,yi,Ct,u,F.ao.vertical,["vertical"],Xe,lt,Wr,hr));const fi=m?m.boxStartIndex:Ue.collisionBoxArray.length,Mr=m?m.boxEndIndex:Ue.collisionBoxArray.length,Oe=E?E.boxStartIndex:Ue.collisionBoxArray.length,Ie=E?E.boxEndIndex:Ue.collisionBoxArray.length,qe=w?w.boxStartIndex:Ue.collisionBoxArray.length,ct=w?w.boxEndIndex:Ue.collisionBoxArray.length,Xt=R?R.boxStartIndex:Ue.collisionBoxArray.length,Zi=R?R.boxEndIndex:Ue.collisionBoxArray.length;let qt=-1;const ci=(an,ws)=>an&&an.circleDiameter?Math.max(an.circleDiameter,ws):ws;qt=ci(m,qt),qt=ci(E,qt),qt=ci(w,qt),qt=ci(R,qt);const $n=qt>-1?1:0;$n&&(qt*=a/Yr),Ue.glyphOffsetArray.length>=_u.MAX_GLYPHS&&Qr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yi.sortKey!==void 0&&Ue.addToSortKeyRanges(Ue.symbolInstances.length,yi.sortKey);const vr=Xd(Wt,yi,hr),[bu,$p]=function(an,ws){const od=an.length,Ec=ws==null?void 0:ws.values;if((Ec==null?void 0:Ec.length)>0)for(let Kd=0;Kd<Ec.length;Kd+=2){const wu=Ec[Kd+1];an.emplaceBack(F.aE[Ec[Kd]],wu[0],wu[1])}return[od,an.length]}(Ue.textAnchorOffsets,vr);Ue.symbolInstances.emplaceBack(it.x,it.y,Xe.right>=0?Xe.right:-1,Xe.center>=0?Xe.center:-1,Xe.left>=0?Xe.left:-1,Xe.vertical||-1,nt,lt,Ke,fi,Mr,Oe,Ie,qe,ct,Xt,Zi,li,be,Ge,Y,te,$n,0,Hi,qt,bu,$p)}(l,et,We,s,d,_,ve,l.layers[0],l.collisionBoxArray,i.index,i.sourceLayerIndex,l.index,I,[q,q,q,q],ue,r,B,X,le,M,i,T,o,h,n)};if(ce==="line")for(const We of qd(i.geometry,0,0,_t,_t)){const et=mc(We,we),Ue=Rp(et,j,J,s.vertical||A,d,24,L,l.overscaling,_t);for(const it of Ue)A&&wh(l,A.text,Te,it)||Ye(et,it)}else if(ce==="line-center"){for(const We of i.geometry)if(We.length>1){const et=mc(We,we),Ue=kp(et,J,s.vertical||A,d,24,L);Ue&&Ye(et,Ue)}}else if(i.type==="Polygon")for(const We of To(i.geometry,0)){const et=Yo(We,16);Ye(mc(We[0],we,!0),new co(et.x,et.y,0))}else if(i.type==="LineString")for(const We of i.geometry){const et=mc(We,we);Ye(et,new co(et[0].x,et[0].y,0))}else if(i.type==="Point")for(const We of i.geometry)for(const et of We)Ye([et],new co(et.x,et.y,0))}function Ol(l,i,s,d,_,T,n,e,r,o,h,p,g,v,M){const A=function(L,B,j,q,X,J,ue,le){const ce=q.layout.get("text-rotate").evaluate(J,{})*Math.PI/180,Te=[];for(const ye of B.positionedLines)for(const ve of ye.positionedGlyphs){if(!ve.rect)continue;const we=ve.rect||{};let Ye=4,We=!0,et=1,Ue=0;const it=(X||le)&&ve.vertical,tt=ve.metrics.advance*ve.scale/2;if(le&&B.verticalizable&&(Ue=ye.lineOffset/2-(ve.imageName?-(Yr-ve.metrics.width*ve.scale)/2:(ve.scale-1)*Yr)),ve.imageName){const Ni=ue[ve.imageName];We=Ni.sdf,et=Ni.pixelRatio,Ye=1/et}const Pt=X?[ve.x+tt,ve.y]:[0,0];let jt=X?[0,0]:[ve.x+tt+j[0],ve.y+j[1]-Ue],kt=[0,0];it&&(kt=jt,jt=[0,0]);const vt=ve.metrics.isDoubleResolution?2:1,Wt=(ve.metrics.left-Ye)*ve.scale-tt+jt[0],Kt=(-ve.metrics.top-Ye)*ve.scale+jt[1],li=Wt+we.w/vt*ve.scale/et,Fi=Kt+we.h/vt*ve.scale/et,Ki=new se(Wt,Kt),Hi=new se(li,Kt),ji=new se(Wt,Fi),gi=new se(li,Fi);if(it){const Ni=new se(-tt,tt- -17),Vi=-Math.PI/2,Qi=12-tt,yi=new se(22-Qi,-(ve.imageName?Qi:0)),Wr=new se(...kt);Ki._rotateAround(Vi,Ni)._add(yi)._add(Wr),Hi._rotateAround(Vi,Ni)._add(yi)._add(Wr),ji._rotateAround(Vi,Ni)._add(yi)._add(Wr),gi._rotateAround(Vi,Ni)._add(yi)._add(Wr)}if(ce){const Ni=Math.sin(ce),Vi=Math.cos(ce),Qi=[Vi,-Ni,Ni,Vi];Ki._matMult(Qi),Hi._matMult(Qi),ji._matMult(Qi),gi._matMult(Qi)}const Ct=new se(0,0),Vt=new se(0,0);Te.push({tl:Ki,tr:Hi,bl:ji,br:gi,tex:we,writingMode:B.writingMode,glyphOffset:Pt,sectionIndex:ve.sectionIndex,isSDF:We,pixelOffsetTL:Ct,pixelOffsetBR:Vt,minFontScaleX:0,minFontScaleY:0})}return Te}(0,s,e,_,T,n,d,l.allowVerticalPlacement),z=l.textSizeData;let I=null;z.kind==="source"?(I=[xa*_.layout.get("text-size").evaluate(n,{})],I[0]>Os&&Qr(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):z.kind==="composite"&&(I=[xa*v.compositeTextSizes[0].evaluate(n,{},M),xa*v.compositeTextSizes[1].evaluate(n,{},M)],(I[0]>Os||I[1]>Os)&&Qr(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),l.addSymbols(l.text,A,I,e,T,n,o,i,r.lineStartIndex,r.lineLength,g,M);for(const L of h)p[L]=l.text.placedSymbolArray.length-1;return 4*A.length}function Dp(l){for(const i in l)return l[i];return null}function wh(l,i,s,d){const _=l.compareText;if(i in _){const T=_[i];for(let n=T.length-1;n>=0;n--)if(d.dist(T[n])<s)return!0}else _[i]=[];return _[i].push(d),!1}const Pf=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yd{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,d]=new Uint8Array(i,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=d>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const T=Pf[15&d];if(!T)throw new Error("Unrecognized array type.");const[n]=new Uint16Array(i,2,1),[e]=new Uint32Array(i,4,1);return new Yd(e,n,T,i)}constructor(i,s=64,d=Float64Array,_){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=d,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const T=Pf.indexOf(this.ArrayType),n=2*i*this.ArrayType.BYTES_PER_ELEMENT,e=i*this.IndexArrayType.BYTES_PER_ELEMENT,r=(8-e%8)%8;if(T<0)throw new Error(`Unexpected typed array class: ${d}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+e+r,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+n+e+r),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+e+r,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+T]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=i)}add(i,s){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=i,this.coords[this._pos++]=s,d}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return vu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,s,d,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:T,coords:n,nodeSize:e}=this,r=[0,T.length-1,0],o=[];for(;r.length;){const h=r.pop()||0,p=r.pop()||0,g=r.pop()||0;if(p-g<=e){for(let z=g;z<=p;z++){const I=n[2*z],L=n[2*z+1];I>=i&&I<=d&&L>=s&&L<=_&&o.push(T[z])}continue}const v=g+p>>1,M=n[2*v],A=n[2*v+1];M>=i&&M<=d&&A>=s&&A<=_&&o.push(T[v]),(h===0?i<=M:s<=A)&&(r.push(g),r.push(v-1),r.push(1-h)),(h===0?d>=M:_>=A)&&(r.push(v+1),r.push(p),r.push(1-h))}return o}within(i,s,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:T,nodeSize:n}=this,e=[0,_.length-1,0],r=[],o=d*d;for(;e.length;){const h=e.pop()||0,p=e.pop()||0,g=e.pop()||0;if(p-g<=n){for(let z=g;z<=p;z++)kf(T[2*z],T[2*z+1],i,s)<=o&&r.push(_[z]);continue}const v=g+p>>1,M=T[2*v],A=T[2*v+1];kf(M,A,i,s)<=o&&r.push(_[v]),(h===0?i-d<=M:s-d<=A)&&(e.push(g),e.push(v-1),e.push(1-h)),(h===0?i+d>=M:s+d>=A)&&(e.push(v+1),e.push(p),e.push(1-h))}return r}}function vu(l,i,s,d,_,T){if(_-d<=s)return;const n=d+_>>1;Lp(l,i,n,d,_,T),vu(l,i,s,d,n-1,1-T),vu(l,i,s,n+1,_,1-T)}function Lp(l,i,s,d,_,T){for(;_>d;){if(_-d>600){const o=_-d+1,h=s-d+1,p=Math.log(o),g=.5*Math.exp(2*p/3),v=.5*Math.sqrt(p*g*(o-g)/o)*(h-o/2<0?-1:1);Lp(l,i,s,Math.max(d,Math.floor(s-h*g/o+v)),Math.min(_,Math.floor(s+(o-h)*g/o+v)),T)}const n=i[2*s+T];let e=d,r=_;for(Wd(l,i,d,s),i[2*_+T]>n&&Wd(l,i,d,_);e<r;){for(Wd(l,i,e,r),e++,r--;i[2*e+T]<n;)e++;for(;i[2*r+T]>n;)r--}i[2*d+T]===n?Wd(l,i,d,r):(r++,Wd(l,i,r,_)),r<=s&&(d=r+1),s<=r&&(_=r-1)}}function Wd(l,i,s,d){If(l,s,d),If(i,2*s,2*d),If(i,2*s+1,2*d+1)}function If(l,i,s){const d=l[i];l[i]=l[s],l[s]=d}function kf(l,i,s,d){const _=l-s,T=i-d;return _*_+T*T}var Rf;F.cx=void 0,(Rf=F.cx||(F.cx={})).create="create",Rf.load="load",Rf.fullLoad="fullLoad";let nd=null,Fl=[];const Sh=1e3/60,ad="loadTime",fp="fullLoadTime",sd={mark(l){performance.mark(l)},frame(l){const i=l;nd!=null&&Fl.push(i-nd),nd=i},clearMetrics(){nd=null,Fl=[],performance.clearMeasures(ad),performance.clearMeasures(fp);for(const l in F.cx)performance.clearMarks(F.cx[l])},getPerformanceMetrics(){performance.measure(ad,F.cx.create,F.cx.load),performance.measure(fp,F.cx.create,F.cx.fullLoad);const l=performance.getEntriesByName(ad)[0].duration,i=performance.getEntriesByName(fp)[0].duration,s=Fl.length,d=1/(Fl.reduce((T,n)=>T+n,0)/s/1e3),_=Fl.filter(T=>T>Sh).reduce((T,n)=>T+(n-Sh)/Sh,0);return{loadTime:l,fullLoadTime:i,fps:d,percentDroppedFrames:_/(s+_)*100,totalFrames:s}}};F.$=_t,F.A=ot,F.B=function([l,i,s]){return i+=90,i*=Math.PI/180,s*=Math.PI/180,{x:l*Math.cos(i)*Math.sin(s),y:l*Math.sin(i)*Math.sin(s),z:l*Math.cos(s)}},F.C=As,F.D=Ot,F.E=Dt,F.F=rr,F.G=za,F.H=function(l){if(sn==null){const i=l.navigator?l.navigator.userAgent:null;sn=!!l.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return sn},F.I=Kh,F.J=class{constructor(l,i){this.target=l,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new lp(()=>this.process()),this.subscription=Ns(this.target,"message",s=>this.receive(s),!1),this.globalScope=rs(self)?l:window}registerMessageHandler(l,i){this.messageHandlers[l]=i}sendAsync(l,i){return new Promise((s,d)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10),T=i?Ns(i.signal,"abort",()=>{T==null||T.unsubscribe(),delete this.resolveRejects[_];const r={id:_,type:"<cancel>",origin:location.origin,targetMapId:l.targetMapId,sourceMapId:this.mapId};this.target.postMessage(r)},$i):null;this.resolveRejects[_]={resolve:r=>{T==null||T.unsubscribe(),s(r)},reject:r=>{T==null||T.unsubscribe(),d(r)}};const n=[],e=Object.assign(Object.assign({},l),{id:_,sourceMapId:this.mapId,origin:location.origin,data:xl(l.data,n)});this.target.postMessage(e,{transfer:n})})}receive(l){const i=l.data,s=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!=="resource://android"&&location.origin!=="resource://android"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[s];const d=this.abortControllers[s];return delete this.abortControllers[s],void(d&&d.abort())}if(rs(self)||i.mustQueue)return this.tasks[s]=i,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,i)}}process(){if(this.taskQueue.length===0)return;const l=this.taskQueue.shift(),i=this.tasks[l];delete this.tasks[l],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(l,i)}processTask(l,i){return y(this,void 0,void 0,function*(){if(i.type==="<response>"){const _=this.resolveRejects[l];return delete this.resolveRejects[l],_?void(i.error?_.reject(fa(i.error)):_.resolve(fa(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(l,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=fa(i.data),d=new AbortController;this.abortControllers[l]=d;try{const _=yield this.messageHandlers[i.type](i.sourceMapId,s,d);this.completeTask(l,null,_)}catch(_){this.completeTask(l,_)}})}completeTask(l,i,s){const d=[];delete this.abortControllers[l];const _={id:l,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?xl(i):null,data:xl(s,d)};this.target.postMessage(_,{transfer:d})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},F.K=re,F.L=function(){var l=new ot(16);return ot!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},F.M=function(l,i,s){var d,_,T,n,e,r,o,h,p,g,v,M,A=s[0],z=s[1],I=s[2];return i===l?(l[12]=i[0]*A+i[4]*z+i[8]*I+i[12],l[13]=i[1]*A+i[5]*z+i[9]*I+i[13],l[14]=i[2]*A+i[6]*z+i[10]*I+i[14],l[15]=i[3]*A+i[7]*z+i[11]*I+i[15]):(_=i[1],T=i[2],n=i[3],e=i[4],r=i[5],o=i[6],h=i[7],p=i[8],g=i[9],v=i[10],M=i[11],l[0]=d=i[0],l[1]=_,l[2]=T,l[3]=n,l[4]=e,l[5]=r,l[6]=o,l[7]=h,l[8]=p,l[9]=g,l[10]=v,l[11]=M,l[12]=d*A+e*z+p*I+i[12],l[13]=_*A+r*z+g*I+i[13],l[14]=T*A+o*z+v*I+i[14],l[15]=n*A+h*z+M*I+i[15]),l},F.N=function(l,i,s){var d=s[0],_=s[1],T=s[2];return l[0]=i[0]*d,l[1]=i[1]*d,l[2]=i[2]*d,l[3]=i[3]*d,l[4]=i[4]*_,l[5]=i[5]*_,l[6]=i[6]*_,l[7]=i[7]*_,l[8]=i[8]*T,l[9]=i[9]*T,l[10]=i[10]*T,l[11]=i[11]*T,l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15],l},F.O=function(l,i,s){var d=i[0],_=i[1],T=i[2],n=i[3],e=i[4],r=i[5],o=i[6],h=i[7],p=i[8],g=i[9],v=i[10],M=i[11],A=i[12],z=i[13],I=i[14],L=i[15],B=s[0],j=s[1],q=s[2],X=s[3];return l[0]=B*d+j*e+q*p+X*A,l[1]=B*_+j*r+q*g+X*z,l[2]=B*T+j*o+q*v+X*I,l[3]=B*n+j*h+q*M+X*L,l[4]=(B=s[4])*d+(j=s[5])*e+(q=s[6])*p+(X=s[7])*A,l[5]=B*_+j*r+q*g+X*z,l[6]=B*T+j*o+q*v+X*I,l[7]=B*n+j*h+q*M+X*L,l[8]=(B=s[8])*d+(j=s[9])*e+(q=s[10])*p+(X=s[11])*A,l[9]=B*_+j*r+q*g+X*z,l[10]=B*T+j*o+q*v+X*I,l[11]=B*n+j*h+q*M+X*L,l[12]=(B=s[12])*d+(j=s[13])*e+(q=s[14])*p+(X=s[15])*A,l[13]=B*_+j*r+q*g+X*z,l[14]=B*T+j*o+q*v+X*I,l[15]=B*n+j*h+q*M+X*L,l},F.P=se,F.Q=function(l,i){const s={};for(let d=0;d<i.length;d++){const _=i[d];_ in l&&(s[_]=l[_])}return s},F.R=In,F.S=es,F.T=qo,F.U=gh,F.V=Nd,F.W=Et,F.X=Yt,F.Y=Wo,F.Z=Da,F._=y,F.a=K,F.a$=ft,F.a0=function(l,i){var s,d,_,T;if(!l)return i??{};if(!i)return l;const n=Object.assign({},l);if(i.removeAll&&(n.removeAll=!0),i.remove){const e=new Set(n.remove?n.remove.concat(i.remove):i.remove);n.remove=Array.from(e.values())}if(i.add){const e=n.add?n.add.concat(i.add):i.add,r=new Map(e.map(o=>[o.id,o]));n.add=Array.from(r.values())}if(i.update){const e=new Map((s=n.update)===null||s===void 0?void 0:s.map(r=>[r.id,r]));for(const r of i.update){const o=(d=e.get(r.id))!==null&&d!==void 0?d:{id:r.id};r.newGeometry&&(o.newGeometry=r.newGeometry),r.addOrUpdateProperties&&(o.addOrUpdateProperties=((_=o.addOrUpdateProperties)!==null&&_!==void 0?_:[]).concat(r.addOrUpdateProperties)),r.removeProperties&&(o.removeProperties=((T=o.removeProperties)!==null&&T!==void 0?T:[]).concat(r.removeProperties)),r.removeAllProperties&&(o.removeAllProperties=!0),e.set(r.id,o)}n.update=Array.from(e.values())}return n},F.a1=Vd,F.a2=xn,F.a3=25,F.a4=Af,F.a5=l=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(s=>{i.onloadstart=()=>{s(i)};for(const d of l){const _=window.document.createElement("source");je(d)||(i.crossOrigin="Anonymous"),_.src=d,i.appendChild(_)}})},F.a6=pt,F.a7=function(){return kr++},F.a8=V,F.a9=_u,F.aA=function(l){let i=1/0,s=1/0,d=-1/0,_=-1/0;for(const T of l)i=Math.min(i,T.x),s=Math.min(s,T.y),d=Math.max(d,T.x),_=Math.max(_,T.y);return[i,s,d,_]},F.aB=Yr,F.aC=_e,F.aD=function(l,i,s,d,_=!1){if(!s[0]&&!s[1])return[0,0];const T=_?d==="map"?-l.bearingInRadians:0:d==="viewport"?l.bearingInRadians:0;if(T){const n=Math.sin(T),e=Math.cos(T);s=[s[0]*e-s[1]*n,s[0]*n+s[1]*e]}return[_?s[0]:_e(i,s[0],l.zoom),_?s[1]:_e(i,s[1],l.zoom)]},F.aF=Od,F.aG=bh,F.aH=Ld,F.aI=Yd,F.aJ=un,F.aK=aa,F.aL=fe,F.aM=mi,F.aN=yr,F.aO=Di,F.aP=Ko,F.aQ=Mf,F.aR=Pi,F.aS=ui,F.aT=function(l){var i=new ot(3);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i},F.aU=function(l,i,s){return l[0]=i[0]-s[0],l[1]=i[1]-s[1],l[2]=i[2]-s[2],l},F.aV=function(l,i){var s=i[0],d=i[1],_=i[2],T=s*s+d*d+_*_;return T>0&&(T=1/Math.sqrt(T)),l[0]=i[0]*T,l[1]=i[1]*T,l[2]=i[2]*T,l},F.aW=$e,F.aX=function(l,i){return l[0]*i[0]+l[1]*i[1]+l[2]*i[2]},F.aY=function(l,i,s){return l[0]=i[0]*s[0],l[1]=i[1]*s[1],l[2]=i[2]*s[2],l[3]=i[3]*s[3],l},F.aZ=ti,F.a_=function(l,i,s){const d=i[0]*s[0]+i[1]*s[1]+i[2]*s[2];return d===0?null:(-(l[0]*s[0]+l[1]*s[1]+l[2]*s[2])-s[3])/d},F.aa=ko,F.ab=Ka,F.ac=Ud,F.ad=function(l){const i={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,d,_,T)=>{const n=_||T;return i[d]=!n||n.toLowerCase(),""}),i["max-age"]){const s=parseInt(i["max-age"],10);isNaN(s)?delete i["max-age"]:i["max-age"]=s}return i},F.ae=Vl,F.af=function(l){return Math.pow(2,l)},F.ag=Rt,F.ah=Zt,F.ai=85.051129,F.aj=ed,F.ak=function(l){return Math.log(l)/Math.LN2},F.al=function(l){var i=l[0],s=l[1];return i*i+s*s},F.am=function(l,i){const s=[];for(const d in l)d in i||s.push(d);return s},F.an=function(l,i){let s=0,d=0;if(l.kind==="constant")d=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:_,minZoom:T,maxZoom:n}=l,e=_?Zt(Un.interpolationFactor(_,i,T,n),0,1):0;l.kind==="camera"?d=As.number(l.minSize,l.maxSize,e):s=e}return{uSizeT:s,uSize:d}},F.ap=function(l,{uSize:i,uSizeT:s},{lowerSize:d,upperSize:_}){return l.kind==="source"?d/xa:l.kind==="composite"?As.number(d/xa,_/xa,s):i},F.aq=function(l,i){var s=i[0],d=i[1],_=i[2],T=i[3],n=i[4],e=i[5],r=i[6],o=i[7],h=i[8],p=i[9],g=i[10],v=i[11],M=i[12],A=i[13],z=i[14],I=i[15],L=s*e-d*n,B=s*r-_*n,j=s*o-T*n,q=d*r-_*e,X=d*o-T*e,J=_*o-T*r,ue=h*A-p*M,le=h*z-g*M,ce=h*I-v*M,Te=p*z-g*A,ye=p*I-v*A,ve=g*I-v*z,we=L*ve-B*ye+j*Te+q*ce-X*le+J*ue;return we?(l[0]=(e*ve-r*ye+o*Te)*(we=1/we),l[1]=(_*ye-d*ve-T*Te)*we,l[2]=(A*J-z*X+I*q)*we,l[3]=(g*X-p*J-v*q)*we,l[4]=(r*ce-n*ve-o*le)*we,l[5]=(s*ve-_*ce+T*le)*we,l[6]=(z*j-M*J-I*B)*we,l[7]=(h*J-g*j+v*B)*we,l[8]=(n*ye-e*ce+o*ue)*we,l[9]=(d*ce-s*ye-T*ue)*we,l[10]=(M*X-A*j+I*L)*we,l[11]=(p*j-h*X-v*L)*we,l[12]=(e*le-n*Te-r*ue)*we,l[13]=(s*Te-d*le+_*ue)*we,l[14]=(A*B-M*q-z*L)*we,l[15]=(h*q-p*B+g*L)*we,l):null},F.ar=bt,F.as=function(l){var i=l[0],s=l[1];return Math.sqrt(i*i+s*s)},F.at=function(l){return l[0]=0,l[1]=0,l},F.au=function(l,i,s){return l[0]=i[0]*s,l[1]=i[1]*s,l},F.av=Tc,F.aw=fn,F.ax=function(l,i,s,d){const _=i.y-l.y,T=i.x-l.x,n=d.y-s.y,e=d.x-s.x,r=n*T-e*_;if(r===0)return null;const o=(e*(l.y-s.y)-n*(l.x-s.x))/r;return new se(l.x+o*T,l.y+o*_)},F.ay=qd,F.az=Ff,F.b=Nn,F.b$=class extends b{},F.b0=function(l,i,s){return l[0]=i[0]*s,l[1]=i[1]*s,l[2]=i[2]*s,l[3]=i[3]*s,l},F.b1=function(l,i){return l[0]*i[0]+l[1]*i[1]+l[2]*i[2]+l[3]},F.b2=cp,F.b3=ur,F.b4=function(l,i,s,d,_){var T=1/Math.tan(i/2);if(l[0]=T/s,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=T,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,_!=null&&_!==1/0){var n=1/(d-_);l[10]=(_+d)*n,l[14]=2*_*d*n}else l[10]=-1,l[14]=-2*d;return l},F.b5=function(l){var i=new ot(16);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3],i[4]=l[4],i[5]=l[5],i[6]=l[6],i[7]=l[7],i[8]=l[8],i[9]=l[9],i[10]=l[10],i[11]=l[11],i[12]=l[12],i[13]=l[13],i[14]=l[14],i[15]=l[15],i},F.b6=function(l,i,s){var d=Math.sin(s),_=Math.cos(s),T=i[0],n=i[1],e=i[2],r=i[3],o=i[4],h=i[5],p=i[6],g=i[7];return i!==l&&(l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=T*_+o*d,l[1]=n*_+h*d,l[2]=e*_+p*d,l[3]=r*_+g*d,l[4]=o*_-T*d,l[5]=h*_-n*d,l[6]=p*_-e*d,l[7]=g*_-r*d,l},F.b7=function(l,i,s){var d=Math.sin(s),_=Math.cos(s),T=i[4],n=i[5],e=i[6],r=i[7],o=i[8],h=i[9],p=i[10],g=i[11];return i!==l&&(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[4]=T*_+o*d,l[5]=n*_+h*d,l[6]=e*_+p*d,l[7]=r*_+g*d,l[8]=o*_-T*d,l[9]=h*_-n*d,l[10]=p*_-e*d,l[11]=g*_-r*d,l},F.b8=function(){const l=new Float32Array(16);return Rt(l),l},F.b9=function(){const l=new Float64Array(16);return Rt(l),l},F.bA=function(l,i){const s=rt(l,360),d=rt(i,360),_=d-s,T=d>s?_-360:_+360;return Math.abs(_)<Math.abs(T)?_:T},F.bB=function(l){return l[0]=0,l[1]=0,l[2]=0,l},F.bC=function(l,i,s,d){const _=Math.sqrt(l*l+i*i),T=Math.sqrt(s*s+d*d);l/=_,i/=_,s/=T,d/=T;const n=Math.acos(l*s+i*d);return-i*s+l*d>0?n:-n},F.bD=function(l,i){const s=rt(l,2*Math.PI),d=rt(i,2*Math.PI);return Math.min(Math.abs(s-d),Math.abs(s-d+2*Math.PI),Math.abs(s-d-2*Math.PI))},F.bE=function(){const l={},i=ke.$version;for(const s in ke.$root){const d=ke.$root[s];if(d.required){let _=null;_=s==="version"?i:d.type==="array"?[]:{},_!=null&&(l[s]=_)}}return l},F.bF=lc,F.bG=Ae,F.bH=function l(i,s){if(Array.isArray(i)){if(!Array.isArray(s)||i.length!==s.length)return!1;for(let d=0;d<i.length;d++)if(!l(i[d],s[d]))return!1;return!0}if(typeof i=="object"&&i!==null&&s!==null){if(typeof s!="object"||Object.keys(i).length!==Object.keys(s).length)return!1;for(const d in i)if(!l(i[d],s[d]))return!1;return!0}return i===s},F.bI=function(l){l=l.slice();const i=Object.create(null);for(let s=0;s<l.length;s++)i[l[s].id]=l[s];for(let s=0;s<l.length;s++)"ref"in l[s]&&(l[s]=Ti(l[s],i[l[s].ref]));return l},F.bJ=function(l){if(l.type==="custom")return new op(l);switch(l.type){case"background":return new Mc(l);case"circle":return new xp(l);case"color-relief":return new lf(l);case"fill":return new uu(l);case"fill-extrusion":return new qi(l);case"heatmap":return new Sd(l);case"hillshade":return new vp(l);case"line":return new Ja(l);case"raster":return new mh(l);case"symbol":return new Jh(l)}},F.bK=sr,F.bL=function(l,i){if(!l)return[{command:"setStyle",args:[i]}];let s=[];try{if(!$t(l.version,i.version))return[{command:"setStyle",args:[i]}];$t(l.center,i.center)||s.push({command:"setCenter",args:[i.center]}),$t(l.state,i.state)||s.push({command:"setGlobalState",args:[i.state]}),$t(l.centerAltitude,i.centerAltitude)||s.push({command:"setCenterAltitude",args:[i.centerAltitude]}),$t(l.zoom,i.zoom)||s.push({command:"setZoom",args:[i.zoom]}),$t(l.bearing,i.bearing)||s.push({command:"setBearing",args:[i.bearing]}),$t(l.pitch,i.pitch)||s.push({command:"setPitch",args:[i.pitch]}),$t(l.roll,i.roll)||s.push({command:"setRoll",args:[i.roll]}),$t(l.sprite,i.sprite)||s.push({command:"setSprite",args:[i.sprite]}),$t(l.glyphs,i.glyphs)||s.push({command:"setGlyphs",args:[i.glyphs]}),$t(l.transition,i.transition)||s.push({command:"setTransition",args:[i.transition]}),$t(l.light,i.light)||s.push({command:"setLight",args:[i.light]}),$t(l.terrain,i.terrain)||s.push({command:"setTerrain",args:[i.terrain]}),$t(l.sky,i.sky)||s.push({command:"setSky",args:[i.sky]}),$t(l.projection,i.projection)||s.push({command:"setProjection",args:[i.projection]});const d={},_=[];(function(n,e,r,o){let h;for(h in e=e||{},n=n||{})Object.prototype.hasOwnProperty.call(n,h)&&(Object.prototype.hasOwnProperty.call(e,h)||Yi(h,r,o));for(h in e)Object.prototype.hasOwnProperty.call(e,h)&&(Object.prototype.hasOwnProperty.call(n,h)?$t(n[h],e[h])||(n[h].type==="geojson"&&e[h].type==="geojson"&&Mi(n,e,h)?hi(r,{command:"setGeoJSONSourceData",args:[h,e[h].data]}):er(h,e,r,o)):Ii(h,e,r))})(l.sources,i.sources,_,d);const T=[];l.layers&&l.layers.forEach(n=>{"source"in n&&d[n.source]?s.push({command:"removeLayer",args:[n.id]}):T.push(n)}),s=s.concat(_),function(n,e,r){e=e||[];const o=(n=n||[]).map(di),h=e.map(di),p=n.reduce(Bi,{}),g=e.reduce(Bi,{}),v=o.slice(),M=Object.create(null);let A,z,I,L,B;for(let j=0,q=0;j<o.length;j++)A=o[j],Object.prototype.hasOwnProperty.call(g,A)?q++:(hi(r,{command:"removeLayer",args:[A]}),v.splice(v.indexOf(A,q),1));for(let j=0,q=0;j<h.length;j++)A=h[h.length-1-j],v[v.length-1-j]!==A&&(Object.prototype.hasOwnProperty.call(p,A)?(hi(r,{command:"removeLayer",args:[A]}),v.splice(v.lastIndexOf(A,v.length-q),1)):q++,L=v[v.length-j],hi(r,{command:"addLayer",args:[g[A],L]}),v.splice(v.length-j,0,A),M[A]=!0);for(let j=0;j<h.length;j++)if(A=h[j],z=p[A],I=g[A],!M[A]&&!$t(z,I))if($t(z.source,I.source)&&$t(z["source-layer"],I["source-layer"])&&$t(z.type,I.type)){for(B in Lt(z.layout,I.layout,r,A,null,"setLayoutProperty"),Lt(z.paint,I.paint,r,A,null,"setPaintProperty"),$t(z.filter,I.filter)||hi(r,{command:"setFilter",args:[A,I.filter]}),$t(z.minzoom,I.minzoom)&&$t(z.maxzoom,I.maxzoom)||hi(r,{command:"setLayerZoomRange",args:[A,I.minzoom,I.maxzoom]}),z)Object.prototype.hasOwnProperty.call(z,B)&&B!=="layout"&&B!=="paint"&&B!=="filter"&&B!=="metadata"&&B!=="minzoom"&&B!=="maxzoom"&&(B.indexOf("paint.")===0?Lt(z[B],I[B],r,A,B.slice(6),"setPaintProperty"):$t(z[B],I[B])||hi(r,{command:"setLayerProperty",args:[A,B,I[B]]}));for(B in I)Object.prototype.hasOwnProperty.call(I,B)&&!Object.prototype.hasOwnProperty.call(z,B)&&B!=="layout"&&B!=="paint"&&B!=="filter"&&B!=="metadata"&&B!=="minzoom"&&B!=="maxzoom"&&(B.indexOf("paint.")===0?Lt(z[B],I[B],r,A,B.slice(6),"setPaintProperty"):$t(z[B],I[B])||hi(r,{command:"setLayerProperty",args:[A,B,I[B]]}))}else hi(r,{command:"removeLayer",args:[A]}),L=v[v.lastIndexOf(A)+1],hi(r,{command:"addLayer",args:[I,L]})}(T,i.layers,s)}catch(d){console.warn("Unable to compute style diff:",d),s=[{command:"setStyle",args:[i]}]}return s},F.bM=function(l){const i=[],s=l.id;return s===void 0&&i.push({message:`layers.${s}: missing required property "id"`}),l.render===void 0&&i.push({message:`layers.${s}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&i.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),i},F.bN=jn,F.bO=Hn,F.bP=class extends ra{constructor(l,i){super(l,i),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},F.bQ=Xr,F.bR=class extends ra{constructor(l,i){super(l,i),this.current=ma}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let i=1;i<16;i++)if(l[i]!==this.current[i]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},F.bS=Dr,F.bT=class extends ra{constructor(l,i){super(l,i),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},F.bU=class extends ra{constructor(l,i){super(l,i),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},F.bV=St,F.bW=function(l,i){var s=Math.sin(i),d=Math.cos(i);return l[0]=d,l[1]=s,l[2]=0,l[3]=-s,l[4]=d,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},F.bX=function(l,i,s){var d=i[0],_=i[1],T=i[2];return l[0]=d*s[0]+_*s[3]+T*s[6],l[1]=d*s[1]+_*s[4]+T*s[7],l[2]=d*s[2]+_*s[5]+T*s[8],l},F.bY=function(l,i,s,d,_,T,n){var e=1/(i-s),r=1/(d-_),o=1/(T-n);return l[0]=-2*e,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*r,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*o,l[11]=0,l[12]=(i+s)*e,l[13]=(_+d)*r,l[14]=(n+T)*o,l[15]=1,l},F.bZ=class extends ra{constructor(l,i){super(l,i),this.current=new Array}set(l){if(l!=this.current){this.current=l;const i=new Float32Array(4*l.length);for(let s=0;s<l.length;s++)i[4*s]=l[s].r,i[4*s+1]=l[s].g,i[4*s+2]=l[s].b,i[4*s+3]=l[s].a;this.gl.uniform4fv(this.location,i)}}},F.b_=class extends ra{constructor(l,i){super(l,i),this.current=new Array}set(l){if(l!=this.current){this.current=l;const i=new Float32Array(l);this.gl.uniform1fv(this.location,i)}}},F.ba=function(){return new Float64Array(16)},F.bb=function(l,i,s){const d=new Float64Array(4);return Qe(d,l,i-90,s),d},F.bc=function(l,i,s,d){var _,T,n,e,r,o=i[0],h=i[1],p=i[2],g=i[3],v=s[0],M=s[1],A=s[2],z=s[3];return(T=o*v+h*M+p*A+g*z)<0&&(T=-T,v=-v,M=-M,A=-A,z=-z),1-T>Nt?(_=Math.acos(T),n=Math.sin(_),e=Math.sin((1-d)*_)/n,r=Math.sin(d*_)/n):(e=1-d,r=d),l[0]=e*o+r*v,l[1]=e*h+r*M,l[2]=e*p+r*A,l[3]=e*g+r*z,l},F.bd=function(l){const i=new Float64Array(9);var s,d,_,T,n,e,r,o,h,p,g,v,M,A,z,I,L,B;p=(_=(d=l)[0])*(r=_+_),g=(T=d[1])*r,M=(n=d[2])*r,A=n*(o=T+T),I=(e=d[3])*r,L=e*o,B=e*(h=n+n),(s=i)[0]=1-(v=T*o)-(z=n*h),s[3]=g-B,s[6]=M+L,s[1]=g+B,s[4]=1-p-z,s[7]=A-I,s[2]=M-L,s[5]=A+I,s[8]=1-p-v;const j=Ko(-Math.asin(Zt(i[2],-1,1)));let q,X;return Math.hypot(i[5],i[8])<.001?(q=0,X=-Ko(Math.atan2(i[3],i[4]))):(q=Ko(i[5]===0&&i[8]===0?0:Math.atan2(i[5],i[8])),X=Ko(i[1]===0&&i[0]===0?0:Math.atan2(i[1],i[0]))),{roll:q,pitch:j+90,bearing:X}},F.be=function(l,i){return l.roll==i.roll&&l.pitch==i.pitch&&l.bearing==i.bearing},F.bf=pi,F.bg=No,F.bh=ka,F.bi=nh,F.bj=Pr,F.bk=It,F.bl=mt,F.bm=Gr,F.bn=function(l,i,s,d,_){return It(d,_,Zt((l-i)/(s-i),0,1))},F.bo=rt,F.bp=function(){return new Float64Array(3)},F.bq=function(l,i,s,d){return l[0]=i[0]+s[0]*d,l[1]=i[1]+s[1]*d,l[2]=i[2]+s[2]*d,l},F.br=Qe,F.bs=function(l,i,s){var d=s[0],_=s[1],T=s[2],n=s[3],e=i[0],r=i[1],o=i[2],h=_*o-T*r,p=T*e-d*o,g=d*r-_*e;return l[0]=e+n*(h+=h)+_*(g+=g)-T*(p+=p),l[1]=r+n*p+T*h-d*g,l[2]=o+n*g+d*p-_*h,l},F.bt=function(l,i,s){const d=(_=[l[0],l[1],l[2],i[0],i[1],i[2],s[0],s[1],s[2]])[0]*((h=_[8])*(n=_[4])-(e=_[5])*(o=_[7]))+_[1]*(-h*(T=_[3])+e*(r=_[6]))+_[2]*(o*T-n*r);var _,T,n,e,r,o,h;if(d===0)return null;const p=$e([],[i[0],i[1],i[2]],[s[0],s[1],s[2]]),g=$e([],[s[0],s[1],s[2]],[l[0],l[1],l[2]]),v=$e([],[l[0],l[1],l[2]],[i[0],i[1],i[2]]),M=Pi([],p,-l[3]);return ui(M,M,Pi([],g,-i[3])),ui(M,M,Pi([],v,-s[3])),Pi(M,M,1/d),M},F.bu=va,F.bv=function(){return new Float64Array(4)},F.bw=function(l,i,s,d){var _=[],T=[];return _[0]=i[0]-s[0],_[1]=i[1]-s[1],_[2]=i[2]-s[2],T[0]=_[0]*Math.cos(d)-_[1]*Math.sin(d),T[1]=_[0]*Math.sin(d)+_[1]*Math.cos(d),T[2]=_[2],l[0]=T[0]+s[0],l[1]=T[1]+s[1],l[2]=T[2]+s[2],l},F.bx=function(l,i,s,d){var _=[],T=[];return _[0]=i[0]-s[0],_[1]=i[1]-s[1],_[2]=i[2]-s[2],T[0]=_[0],T[1]=_[1]*Math.cos(d)-_[2]*Math.sin(d),T[2]=_[1]*Math.sin(d)+_[2]*Math.cos(d),l[0]=T[0]+s[0],l[1]=T[1]+s[1],l[2]=T[2]+s[2],l},F.by=function(l,i,s,d){var _=[],T=[];return _[0]=i[0]-s[0],_[1]=i[1]-s[1],_[2]=i[2]-s[2],T[0]=_[2]*Math.sin(d)+_[0]*Math.cos(d),T[1]=_[1],T[2]=_[2]*Math.cos(d)-_[0]*Math.sin(d),l[0]=T[0]+s[0],l[1]=T[1]+s[1],l[2]=T[2]+s[2],l},F.bz=function(l,i,s){var d=Math.sin(s),_=Math.cos(s),T=i[0],n=i[1],e=i[2],r=i[3],o=i[8],h=i[9],p=i[10],g=i[11];return i!==l&&(l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=T*_-o*d,l[1]=n*_-h*d,l[2]=e*_-p*d,l[3]=r*_-g*d,l[8]=T*d+o*_,l[9]=n*d+h*_,l[10]=e*d+p*_,l[11]=r*d+g*_,l},F.c=Ee,F.c0=ya,F.c1=class extends c{},F.c2=au,F.c3=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},F.c4=Nh,F.c5=function(l,i,s){var d=i[0],_=i[1],T=i[2],n=s[3]*d+s[7]*_+s[11]*T+s[15];return l[0]=(s[0]*d+s[4]*_+s[8]*T+s[12])/(n=n||1),l[1]=(s[1]*d+s[5]*_+s[9]*T+s[13])/n,l[2]=(s[2]*d+s[6]*_+s[10]*T+s[14])/n,l},F.c6=class extends ta{},F.c7=class extends O{},F.c8=function(l,i){return l[0]===i[0]&&l[1]===i[1]&&l[2]===i[2]&&l[3]===i[3]&&l[4]===i[4]&&l[5]===i[5]&&l[6]===i[6]&&l[7]===i[7]&&l[8]===i[8]&&l[9]===i[9]&&l[10]===i[10]&&l[11]===i[11]&&l[12]===i[12]&&l[13]===i[13]&&l[14]===i[14]&&l[15]===i[15]},F.c9=function(l,i){var s=l[0],d=l[1],_=l[2],T=l[3],n=l[4],e=l[5],r=l[6],o=l[7],h=l[8],p=l[9],g=l[10],v=l[11],M=l[12],A=l[13],z=l[14],I=l[15],L=i[0],B=i[1],j=i[2],q=i[3],X=i[4],J=i[5],ue=i[6],le=i[7],ce=i[8],Te=i[9],ye=i[10],ve=i[11],we=i[12],Ye=i[13],We=i[14],et=i[15];return Math.abs(s-L)<=Nt*Math.max(1,Math.abs(s),Math.abs(L))&&Math.abs(d-B)<=Nt*Math.max(1,Math.abs(d),Math.abs(B))&&Math.abs(_-j)<=Nt*Math.max(1,Math.abs(_),Math.abs(j))&&Math.abs(T-q)<=Nt*Math.max(1,Math.abs(T),Math.abs(q))&&Math.abs(n-X)<=Nt*Math.max(1,Math.abs(n),Math.abs(X))&&Math.abs(e-J)<=Nt*Math.max(1,Math.abs(e),Math.abs(J))&&Math.abs(r-ue)<=Nt*Math.max(1,Math.abs(r),Math.abs(ue))&&Math.abs(o-le)<=Nt*Math.max(1,Math.abs(o),Math.abs(le))&&Math.abs(h-ce)<=Nt*Math.max(1,Math.abs(h),Math.abs(ce))&&Math.abs(p-Te)<=Nt*Math.max(1,Math.abs(p),Math.abs(Te))&&Math.abs(g-ye)<=Nt*Math.max(1,Math.abs(g),Math.abs(ye))&&Math.abs(v-ve)<=Nt*Math.max(1,Math.abs(v),Math.abs(ve))&&Math.abs(M-we)<=Nt*Math.max(1,Math.abs(M),Math.abs(we))&&Math.abs(A-Ye)<=Nt*Math.max(1,Math.abs(A),Math.abs(Ye))&&Math.abs(z-We)<=Nt*Math.max(1,Math.abs(z),Math.abs(We))&&Math.abs(I-et)<=Nt*Math.max(1,Math.abs(I),Math.abs(et))},F.cA=function(l,i){K.REGISTERED_PROTOCOLS[l]=i},F.cB=function(l){delete K.REGISTERED_PROTOCOLS[l]},F.cC=function(l,i){const s={};for(let _=0;_<l.length;_++){const T=i&&i[l[_].id]||_l(l[_]);i&&(i[l[_].id]=T);let n=s[T];n||(n=s[T]=[]),n.push(l[_])}const d=[];for(const _ in s)d.push(s[_]);return d},F.cD=At,F.cE=Cf,F.cF=Ef,F.cG=xf,F.cH=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=_t/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;const i=l.bucket.layers[0],s=i.layout,d=i._unevaluatedLayout._values,_={layoutIconSize:d["icon-size"].possiblyEvaluate(new rr(l.bucket.zoom+1),l.canonical),layoutTextSize:d["text-size"].possiblyEvaluate(new rr(l.bucket.zoom+1),l.canonical),textMaxSize:d["text-size"].possiblyEvaluate(new rr(18))};if(l.bucket.textSizeData.kind==="composite"){const{minZoom:o,maxZoom:h}=l.bucket.textSizeData;_.compositeTextSizes=[d["text-size"].possiblyEvaluate(new rr(o),l.canonical),d["text-size"].possiblyEvaluate(new rr(h),l.canonical)]}if(l.bucket.iconSizeData.kind==="composite"){const{minZoom:o,maxZoom:h}=l.bucket.iconSizeData;_.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new rr(o),l.canonical),d["icon-size"].possiblyEvaluate(new rr(h),l.canonical)]}const T=s.get("text-line-height")*Yr,n=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",e=s.get("text-keep-upright"),r=s.get("text-size");for(const o of l.bucket.features){const h=s.get("text-font").evaluate(o,{},l.canonical).join(","),p=r.evaluate(o,{},l.canonical),g=_.layoutTextSize.evaluate(o,{},l.canonical),v=_.layoutIconSize.evaluate(o,{},l.canonical),M={horizontal:{},vertical:void 0},A=o.text;let z,I=[0,0];if(A){const j=A.toString(),q=s.get("text-letter-spacing").evaluate(o,{},l.canonical)*Yr,X=qu(j)?q:0,J=s.get("text-anchor").evaluate(o,{},l.canonical),ue=Xd(i,o,l.canonical);if(!ue){const ye=s.get("text-radial-offset").evaluate(o,{},l.canonical);I=ye?ts(J,[ye*Yr,xu]):s.get("text-offset").evaluate(o,{},l.canonical).map(ve=>ve*Yr)}let le=n?"center":s.get("text-justify").evaluate(o,{},l.canonical);const ce=s.get("symbol-placement")==="point"?s.get("text-max-width").evaluate(o,{},l.canonical)*Yr:1/0,Te=()=>{l.bucket.allowVerticalPlacement&&Xa(j)&&(M.vertical=Rd(A,l.glyphMap,l.glyphPositions,l.imagePositions,h,ce,T,J,"left",X,I,F.ao.vertical,!0,g,p))};if(!n&&ue){const ye=new Set;if(le==="auto")for(let we=0;we<ue.values.length;we+=2)ye.add(bh(ue.values[we]));else ye.add(le);let ve=!1;for(const we of ye)if(!M.horizontal[we])if(ve)M.horizontal[we]=M.horizontal[0];else{const Ye=Rd(A,l.glyphMap,l.glyphPositions,l.imagePositions,h,ce,T,"center",we,X,I,F.ao.horizontal,!1,g,p);Ye&&(M.horizontal[we]=Ye,ve=Ye.positionedLines.length===1)}Te()}else{le==="auto"&&(le=bh(J));const ye=Rd(A,l.glyphMap,l.glyphPositions,l.imagePositions,h,ce,T,J,le,X,I,F.ao.horizontal,!1,g,p);ye&&(M.horizontal[le]=ye),Te(),Xa(j)&&n&&e&&(M.vertical=Rd(A,l.glyphMap,l.glyphPositions,l.imagePositions,h,ce,T,J,le,X,I,F.ao.vertical,!1,g,p))}}let L=!1;if(o.icon&&o.icon.name){const j=l.imageMap[o.icon.name];j&&(z=bf(l.imagePositions[o.icon.name],s.get("icon-offset").evaluate(o,{},l.canonical),s.get("icon-anchor").evaluate(o,{},l.canonical)),L=!!j.sdf,l.bucket.sdfIcons===void 0?l.bucket.sdfIcons=L:l.bucket.sdfIcons!==L&&Qr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(j.pixelRatio!==l.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(l.bucket.iconsNeedLinear=!0))}const B=Dp(M.horizontal)||M.vertical;l.bucket.iconsInText=!!B&&B.iconsInText,(B||z)&&Bl(l.bucket,o,M,z,l.imageMap,_,g,v,I,L,l.canonical,l.subdivisionGranularity)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},F.cI=$o,F.cJ=Qa,F.cK=Xh,F.cL=Hf,F.cM=fu,F.cN=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return l.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},F.cO=function(l,i,s,d,_){return y(this,void 0,void 0,function*(){if(Yt())try{return yield Wo(l,i,s,d,_)}catch{}return function(T,n,e,r,o){const h=T.width,p=T.height;as&&La||(as=new OffscreenCanvas(h,p),La=as.getContext("2d",{willReadFrequently:!0})),as.width=h,as.height=p,La.drawImage(T,0,0,h,p);const g=La.getImageData(n,e,r,o);return La.clearRect(0,0,h,p),g.data}(l,i,s,d,_)})},F.cP=Md,F.cQ=pe,F.cR=Zo,F.cS=hu,F.cT=Mt,F.cU=function(l,i){const s=new Map;if(l!=null)if(l.type==="Feature")s.set(yh(l,i),l);else for(const d of l.features)s.set(yh(d,i),d);return s},F.cV=function(l,i){if(l==null)return!0;if(l.type==="Feature")return yh(l,i)!=null;if(l.type==="FeatureCollection"){const s=new Set;for(const d of l.features){const _=yh(d,i);if(_==null||s.has(_))return!1;s.add(_)}return!0}return!1},F.cW=function(l,i,s){var d,_,T,n;if(i.removeAll&&l.clear(),i.remove)for(const e of i.remove)l.delete(e);if(i.add)for(const e of i.add){const r=yh(e,s);r!=null&&l.set(r,e)}if(i.update)for(const e of i.update){let r=l.get(e.id);if(r==null)continue;const o=!e.removeAllProperties&&(((d=e.removeProperties)===null||d===void 0?void 0:d.length)>0||((_=e.addOrUpdateProperties)===null||_===void 0?void 0:_.length)>0);if((e.newGeometry||e.removeAllProperties||o)&&(r=Object.assign({},r),l.set(e.id,r),o&&(r.properties=Object.assign({},r.properties))),e.newGeometry&&(r.geometry=e.newGeometry),e.removeAllProperties)r.properties={};else if(((T=e.removeProperties)===null||T===void 0?void 0:T.length)>0)for(const h of e.removeProperties)Object.prototype.hasOwnProperty.call(r.properties,h)&&delete r.properties[h];if(((n=e.addOrUpdateProperties)===null||n===void 0?void 0:n.length)>0)for(const{key:h,value:p}of e.addOrUpdateProperties)r.properties[h]=p}},F.cX=On,F.ca=function(l,i){return l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15],l},F.cb=l=>l.type==="symbol",F.cc=l=>l.type==="circle",F.cd=l=>l.type==="heatmap",F.ce=l=>l.type==="line",F.cf=l=>l.type==="fill",F.cg=l=>l.type==="fill-extrusion",F.ch=l=>l.type==="hillshade",F.ci=l=>l.type==="color-relief",F.cj=l=>l.type==="raster",F.ck=l=>l.type==="background",F.cl=l=>l.type==="custom",F.cm=ut,F.cn=function(l,i,s){const d=Be(i.x-s.x,i.y-s.y),_=Be(l.x-s.x,l.y-s.y);var T,n;return Ko(Math.atan2(d[0]*_[1]-d[1]*_[0],(T=d)[0]*(n=_)[0]+T[1]*n[1]))},F.co=bi,F.cp=function(l,i){return pn[i]&&(l instanceof MouseEvent||l instanceof WheelEvent)},F.cq=function(l,i){return ss[i]&&"touches"in l},F.cr=function(l){return ss[l]||pn[l]},F.cs=function(l,i,s){var d=i[0],_=i[1];return l[0]=s[0]*d+s[4]*_+s[12],l[1]=s[1]*d+s[5]*_+s[13],l},F.ct=function(l,i){const{x:s,y:d}=Vd.fromLngLat(i);return!(l<0||l>25||d<0||d>=1||s<0||s>=1)},F.cu=function(l,i){return l[0]=i[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=i[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=i[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},F.cv=class extends Ml{},F.cw=sd,F.cy=function(l){return l.message===ba},F.cz=me,F.d=je,F.e=Ei,F.f=l=>y(void 0,void 0,void 0,function*(){if(l.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(l)],{type:"image/png"});try{return createImageBitmap(i)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),F.g=ee,F.h=l=>new Promise((i,s)=>{const d=new Image;d.onload=()=>{i(d),URL.revokeObjectURL(d.src),d.onload=null,window.requestAnimationFrame(()=>{d.src=ns})},d.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(l)],{type:"image/png"});d.src=l.byteLength?URL.createObjectURL(_):ns}),F.i=rs,F.j=(l,i)=>Pe(Ei(l,{type:"json"}),i),F.k=at,F.l=ht,F.m=Pe,F.n=(l,i)=>Pe(Ei(l,{type:"arrayBuffer"}),i),F.o=function(l){return new fu(l).readFields(Id,[])},F.p=_f,F.q=nu,F.r=ea,F.s=Ns,F.t=tu,F.u=ki,F.v=ke,F.w=Qr,F.x=Qt,F.y=Pn,F.z=Ft}),Q("worker",["./shared"],function(F){class y{constructor(K){this.keyCache={},K&&this.replace(K)}replace(K){this._layerConfigs={},this._layers={},this.update(K,[])}update(K,ee){for(const me of K){this._layerConfigs[me.id]=me;const Ae=this._layers[me.id]=F.bJ(me);Ae._featureFilter=F.aa(Ae.filter),this.keyCache[me.id]&&delete this.keyCache[me.id]}for(const me of ee)delete this.keyCache[me],delete this._layerConfigs[me],delete this._layers[me];this.familiesBySource={};const re=F.cC(Object.values(this._layerConfigs),this.keyCache);for(const me of re){const Ae=me.map(at=>this._layers[at.id]),Pe=Ae[0];if(Pe.visibility==="none")continue;const je=Pe.source||"";let Re=this.familiesBySource[je];Re||(Re=this.familiesBySource[je]={});const Je=Pe.sourceLayer||"_geojsonTileLayer";let ht=Re[Je];ht||(ht=Re[Je]=[]),ht.push(Ae)}}}class se{constructor(K){const ee={},re=[];for(const je in K){const Re=K[je],Je=ee[je]={};for(const ht in Re){const at=Re[+ht];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;const Dt={x:0,y:0,w:at.bitmap.width+2,h:at.bitmap.height+2};re.push(Dt),Je[ht]={rect:Dt,metrics:at.metrics}}}const{w:me,h:Ae}=F.p(re),Pe=new F.q({width:me||1,height:Ae||1});for(const je in K){const Re=K[je];for(const Je in Re){const ht=Re[+Je];if(!ht||ht.bitmap.width===0||ht.bitmap.height===0)continue;const at=ee[je][Je].rect;F.q.copy(ht.bitmap,Pe,{x:0,y:0},{x:at.x+1,y:at.y+1},ht.bitmap)}}this.image=Pe,this.positions=ee}}F.cD("GlyphAtlas",se);class pe{constructor(K){this.tileID=new F.Z(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.uid=K.uid,this.zoom=K.zoom,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=K.showCollisionBoxes,this.collectResourceTiming=!!K.collectResourceTiming,this.returnDependencies=!!K.returnDependencies,this.promoteId=K.promoteId,this.inFlightDependencies=[],this.globalState=K.globalState}parse(K,ee,re,me,Ae){return F._(this,void 0,void 0,function*(){this.status="parsing",this.data=K,this.collisionBoxArray=new F.a8;const Pe=new F.cE(Object.keys(K.layers).sort()),je=new F.cF(this.tileID,this.promoteId);je.bucketLayerIDs=[];const Re={},Je={featureIndex:je,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:re,subdivisionGranularity:Ae},ht=ee.familiesBySource[this.source];for(const Lt in ht){const di=K.layers[Lt];if(!di)continue;di.version===1&&F.w(`Vector tile source "${this.source}" layer "${Lt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bi=Pe.encode(Lt),pt=[];for(let Ar=0;Ar<di.length;Ar++){const Ur=di.feature(Ar),Ba=je.getId(Ur,Lt);pt.push({feature:Ur,id:Ba,index:Ar,sourceLayerIndex:Bi})}for(const Ar of ht[Lt]){const Ur=Ar[0];Ur.source!==this.source&&F.w(`layer.source = ${Ur.source} does not equal this.source = ${this.source}`),Ur.minzoom&&this.zoom<Math.floor(Ur.minzoom)||Ur.maxzoom&&this.zoom>=Ur.maxzoom||Ur.visibility!=="none"&&(Ce(Ar,this.zoom,re,this.globalState),(Re[Ur.id]=Ur.createBucket({index:je.bucketLayerIDs.length,layers:Ar,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bi,sourceID:this.source,globalState:this.globalState})).populate(pt,Je,this.tileID.canonical),je.bucketLayerIDs.push(Ar.map(Ba=>Ba.id)))}}const at=F.bN(Je.glyphDependencies,Lt=>Object.keys(Lt).map(Number));this.inFlightDependencies.forEach(Lt=>Lt==null?void 0:Lt.abort()),this.inFlightDependencies=[];let Dt=Promise.resolve({});if(Object.keys(at).length){const Lt=new AbortController;this.inFlightDependencies.push(Lt),Dt=me.sendAsync({type:"GG",data:{stacks:at,source:this.source,tileID:this.tileID,type:"glyphs"}},Lt)}const ke=Object.keys(Je.iconDependencies);let Tt=Promise.resolve({});if(ke.length){const Lt=new AbortController;this.inFlightDependencies.push(Lt),Tt=me.sendAsync({type:"GI",data:{icons:ke,source:this.source,tileID:this.tileID,type:"icons"}},Lt)}const Ti=Object.keys(Je.patternDependencies);let $t=Promise.resolve({});if(Ti.length){const Lt=new AbortController;this.inFlightDependencies.push(Lt),$t=me.sendAsync({type:"GI",data:{icons:Ti,source:this.source,tileID:this.tileID,type:"patterns"}},Lt)}const[hi,Ii,Yi]=yield Promise.all([Dt,Tt,$t]),er=new se(hi),Mi=new F.cG(Ii,Yi);for(const Lt in Re){const di=Re[Lt];di instanceof F.a9?(Ce(di.layers,this.zoom,re,this.globalState),F.cH({bucket:di,glyphMap:hi,glyphPositions:er.positions,imageMap:Ii,imagePositions:Mi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Je.subdivisionGranularity})):di.hasPattern&&(di instanceof F.cI||di instanceof F.cJ||di instanceof F.cK)&&(Ce(di.layers,this.zoom,re,this.globalState),di.addFeatures(Je,this.tileID.canonical,Mi.patternPositions))}return this.status="done",{buckets:Object.values(Re).filter(Lt=>!Lt.isEmpty()),featureIndex:je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:er.image,imageAtlas:Mi,glyphMap:this.returnDependencies?hi:null,iconMap:this.returnDependencies?Ii:null,glyphPositions:this.returnDependencies?er.positions:null}})}}function Ce(Ee,K,ee,re){const me=new F.F(K,{globalState:re});for(const Ae of Ee)Ae.recalculate(me,ee)}class Ze{constructor(K,ee,re){this.actor=K,this.layerIndex=ee,this.availableImages=re,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(K,ee){return F._(this,void 0,void 0,function*(){const re=yield F.n(K.request,ee);try{return{vectorTile:new F.cL(new F.cM(re.data)),rawData:re.data,cacheControl:re.cacheControl,expires:re.expires}}catch(me){const Ae=new Uint8Array(re.data);let Pe=`Unable to parse the tile at ${K.request.url}, `;throw Pe+=Ae[0]===31&&Ae[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${me.message}`,new Error(Pe)}})}loadTile(K){return F._(this,void 0,void 0,function*(){const ee=K.uid,re=!!(K&&K.request&&K.request.collectResourceTiming)&&new F.cN(K.request),me=new pe(K);this.loading[ee]=me;const Ae=new AbortController;me.abort=Ae;try{const Pe=yield this.loadVectorTile(K,Ae);if(delete this.loading[ee],!Pe)return null;const je=Pe.rawData,Re={};Pe.expires&&(Re.expires=Pe.expires),Pe.cacheControl&&(Re.cacheControl=Pe.cacheControl);const Je={};if(re){const at=re.finish();at&&(Je.resourceTiming=JSON.parse(JSON.stringify(at)))}me.vectorTile=Pe.vectorTile;const ht=me.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity);this.loaded[ee]=me,this.fetching[ee]={rawTileData:je,cacheControl:Re,resourceTiming:Je};try{const at=yield ht;return F.e({rawTileData:je.slice(0)},at,Re,Je)}finally{delete this.fetching[ee]}}catch(Pe){throw delete this.loading[ee],me.status="done",this.loaded[ee]=me,Pe}})}reloadTile(K){return F._(this,void 0,void 0,function*(){const ee=K.uid;if(!this.loaded||!this.loaded[ee])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const re=this.loaded[ee];if(re.showCollisionBoxes=K.showCollisionBoxes,re.globalState=K.globalState,re.status==="parsing"){const me=yield re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity);let Ae;if(this.fetching[ee]){const{rawTileData:Pe,cacheControl:je,resourceTiming:Re}=this.fetching[ee];delete this.fetching[ee],Ae=F.e({rawTileData:Pe.slice(0)},me,je,Re)}else Ae=me;return Ae}if(re.status==="done"&&re.vectorTile)return re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity)})}abortTile(K){return F._(this,void 0,void 0,function*(){const ee=this.loading,re=K.uid;ee&&ee[re]&&ee[re].abort&&(ee[re].abort.abort(),delete ee[re])})}removeTile(K){return F._(this,void 0,void 0,function*(){this.loaded&&this.loaded[K.uid]&&delete this.loaded[K.uid]})}}class Le{constructor(){this.loaded={}}loadTile(K){return F._(this,void 0,void 0,function*(){const{uid:ee,encoding:re,rawImageData:me,redFactor:Ae,greenFactor:Pe,blueFactor:je,baseShift:Re}=K,Je=me.width+2,ht=me.height+2,at=F.b(me)?new F.R({width:Je,height:ht},yield F.cO(me,-1,-1,Je,ht)):me,Dt=new F.cP(ee,at,re,Ae,Pe,je,Re);return this.loaded=this.loaded||{},this.loaded[ee]=Dt,Dt})}removeTile(K){const ee=this.loaded,re=K.uid;ee&&ee[re]&&delete ee[re]}}var Se,wt,Ut=function(){if(wt)return Se;function Ee(ee,re){if(ee.length!==0){K(ee[0],re);for(var me=1;me<ee.length;me++)K(ee[me],!re)}}function K(ee,re){for(var me=0,Ae=0,Pe=0,je=ee.length,Re=je-1;Pe<je;Re=Pe++){var Je=(ee[Pe][0]-ee[Re][0])*(ee[Re][1]+ee[Pe][1]),ht=me+Je;Ae+=Math.abs(me)>=Math.abs(Je)?me-ht+Je:Je-ht+me,me=ht}me+Ae>=0!=!!re&&ee.reverse()}return wt=1,Se=function ee(re,me){var Ae,Pe=re&&re.type;if(Pe==="FeatureCollection")for(Ae=0;Ae<re.features.length;Ae++)ee(re.features[Ae],me);else if(Pe==="GeometryCollection")for(Ae=0;Ae<re.geometries.length;Ae++)ee(re.geometries[Ae],me);else if(Pe==="Feature")ee(re.geometry,me);else if(Pe==="Polygon")Ee(re.coordinates,me);else if(Pe==="MultiPolygon")for(Ae=0;Ae<re.coordinates.length;Ae++)Ee(re.coordinates[Ae],me);return re}}(),Et=F.cQ(Ut);class Yt extends F.cS{constructor(K,ee){super(new F.cM,0,ee,[],[]),this.feature=K,this.type=K.type,this.properties=K.tags?K.tags:{},"id"in K&&(typeof K.id=="string"?this.id=parseInt(K.id,10):typeof K.id!="number"||isNaN(K.id)||(this.id=K.id))}loadGeometry(){const K=[],ee=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const re of ee){const me=[];for(const Ae of re)me.push(new F.P(Ae[0],Ae[1]));K.push(me)}return K}}class Nt extends F.cR{constructor(K,ee){super(new F.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=ee?ee.version:1,this.extent=ee?ee.extent:4096,this.length=K.length,this.features=K}feature(K){return new Yt(this.features[K],this.extent)}}function ot(Ee,K){K.writeVarintField(15,Ee.version||1),K.writeStringField(1,Ee.name||""),K.writeVarintField(5,Ee.extent||4096);const ee={keys:[],values:[],keycache:{},valuecache:{}};for(let Ae=0;Ae<Ee.length;Ae++)ee.feature=Ee.feature(Ae),K.writeMessage(2,St,ee);const re=ee.keys;for(const Ae of re)K.writeStringField(3,Ae);const me=ee.values;for(const Ae of me)K.writeMessage(4,ui,Ae)}function St(Ee,K){if(!Ee.feature)return;const ee=Ee.feature;ee.id!==void 0&&K.writeVarintField(1,ee.id),K.writeMessage(2,Rt,Ee),K.writeVarintField(3,ee.type),K.writeMessage(4,zt,ee)}function Rt(Ee,K){var ee;for(const re in(ee=Ee.feature)==null?void 0:ee.properties){let me=Ee.feature.properties[re],Ae=Ee.keycache[re];if(me===null)continue;Ae===void 0&&(Ee.keys.push(re),Ae=Ee.keys.length-1,Ee.keycache[re]=Ae),K.writeVarint(Ae),typeof me!="string"&&typeof me!="boolean"&&typeof me!="number"&&(me=JSON.stringify(me));const Pe=typeof me+":"+me;let je=Ee.valuecache[Pe];je===void 0&&(Ee.values.push(me),je=Ee.values.length-1,Ee.valuecache[Pe]=je),K.writeVarint(je)}}function Gt(Ee,K){return(K<<3)+(7&Ee)}function ti(Ee){return Ee<<1^Ee>>31}function zt(Ee,K){const ee=Ee.loadGeometry(),re=Ee.type;let me=0,Ae=0;for(const Pe of ee){let je=1;re===1&&(je=Pe.length),K.writeVarint(Gt(1,je));const Re=re===3?Pe.length-1:Pe.length;for(let Je=0;Je<Re;Je++){Je===1&&re!==1&&K.writeVarint(Gt(2,Re-1));const ht=Pe[Je].x-me,at=Pe[Je].y-Ae;K.writeVarint(ti(ht)),K.writeVarint(ti(at)),me+=ht,Ae+=at}Ee.type===3&&K.writeVarint(Gt(7,1))}}function ui(Ee,K){const ee=typeof Ee;ee==="string"?K.writeStringField(1,Ee):ee==="boolean"?K.writeBooleanField(7,Ee):ee==="number"&&(Ee%1!=0?K.writeDoubleField(3,Ee):Ee<0?K.writeSVarintField(6,Ee):K.writeVarintField(5,Ee))}const Pi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ee=>Ee},$e=Math.fround||(Ji=new Float32Array(1),Ee=>(Ji[0]=+Ee,Ji[0]));var Ji;class ft{constructor(K){this.options=Object.assign(Object.create(Pi),K),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(K){const{log:ee,minZoom:re,maxZoom:me}=this.options;ee&&console.time("total time");const Ae=`prepare ${K.length} points`;ee&&console.time(Ae),this.points=K;const Pe=[];for(let Re=0;Re<K.length;Re++){const Je=K[Re];if(!Je.geometry)continue;const[ht,at]=Je.geometry.coordinates,Dt=$e(Qe(ht)),ke=$e(bt(at));Pe.push(Dt,ke,1/0,Re,-1,1),this.options.reduce&&Pe.push(0)}let je=this.trees[me+1]=this._createTree(Pe);ee&&console.timeEnd(Ae);for(let Re=me;Re>=re;Re--){const Je=+Date.now();je=this.trees[Re]=this._createTree(this._cluster(je,Re)),ee&&console.log("z%d: %d clusters in %dms",Re,je.numItems,+Date.now()-Je)}return ee&&console.timeEnd("total time"),this}getClusters(K,ee){let re=((K[0]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,K[1]));let Ae=K[2]===180?180:((K[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)re=-180,Ae=180;else if(re>Ae){const at=this.getClusters([re,me,180,Pe],ee),Dt=this.getClusters([-180,me,Ae,Pe],ee);return at.concat(Dt)}const je=this.trees[this._limitZoom(ee)],Re=je.range(Qe(re),bt(Pe),Qe(Ae),bt(me)),Je=je.data,ht=[];for(const at of Re){const Dt=this.stride*at;ht.push(Je[Dt+5]>1?fn(Je,Dt,this.clusterProps):this.points[Je[Dt+3]])}return ht}getChildren(K){const ee=this._getOriginId(K),re=this._getOriginZoom(K),me="No cluster with the specified id.",Ae=this.trees[re];if(!Ae)throw new Error(me);const Pe=Ae.data;if(ee*this.stride>=Pe.length)throw new Error(me);const je=this.options.radius/(this.options.extent*Math.pow(2,re-1)),Re=Ae.within(Pe[ee*this.stride],Pe[ee*this.stride+1],je),Je=[];for(const ht of Re){const at=ht*this.stride;Pe[at+4]===K&&Je.push(Pe[at+5]>1?fn(Pe,at,this.clusterProps):this.points[Pe[at+3]])}if(Je.length===0)throw new Error(me);return Je}getLeaves(K,ee,re){const me=[];return this._appendLeaves(me,K,ee=ee||10,re=re||0,0),me}getTile(K,ee,re){const me=this.trees[this._limitZoom(K)],Ae=Math.pow(2,K),{extent:Pe,radius:je}=this.options,Re=je/Pe,Je=(re-Re)/Ae,ht=(re+1+Re)/Ae,at={features:[]};return this._addTileFeatures(me.range((ee-Re)/Ae,Je,(ee+1+Re)/Ae,ht),me.data,ee,re,Ae,at),ee===0&&this._addTileFeatures(me.range(1-Re/Ae,Je,1,ht),me.data,Ae,re,Ae,at),ee===Ae-1&&this._addTileFeatures(me.range(0,Je,Re/Ae,ht),me.data,-1,re,Ae,at),at.features.length?at:null}getClusterExpansionZoom(K){let ee=this._getOriginZoom(K)-1;for(;ee<=this.options.maxZoom;){const re=this.getChildren(K);if(ee++,re.length!==1)break;K=re[0].properties.cluster_id}return ee}_appendLeaves(K,ee,re,me,Ae){const Pe=this.getChildren(ee);for(const je of Pe){const Re=je.properties;if(Re&&Re.cluster?Ae+Re.point_count<=me?Ae+=Re.point_count:Ae=this._appendLeaves(K,Re.cluster_id,re,me,Ae):Ae<me?Ae++:K.push(je),K.length===re)break}return Ae}_createTree(K){const ee=new F.aI(K.length/this.stride|0,this.options.nodeSize,Float32Array);for(let re=0;re<K.length;re+=this.stride)ee.add(K[re],K[re+1]);return ee.finish(),ee.data=K,ee}_addTileFeatures(K,ee,re,me,Ae,Pe){for(const je of K){const Re=je*this.stride,Je=ee[Re+5]>1;let ht,at,Dt;if(Je)ht=Ri(ee,Re,this.clusterProps),at=ee[Re],Dt=ee[Re+1];else{const Ti=this.points[ee[Re+3]];ht=Ti.properties;const[$t,hi]=Ti.geometry.coordinates;at=Qe($t),Dt=bt(hi)}const ke={type:1,geometry:[[Math.round(this.options.extent*(at*Ae-re)),Math.round(this.options.extent*(Dt*Ae-me))]],tags:ht};let Tt;Tt=Je||this.options.generateId?ee[Re+3]:this.points[ee[Re+3]].id,Tt!==void 0&&(ke.id=Tt),Pe.features.push(ke)}}_limitZoom(K){return Math.max(this.options.minZoom,Math.min(Math.floor(+K),this.options.maxZoom+1))}_cluster(K,ee){const{radius:re,extent:me,reduce:Ae,minPoints:Pe}=this.options,je=re/(me*Math.pow(2,ee)),Re=K.data,Je=[],ht=this.stride;for(let at=0;at<Re.length;at+=ht){if(Re[at+2]<=ee)continue;Re[at+2]=ee;const Dt=Re[at],ke=Re[at+1],Tt=K.within(Re[at],Re[at+1],je),Ti=Re[at+5];let $t=Ti;for(const hi of Tt){const Ii=hi*ht;Re[Ii+2]>ee&&($t+=Re[Ii+5])}if($t>Ti&&$t>=Pe){let hi,Ii=Dt*Ti,Yi=ke*Ti,er=-1;const Mi=(at/ht<<5)+(ee+1)+this.points.length;for(const Lt of Tt){const di=Lt*ht;if(Re[di+2]<=ee)continue;Re[di+2]=ee;const Bi=Re[di+5];Ii+=Re[di]*Bi,Yi+=Re[di+1]*Bi,Re[di+4]=Mi,Ae&&(hi||(hi=this._map(Re,at,!0),er=this.clusterProps.length,this.clusterProps.push(hi)),Ae(hi,this._map(Re,di)))}Re[at+4]=Mi,Je.push(Ii/$t,Yi/$t,1/0,Mi,-1,$t),Ae&&Je.push(er)}else{for(let hi=0;hi<ht;hi++)Je.push(Re[at+hi]);if($t>1)for(const hi of Tt){const Ii=hi*ht;if(!(Re[Ii+2]<=ee)){Re[Ii+2]=ee;for(let Yi=0;Yi<ht;Yi++)Je.push(Re[Ii+Yi])}}}}return Je}_getOriginId(K){return K-this.points.length>>5}_getOriginZoom(K){return(K-this.points.length)%32}_map(K,ee,re){if(K[ee+5]>1){const Pe=this.clusterProps[K[ee+6]];return re?Object.assign({},Pe):Pe}const me=this.points[K[ee+3]].properties,Ae=this.options.map(me);return re&&Ae===me?Object.assign({},Ae):Ae}}function fn(Ee,K,ee){return{type:"Feature",id:Ee[K+3],properties:Ri(Ee,K,ee),geometry:{type:"Point",coordinates:[(re=Ee[K],360*(re-.5)),Be(Ee[K+1])]}};var re}function Ri(Ee,K,ee){const re=Ee[K+5],me=re>=1e4?`${Math.round(re/1e3)}k`:re>=1e3?Math.round(re/100)/10+"k":re,Ae=Ee[K+6],Pe=Ae===-1?{}:Object.assign({},ee[Ae]);return Object.assign(Pe,{cluster:!0,cluster_id:Ee[K+3],point_count:re,point_count_abbreviated:me})}function Qe(Ee){return Ee/360+.5}function bt(Ee){const K=Math.sin(Ee*Math.PI/180),ee=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return ee<0?0:ee>1?1:ee}function Be(Ee){const K=(180-360*Ee)*Math.PI/180;return 360*Math.atan(Math.exp(K))/Math.PI-90}function _t(Ee,K,ee,re){let me=re;const Ae=K+(ee-K>>1);let Pe,je=ee-K;const Re=Ee[K],Je=Ee[K+1],ht=Ee[ee],at=Ee[ee+1];for(let Dt=K+3;Dt<ee;Dt+=3){const ke=_e(Ee[Dt],Ee[Dt+1],Re,Je,ht,at);if(ke>me)Pe=Dt,me=ke;else if(ke===me){const Tt=Math.abs(Dt-Ae);Tt<je&&(Pe=Dt,je=Tt)}}me>re&&(Pe-K>3&&_t(Ee,K,Pe,re),Ee[Pe+2]=me,ee-Pe>3&&_t(Ee,Pe,ee,re))}function _e(Ee,K,ee,re,me,Ae){let Pe=me-ee,je=Ae-re;if(Pe!==0||je!==0){const Re=((Ee-ee)*Pe+(K-re)*je)/(Pe*Pe+je*je);Re>1?(ee=me,re=Ae):Re>0&&(ee+=Pe*Re,re+=je*Re)}return Pe=Ee-ee,je=K-re,Pe*Pe+je*je}function rt(Ee,K,ee,re){const me={id:Ee??null,type:K,geometry:ee,tags:re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(K==="Point"||K==="MultiPoint"||K==="LineString")It(me,ee);else if(K==="Polygon")It(me,ee[0]);else if(K==="MultiLineString")for(const Ae of ee)It(me,Ae);else if(K==="MultiPolygon")for(const Ae of ee)It(me,Ae[0]);return me}function It(Ee,K){for(let ee=0;ee<K.length;ee+=3)Ee.minX=Math.min(Ee.minX,K[ee]),Ee.minY=Math.min(Ee.minY,K[ee+1]),Ee.maxX=Math.max(Ee.maxX,K[ee]),Ee.maxY=Math.max(Ee.maxY,K[ee+1])}function mt(Ee,K,ee,re){if(!K.geometry)return;const me=K.geometry.coordinates;if(me&&me.length===0)return;const Ae=K.geometry.type,Pe=Math.pow(ee.tolerance/((1<<ee.maxZoom)*ee.extent),2);let je=[],Re=K.id;if(ee.promoteId?Re=K.properties[ee.promoteId]:ee.generateId&&(Re=re||0),Ae==="Point")ut(me,je);else if(Ae==="MultiPoint")for(const Je of me)ut(Je,je);else if(Ae==="LineString")bi(me,je,Pe,!1);else if(Ae==="MultiLineString"){if(ee.lineMetrics){for(const Je of me)je=[],bi(Je,je,Pe,!1),Ee.push(rt(Re,"LineString",je,K.properties));return}Zt(me,je,Pe,!1)}else if(Ae==="Polygon")Zt(me,je,Pe,!0);else{if(Ae!=="MultiPolygon"){if(Ae==="GeometryCollection"){for(const Je of K.geometry.geometries)mt(Ee,{id:Re,geometry:Je,properties:K.properties},ee,re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Je of me){const ht=[];Zt(Je,ht,Pe,!0),je.push(ht)}}Ee.push(rt(Re,Ae,je,K.properties))}function ut(Ee,K){K.push(Di(Ee[0]),Ei(Ee[1]),0)}function bi(Ee,K,ee,re){let me,Ae,Pe=0;for(let Re=0;Re<Ee.length;Re++){const Je=Di(Ee[Re][0]),ht=Ei(Ee[Re][1]);K.push(Je,ht,0),Re>0&&(Pe+=re?(me*ht-Je*Ae)/2:Math.sqrt(Math.pow(Je-me,2)+Math.pow(ht-Ae,2))),me=Je,Ae=ht}const je=K.length-3;K[2]=1,_t(K,0,je,ee),K[je+2]=1,K.size=Math.abs(Pe),K.start=0,K.end=K.size}function Zt(Ee,K,ee,re){for(let me=0;me<Ee.length;me++){const Ae=[];bi(Ee[me],Ae,ee,re),K.push(Ae)}}function Di(Ee){return Ee/360+.5}function Ei(Ee){const K=Math.sin(Ee*Math.PI/180),ee=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return ee<0?0:ee>1?1:ee}function kr(Ee,K,ee,re,me,Ae,Pe,je){if(re/=K,Ae>=(ee/=K)&&Pe<re)return Ee;if(Pe<ee||Ae>=re)return null;const Re=[];for(const Je of Ee){const ht=Je.geometry;let at=Je.type;const Dt=me===0?Je.minX:Je.minY,ke=me===0?Je.maxX:Je.maxY;if(Dt>=ee&&ke<re){Re.push(Je);continue}if(ke<ee||Dt>=re)continue;let Tt=[];if(at==="Point"||at==="MultiPoint")jn(ht,Tt,ee,re,me);else if(at==="LineString")Hn(ht,Tt,ee,re,me,!1,je.lineMetrics);else if(at==="MultiLineString")xi(ht,Tt,ee,re,me,!1);else if(at==="Polygon")xi(ht,Tt,ee,re,me,!0);else if(at==="MultiPolygon")for(const Ti of ht){const $t=[];xi(Ti,$t,ee,re,me,!0),$t.length&&Tt.push($t)}if(Tt.length){if(je.lineMetrics&&at==="LineString"){for(const Ti of Tt)Re.push(rt(Je.id,at,Ti,Je.tags));continue}at!=="LineString"&&at!=="MultiLineString"||(Tt.length===1?(at="LineString",Tt=Tt[0]):at="MultiLineString"),at!=="Point"&&at!=="MultiPoint"||(at=Tt.length===3?"Point":"MultiPoint"),Re.push(rt(Je.id,at,Tt,Je.tags))}}return Re.length?Re:null}function jn(Ee,K,ee,re,me){for(let Ae=0;Ae<Ee.length;Ae+=3){const Pe=Ee[Ae+me];Pe>=ee&&Pe<=re&&Qr(K,Ee[Ae],Ee[Ae+1],Ee[Ae+2])}}function Hn(Ee,K,ee,re,me,Ae,Pe){let je=sr(Ee);const Re=me===0?oa:rs;let Je,ht,at=Ee.start;for(let $t=0;$t<Ee.length-3;$t+=3){const hi=Ee[$t],Ii=Ee[$t+1],Yi=Ee[$t+2],er=Ee[$t+3],Mi=Ee[$t+4],Lt=me===0?hi:Ii,di=me===0?er:Mi;let Bi=!1;Pe&&(Je=Math.sqrt(Math.pow(hi-er,2)+Math.pow(Ii-Mi,2))),Lt<ee?di>ee&&(ht=Re(je,hi,Ii,er,Mi,ee),Pe&&(je.start=at+Je*ht)):Lt>re?di<re&&(ht=Re(je,hi,Ii,er,Mi,re),Pe&&(je.start=at+Je*ht)):Qr(je,hi,Ii,Yi),di<ee&&Lt>=ee&&(ht=Re(je,hi,Ii,er,Mi,ee),Bi=!0),di>re&&Lt<=re&&(ht=Re(je,hi,Ii,er,Mi,re),Bi=!0),!Ae&&Bi&&(Pe&&(je.end=at+Je*ht),K.push(je),je=sr(Ee)),Pe&&(at+=Je)}let Dt=Ee.length-3;const ke=Ee[Dt],Tt=Ee[Dt+1],Ti=me===0?ke:Tt;Ti>=ee&&Ti<=re&&Qr(je,ke,Tt,Ee[Dt+2]),Dt=je.length-3,Ae&&Dt>=3&&(je[Dt]!==je[0]||je[Dt+1]!==je[1])&&Qr(je,je[0],je[1],je[2]),je.length&&K.push(je)}function sr(Ee){const K=[];return K.size=Ee.size,K.start=Ee.start,K.end=Ee.end,K}function xi(Ee,K,ee,re,me,Ae){for(const Pe of Ee)Hn(Pe,K,ee,re,me,Ae,!1)}function Qr(Ee,K,ee,re){Ee.push(K,ee,re)}function oa(Ee,K,ee,re,me,Ae){const Pe=(Ae-K)/(re-K);return Qr(Ee,Ae,ee+(me-ee)*Pe,1),Pe}function rs(Ee,K,ee,re,me,Ae){const Pe=(Ae-ee)/(me-ee);return Qr(Ee,K+(re-K)*Pe,Ae,1),Pe}function sn(Ee,K){const ee=[];for(let re=0;re<Ee.length;re++){const me=Ee[re],Ae=me.type;let Pe;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")Pe=Nn(me.geometry,K);else if(Ae==="MultiLineString"||Ae==="Polygon"){Pe=[];for(const je of me.geometry)Pe.push(Nn(je,K))}else if(Ae==="MultiPolygon"){Pe=[];for(const je of me.geometry){const Re=[];for(const Je of je)Re.push(Nn(Je,K));Pe.push(Re)}}ee.push(rt(me.id,Ae,Pe,me.tags))}return ee}function Nn(Ee,K){const ee=[];ee.size=Ee.size,Ee.start!==void 0&&(ee.start=Ee.start,ee.end=Ee.end);for(let re=0;re<Ee.length;re+=3)ee.push(Ee[re]+K,Ee[re+1],Ee[re+2]);return ee}function ns(Ee,K){if(Ee.transformed)return Ee;const ee=1<<Ee.z,re=Ee.x,me=Ee.y;for(const Ae of Ee.features){const Pe=Ae.geometry,je=Ae.type;if(Ae.geometry=[],je===1)for(let Re=0;Re<Pe.length;Re+=2)Ae.geometry.push(Wo(Pe[Re],Pe[Re+1],K,ee,re,me));else for(let Re=0;Re<Pe.length;Re++){const Je=[];for(let ht=0;ht<Pe[Re].length;ht+=2)Je.push(Wo(Pe[Re][ht],Pe[Re][ht+1],K,ee,re,me));Ae.geometry.push(Je)}}return Ee.transformed=!0,Ee}function Wo(Ee,K,ee,re,me,Ae){return[Math.round(ee*(Ee*re-me)),Math.round(ee*(K*re-Ae))]}function as(Ee,K,ee,re,me){const Ae=K===me.maxZoom?0:me.tolerance/((1<<K)*me.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:Ee.length,source:null,x:ee,y:re,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const je of Ee)La(Pe,je,Ae,me);return Pe}function La(Ee,K,ee,re){const me=K.geometry,Ae=K.type,Pe=[];if(Ee.minX=Math.min(Ee.minX,K.minX),Ee.minY=Math.min(Ee.minY,K.minY),Ee.maxX=Math.max(Ee.maxX,K.maxX),Ee.maxY=Math.max(Ee.maxY,K.maxY),Ae==="Point"||Ae==="MultiPoint")for(let je=0;je<me.length;je+=3)Pe.push(me[je],me[je+1]),Ee.numPoints++,Ee.numSimplified++;else if(Ae==="LineString")Ns(Pe,me,Ee,ee,!1,!1);else if(Ae==="MultiLineString"||Ae==="Polygon")for(let je=0;je<me.length;je++)Ns(Pe,me[je],Ee,ee,Ae==="Polygon",je===0);else if(Ae==="MultiPolygon")for(let je=0;je<me.length;je++){const Re=me[je];for(let Je=0;Je<Re.length;Je++)Ns(Pe,Re[Je],Ee,ee,!0,Je===0)}if(Pe.length){let je=K.tags||null;if(Ae==="LineString"&&re.lineMetrics){je={};for(const Je in K.tags)je[Je]=K.tags[Je];je.mapbox_clip_start=me.start/me.size,je.mapbox_clip_end=me.end/me.size}const Re={geometry:Pe,type:Ae==="Polygon"||Ae==="MultiPolygon"?3:Ae==="LineString"||Ae==="MultiLineString"?2:1,tags:je};K.id!==null&&(Re.id=K.id),Ee.features.push(Re)}}function Ns(Ee,K,ee,re,me,Ae){const Pe=re*re;if(re>0&&K.size<(me?Pe:re))return void(ee.numPoints+=K.length/3);const je=[];for(let Re=0;Re<K.length;Re+=3)(re===0||K[Re+2]>Pe)&&(ee.numSimplified++,je.push(K[Re],K[Re+1])),ee.numPoints++;me&&function(Re,Je){let ht=0;for(let at=0,Dt=Re.length,ke=Dt-2;at<Dt;ke=at,at+=2)ht+=(Re[at]-Re[ke])*(Re[at+1]+Re[ke+1]);if(ht>0===Je)for(let at=0,Dt=Re.length;at<Dt/2;at+=2){const ke=Re[at],Tt=Re[at+1];Re[at]=Re[Dt-2-at],Re[at+1]=Re[Dt-1-at],Re[Dt-2-at]=ke,Re[Dt-1-at]=Tt}}(je,Ae),Ee.push(je)}const Vl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ko{constructor(K,ee){const re=(ee=this.options=function(Ae,Pe){for(const je in Pe)Ae[je]=Pe[je];return Ae}(Object.create(Vl),ee)).debug;if(re&&console.time("preprocess data"),ee.maxZoom<0||ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ee.promoteId&&ee.generateId)throw new Error("promoteId and generateId cannot be used together.");let me=function(Ae,Pe){const je=[];if(Ae.type==="FeatureCollection")for(let Re=0;Re<Ae.features.length;Re++)mt(je,Ae.features[Re],Pe,Re);else mt(je,Ae.type==="Feature"?Ae:{geometry:Ae},Pe);return je}(K,ee);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ee.indexMaxZoom,ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),me=function(Ae,Pe){const je=Pe.buffer/Pe.extent;let Re=Ae;const Je=kr(Ae,1,-1-je,je,0,-1,2,Pe),ht=kr(Ae,1,1-je,2+je,0,-1,2,Pe);return(Je||ht)&&(Re=kr(Ae,1,-je,1+je,0,-1,2,Pe)||[],Je&&(Re=sn(Je,1).concat(Re)),ht&&(Re=Re.concat(sn(ht,-1)))),Re}(me,ee),me.length&&this.splitTile(me,0,0,0),re&&(me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(K,ee,re,me,Ae,Pe,je){const Re=[K,ee,re,me],Je=this.options,ht=Je.debug;for(;Re.length;){me=Re.pop(),re=Re.pop(),ee=Re.pop(),K=Re.pop();const at=1<<ee,Dt=ss(ee,re,me);let ke=this.tiles[Dt];if(!ke&&(ht>1&&console.time("creation"),ke=this.tiles[Dt]=as(K,ee,re,me,Je),this.tileCoords.push({z:ee,x:re,y:me}),ht)){ht>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ee,re,me,ke.numFeatures,ke.numPoints,ke.numSimplified),console.timeEnd("creation"));const Bi=`z${ee}`;this.stats[Bi]=(this.stats[Bi]||0)+1,this.total++}if(ke.source=K,Ae==null){if(ee===Je.indexMaxZoom||ke.numPoints<=Je.indexMaxPoints)continue}else{if(ee===Je.maxZoom||ee===Ae)continue;if(Ae!=null){const Bi=Ae-ee;if(re!==Pe>>Bi||me!==je>>Bi)continue}}if(ke.source=null,K.length===0)continue;ht>1&&console.time("clipping");const Tt=.5*Je.buffer/Je.extent,Ti=.5-Tt,$t=.5+Tt,hi=1+Tt;let Ii=null,Yi=null,er=null,Mi=null,Lt=kr(K,at,re-Tt,re+$t,0,ke.minX,ke.maxX,Je),di=kr(K,at,re+Ti,re+hi,0,ke.minX,ke.maxX,Je);K=null,Lt&&(Ii=kr(Lt,at,me-Tt,me+$t,1,ke.minY,ke.maxY,Je),Yi=kr(Lt,at,me+Ti,me+hi,1,ke.minY,ke.maxY,Je),Lt=null),di&&(er=kr(di,at,me-Tt,me+$t,1,ke.minY,ke.maxY,Je),Mi=kr(di,at,me+Ti,me+hi,1,ke.minY,ke.maxY,Je),di=null),ht>1&&console.timeEnd("clipping"),Re.push(Ii||[],ee+1,2*re,2*me),Re.push(Yi||[],ee+1,2*re,2*me+1),Re.push(er||[],ee+1,2*re+1,2*me),Re.push(Mi||[],ee+1,2*re+1,2*me+1)}}getTile(K,ee,re){K=+K,ee=+ee,re=+re;const me=this.options,{extent:Ae,debug:Pe}=me;if(K<0||K>24)return null;const je=1<<K,Re=ss(K,ee=ee+je&je-1,re);if(this.tiles[Re])return ns(this.tiles[Re],Ae);Pe>1&&console.log("drilling down to z%d-%d-%d",K,ee,re);let Je,ht=K,at=ee,Dt=re;for(;!Je&&ht>0;)ht--,at>>=1,Dt>>=1,Je=this.tiles[ss(ht,at,Dt)];return Je&&Je.source?(Pe>1&&(console.log("found parent tile z%d-%d-%d",ht,at,Dt),console.time("drilling down")),this.splitTile(Je.source,ht,at,Dt,K,ee,re),Pe>1&&console.timeEnd("drilling down"),this.tiles[Re]?ns(this.tiles[Re],Ae):null):null}}function ss(Ee,K,ee){return 32*((1<<Ee)*ee+K)+Ee}class pn extends Ze{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(K,ee){return F._(this,void 0,void 0,function*(){const re=K.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const me=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!me)return null;const Ae=new Nt(me.features,{version:2,extent:F.$});let Pe=function(je){const Re=new F.cM;return function(Je,ht){for(const at in Je.layers)ht.writeMessage(3,ot,Je.layers[at])}(je,Re),Re.finish()}(Ae);return Pe.byteOffset===0&&Pe.byteLength===Pe.buffer.byteLength||(Pe=new Uint8Array(Pe)),{vectorTile:Ae,rawData:Pe.buffer}})}loadData(K){return F._(this,void 0,void 0,function*(){var ee;(ee=this._pendingRequest)===null||ee===void 0||ee.abort();const re=!!(K&&K.request&&K.request.collectResourceTiming)&&new F.cN(K.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(K,this._pendingRequest);const me=yield this._pendingData;this._geoJSONIndex=K.cluster?new ft(function({superclusterOptions:Pe,clusterProperties:je}){if(!je||!Pe)return Pe;const Re={},Je={},ht={accumulated:null,zoom:0},at={properties:null},Dt=Object.keys(je);for(const ke of Dt){const[Tt,Ti]=je[ke],$t=F.cT(Ti),hi=F.cT(typeof Tt=="string"?[Tt,["accumulated"],["get",ke]]:Tt);Re[ke]=$t.value,Je[ke]=hi.value}return Pe.map=ke=>{at.properties=ke;const Tt={};for(const Ti of Dt)Tt[Ti]=Re[Ti].evaluate(ht,at);return Tt},Pe.reduce=(ke,Tt)=>{at.properties=Tt;for(const Ti of Dt)ht.accumulated=ke[Ti],ke[Ti]=Je[Ti].evaluate(ht,at)},Pe}(K)).load(me.features):function(Pe,je){return new Ko(Pe,je)}(me,K.geojsonVtOptions),this.loaded={};const Ae={data:me};if(re){const Pe=re.finish();Pe&&(Ae.resourceTiming={},Ae.resourceTiming[K.source]=JSON.parse(JSON.stringify(Pe)))}return Ae}catch(me){if(delete this._pendingRequest,F.cy(me))return{abandoned:!0};throw me}})}getData(){return F._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(K){const ee=this.loaded;return ee&&ee[K.uid]?super.reloadTile(K):this.loadTile(K)}loadAndProcessGeoJSON(K,ee){return F._(this,void 0,void 0,function*(){let re=yield this.loadGeoJSON(K,ee);if(delete this._pendingRequest,typeof re!="object")throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`);if(Et(re,!0),K.filter){const me=F.cT(K.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(me.result==="error")throw new Error(me.value.map(Pe=>`${Pe.key}: ${Pe.message}`).join(", "));re={type:"FeatureCollection",features:re.features.filter(Pe=>me.value.evaluate({zoom:0},Pe))}}return re})}loadGeoJSON(K,ee){return F._(this,void 0,void 0,function*(){const{promoteId:re}=K;if(K.request){const me=yield F.j(K.request,ee);return this._dataUpdateable=F.cV(me.data,re)?F.cU(me.data,re):void 0,me.data}if(typeof K.data=="string")try{const me=JSON.parse(K.data);return this._dataUpdateable=F.cV(me,re)?F.cU(me,re):void 0,me}catch{throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`)}if(!K.dataDiff)throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${K.source}`);return F.cW(this._dataUpdateable,K.dataDiff,re),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(K){return F._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(K){return this._geoJSONIndex.getClusterExpansionZoom(K.clusterId)}getClusterChildren(K){return this._geoJSONIndex.getChildren(K.clusterId)}getClusterLeaves(K){return this._geoJSONIndex.getLeaves(K.clusterId,K.limit,K.offset)}}class ba{constructor(K){this.self=K,this.actor=new F.J(K),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ee,re)=>{if(this.externalWorkerSourceTypes[ee])throw new Error(`Worker source with name "${ee}" already registered.`);this.externalWorkerSourceTypes[ee]=re},this.self.addProtocol=F.cA,this.self.removeProtocol=F.cB,this.self.registerRTLTextPlugin=ee=>{F.cX.setMethods(ee)},this.actor.registerMessageHandler("LDT",(ee,re)=>this._getDEMWorkerSource(ee,re.source).loadTile(re)),this.actor.registerMessageHandler("RDT",(ee,re)=>F._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ee,re.source).removeTile(re)})),this.actor.registerMessageHandler("GCEZ",(ee,re)=>F._(this,void 0,void 0,function*(){return this._getWorkerSource(ee,re.type,re.source).getClusterExpansionZoom(re)})),this.actor.registerMessageHandler("GCC",(ee,re)=>F._(this,void 0,void 0,function*(){return this._getWorkerSource(ee,re.type,re.source).getClusterChildren(re)})),this.actor.registerMessageHandler("GCL",(ee,re)=>F._(this,void 0,void 0,function*(){return this._getWorkerSource(ee,re.type,re.source).getClusterLeaves(re)})),this.actor.registerMessageHandler("LD",(ee,re)=>this._getWorkerSource(ee,re.type,re.source).loadData(re)),this.actor.registerMessageHandler("GD",(ee,re)=>this._getWorkerSource(ee,re.type,re.source).getData()),this.actor.registerMessageHandler("LT",(ee,re)=>this._getWorkerSource(ee,re.type,re.source).loadTile(re)),this.actor.registerMessageHandler("RT",(ee,re)=>this._getWorkerSource(ee,re.type,re.source).reloadTile(re)),this.actor.registerMessageHandler("AT",(ee,re)=>this._getWorkerSource(ee,re.type,re.source).abortTile(re)),this.actor.registerMessageHandler("RMT",(ee,re)=>this._getWorkerSource(ee,re.type,re.source).removeTile(re)),this.actor.registerMessageHandler("RS",(ee,re)=>F._(this,void 0,void 0,function*(){if(!this.workerSources[ee]||!this.workerSources[ee][re.type]||!this.workerSources[ee][re.type][re.source])return;const me=this.workerSources[ee][re.type][re.source];delete this.workerSources[ee][re.type][re.source],me.removeSource!==void 0&&me.removeSource(re)})),this.actor.registerMessageHandler("RM",ee=>F._(this,void 0,void 0,function*(){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.workerSources[ee],delete this.demWorkerSources[ee]})),this.actor.registerMessageHandler("SR",(ee,re)=>F._(this,void 0,void 0,function*(){this.referrer=re})),this.actor.registerMessageHandler("SRPS",(ee,re)=>this._syncRTLPluginState(ee,re)),this.actor.registerMessageHandler("IS",(ee,re)=>F._(this,void 0,void 0,function*(){this.self.importScripts(re)})),this.actor.registerMessageHandler("SI",(ee,re)=>this._setImages(ee,re)),this.actor.registerMessageHandler("UL",(ee,re)=>F._(this,void 0,void 0,function*(){this._getLayerIndex(ee).update(re.layers,re.removedIds)})),this.actor.registerMessageHandler("SL",(ee,re)=>F._(this,void 0,void 0,function*(){this._getLayerIndex(ee).replace(re)}))}_setImages(K,ee){return F._(this,void 0,void 0,function*(){this.availableImages[K]=ee;for(const re in this.workerSources[K]){const me=this.workerSources[K][re];for(const Ae in me)me[Ae].availableImages=ee}})}_syncRTLPluginState(K,ee){return F._(this,void 0,void 0,function*(){return yield F.cX.syncState(ee,this.self.importScripts)})}_getAvailableImages(K){let ee=this.availableImages[K];return ee||(ee=[]),ee}_getLayerIndex(K){let ee=this.layerIndexes[K];return ee||(ee=this.layerIndexes[K]=new y),ee}_getWorkerSource(K,ee,re){if(this.workerSources[K]||(this.workerSources[K]={}),this.workerSources[K][ee]||(this.workerSources[K][ee]={}),!this.workerSources[K][ee][re]){const me={sendAsync:(Ae,Pe)=>(Ae.targetMapId=K,this.actor.sendAsync(Ae,Pe))};switch(ee){case"vector":this.workerSources[K][ee][re]=new Ze(me,this._getLayerIndex(K),this._getAvailableImages(K));break;case"geojson":this.workerSources[K][ee][re]=new pn(me,this._getLayerIndex(K),this._getAvailableImages(K));break;default:this.workerSources[K][ee][re]=new this.externalWorkerSourceTypes[ee](me,this._getLayerIndex(K),this._getAvailableImages(K))}}return this.workerSources[K][ee][re]}_getDEMWorkerSource(K,ee){return this.demWorkerSources[K]||(this.demWorkerSources[K]={}),this.demWorkerSources[K][ee]||(this.demWorkerSources[K][ee]=new Le),this.demWorkerSources[K][ee]}}return F.i(self)&&(self.worker=new ba(self)),ba}),Q("index",["exports","./shared"],function(F,y){var se="5.7.0";function pe(){var b=new y.A(4);return y.A!=Float32Array&&(b[1]=0,b[2]=0),b[0]=1,b[3]=1,b}let Ce,Ze;const Le={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(b,t,c){const f=requestAnimationFrame(S=>{x(),t(S)}),{unsubscribe:x}=y.s(b.signal,"abort",()=>{x(),cancelAnimationFrame(f),c(y.c())},!1)},frameAsync(b){return new Promise((t,c)=>{this.frame(b,t,c)})},getImageData(b,t=0){return this.getImageCanvasContext(b).getImageData(-t,-t,b.width+2*t,b.height+2*t)},getImageCanvasContext(b){const t=window.document.createElement("canvas"),c=t.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return t.width=b.width,t.height=b.height,c.drawImage(b,0,0,b.width,b.height),c},resolveURL:b=>(Ce||(Ce=document.createElement("a")),Ce.href=b,Ce.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Ze==null&&(Ze=matchMedia("(prefers-reduced-motion: reduce)")),Ze.matches)}};class Se{static testProp(t){if(!Se.docStyle)return t[0];for(let c=0;c<t.length;c++)if(t[c]in Se.docStyle)return t[c];return t[0]}static create(t,c,f){const x=window.document.createElement(t);return c!==void 0&&(x.className=c),f&&f.appendChild(x),x}static createNS(t,c){return window.document.createElementNS(t,c)}static disableDrag(){Se.docStyle&&Se.selectProp&&(Se.userSelect=Se.docStyle[Se.selectProp],Se.docStyle[Se.selectProp]="none")}static enableDrag(){Se.docStyle&&Se.selectProp&&(Se.docStyle[Se.selectProp]=Se.userSelect)}static setTransform(t,c){t.style[Se.transformProp]=c}static addEventListener(t,c,f,x={}){t.addEventListener(c,f,"passive"in x?x:x.capture)}static removeEventListener(t,c,f,x={}){t.removeEventListener(c,f,"passive"in x?x:x.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Se.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Se.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Se.suppressClickInternal,!0)},0)}static getScale(t){const c=t.getBoundingClientRect();return{x:c.width/t.offsetWidth||1,y:c.height/t.offsetHeight||1,boundingClientRect:c}}static getPoint(t,c,f){const x=c.boundingClientRect;return new y.P((f.clientX-x.left)/c.x-t.clientLeft,(f.clientY-x.top)/c.y-t.clientTop)}static mousePos(t,c){const f=Se.getScale(t);return Se.getPoint(t,f,c)}static touchPos(t,c){const f=[],x=Se.getScale(t);for(let S=0;S<c.length;S++)f.push(Se.getPoint(t,x,c[S]));return f}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const c=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),f=c.querySelectorAll("script");for(const x of f)x.remove();return Se.clean(c),c.innerHTML}static isPossiblyDangerous(t,c){const f=c.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!f.includes("javascript:")&&!f.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const c=t.children;for(const f of c)Se.removeAttributes(f),Se.clean(f)}static removeAttributes(t){for(const{name:c,value:f}of t.attributes)Se.isPossiblyDangerous(c,f)&&t.removeAttribute(c)}}Se.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Se.selectProp=Se.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Se.transformProp=Se.testProp(["transform","WebkitTransform"]);const wt={supported:!1,testSupport:function(b){!Yt&&Et&&(Nt?ot(b):Ut=b)}};let Ut,Et,Yt=!1,Nt=!1;function ot(b){const t=b.createTexture();b.bindTexture(b.TEXTURE_2D,t);try{if(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,Et),b.isContextLost())return;wt.supported=!0}catch{}b.deleteTexture(t),Yt=!0}var St;typeof document<"u"&&(Et=document.createElement("img"),Et.onload=()=>{Ut&&ot(Ut),Ut=null,Nt=!0},Et.onerror=()=>{Yt=!0,Ut=null},Et.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(b){let t,c,f,x;b.resetRequestQueue=()=>{t=[],c=0,f=0,x={}},b.addThrottleControl=k=>{const O=f++;return x[O]=k,O},b.removeThrottleControl=k=>{delete x[k],C()},b.getImage=(k,O,N=!0)=>new Promise((U,V)=>{wt.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*"),y.e(k,{type:"image"}),t.push({abortController:O,requestParameters:k,supportImageRefresh:N,state:"queued",onError:$=>{V($)},onSuccess:$=>{U($)}}),C()});const S=k=>y._(this,void 0,void 0,function*(){k.state="running";const{requestParameters:O,supportImageRefresh:N,onError:U,onSuccess:V,abortController:$}=k,W=N===!1&&!y.i(self)&&!y.g(O.url)&&(!O.headers||Object.keys(O.headers).reduce((oe,he)=>oe&&he==="accept",!0));c++;const ae=W?P(O,$):y.m(O,$);try{const oe=yield ae;delete k.abortController,k.state="completed",oe.data instanceof HTMLImageElement||y.b(oe.data)?V(oe):oe.data&&V({data:yield(ne=oe.data,typeof createImageBitmap=="function"?y.f(ne):y.h(ne)),cacheControl:oe.cacheControl,expires:oe.expires})}catch(oe){delete k.abortController,U(oe)}finally{c--,C()}var ne}),C=()=>{const k=(()=>{for(const O of Object.keys(x))if(x[O]())return!0;return!1})()?y.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:y.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let O=c;O<k&&t.length>0;O++){const N=t.shift();N.abortController.signal.aborted?O--:S(N)}},P=(k,O)=>new Promise((N,U)=>{const V=new Image,$=k.url,W=k.credentials;W&&W==="include"?V.crossOrigin="use-credentials":(W&&W==="same-origin"||!y.d($))&&(V.crossOrigin="anonymous"),O.signal.addEventListener("abort",()=>{V.src="",U(y.c())}),V.fetchPriority="high",V.onload=()=>{V.onerror=V.onload=null,N({data:V})},V.onerror=()=>{V.onerror=V.onload=null,O.signal.aborted||U(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},V.src=$})}(St||(St={})),St.resetRequestQueue();class Rt{constructor(t){this._transformRequestFn=t??null}transformRequest(t,c){return this._transformRequestFn&&this._transformRequestFn(t,c)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Gt(b){const t=[];if(typeof b=="string")t.push({id:"default",url:b});else if(b&&b.length>0){const c=[];for(const{id:f,url:x}of b){const S=`${f}${x}`;c.indexOf(S)===-1&&(c.push(S),t.push({id:f,url:x}))}}return t}function ti(b,t,c){try{const f=new URL(b);return f.pathname+=`${t}${c}`,f.toString()}catch{throw new Error(`Invalid sprite URL "${b}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function zt(b){const{userImage:t}=b;return!!(t&&t.render&&t.render())&&(b.data.replace(new Uint8Array(t.data.buffer)),!0)}class ui extends y.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:c,promiseResolve:f}of this.requestors)f(this._getImagesForIds(c));this.requestors=[]}}getImage(t){const c=this.images[t];if(c&&!c.data&&c.spriteData){const f=c.spriteData;c.data=new y.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),c.spriteData=null}return c}addImage(t,c){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,c)&&(this.images[t]=c)}_validate(t,c){let f=!0;const x=c.data||c.spriteData;return this._validateStretch(c.stretchX,x&&x.width)||(this.fire(new y.k(new Error(`Image "${t}" has invalid "stretchX" value`))),f=!1),this._validateStretch(c.stretchY,x&&x.height)||(this.fire(new y.k(new Error(`Image "${t}" has invalid "stretchY" value`))),f=!1),this._validateContent(c.content,c)||(this.fire(new y.k(new Error(`Image "${t}" has invalid "content" value`))),f=!1),f}_validateStretch(t,c){if(!t)return!0;let f=0;for(const x of t){if(x[0]<f||x[1]<x[0]||c<x[1])return!1;f=x[1]}return!0}_validateContent(t,c){if(!t)return!0;if(t.length!==4)return!1;const f=c.spriteData,x=f&&f.width||c.data.width,S=f&&f.height||c.data.height;return!(t[0]<0||x<t[0]||t[1]<0||S<t[1]||t[2]<0||x<t[2]||t[3]<0||S<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,c,f=!0){const x=this.getImage(t);if(f&&(x.data.width!==c.data.width||x.data.height!==c.data.height))throw new Error(`size mismatch between old image (${x.data.width}x${x.data.height}) and new image (${c.data.width}x${c.data.height}).`);c.version=x.version+1,this.images[t]=c,this.updatedImages[t]=!0}removeImage(t){const c=this.images[t];delete this.images[t],delete this.patterns[t],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((c,f)=>{let x=!0;if(!this.isLoaded())for(const S of t)this.images[S]||(x=!1);this.isLoaded()||x?c(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:c})})}_getImagesForIds(t){const c={};for(const f of t){let x=this.getImage(f);x||(this.fire(new y.l("styleimagemissing",{id:f})),x=this.getImage(f)),x?c[f]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,textFitWidth:x.textFitWidth,textFitHeight:x.textFitHeight,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:y.w(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return c}getPixelSize(){const{width:t,height:c}=this.atlasImage;return{width:t,height:c}}getPattern(t){const c=this.patterns[t],f=this.getImage(t);if(!f)return null;if(c&&c.position.version===f.version)return c.position;if(c)c.position.version=f.version;else{const x={w:f.data.width+2,h:f.data.height+2,x:0,y:0},S=new y.I(x,f);this.patterns[t]={bin:x,position:S}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const c=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.T(t,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const S in this.patterns)t.push(this.patterns[S].bin);const{w:c,h:f}=y.p(t),x=this.atlasImage;x.resize({width:c||1,height:f||1});for(const S in this.patterns){const{bin:C}=this.patterns[S],P=C.x+1,k=C.y+1,O=this.getImage(S).data,N=O.width,U=O.height;y.R.copy(O,x,{x:0,y:0},{x:P,y:k},{width:N,height:U}),y.R.copy(O,x,{x:0,y:U-1},{x:P,y:k-1},{width:N,height:1}),y.R.copy(O,x,{x:0,y:0},{x:P,y:k+U},{width:N,height:1}),y.R.copy(O,x,{x:N-1,y:0},{x:P-1,y:k},{width:1,height:U}),y.R.copy(O,x,{x:0,y:0},{x:P+N,y:k},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const c of t){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const f=this.getImage(c);f||y.w(`Image with ID: "${c}" was not found`),zt(f)&&this.updateImage(c,f)}}}const Pi=1e20;function $e(b,t,c,f,x,S,C,P,k){for(let O=t;O<t+f;O++)Ji(b,c*S+O,S,x,C,P,k);for(let O=c;O<c+x;O++)Ji(b,O*S+t,1,f,C,P,k)}function Ji(b,t,c,f,x,S,C){S[0]=0,C[0]=-1e20,C[1]=Pi,x[0]=b[t];for(let P=1,k=0,O=0;P<f;P++){x[P]=b[t+P*c];const N=P*P;do{const U=S[k];O=(x[P]-x[U]+N-U*U)/(P-U)/2}while(O<=C[k]&&--k>-1);k++,S[k]=P,C[k]=O,C[k+1]=Pi}for(let P=0,k=0;P<f;P++){for(;C[k+1]<P;)k++;const O=S[k],N=P-O;b[t+P*c]=x[O]+N*N}}class ft{constructor(t,c,f){this.requestManager=t,this.localIdeographFontFamily=c,this.entries={},this.lang=f}setURL(t){this.url=t}getGlyphs(t){return y._(this,void 0,void 0,function*(){const c=[];for(const S in t)for(const C of t[S])c.push(this._getAndCacheGlyphsPromise(S,C));const f=yield Promise.all(c),x={};for(const{stack:S,id:C,glyph:P}of f)x[S]||(x[S]={}),x[S][C]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};return x})}_getAndCacheGlyphsPromise(t,c){return y._(this,void 0,void 0,function*(){let f=this.entries[t];f||(f=this.entries[t]={glyphs:{},requests:{},ranges:{}});let x=f.glyphs[c];if(x!==void 0)return{stack:t,id:c,glyph:x};if(x=this._tinySDF(f,t,c),x)return f.glyphs[c]=x,{stack:t,id:c,glyph:x};const S=Math.floor(c/256);if(256*S>65535)throw new Error("glyphs > 65535 not supported");if(f.ranges[S])return{stack:t,id:c,glyph:x};if(!this.url)throw new Error("glyphsUrl is not set");if(!f.requests[S]){const P=ft.loadGlyphRange(t,S,this.url,this.requestManager);f.requests[S]=P}const C=yield f.requests[S];for(const P in C)this._doesCharSupportLocalGlyph(+P)||(f.glyphs[+P]=C[+P]);return f.ranges[S]=!0,{stack:t,id:c,glyph:C[c]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(t))||y.u["CJK Unified Ideographs"](t)||y.u["Hangul Syllables"](t)||y.u.Hiragana(t)||y.u.Katakana(t)||y.u["CJK Symbols and Punctuation"](t)||y.u["Halfwidth and Fullwidth Forms"](t))}_tinySDF(t,c,f){const x=this.localIdeographFontFamily;if(!x||!this._doesCharSupportLocalGlyph(f))return;let S=t.tinySDF;if(!S){let P="400";/bold/i.test(c)?P="900":/medium/i.test(c)?P="500":/light/i.test(c)&&(P="200"),S=t.tinySDF=new ft.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:x,fontWeight:P})}const C=S.draw(String.fromCharCode(f));return{id:f,bitmap:new y.q({width:C.width||60,height:C.height||60},C.data),metrics:{width:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:C.glyphAdvance/2||24,isDoubleResolution:!0}}}}ft.loadGlyphRange=function(b,t,c,f){return y._(this,void 0,void 0,function*(){const x=256*t,S=x+255,C=f.transformRequest(c.replace("{fontstack}",b).replace("{range}",`${x}-${S}`),"Glyphs"),P=yield y.n(C,new AbortController);if(!P||!P.data)throw new Error(`Could not load glyph range. range: ${t}, ${x}-${S}`);const k={};for(const O of y.o(P.data))k[O.id]=O;return k})},ft.TinySDF=class{constructor({fontSize:b=24,buffer:t=3,radius:c=8,cutoff:f=.25,fontFamily:x="sans-serif",fontWeight:S="normal",fontStyle:C="normal",lang:P=null}={}){this.buffer=t,this.cutoff=f,this.radius=c,this.lang=P;const k=this.size=b+4*t,O=this._createCanvas(k),N=this.ctx=O.getContext("2d",{willReadFrequently:!0});N.font=`${C} ${S} ${b}px ${x}`,N.textBaseline="alphabetic",N.textAlign="left",N.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Uint16Array(k)}_createCanvas(b){const t=document.createElement("canvas");return t.width=t.height=b,t}draw(b){const{width:t,actualBoundingBoxAscent:c,actualBoundingBoxDescent:f,actualBoundingBoxLeft:x,actualBoundingBoxRight:S}=this.ctx.measureText(b),C=Math.ceil(c),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-x))),k=Math.min(this.size-this.buffer,C+Math.ceil(f)),O=P+2*this.buffer,N=k+2*this.buffer,U=Math.max(O*N,0),V=new Uint8ClampedArray(U),$={data:V,width:O,height:N,glyphWidth:P,glyphHeight:k,glyphTop:C,glyphLeft:0,glyphAdvance:t};if(P===0||k===0)return $;const{ctx:W,buffer:ae,gridInner:ne,gridOuter:oe}=this;this.lang&&(W.lang=this.lang),W.clearRect(ae,ae,P,k),W.fillText(b,ae,ae+C);const he=W.getImageData(ae,ae,P,k);oe.fill(Pi,0,U),ne.fill(0,0,U);for(let ge=0;ge<k;ge++)for(let de=0;de<P;de++){const xe=he.data[4*(ge*P+de)+3]/255;if(xe===0)continue;const Me=(ge+ae)*O+de+ae;if(xe===1)oe[Me]=0,ne[Me]=Pi;else{const fe=.5-xe;oe[Me]=fe>0?fe*fe:0,ne[Me]=fe<0?fe*fe:0}}$e(oe,0,0,O,N,O,this.f,this.v,this.z),$e(ne,ae,ae,P,k,O,this.f,this.v,this.z);for(let ge=0;ge<U;ge++){const de=Math.sqrt(oe[ge])-Math.sqrt(ne[ge]);V[ge]=Math.round(255-255*(de/this.radius+this.cutoff))}return $}};class fn{constructor(){this.specification=y.v.light.position}possiblyEvaluate(t,c){return y.B(t.expression.evaluate(c))}interpolate(t,c,f){return{x:y.C.number(t.x,c.x,f),y:y.C.number(t.y,c.y,f),z:y.C.number(t.z,c.z,f)}}}let Ri;class Qe extends y.E{constructor(t){super(),Ri=Ri||new y.r({anchor:new y.D(y.v.light.anchor),position:new fn,color:new y.D(y.v.light.color),intensity:new y.D(y.v.light.intensity)}),this._transitionable=new y.t(Ri),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,c={}){if(!this._validate(y.x,t,c))for(const f in t){const x=t[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),x):this._transitionable.setValue(f,x)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,c,f){return(!f||f.validate!==!1)&&y.y(this,t.call(y.z,{value:c,style:{glyphs:!0,sprite:!0},styleSpec:y.v}))}}const bt=new y.r({"sky-color":new y.D(y.v.sky["sky-color"]),"horizon-color":new y.D(y.v.sky["horizon-color"]),"fog-color":new y.D(y.v.sky["fog-color"]),"fog-ground-blend":new y.D(y.v.sky["fog-ground-blend"]),"horizon-fog-blend":new y.D(y.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new y.D(y.v.sky["sky-horizon-blend"]),"atmosphere-blend":new y.D(y.v.sky["atmosphere-blend"])});class Be extends y.E{constructor(t){super(),this._transitionable=new y.t(bt),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new y.F(0))}setSky(t,c={}){if(!this._validate(y.G,t,c)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const f in t){const x=t[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),x):this._transitionable.setValue(f,x)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,c,f={}){return(f==null?void 0:f.validate)!==!1&&y.y(this,t.call(y.z,y.e({value:c,style:{glyphs:!0,sprite:!0},styleSpec:y.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class _t{constructor(t,c){this.width=t,this.height=c,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,c){const f=t.join(",")+String(c);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(t,c)),this.dashEntry[f]}getDashRanges(t,c,f){const x=[];let S=t.length%2==1?-t[t.length-1]*f:0,C=t[0]*f,P=!0;x.push({left:S,right:C,isDash:P,zeroLength:t[0]===0});let k=t[0];for(let O=1;O<t.length;O++){P=!P;const N=t[O];S=k*f,k+=N,C=k*f,x.push({left:S,right:C,isDash:P,zeroLength:N===0})}return x}addRoundDash(t,c,f){const x=c/2;for(let S=-f;S<=f;S++){const C=this.width*(this.nextRow+f+S);let P=0,k=t[P];for(let O=0;O<this.width;O++){O/k.right>1&&(k=t[++P]);const N=Math.abs(O-k.left),U=Math.abs(O-k.right),V=Math.min(N,U);let $;const W=S/f*(x+1);if(k.isDash){const ae=x-Math.abs(W);$=Math.sqrt(V*V+ae*ae)}else $=x-Math.sqrt(V*V+W*W);this.data[C+O]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(t){for(let P=t.length-1;P>=0;--P){const k=t[P],O=t[P+1];k.zeroLength?t.splice(P,1):O&&O.isDash===k.isDash&&(O.left=k.left,t.splice(P,1))}const c=t[0],f=t[t.length-1];c.isDash===f.isDash&&(c.left=f.left-this.width,f.right=c.right+this.width);const x=this.width*this.nextRow;let S=0,C=t[S];for(let P=0;P<this.width;P++){P/C.right>1&&(C=t[++S]);const k=Math.abs(P-C.left),O=Math.abs(P-C.right),N=Math.min(k,O);this.data[x+P]=Math.max(0,Math.min(255,(C.isDash?N:-N)+128))}}addDash(t,c){const f=c?7:0,x=2*f+1;if(this.nextRow+x>this.height)return y.w("LineAtlas out of space"),null;let S=0;for(let P=0;P<t.length;P++)S+=t[P];if(S!==0){const P=this.width/S,k=this.getDashRanges(t,this.width,P);c?this.addRoundDash(k,P,f):this.addRegularDash(k)}const C={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:S};return this.nextRow+=x,this.dirty=!0,C}bind(t){const c=t.gl;this.texture?(c.bindTexture(c.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,c.texSubImage2D(c.TEXTURE_2D,0,0,0,this.width,this.height,c.ALPHA,c.UNSIGNED_BYTE,this.data))):(this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texImage2D(c.TEXTURE_2D,0,c.ALPHA,this.width,this.height,0,c.ALPHA,c.UNSIGNED_BYTE,this.data))}}const _e="maplibre_preloaded_worker_pool";class rt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<rt.workerCount;)this.workers.push(new Worker(y.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_e]}numActive(){return Object.keys(this.active).length}}const It=Math.floor(Le.hardwareConcurrency/2);let mt,ut;function bi(){return mt||(mt=new rt),mt}rt.workerCount=y.H(globalThis)?Math.max(Math.min(It,3),1):1;class Zt{constructor(t,c){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=c;const f=this.workerPool.acquire(c);for(let x=0;x<f.length;x++){const S=new y.J(f[x],c);S.name=`Worker ${x}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,c){const f=[];for(const x of this.actors)f.push(x.sendAsync({type:t,data:c}));return Promise.all(f)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(c=>{c.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,c){for(const f of this.actors)f.registerMessageHandler(t,c)}}function Di(){return ut||(ut=new Zt(bi(),y.K),ut.registerMessageHandler("GR",(b,t,c)=>y.m(t,c))),ut}function Ei(b,t){const c=y.L();return y.M(c,c,[1,1,0]),y.N(c,c,[.5*b.width,.5*b.height,1]),b.calculatePosMatrix?y.O(c,c,b.calculatePosMatrix(t.toUnwrapped())):c}function kr(b,t,c,f,x,S,C){var P;const k=function(V,$,W){if(V)for(const ae of V){const ne=$[ae];if(ne&&ne.source===W&&ne.type==="fill-extrusion")return!0}else for(const ae in $){const ne=$[ae];if(ne.source===W&&ne.type==="fill-extrusion")return!0}return!1}((P=x==null?void 0:x.layers)!==null&&P!==void 0?P:null,t,b.id),O=S.maxPitchScaleFactor(),N=b.tilesIn(f,O,k);N.sort(jn);const U=[];for(const V of N)U.push({wrappedTileID:V.tileID.wrapped().key,queryResults:V.tile.queryRenderedFeatures(t,c,b._state,V.queryGeometry,V.cameraQueryGeometry,V.scale,x,S,O,Ei(b.transform,V.tileID),C?($,W)=>C(V.tileID,$,W):void 0)});return function(V,$){for(const W in V)for(const ae of V[W])Hn(ae,$);return V}(function(V){const $={},W={};for(const ae of V){const ne=ae.queryResults,oe=ae.wrappedTileID,he=W[oe]=W[oe]||{};for(const ge in ne){const de=ne[ge],xe=he[ge]=he[ge]||{},Me=$[ge]=$[ge]||[];for(const fe of de)xe[fe.featureIndex]||(xe[fe.featureIndex]=!0,Me.push(fe))}}return $}(U),b)}function jn(b,t){const c=b.tileID,f=t.tileID;return c.overscaledZ-f.overscaledZ||c.canonical.y-f.canonical.y||c.wrap-f.wrap||c.canonical.x-f.canonical.x}function Hn(b,t){const c=b.feature,f=t.getFeatureState(c.layer["source-layer"],c.id);c.source=c.layer.source,c.layer["source-layer"]&&(c.sourceLayer=c.layer["source-layer"]),c.state=f}function sr(b,t,c){return y._(this,void 0,void 0,function*(){let f=b;if(b.url?f=(yield y.j(t.transformRequest(b.url,"Source"),c)).data:yield Le.frameAsync(c),!f)return null;const x=y.Q(y.e(f,b),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in f&&f.vector_layers&&(x.vectorLayerIds=f.vector_layers.map(S=>S.id)),x})}class xi{constructor(t,c){t&&(c?this.setSouthWest(t).setNorthEast(c):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof y.S?new y.S(t.lng,t.lat):y.S.convert(t),this}setSouthWest(t){return this._sw=t instanceof y.S?new y.S(t.lng,t.lat):y.S.convert(t),this}extend(t){const c=this._sw,f=this._ne;let x,S;if(t instanceof y.S)x=t,S=t;else{if(!(t instanceof xi))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(xi.convert(t)):this.extend(y.S.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(y.S.convert(t)):this;if(x=t._sw,S=t._ne,!x||!S)return this}return c||f?(c.lng=Math.min(x.lng,c.lng),c.lat=Math.min(x.lat,c.lat),f.lng=Math.max(S.lng,f.lng),f.lat=Math.max(S.lat,f.lat)):(this._sw=new y.S(x.lng,x.lat),this._ne=new y.S(S.lng,S.lat)),this}getCenter(){return new y.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new y.S(this.getWest(),this.getNorth())}getSouthEast(){return new y.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:c,lat:f}=y.S.convert(t);let x=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&x}static convert(t){return t instanceof xi?t:t&&new xi(t)}static fromLngLat(t,c=0){const f=360*c/40075017,x=f/Math.cos(Math.PI/180*t.lat);return new xi(new y.S(t.lng-x,t.lat-f),new y.S(t.lng+x,t.lat+f))}adjustAntiMeridian(){const t=new y.S(this._sw.lng,this._sw.lat),c=new y.S(this._ne.lng,this._ne.lat);return new xi(t,t.lng>c.lng?new y.S(c.lng+360,c.lat):c)}}class Qr{constructor(t,c,f){this.bounds=xi.convert(this.validateBounds(t)),this.minzoom=c||0,this.maxzoom=f||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const c=Math.pow(2,t.z),f=Math.floor(y.V(this.bounds.getWest())*c),x=Math.floor(y.U(this.bounds.getNorth())*c),S=Math.ceil(y.V(this.bounds.getEast())*c),C=Math.ceil(y.U(this.bounds.getSouth())*c);return t.x>=f&&t.x<S&&t.y>=x&&t.y<C}}class oa extends y.E{constructor(t,c,f,x){if(super(),this.id=t,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.e(this,y.Q(c,["url","scheme","tileSize","promoteId"])),this._options=y.e({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x)}load(){return y._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new y.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield sr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(y.e(this,t),t.bounds&&(this.tileBounds=new Qr(t.bounds,this.minzoom,this.maxzoom)),this.fire(new y.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new y.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new y.k(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return y.e({},this._options)}loadTile(t){return y._(this,void 0,void 0,function*(){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(c,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};f.request.collectResourceTiming=this._collectResourceTiming;let x="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((S,C)=>{t.reloadPromise={resolve:S,reject:C}})}else t.actor=this.dispatcher.getActor(),x="LT";t.abortController=new AbortController;try{const S=yield t.actor.sendAsync({type:x,data:f},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,S)}catch(S){if(delete t.abortController,t.aborted)return;if(S&&S.status!==404)throw S;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,c){if(c&&c.resourceTiming&&(t.resourceTiming=c.resourceTiming),c&&this.map._refreshExpiredTiles&&t.setExpiryData(c),t.loadVectorData(c,this.map.painter),t.reloadPromise){const f=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(f.resolve).catch(f.reject)}}abortTile(t){return y._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return y._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class rs extends y.E{constructor(t,c,f,x){super(),this.id=t,this.dispatcher=f,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.e({type:"raster"},c),y.e(this,y.Q(c,["url","scheme","tileSize"]))}load(){return y._(this,arguments,void 0,function*(t=!1){this._loaded=!1,this.fire(new y.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const c=yield sr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,c&&(y.e(this,c),c.bounds&&(this.tileBounds=new Qr(c.bounds,this.minzoom,this.maxzoom)),this.fire(new y.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new y.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(c){this._tileJSONRequest=null,this.fire(new y.k(c))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return y.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return y._(this,void 0,void 0,function*(){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const f=yield St.getImage(this.map._requestManager.transformRequest(c,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(f&&f.data){this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&t.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const x=this.map.painter.context,S=x.gl,C=f.data;t.texture=this.map.painter.getTileTexture(C.width),t.texture?t.texture.update(C,{useMipmap:!0}):(t.texture=new y.T(x,C,S.RGBA,{useMipmap:!0}),t.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(f){if(delete t.abortController,t.aborted)t.state="unloaded";else if(f)throw t.state="errored",f}})}abortTile(t){return y._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return y._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class sn extends rs{constructor(t,c,f,x){super(t,c,f,x),this.type="raster-dem",this.maxzoom=22,this._options=y.e({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox",this.redFactor=c.redFactor,this.greenFactor=c.greenFactor,this.blueFactor=c.blueFactor,this.baseShift=c.baseShift}loadTile(t){return y._(this,void 0,void 0,function*(){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(c,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const x=yield St.getImage(f,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(x&&x.data){const S=x.data;this.map._refreshExpiredTiles&&(x.cacheControl||x.expires)&&t.setExpiryData({cacheControl:x.cacheControl,expires:x.expires});const C=y.b(S)&&y.W()?S:yield this.readImageNow(S),P={type:this.type,uid:t.uid,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const k=yield t.actor.sendAsync({type:"LDT",data:P});t.dem=k,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(x){if(delete t.abortController,t.aborted)t.state="unloaded";else if(x)throw t.state="errored",x}})}readImageNow(t){return y._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&y.X()){const c=t.width+2,f=t.height+2;try{return new y.R({width:c,height:f},yield y.Y(t,-1,-1,c,f))}catch{}}return Le.getImageData(t,1)})}_getNeighboringTiles(t){const c=t.canonical,f=Math.pow(2,c.z),x=(c.x-1+f)%f,S=c.x===0?t.wrap-1:t.wrap,C=(c.x+1+f)%f,P=c.x+1===f?t.wrap+1:t.wrap,k={};return k[new y.Z(t.overscaledZ,S,c.z,x,c.y).key]={backfilled:!1},k[new y.Z(t.overscaledZ,P,c.z,C,c.y).key]={backfilled:!1},c.y>0&&(k[new y.Z(t.overscaledZ,S,c.z,x,c.y-1).key]={backfilled:!1},k[new y.Z(t.overscaledZ,t.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},k[new y.Z(t.overscaledZ,P,c.z,C,c.y-1).key]={backfilled:!1}),c.y+1<f&&(k[new y.Z(t.overscaledZ,S,c.z,x,c.y+1).key]={backfilled:!1},k[new y.Z(t.overscaledZ,t.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},k[new y.Z(t.overscaledZ,P,c.z,C,c.y+1).key]={backfilled:!1}),k}unloadTile(t){return y._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class Nn extends y.E{constructor(t,c,f,x){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:c.data},this.actor=f.getActor(),this.setEventedParent(x),this._data=c.data,this._options=y.e({},c),this._collectResourceTiming=c.collectResourceTiming,c.maxzoom!==void 0&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId,c.clusterMaxZoom!==void 0&&this.maxzoom<=c.clusterMaxZoom&&y.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${c.clusterMaxZoom}".`),this.workerOptions=y.e({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(c.buffer!==void 0?c.buffer:128),tolerance:this._pixelsToTileUnits(c.tolerance!==void 0?c.tolerance:.375),extent:y.$,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(c.clusterMaxZoom),minPoints:Math.max(2,c.clusterMinPoints||2),extent:y.$,radius:this._pixelsToTileUnits(c.clusterRadius||50),log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(t){return t*(y.$/this.tileSize)}_getClusterMaxZoom(t){const c=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||y.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${c}"`),c}load(){return y._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._pendingWorkerUpdate={data:t},this._updateWorkerData(),this}updateData(t){return this._pendingWorkerUpdate.diff=y.a0(this._pendingWorkerUpdate.diff,t),this._updateWorkerData(),this}getData(){return y._(this,void 0,void 0,function*(){const t=y.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}getCoordinatesFromGeometry(t){return t.type==="GeometryCollection"?t.geometries.map(c=>c.coordinates).flat(1/0):t.coordinates.flat(1/0)}getBounds(){return y._(this,void 0,void 0,function*(){const t=new xi,c=yield this.getData();let f;switch(c.type){case"FeatureCollection":f=c.features.map(x=>this.getCoordinatesFromGeometry(x.geometry)).flat(1/0);break;case"Feature":f=this.getCoordinatesFromGeometry(c.geometry);break;default:f=this.getCoordinatesFromGeometry(c)}if(f.length==0)return t;for(let x=0;x<f.length-1;x+=2)t.extend([f[x],f[x+1]]);return t})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,c,f){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:c,offset:f}})}_updateWorkerData(){return y._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;const{data:t,diff:c}=this._pendingWorkerUpdate;if(!t&&!c)return void y.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const f=y.e({type:this.type},this.workerOptions);t?(typeof t=="string"?(f.request=this.map._requestManager.transformRequest(Le.resolveURL(t),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(t),this._pendingWorkerUpdate.data=void 0):c&&(f.dataDiff=c,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new y.l("dataloading",{dataType:"source"}));try{const x=yield this.actor.sendAsync({type:"LD",data:f});if(this._isUpdatingWorker=!1,this._removed||x.abandoned)return void this.fire(new y.l("dataabort",{dataType:"source"}));this._data=x.data;let S=null;x.resourceTiming&&x.resourceTiming[this.id]&&(S=x.resourceTiming[this.id].slice(0));const C={dataType:"source"};this._collectResourceTiming&&S&&S.length>0&&y.e(C,{resourceTiming:S}),this.fire(new y.l("data",Object.assign(Object.assign({},C),{sourceDataType:"metadata"}))),this.fire(new y.l("data",Object.assign(Object.assign({},C),{sourceDataType:"content"})))}catch(x){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new y.l("dataabort",{dataType:"source"}));this.fire(new y.k(x))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}})}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(t){return y._(this,void 0,void 0,function*(){const c=t.actor?"RT":"LT";t.actor=this.actor;const f={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};t.abortController=new AbortController;const x=yield this.actor.sendAsync({type:c,data:f},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(x,this.map.painter,c==="RT")})}abortTile(t){return y._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return y._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return y.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class ns extends y.E{constructor(t,c,f,x){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=f,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=c}load(t){return y._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new y.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const c=yield St.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,c&&c.data&&(this.image=c.data,t&&(this.coordinates=t),this._finishLoading())}catch(c){this._request=null,this._loaded=!0,this.fire(new y.k(c))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const c=t.map(y.a1.fromLngLat);var f;return this.tileID=function(x){const S=y.a2.fromPoints(x),C=S.width(),P=S.height(),k=Math.max(C,P),O=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),N=Math.pow(2,O);return new y.a4(O,Math.floor((S.minX+S.maxX)/2*N),Math.floor((S.minY+S.maxY)/2*N))}(c),this.terrainTileRanges=this._getOverlappingTileRanges(c),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=c.map(x=>this.tileID.getTilePoint(x)._round()),this.flippedWindingOrder=((f=this.tileCoords)[1].x-f[0].x)*(f[2].y-f[0].y)-(f[1].y-f[0].y)*(f[2].x-f[0].x)<0,this.fire(new y.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,c=t.gl;this.texture||(this.texture=new y.T(t,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let f=!1;for(const x in this.tiles){const S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,f=!0)}f&&this.fire(new y.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return y._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:c,minY:f,maxX:x,maxY:S}=y.a2.fromPoints(t),C={};for(let P=0;P<=y.a3;P++){const k=Math.pow(2,P),O=Math.floor(c*k),N=Math.floor(f*k),U=Math.floor(x*k),V=Math.floor(S*k);C[P]={minTileX:O,minTileY:N,maxTileX:U,maxTileY:V}}return C}}class Wo extends ns{constructor(t,c,f,x){super(t,c,f,x),this.roundZoom=!0,this.type="video",this.options=c}load(){return y._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const c of t.urls)this.urls.push(this.map._requestManager.transformRequest(c,"Source").url);try{const c=yield y.a5(this.urls);if(this._loaded=!0,!c)return;this.video=c,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(c){this.fire(new y.k(c))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const c=this.video.seekable;t<c.start(0)||t>c.end(0)?this.fire(new y.k(new y.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,c=t.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new y.T(t,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let f=!1;for(const x in this.tiles){const S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,f=!0)}f&&this.fire(new y.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class as extends ns{constructor(t,c,f,x){super(t,c,f,x),c.coordinates?Array.isArray(c.coordinates)&&c.coordinates.length===4&&!c.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(C=>typeof C!="number"))||this.fire(new y.k(new y.a6(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.k(new y.a6(`sources.${t}`,null,'missing required property "coordinates"'))),c.animate&&typeof c.animate!="boolean"&&this.fire(new y.k(new y.a6(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),c.canvas?typeof c.canvas=="string"||c.canvas instanceof HTMLCanvasElement||this.fire(new y.k(new y.a6(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.k(new y.a6(`sources.${t}`,null,'missing required property "canvas"'))),this.options=c,this.animate=c.animate===void 0||c.animate}load(){return y._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const c=this.map.painter.context,f=c.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.T(c,this.canvas,f.RGBA,{premultiply:!0});let x=!1;for(const S in this.tiles){const C=this.tiles[S];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,x=!0)}x&&this.fire(new y.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const La={},Ns=b=>{switch(b){case"geojson":return Nn;case"image":return ns;case"raster":return rs;case"raster-dem":return sn;case"vector":return oa;case"video":return Wo;case"canvas":return as}return La[b]},Vl="RTLPluginLoaded";class Ko extends y.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Di()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(c=>{throw this.status="error",c})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return y._(this,arguments,void 0,function*(c,f=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Le.resolveURL(c),!this.url)throw new Error(`requested url ${c} is invalid`);if(this.status==="unavailable"){if(!f)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return y._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new y.l(Vl))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ss=null;function pn(){return ss||(ss=new Ko),ss}class ba{constructor(t,c){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=y.a7(),this.uses=0,this.tileSize=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const c=t+this.timeAdded;c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,c,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(x,S){const C={};if(!S)return C;for(const P of x){const k=P.layerIds.map(O=>S.getLayer(O)).filter(Boolean);if(k.length!==0){P.layers=k,P.stateDependentLayerIds&&(P.stateDependentLayers=P.stateDependentLayerIds.map(O=>k.filter(N=>N.id===O)[0]));for(const O of k)C[O.id]=P}}return C}(t.buckets,c==null?void 0:c.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const S=this.buckets[x];if(S instanceof y.a9){if(this.hasSymbolBuckets=!0,!f)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const S=this.buckets[x];if(S instanceof y.a9&&S.hasRTLText){this.hasRTLText=!0,pn().lazyLoad();break}}this.queryPadding=0;for(const x in this.buckets){const S=this.buckets[x];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(x).queryRadius(S))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new y.a8}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const f in this.buckets){const x=this.buckets[f];x.uploadPending()&&x.upload(t)}const c=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new y.T(t,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new y.T(t,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,c,f,x,S,C,P,k,O,N,U){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:S,scale:C,tileSize:this.tileSize,pixelPosMatrix:N,transform:k,params:P,queryPadding:this.queryPadding*O,getElevation:U},t,c,f):{}}querySourceFeatures(t,c){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const x=f.loadVTLayers(),S=c&&c.sourceLayer?c.sourceLayer:"",C=x._geojsonTileLayer||x[S];if(!C)return;const P=y.aa(c&&c.filter),{z:k,x:O,y:N}=this.tileID.canonical,U={z:k,x:O,y:N};for(let V=0;V<C.length;V++){const $=C.feature(V);if(P.needGeometry){const ne=y.ab($,!0);if(!P.filter(new y.F(this.tileID.overscaledZ),ne,this.tileID.canonical))continue}else if(!P.filter(new y.F(this.tileID.overscaledZ),$))continue;const W=f.getId($,S),ae=new y.ac($,k,O,N,W);ae.tile=U,t.push(ae)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const c=this.expirationTime;if(t.cacheControl){const f=y.ad(t.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const f=Date.now();let x=!1;if(this.expirationTime>f)x=!1;else if(c)if(this.expirationTime<c)x=!0;else{const S=this.expirationTime-c;S?this.expirationTime=f+Math.max(S,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,c){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const x in this.buckets){if(!c.style.hasLayer(x))continue;const S=this.buckets[x],C=S.layers[0].sourceLayer||"_geojsonTileLayer",P=f[C],k=t[C];if(!P||!k||Object.keys(k).length===0)continue;S.update(k,P,this.imageAtlas&&this.imageAtlas.patternPositions||{});const O=c&&c.style&&c.style.getLayer(x);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Le.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=Le.now()+t}setDependencies(t,c){const f={};for(const x of c)f[x]=!0;this.dependencies[t]=f}hasDependency(t,c){for(const f of t){const x=this.dependencies[f];if(x){for(const S of c)if(x[S])return!0}}return!1}}class Ee{constructor(t,c){this.max=t,this.onRemove=c,this.reset()}reset(){for(const t in this.data)for(const c of this.data[t])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(t,c,f){const x=t.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const S={value:c,timeout:void 0};if(f!==void 0&&(S.timeout=setTimeout(()=>{this.remove(t,S)},f)),this.data[x].push(S),this.order.push(x),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const c=this.data[t].shift();return c.timeout&&clearTimeout(c.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),c.value}getByKey(t){const c=this.data[t];return c?c[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,c){if(!this.has(t))return this;const f=t.wrapped().key,x=c===void 0?0:this.data[f].indexOf(c),S=this.data[f][x];return this.data[f].splice(x,1),S.timeout&&clearTimeout(S.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(S.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(t){const c=[];for(const f in this.data)for(const x of this.data[f])t(x.value)||c.push(x);for(const f of c)this.remove(f.value.tileID,f)}}class K{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,c,f){const x=String(c);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][x]=this.stateChanges[t][x]||{},y.e(this.stateChanges[t][x],f),this.deletedStates[t]===null){this.deletedStates[t]={};for(const S in this.state[t])S!==x&&(this.deletedStates[t][S]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][x]===null){this.deletedStates[t][x]={};for(const S in this.state[t][x])f[S]||(this.deletedStates[t][x][S]=null)}else for(const S in f)this.deletedStates[t]&&this.deletedStates[t][x]&&this.deletedStates[t][x][S]===null&&delete this.deletedStates[t][x][S]}removeFeatureState(t,c,f){if(this.deletedStates[t]===null)return;const x=String(c);if(this.deletedStates[t]=this.deletedStates[t]||{},f&&c!==void 0)this.deletedStates[t][x]!==null&&(this.deletedStates[t][x]=this.deletedStates[t][x]||{},this.deletedStates[t][x][f]=null);else if(c!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][x])for(f in this.deletedStates[t][x]={},this.stateChanges[t][x])this.deletedStates[t][x][f]=null;else this.deletedStates[t][x]=null;else this.deletedStates[t]=null}getState(t,c){const f=String(c),x=y.e({},(this.state[t]||{})[f],(this.stateChanges[t]||{})[f]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const S=this.deletedStates[t][c];if(S===null)return{};for(const C in S)delete x[C]}return x}initializeTileState(t,c){t.setFeatureState(this.state,c)}coalesceChanges(t,c){const f={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const S={};for(const C in this.stateChanges[x])this.state[x][C]||(this.state[x][C]={}),y.e(this.state[x][C],this.stateChanges[x][C]),S[C]=this.state[x][C];f[x]=S}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const S={};if(this.deletedStates[x]===null)for(const C in this.state[x])S[C]={},this.state[x][C]={};else for(const C in this.deletedStates[x]){if(this.deletedStates[x][C]===null)this.state[x][C]={};else for(const P of Object.keys(this.deletedStates[x][C]))delete this.state[x][C][P];S[C]=this.state[x][C]}f[x]=f[x]||{},y.e(f[x],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const x in t)t[x].setFeatureState(f,c)}}const ee=89.25;function re(b,t){const c=y.ah(t.lat,-y.ai,y.ai);return new y.P(y.V(t.lng)*b,y.U(c)*b)}function me(b,t){return new y.a1(t.x/b,t.y/b).toLngLat()}function Ae(b){return b.cameraToCenterDistance*Math.min(.85*Math.tan(y.ae(90-b.pitch)),Math.tan(y.ae(ee-b.pitch)))}function Pe(b,t){const c=b.canonical,f=t/y.af(c.z),x=c.x+Math.pow(2,c.z)*b.wrap,S=y.ag(new Float64Array(16));return y.M(S,S,[x*f,c.y*f,0]),y.N(S,S,[f/y.$,f/y.$,1]),S}function je(b,t,c,f,x){const S=y.a1.fromLngLat(b,t),C=x*y.aj(1,b.lat),P=C*Math.cos(y.ae(c)),k=Math.sqrt(C*C-P*P),O=k*Math.sin(y.ae(-f)),N=k*Math.cos(y.ae(-f));return new y.a1(S.x+O,S.y+N,S.z+P)}function Re(b,t,c){const f=t.intersectsFrustum(b);if(!c||f===0)return f;const x=t.intersectsPlane(c);return x===0?0:f===2&&x===2?2:1}function Je(b,t,c){let f=0;const x=(c-t)/10;for(let S=0;S<10;S++)f+=x*Math.pow(Math.cos(t+(S+.5)/10*(c-t)),b);return f}function ht(b,t){return function(c,f,x,S,C){const P=2*((b-1)/y.ak(Math.cos(y.ae(ee-C))/Math.cos(y.ae(ee)))-1),k=Math.acos(x/S),O=2*Je(P-1,0,y.ae(C/2)),N=Math.min(y.ae(ee),k+y.ae(C/2)),U=Je(P-1,Math.min(N,k-y.ae(C/2)),N),V=Math.atan(f/x),$=Math.hypot(f,x);let W=c;return W+=y.ak(S/$/Math.max(.5,Math.cos(y.ae(C/2)))),W+=P*y.ak(Math.cos(V))/2,W-=y.ak(Math.max(1,U/O/t))/2,W}}const at=ht(9.314,3);function Dt(b,t){const c=(t.roundZoom?Math.round:Math.floor)(b.zoom+y.ak(b.tileSize/t.tileSize));return Math.max(0,c)}function ke(b,t){const c=b.getCameraFrustum(),f=b.getClippingPlane(),x=b.screenPointToMercatorCoordinate(b.getCameraPoint()),S=y.a1.fromLngLat(b.center,b.elevation);x.z=S.z+Math.cos(b.pitchInRadians)*b.cameraToCenterDistance/b.worldSize;const C=b.getCoveringTilesDetailsProvider(),P=C.allowVariableZoom(b,t),k=Dt(b,t),O=t.minzoom||0,N=t.maxzoom!==void 0?t.maxzoom:b.maxZoom,U=Math.min(Math.max(0,k),N),V=Math.pow(2,U),$=[V*x.x,V*x.y,0],W=[V*S.x,V*S.y,0],ae=Math.hypot(S.x-x.x,S.y-x.y),ne=Math.abs(S.z-x.z),oe=Math.hypot(ae,ne),he=xe=>({zoom:0,x:0,y:0,wrap:xe,fullyVisible:!1}),ge=[],de=[];if(b.renderWorldCopies&&C.allowWorldCopies())for(let xe=1;xe<=3;xe++)ge.push(he(-xe)),ge.push(he(xe));for(ge.push(he(0));ge.length>0;){const xe=ge.pop(),Me=xe.x,fe=xe.y;let ze=xe.fullyVisible;const Ve={x:Me,y:fe,z:xe.zoom},Ne=C.getTileBoundingVolume(Ve,xe.wrap,b.elevation,t);if(!ze){const yt=Re(c,Ne,f);if(yt===0)continue;ze=yt===2}const Fe=C.distanceToTile2d(x.x,x.y,Ve,Ne);let He=k;P&&(He=(t.calculateTileZoom||at)(b.zoom+y.ak(b.tileSize/t.tileSize),Fe,ne,oe,b.fov)),He=(t.roundZoom?Math.round:Math.floor)(He),He=Math.max(0,He);const gt=Math.min(He,N);if(xe.wrap=C.getWrap(S,Ve,xe.wrap),xe.zoom>=gt){if(xe.zoom<O)continue;const yt=U-xe.zoom,st=$[0]-.5-(Me<<yt),Bt=$[1]-.5-(fe<<yt),oi=t.reparseOverscaled?Math.max(xe.zoom,He):xe.zoom;de.push({tileID:new y.Z(xe.zoom===N?oi:xe.zoom,xe.wrap,xe.zoom,Me,fe),distanceSq:y.al([W[0]-.5-Me,W[1]-.5-fe]),tileDistanceToCamera:Math.sqrt(st*st+Bt*Bt)})}else for(let yt=0;yt<4;yt++)ge.push({zoom:xe.zoom+1,x:(Me<<1)+yt%2,y:(fe<<1)+(yt>>1),wrap:xe.wrap,fullyVisible:ze})}return de.sort((xe,Me)=>xe.distanceSq-Me.distanceSq).map(xe=>xe.tileID)}const Tt=y.a2.fromPoints([new y.P(0,0),new y.P(y.$,y.$)]);class Ti extends y.E{constructor(t,c,f){super(),this.id=t,this.dispatcher=f,this.on("data",x=>this._dataHandler(x)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((x,S,C,P)=>{const k=new(Ns(S.type))(x,S,C,P);if(k.id!==x)throw new Error(`Expected Source id to be ${x} instead of ${k.id}`);return k})(t,c,f,this),this._tiles={},this._cache=new Ee(0,x=>this._unloadTile(x)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new K,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const c=this._tiles[t];if(c.state!=="loaded"&&c.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,c,f){return y._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,c,f)}catch(x){t.state="errored",x.status!==404?this._source.fire(new y.k(x,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new y.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const f=this._tiles[c];f.upload(t),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort($t).map(t=>t.key)}getRenderableIds(t){const c=[];for(const f in this._tiles)this._isIdRenderable(f,t)&&c.push(this._tiles[f]);return t?c.sort((f,x)=>{const S=f.tileID,C=x.tileID,P=new y.P(S.canonical.x,S.canonical.y)._rotate(-this.transform.bearingInRadians),k=new y.P(C.canonical.x,C.canonical.y)._rotate(-this.transform.bearingInRadians);return S.overscaledZ-C.overscaledZ||k.y-P.y||k.x-P.x}).map(f=>f.tileID.key):c.map(f=>f.tileID).sort($t).map(f=>f.key)}hasRenderableParent(t){const c=this.findLoadedParent(t,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(t,c){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(c||!this._tiles[t].holdingForFade())}reload(t){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const c in this._tiles)t?this._reloadTile(c,"expired"):this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")}}_reloadTile(t,c){return y._(this,void 0,void 0,function*(){const f=this._tiles[t];f&&(f.state!=="loading"&&(f.state=c),yield this._loadTile(f,t,c))})}_tileLoaded(t,c,f){t.timeAdded=Le.now(),f==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(c,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new y.l("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const c=this.getRenderableIds();for(let x=0;x<c.length;x++){const S=c[x];if(t.neighboringTiles&&t.neighboringTiles[S]){const C=this.getTileByID(S);f(t,C),f(C,t)}}function f(x,S){x.needsHillshadePrepare=!0,x.needsTerrainPrepare=!0;let C=S.tileID.canonical.x-x.tileID.canonical.x;const P=S.tileID.canonical.y-x.tileID.canonical.y,k=Math.pow(2,x.tileID.canonical.z),O=S.tileID.key;C===0&&P===0||Math.abs(P)>1||(Math.abs(C)>1&&(Math.abs(C+k)===1?C+=k:Math.abs(C-k)===1&&(C-=k)),S.dem&&x.dem&&(x.dem.backfillBorder(S.dem,C,P),x.neighboringTiles&&x.neighboringTiles[O]&&(x.neighboringTiles[O].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,c,f,x){for(const S in this._tiles){let C=this._tiles[S];if(x[S]||!C.hasData()||C.tileID.overscaledZ<=c||C.tileID.overscaledZ>f)continue;let P=C.tileID;for(;C&&C.tileID.overscaledZ>c+1;){const O=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[O.key],C&&C.hasData()&&(P=O)}let k=P;for(;k.overscaledZ>c;)if(k=k.scaledTo(k.overscaledZ-1),t[k.key]||t[k.canonical.key]){x[P.key]=P;break}}}findLoadedParent(t,c){if(t.key in this._loadedParentTiles){const f=this._loadedParentTiles[t.key];return f&&f.tileID.overscaledZ>=c?f:null}for(let f=t.overscaledZ-1;f>=c;f--){const x=t.scaledTo(f),S=this._getLoadedTile(x);if(S)return S}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const c=this._tiles[t.key];return c&&c.hasData()?c:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const c=Math.ceil(t.width/this._source.tileSize)+1,f=Math.ceil(t.height/this._source.tileSize)+1,x=Math.floor(c*f*(this._maxTileCacheZoomLevels===null?y.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(S)}handleWrapJump(t){const c=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,c){const f={};for(const x in this._tiles){const S=this._tiles[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),f[S.tileID.key]=S}this._tiles=f;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(x,this._tiles[x])}}_updateCoveredAndRetainedTiles(t,c,f,x,S,C){const P={},k={},O=Object.keys(t),N=Le.now();for(const U of O){const V=t[U],$=this._tiles[U];if(!$||$.fadeEndTime!==0&&$.fadeEndTime<=N)continue;const W=this.findLoadedParent(V,c),ae=this.findLoadedSibling(V),ne=W||ae||null;ne&&(this._addTile(ne.tileID),P[ne.tileID.key]=ne.tileID),k[U]=V}this._retainLoadedChildren(k,x,f,t);for(const U in P)t[U]||(this._coveredTiles[U]=!0,t[U]=P[U]);if(C){const U={},V={};for(const $ of S)this._tiles[$.key].hasData()?U[$.key]=$:V[$.key]=$;for(const $ in V){const W=V[$].children(this._source.maxzoom);this._tiles[W[0].key]&&this._tiles[W[1].key]&&this._tiles[W[2].key]&&this._tiles[W[3].key]&&(U[W[0].key]=t[W[0].key]=W[0],U[W[1].key]=t[W[1].key]=W[1],U[W[2].key]=t[W[2].key]=W[2],U[W[3].key]=t[W[3].key]=W[3],delete V[$])}for(const $ in V){const W=V[$],ae=this.findLoadedParent(W,this._source.minzoom),ne=this.findLoadedSibling(W),oe=ae||ne||null;if(oe){U[oe.tileID.key]=t[oe.tileID.key]=oe.tileID;for(const he in U)U[he].isChildOf(oe.tileID)&&delete U[he]}}for(const $ in this._tiles)U[$]||(this._coveredTiles[$]=!0)}}update(t,c){if(!this._sourceLoaded||this._paused)return;let f;this.transform=t,this.terrain=c,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(N=>new y.Z(N.canonical.z,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y)):(f=ke(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:c,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(f=f.filter(N=>this._source.hasTile(N)))):f=[];const x=Dt(t,this._source),S=Math.max(x-Ti.maxOverzooming,this._source.minzoom),C=Math.max(x+Ti.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const N={};for(const U of f)if(U.canonical.z>this._source.minzoom){const V=U.scaledTo(U.canonical.z-1);N[V.key]=V;const $=U.scaledTo(Math.max(this._source.minzoom,Math.min(U.canonical.z,5)));N[$.key]=$}f=f.concat(Object.values(N))}const P=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,P&&this.fire(new y.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const k=this._updateRetainedTiles(f,x);hi(this._source.type)&&this._updateCoveredAndRetainedTiles(k,S,C,x,f,c);for(const N in k)this._tiles[N].clearFadeHold();const O=y.am(this._tiles,k);for(const N of O){const U=this._tiles[N];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(N)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,c){var f;const x={},S={},C=Math.max(c-Ti.maxOverzooming,this._source.minzoom),P=Math.max(c+Ti.maxUnderzooming,this._source.minzoom),k={};for(const O of t){const N=this._addTile(O);x[O.key]=O,N.hasData()||c<this._source.maxzoom&&(k[O.key]=O)}this._retainLoadedChildren(k,c,P,x);for(const O of t){let N=this._tiles[O.key];if(N.hasData())continue;if(c+1>this._source.maxzoom){const V=O.children(this._source.maxzoom)[0],$=this.getTile(V);if($&&$.hasData()){x[V.key]=V;continue}}else{const V=O.children(this._source.maxzoom);if(x[V[0].key]&&x[V[1].key]&&x[V[2].key]&&x[V[3].key])continue}let U=N.wasRequested();for(let V=O.overscaledZ-1;V>=C;--V){const $=O.scaledTo(V);if(S[$.key])break;if(S[$.key]=!0,N=this.getTile($),!N&&U&&(N=this._addTile($)),N){const W=N.hasData();if((W||!(!((f=this.map)===null||f===void 0)&&f.cancelPendingTileRequestsWhileZooming)||U)&&(x[$.key]=$),U=N.wasRequested(),W)break}}}return x}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const c=[];let f,x=this._tiles[t].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){f=this._loadedParentTiles[x.key];break}c.push(x.key);const S=x.scaledTo(x.overscaledZ-1);if(f=this._getLoadedTile(S),f)break;x=S}for(const S of c)this._loadedParentTiles[S]=f}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const c=this._tiles[t].tileID,f=this._getLoadedTile(c);this._loadedSiblingTiles[c.key]=f}}_addTile(t){let c=this._tiles[t.key];if(c)return c;c=this._cache.getAndRemove(t),c&&(this._setTileReloadTimer(t.key,c),c.tileID=t,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,c)));const f=c;return c||(c=new ba(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(c,t.key,c.state)),c.uses++,this._tiles[t.key]=c,f||this._source.fire(new y.l("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(t,c){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const f=c.getExpiryTimeout();f&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},f))}refreshTiles(t){for(const c in this._tiles)(this._isIdRenderable(c)||this._tiles[c].state=="errored")&&t.some(f=>f.equals(this._tiles[c].tileID.canonical))&&this._reloadTile(c,"expired")}_removeTile(t){const c=this._tiles[t];c&&(c.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),c.uses>0||(c.hasData()&&c.state!=="reloading"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}_dataHandler(t){const c=t.sourceDataType;t.dataType==="source"&&c==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&c==="content"&&(this.reload(t.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,c,f){const x=[],S=this.transform;if(!S)return x;const C=S.getCoveringTilesDetailsProvider().allowWorldCopies(),P=f?S.getCameraQueryGeometry(t):t,k=$=>S.screenPointToMercatorCoordinate($,this.terrain),O=this.transformBbox(t,k,!C),N=this.transformBbox(P,k,!C),U=this.getIds(),V=y.a2.fromPoints(N);for(let $=0;$<U.length;$++){const W=this._tiles[U[$]];if(W.holdingForFade())continue;const ae=C?[W.tileID]:[W.tileID.unwrapTo(-1),W.tileID.unwrapTo(0)],ne=Math.pow(2,S.zoom-W.tileID.overscaledZ),oe=c*W.queryPadding*y.$/W.tileSize/ne;for(const he of ae){const ge=V.map(de=>he.getTilePoint(new y.a1(de.x,de.y)));if(ge.expandBy(oe),ge.intersects(Tt)){const de=O.map(Me=>he.getTilePoint(Me)),xe=N.map(Me=>he.getTilePoint(Me));x.push({tile:W,tileID:C?he:he.unwrapTo(0),queryGeometry:de,cameraQueryGeometry:xe,scale:ne})}}}return x}transformBbox(t,c,f){let x=t.map(c);if(f){const S=y.a2.fromPoints(t);S.shrinkBy(.001*Math.min(S.width(),S.height()));const C=S.map(c);y.a2.fromPoints(x).covers(C)||(x=x.map(P=>P.x>.5?new y.a1(P.x-1,P.y,P.z):P))}return x}getVisibleCoordinates(t){const c=this.getRenderableIds(t).map(f=>this._tiles[f].tileID);return this.transform&&this.transform.populateCache(c),c}hasTransition(){if(this._source.hasTransition())return!0;if(hi(this._source.type)){const t=Le.now();for(const c in this._tiles)if(this._tiles[c].fadeEndTime>=t)return!0}return!1}setFeatureState(t,c,f){this._state.updateState(t=t||"_geojsonTileLayer",c,f)}removeFeatureState(t,c,f){this._state.removeFeatureState(t=t||"_geojsonTileLayer",c,f)}getFeatureState(t,c){return this._state.getState(t=t||"_geojsonTileLayer",c)}setDependencies(t,c,f){const x=this._tiles[t];x&&x.setDependencies(c,f)}reloadTilesForDependencies(t,c){for(const f in this._tiles)this._tiles[f].hasDependency(t,c)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(t,c))}}function $t(b,t){const c=Math.abs(2*b.wrap)-+(b.wrap<0),f=Math.abs(2*t.wrap)-+(t.wrap<0);return b.overscaledZ-t.overscaledZ||f-c||t.canonical.y-b.canonical.y||t.canonical.x-b.canonical.x}function hi(b){return b==="raster"||b==="image"||b==="video"}Ti.maxOverzooming=10,Ti.maxUnderzooming=3;class Ii{constructor(t,c){this.reset(t,c)}reset(t,c){this.points=t||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=y.ah(t,0,1);let c=1,f=this._distances[c];const x=t*this.paddedLength+this.padding;for(;f<x&&c<this._distances.length;)f=this._distances[++c];const S=c-1,C=this._distances[S],P=f-C,k=P>0?(x-C)/P:0;return this.points[S].mult(1-k).add(this.points[c].mult(k))}}function Yi(b,t){let c=!0;return b==="always"||b!=="never"&&t!=="never"||(c=!1),c}class er{constructor(t,c,f){const x=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(t/f),this.yCellCount=Math.ceil(c/f);for(let C=0;C<this.xCellCount*this.yCellCount;C++)x.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=c,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,c,f,x,S){this._forEachCell(c,f,x,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(x),this.bboxes.push(S)}insertCircle(t,c,f,x){this._forEachCell(c-x,f-x,c+x,f+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(c),this.circles.push(f),this.circles.push(x)}_insertBoxCell(t,c,f,x,S,C){this.boxCells[S].push(C)}_insertCircleCell(t,c,f,x,S,C){this.circleCells[S].push(C)}_query(t,c,f,x,S,C,P){if(f<0||t>this.width||x<0||c>this.height)return[];const k=[];if(t<=0&&c<=0&&this.width<=f&&this.height<=x){if(S)return[{key:null,x1:t,y1:c,x2:f,y2:x}];for(let O=0;O<this.boxKeys.length;O++)k.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const N=this.circles[3*O],U=this.circles[3*O+1],V=this.circles[3*O+2];k.push({key:this.circleKeys[O],x1:N-V,y1:U-V,x2:N+V,y2:U+V})}}else this._forEachCell(t,c,f,x,this._queryCell,k,{hitTest:S,overlapMode:C,seenUids:{box:{},circle:{}}},P);return k}query(t,c,f,x){return this._query(t,c,f,x,!1,null)}hitTest(t,c,f,x,S,C){return this._query(t,c,f,x,!0,S,C).length>0}hitTestCircle(t,c,f,x,S){const C=t-f,P=t+f,k=c-f,O=c+f;if(P<0||C>this.width||O<0||k>this.height)return!1;const N=[];return this._forEachCell(C,k,P,O,this._queryCellCircle,N,{hitTest:!0,overlapMode:x,circle:{x:t,y:c,radius:f},seenUids:{box:{},circle:{}}},S),N.length>0}_queryCell(t,c,f,x,S,C,P,k){const{seenUids:O,hitTest:N,overlapMode:U}=P,V=this.boxCells[S];if(V!==null){const W=this.bboxes;for(const ae of V)if(!O.box[ae]){O.box[ae]=!0;const ne=4*ae,oe=this.boxKeys[ae];if(t<=W[ne+2]&&c<=W[ne+3]&&f>=W[ne+0]&&x>=W[ne+1]&&(!k||k(oe))&&(!N||!Yi(U,oe.overlapMode))&&(C.push({key:oe,x1:W[ne],y1:W[ne+1],x2:W[ne+2],y2:W[ne+3]}),N))return!0}}const $=this.circleCells[S];if($!==null){const W=this.circles;for(const ae of $)if(!O.circle[ae]){O.circle[ae]=!0;const ne=3*ae,oe=this.circleKeys[ae];if(this._circleAndRectCollide(W[ne],W[ne+1],W[ne+2],t,c,f,x)&&(!k||k(oe))&&(!N||!Yi(U,oe.overlapMode))){const he=W[ne],ge=W[ne+1],de=W[ne+2];if(C.push({key:oe,x1:he-de,y1:ge-de,x2:he+de,y2:ge+de}),N)return!0}}}return!1}_queryCellCircle(t,c,f,x,S,C,P,k){const{circle:O,seenUids:N,overlapMode:U}=P,V=this.boxCells[S];if(V!==null){const W=this.bboxes;for(const ae of V)if(!N.box[ae]){N.box[ae]=!0;const ne=4*ae,oe=this.boxKeys[ae];if(this._circleAndRectCollide(O.x,O.y,O.radius,W[ne+0],W[ne+1],W[ne+2],W[ne+3])&&(!k||k(oe))&&!Yi(U,oe.overlapMode))return C.push(!0),!0}}const $=this.circleCells[S];if($!==null){const W=this.circles;for(const ae of $)if(!N.circle[ae]){N.circle[ae]=!0;const ne=3*ae,oe=this.circleKeys[ae];if(this._circlesCollide(W[ne],W[ne+1],W[ne+2],O.x,O.y,O.radius)&&(!k||k(oe))&&!Yi(U,oe.overlapMode))return C.push(!0),!0}}}_forEachCell(t,c,f,x,S,C,P,k){const O=this._convertToXCellCoord(t),N=this._convertToYCellCoord(c),U=this._convertToXCellCoord(f),V=this._convertToYCellCoord(x);for(let $=O;$<=U;$++)for(let W=N;W<=V;W++)if(S.call(this,t,c,f,x,this.xCellCount*W+$,C,P,k))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,c,f,x,S,C){const P=x-t,k=S-c,O=f+C;return O*O>P*P+k*k}_circleAndRectCollide(t,c,f,x,S,C,P){const k=(C-x)/2,O=Math.abs(t-(x+k));if(O>k+f)return!1;const N=(P-S)/2,U=Math.abs(c-(S+N));if(U>N+f)return!1;if(O<=k||U<=N)return!0;const V=O-k,$=U-N;return V*V+$*$<=f*f}}function Mi(b,t,c){const f=y.L();if(!b){const{vecSouth:U,vecEast:V}=di(t),$=pe();$[0]=V[0],$[1]=V[1],$[2]=U[0],$[3]=U[1],x=$,(N=(C=(S=$)[0])*(O=S[3])-(k=S[2])*(P=S[1]))&&(x[0]=O*(N=1/N),x[1]=-P*N,x[2]=-k*N,x[3]=C*N),f[0]=$[0],f[1]=$[1],f[4]=$[2],f[5]=$[3]}var x,S,C,P,k,O,N;return y.N(f,f,[1/c,1/c,1]),f}function Lt(b,t,c,f){if(b){const x=y.L();if(!t){const{vecSouth:S,vecEast:C}=di(c);x[0]=C[0],x[1]=C[1],x[4]=S[0],x[5]=S[1]}return y.N(x,x,[f,f,1]),x}return c.pixelsToClipSpaceMatrix}function di(b){const t=Math.cos(b.rollInRadians),c=Math.sin(b.rollInRadians),f=Math.cos(b.pitchInRadians),x=Math.cos(b.bearingInRadians),S=Math.sin(b.bearingInRadians),C=y.ar();C[0]=-x*f*c-S*t,C[1]=-S*f*c+x*t;const P=y.as(C);P<1e-9?y.at(C):y.au(C,C,1/P);const k=y.ar();k[0]=x*f*t-S*c,k[1]=S*f*t+x*c;const O=y.as(k);return O<1e-9?y.at(k):y.au(k,k,1/O),{vecEast:k,vecSouth:C}}function Bi(b,t,c,f){let x;f?(x=[b,t,f(b,t),1],y.aw(x,x,c)):(x=[b,t,0,1],ho(x,x,c));const S=x[3];return{point:new y.P(x[0]/S,x[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}function pt(b,t){return .5+b/t*.5}function Ar(b,t){return b.x>=-t[0]&&b.x<=t[0]&&b.y>=-t[1]&&b.y<=t[1]}function Ur(b,t,c,f,x,S,C,P,k,O,N,U,V){const $=c?b.textSizeData:b.iconSizeData,W=y.an($,t.transform.zoom),ae=[256/t.width*2+1,256/t.height*2+1],ne=c?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;ne.clear();const oe=b.lineVertexArray,he=c?b.text.placedSymbolArray:b.icon.placedSymbolArray,ge=t.transform.width/t.transform.height;let de=!1;for(let xe=0;xe<he.length;xe++){const Me=he.get(xe);if(Me.hidden||Me.writingMode===y.ao.vertical&&!de){Fa(Me.numGlyphs,ne);continue}de=!1;const fe=new y.P(Me.anchorX,Me.anchorY),ze={getElevation:V,pitchedLabelPlaneMatrix:f,lineVertexArray:oe,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:fe,unwrappedTileID:k,width:O,height:N,translation:U},Ve=or(Me.anchorX,Me.anchorY,ze);if(!Ar(Ve.point,ae)){Fa(Me.numGlyphs,ne);continue}const Ne=pt(t.transform.cameraToCenterDistance,Ve.signedDistanceFromCamera),Fe=y.ap($,W,Me),He=S?Fe*t.transform.getPitchedTextCorrection(Me.anchorX,Me.anchorY,k)/Ne:Fe*Ne,gt=xt({projectionContext:ze,pitchedLabelPlaneMatrixInverse:x,symbol:Me,fontSize:He,flip:!1,keepUpright:C,glyphOffsetArray:b.glyphOffsetArray,dynamicLayoutVertexArray:ne,aspectRatio:ge,rotateToLine:P});de=gt.useVertical,(gt.notEnoughRoom||de||gt.needsFlipping&&xt({projectionContext:ze,pitchedLabelPlaneMatrixInverse:x,symbol:Me,fontSize:He,flip:!0,keepUpright:C,glyphOffsetArray:b.glyphOffsetArray,dynamicLayoutVertexArray:ne,aspectRatio:ge,rotateToLine:P}).notEnoughRoom)&&Fa(Me.numGlyphs,ne)}c?b.text.dynamicLayoutVertexBuffer.updateData(ne):b.icon.dynamicLayoutVertexBuffer.updateData(ne)}function Ba(b,t,c,f,x,S,C,P){const k=S.glyphStartIndex+S.numGlyphs,O=S.lineStartIndex,N=S.lineStartIndex+S.lineLength,U=t.getoffsetX(S.glyphStartIndex),V=t.getoffsetX(k-1),$=Vn(b*U,c,f,x,S.segment,O,N,P,C);if(!$)return null;const W=Vn(b*V,c,f,x,S.segment,O,N,P,C);return W?P.projectionCache.anyProjectionOccluded?null:{first:$,last:W}:null}function dr(b,t,c,f){return b===y.ao.horizontal&&Math.abs(c.y-t.y)>Math.abs(c.x-t.x)*f?{useVertical:!0}:(b===y.ao.vertical?t.y<c.y:t.x>c.x)?{needsFlipping:!0}:null}function xt(b){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:c,symbol:f,fontSize:x,flip:S,keepUpright:C,glyphOffsetArray:P,dynamicLayoutVertexArray:k,aspectRatio:O,rotateToLine:N}=b,U=x/24,V=f.lineOffsetX*U,$=f.lineOffsetY*U;let W;if(f.numGlyphs>1){const ae=f.glyphStartIndex+f.numGlyphs,ne=f.lineStartIndex,oe=f.lineStartIndex+f.lineLength,he=Ba(U,P,V,$,S,f,N,t);if(!he)return{notEnoughRoom:!0};const ge=Oa(he.first.point.x,he.first.point.y,t,c),de=Oa(he.last.point.x,he.last.point.y,t,c);if(C&&!S){const xe=dr(f.writingMode,ge,de,O);if(xe)return xe}W=[he.first];for(let xe=f.glyphStartIndex+1;xe<ae-1;xe++){const Me=Vn(U*P.getoffsetX(xe),V,$,S,f.segment,ne,oe,t,N);if(!Me)return{notEnoughRoom:!0};W.push(Me)}W.push(he.last)}else{if(C&&!S){const ne=lr(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,oe=f.lineStartIndex+f.segment+1,he=new y.P(t.lineVertexArray.getx(oe),t.lineVertexArray.gety(oe)),ge=lr(he.x,he.y,t),de=ge.signedDistanceFromCamera>0?ge.point:ai(t.tileAnchorPoint,he,ne,1,t),xe=Oa(ne.x,ne.y,t,c),Me=Oa(de.x,de.y,t,c),fe=dr(f.writingMode,xe,Me,O);if(fe)return fe}const ae=Vn(U*P.getoffsetX(f.glyphStartIndex),V,$,S,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,t,N);if(!ae||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};W=[ae]}for(const ae of W)y.av(k,ae.point,ae.angle);return{}}function ai(b,t,c,f,x){const S=b.add(b.sub(t)._unit()),C=lr(S.x,S.y,x).point,P=c.sub(C);return c.add(P._mult(f/P.mag()))}function si(b,t,c){const f=t.projectionCache;if(f.projections[b])return f.projections[b];const x=new y.P(t.lineVertexArray.getx(b),t.lineVertexArray.gety(b)),S=lr(x.x,x.y,t);if(S.signedDistanceFromCamera>0)return f.projections[b]=S.point,f.anyProjectionOccluded=f.anyProjectionOccluded||S.isOccluded,S.point;const C=b-c.direction;return ai(c.distanceFromAnchor===0?t.tileAnchorPoint:new y.P(t.lineVertexArray.getx(C),t.lineVertexArray.gety(C)),x,c.previousVertex,c.absOffsetX-c.distanceFromAnchor+1,t)}function lr(b,t,c){const f=b+c.translation[0],x=t+c.translation[1];let S;return c.pitchWithMap?(S=Bi(f,x,c.pitchedLabelPlaneMatrix,c.getElevation),S.isOccluded=!1):(S=c.transform.projectTileCoordinates(f,x,c.unwrappedTileID,c.getElevation),S.point.x=(.5*S.point.x+.5)*c.width,S.point.y=(.5*-S.point.y+.5)*c.height),S}function Oa(b,t,c,f){if(c.pitchWithMap){const x=[b,t,0,1];return y.aw(x,x,f),c.transform.projectTileCoordinates(x[0]/x[3],x[1]/x[3],c.unwrappedTileID,c.getElevation).point}return{x:b/c.width*2-1,y:1-t/c.height*2}}function or(b,t,c){return c.transform.projectTileCoordinates(b,t,c.unwrappedTileID,c.getElevation)}function wi(b,t,c){return b._unit()._perp()._mult(t*c)}function Pc(b,t,c,f,x,S,C,P,k){if(P.projectionCache.offsets[b])return P.projectionCache.offsets[b];const O=c.add(t);if(b+k.direction<f||b+k.direction>=x)return P.projectionCache.offsets[b]=O,O;const N=si(b+k.direction,P,k),U=wi(N.sub(c),C,k.direction),V=c.add(U),$=N.add(U);return P.projectionCache.offsets[b]=y.ax(S,O,V,$)||O,P.projectionCache.offsets[b]}function Vn(b,t,c,f,x,S,C,P,k){const O=f?b-t:b+t;let N=O>0?1:-1,U=0;f&&(N*=-1,U=Math.PI),N<0&&(U+=Math.PI);let V,$=N>0?S+x:S+x+1;P.projectionCache.cachedAnchorPoint?V=P.projectionCache.cachedAnchorPoint:(V=lr(P.tileAnchorPoint.x,P.tileAnchorPoint.y,P).point,P.projectionCache.cachedAnchorPoint=V);let W,ae,ne=V,oe=V,he=0,ge=0;const de=Math.abs(O),xe=[];let Me;for(;he+ge<=de;){if($+=N,$<S||$>=C)return null;he+=ge,oe=ne,ae=W;const Ve={absOffsetX:de,direction:N,distanceFromAnchor:he,previousVertex:oe};if(ne=si($,P,Ve),c===0)xe.push(oe),Me=ne.sub(oe);else{let Ne;const Fe=ne.sub(oe);Ne=Fe.mag()===0?wi(si($+N,P,Ve).sub(ne),c,N):wi(Fe,c,N),ae||(ae=oe.add(Ne)),W=Pc($,Ne,ne,S,C,ae,c,P,Ve),xe.push(ae),Me=W.sub(ae)}ge=Me.mag()}const fe=Me._mult((de-he)/ge)._add(ae||oe),ze=U+Math.atan2(ne.y-oe.y,ne.x-oe.x);return xe.push(fe),{point:fe,angle:k?ze:0,path:xe}}const os=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Fa(b,t){for(let c=0;c<b;c++){const f=t.length;t.resize(f+4),t.float32.set(os,3*f)}}function ho(b,t,c){const f=t[0],x=t[1];return b[0]=c[0]*f+c[4]*x+c[12],b[1]=c[1]*f+c[5]*x+c[13],b[3]=c[3]*f+c[7]*x+c[15],b}const Br=100;class Ul{constructor(t,c=new er(t.width+200,t.height+200,25),f=new er(t.width+200,t.height+200,25)){this.transform=t,this.grid=c,this.ignoredGrid=f,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Br,this.screenBottomBoundary=t.height+Br,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,c,f,x,S,C,P,k,O,N,U,V){const $=this.projectAndGetPerspectiveRatio(t.anchorPointX+k[0],t.anchorPointY+k[1],S,N,V),W=f*$.perspectiveRatio;let ae;if(C||P)ae=this._projectCollisionBox(t,W,x,S,C,P,k,$,N,U,V);else{const Me=$.x+(U?U.x*W:0),fe=$.y+(U?U.y*W:0);ae={allPointsOccluded:!1,box:[Me+t.x1*W,fe+t.y1*W,Me+t.x2*W,fe+t.y2*W]}}const[ne,oe,he,ge]=ae.box,de=C?ae.allPointsOccluded:$.isOccluded;let xe=de;return xe||(xe=$.perspectiveRatio<this.perspectiveRatioCutoff),xe||(xe=!this.isInsideGrid(ne,oe,he,ge)),xe||c!=="always"&&this.grid.hitTest(ne,oe,he,ge,c,O)?{box:[ne,oe,he,ge],placeable:!1,offscreen:!1,occluded:de}:{box:[ne,oe,he,ge],placeable:!0,offscreen:this.isOffscreen(ne,oe,he,ge),occluded:de}}placeCollisionCircles(t,c,f,x,S,C,P,k,O,N,U,V,$,W){const ae=[],ne=new y.P(c.anchorX,c.anchorY),oe=this.getPerspectiveRatio(ne.x,ne.y,C,W),he=(O?S*this.transform.getPitchedTextCorrection(c.anchorX,c.anchorY,C)/oe:S*oe)/y.aB,ge={getElevation:W,pitchedLabelPlaneMatrix:P,lineVertexArray:f,pitchWithMap:O,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ne,unwrappedTileID:C,width:this.transform.width,height:this.transform.height,translation:$},de=Ba(he,x,c.lineOffsetX*he,c.lineOffsetY*he,!1,c,!1,ge);let xe=!1,Me=!1,fe=!0;if(de){const ze=.5*U*oe+V,Ve=new y.P(-100,-100),Ne=new y.P(this.screenRightBoundary,this.screenBottomBoundary),Fe=new Ii,He=de.first,gt=de.last;let yt=[];for(let oi=He.path.length-1;oi>=1;oi--)yt.push(He.path[oi]);for(let oi=1;oi<gt.path.length;oi++)yt.push(gt.path[oi]);const st=2.5*ze;if(O){const oi=this.projectPathToScreenSpace(yt,ge);yt=oi.some(Gi=>Gi.signedDistanceFromCamera<=0)?[]:oi.map(Gi=>Gi.point)}let Bt=[];if(yt.length>0){const oi=yt[0].clone(),Gi=yt[0].clone();for(let yr=1;yr<yt.length;yr++)oi.x=Math.min(oi.x,yt[yr].x),oi.y=Math.min(oi.y,yt[yr].y),Gi.x=Math.max(Gi.x,yt[yr].x),Gi.y=Math.max(Gi.y,yt[yr].y);Bt=oi.x>=Ve.x&&Gi.x<=Ne.x&&oi.y>=Ve.y&&Gi.y<=Ne.y?[yt]:Gi.x<Ve.x||oi.x>Ne.x||Gi.y<Ve.y||oi.y>Ne.y?[]:y.ay([yt],Ve.x,Ve.y,Ne.x,Ne.y)}for(const oi of Bt){Fe.reset(oi,.25*ze);let Gi=0;Gi=Fe.length<=.5*ze?1:Math.ceil(Fe.paddedLength/st)+1;for(let yr=0;yr<Gi;yr++){const nr=yr/Math.max(Gi-1,1),$r=Fe.lerp(nr),jr=$r.x+Br,mi=$r.y+Br;ae.push(jr,mi,ze,0);const _r=jr-ze,Hr=mi-ze,wn=jr+ze,gn=mi+ze;if(fe=fe&&this.isOffscreen(_r,Hr,wn,gn),Me=Me||this.isInsideGrid(_r,Hr,wn,gn),t!=="always"&&this.grid.hitTestCircle(jr,mi,ze,t,N)&&(xe=!0,!k))return{circles:[],offscreen:!1,collisionDetected:xe}}}}return{circles:!k&&xe||!Me||oe<this.perspectiveRatioCutoff?[]:ae,offscreen:fe,collisionDetected:xe}}projectPathToScreenSpace(t,c){const f=function(x,S){const C=y.L();return y.aq(C,S.pitchedLabelPlaneMatrix),x.map(P=>{const k=Bi(P.x,P.y,C,S.getElevation),O=S.transform.projectTileCoordinates(k.point.x,k.point.y,S.unwrappedTileID,S.getElevation);return O.point.x=(.5*O.point.x+.5)*S.width,O.point.y=(.5*-O.point.y+.5)*S.height,O})}(t,c);return function(x){let S=0,C=0,P=0,k=0;for(let O=0;O<x.length;O++)x[O].isOccluded?(P=O+1,k=0):(k++,k>C&&(C=k,S=P));return x.slice(S,S+C)}(f)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[],f=new y.a2;for(const U of t){const V=new y.P(U.x+Br,U.y+Br);f.extend(V),c.push(V)}const{minX:x,minY:S,maxX:C,maxY:P}=f,k=this.grid.query(x,S,C,P).concat(this.ignoredGrid.query(x,S,C,P)),O={},N={};for(const U of k){const V=U.key;if(O[V.bucketInstanceId]===void 0&&(O[V.bucketInstanceId]={}),O[V.bucketInstanceId][V.featureIndex])continue;const $=[new y.P(U.x1,U.y1),new y.P(U.x2,U.y1),new y.P(U.x2,U.y2),new y.P(U.x1,U.y2)];y.az(c,$)&&(O[V.bucketInstanceId][V.featureIndex]=!0,N[V.bucketInstanceId]===void 0&&(N[V.bucketInstanceId]=[]),N[V.bucketInstanceId].push(V.featureIndex))}return N}insertCollisionBox(t,c,f,x,S,C){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:S,collisionGroupID:C,overlapMode:c},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,c,f,x,S,C){const P=f?this.ignoredGrid:this.grid,k={bucketInstanceId:x,featureIndex:S,collisionGroupID:C,overlapMode:c};for(let O=0;O<t.length;O+=4)P.insertCircle(k,t[O],t[O+1],t[O+2])}projectAndGetPerspectiveRatio(t,c,f,x,S){if(S){let C;x?(C=[t,c,x(t,c),1],y.aw(C,C,S)):(C=[t,c,0,1],ho(C,C,S));const P=C[3];return{x:(C[0]/P+1)/2*this.transform.width+Br,y:(-C[1]/P+1)/2*this.transform.height+Br,perspectiveRatio:.5+this.transform.cameraToCenterDistance/P*.5,isOccluded:!1,signedDistanceFromCamera:P}}{const C=this.transform.projectTileCoordinates(t,c,f,x);return{x:(C.point.x+1)/2*this.transform.width+Br,y:(1-C.point.y)/2*this.transform.height+Br,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C.signedDistanceFromCamera*.5,isOccluded:C.isOccluded,signedDistanceFromCamera:C.signedDistanceFromCamera}}}getPerspectiveRatio(t,c,f,x){const S=this.transform.projectTileCoordinates(t,c,f,x);return .5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5}isOffscreen(t,c,f,x){return f<Br||t>=this.screenRightBoundary||x<Br||c>this.screenBottomBoundary}isInsideGrid(t,c,f,x){return f>=0&&t<this.gridRightBoundary&&x>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const t=y.ag([]);return y.M(t,t,[-100,-100,0]),t}_projectCollisionBox(t,c,f,x,S,C,P,k,O,N,U){let V=1,$=0,W=0,ae=1;const ne=t.anchorPointX+P[0],oe=t.anchorPointY+P[1];if(C&&!S){const yt=this.projectAndGetPerspectiveRatio(ne+1,oe,x,O,U),st=yt.x-k.x,Bt=Math.atan((yt.y-k.y)/st)+(st<0?Math.PI:0),oi=Math.sin(Bt),Gi=Math.cos(Bt);V=Gi,$=oi,W=-oi,ae=Gi}else if(!C&&S){const yt=di(this.transform);V=yt.vecEast[0],$=yt.vecEast[1],W=yt.vecSouth[0],ae=yt.vecSouth[1]}let he=k.x,ge=k.y,de=c;S&&(he=ne,ge=oe,de=Math.pow(2,-(this.transform.zoom-f.overscaledZ)),de*=this.transform.getPitchedTextCorrection(ne,oe,x),N||(de*=y.ah(.5+k.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),N&&(he+=V*N.x*de+W*N.y*de,ge+=$*N.x*de+ae*N.y*de);const xe=t.x1*de,Me=t.x2*de,fe=(xe+Me)/2,ze=t.y1*de,Ve=t.y2*de,Ne=(ze+Ve)/2,Fe=[{offsetX:xe,offsetY:ze},{offsetX:fe,offsetY:ze},{offsetX:Me,offsetY:ze},{offsetX:Me,offsetY:Ne},{offsetX:Me,offsetY:Ve},{offsetX:fe,offsetY:Ve},{offsetX:xe,offsetY:Ve},{offsetX:xe,offsetY:Ne}];let He=[];for(const{offsetX:yt,offsetY:st}of Fe)He.push(new y.P(he+V*yt+W*st,ge+$*yt+ae*st));let gt=!1;if(S){const yt=He.map(st=>this.projectAndGetPerspectiveRatio(st.x,st.y,x,O,U));gt=yt.some(st=>!st.isOccluded),He=yt.map(st=>new y.P(st.x,st.y))}else gt=!0;return{box:y.aA(He),allPointsOccluded:!gt}}}class Sn{constructor(t,c,f,x){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?c:-c))):x&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class tr{constructor(t,c,f,x,S){this.text=new Sn(t?t.text:null,c,f,S),this.icon=new Sn(t?t.icon:null,c,x,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ja{constructor(t,c,f){this.text=t,this.icon=c,this.skipFade=f}}class Vs{constructor(t,c,f,x,S){this.bucketInstanceId=t,this.featureIndex=c,this.sourceLayerIndex=f,this.bucketIndex=x,this.tileID=S}}class Qo{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const c=++this.maxGroupID;this.collisionGroups[t]={ID:c,predicate:f=>f.collisionGroupID===c}}return this.collisionGroups[t]}}function Na(b,t,c,f,x){const{horizontalAlign:S,verticalAlign:C}=y.aH(b);return new y.P(-(S-.5)*t+f[0]*x,-(C-.5)*c+f[1]*x)}class ls{constructor(t,c,f,x,S){this.transform=t.clone(),this.terrain=c,this.collisionIndex=new Ul(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Qo(x),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const c=this.terrain;return c?(f,x)=>c.getElevation(t,f,x):null}getBucketParts(t,c,f,x){const S=f.getBucket(c),C=f.latestFeatureIndex;if(!S||!C||c.id!==S.layerIds[0])return;const P=f.collisionBoxArray,k=S.layers[0].layout,O=S.layers[0].paint,N=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),U=f.tileSize/y.$,V=f.tileID.toUnwrapped(),$=k.get("text-rotation-alignment")==="map",W=y.aC(f,1,this.transform.zoom),ae=y.aD(this.collisionIndex.transform,f,O.get("text-translate"),O.get("text-translate-anchor")),ne=y.aD(this.collisionIndex.transform,f,O.get("icon-translate"),O.get("icon-translate-anchor")),oe=Mi($,this.transform,W);this.retainedQueryData[S.bucketInstanceId]=new Vs(S.bucketInstanceId,C,S.sourceLayerIndex,S.index,f.tileID);const he={bucket:S,layout:k,translationText:ae,translationIcon:ne,unwrappedTileID:V,pitchedLabelPlaneMatrix:oe,scale:N,textPixelRatio:U,holdingForFade:f.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:y.an(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(x)for(const ge of S.sortKeyRanges){const{sortKey:de,symbolInstanceStart:xe,symbolInstanceEnd:Me}=ge;t.push({sortKey:de,symbolInstanceStart:xe,symbolInstanceEnd:Me,parameters:he})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:he})}attemptAnchorPlacement(t,c,f,x,S,C,P,k,O,N,U,V,$,W,ae,ne,oe,he,ge,de){const xe=y.aE[t.textAnchor],Me=[t.textOffset0,t.textOffset1],fe=Na(xe,f,x,Me,S),ze=this.collisionIndex.placeCollisionBox(c,V,k,O,N,P,C,ne,U.predicate,ge,fe,de);if((!he||this.collisionIndex.placeCollisionBox(he,V,k,O,N,P,C,oe,U.predicate,ge,fe,de).placeable)&&ze.placeable){let Ve;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(Ve=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:Me,width:f,height:x,anchor:xe,textBoxScale:S,prevAnchor:Ve},this.markUsedJustification(W,xe,$,ae),W.allowVerticalPlacement&&(this.markUsedOrientation(W,ae,$),this.placedOrientations[$.crossTileID]=ae),{shift:fe,placedGlyphBoxes:ze}}}placeLayerBucketPart(t,c,f){const{bucket:x,layout:S,translationText:C,translationIcon:P,unwrappedTileID:k,pitchedLabelPlaneMatrix:O,textPixelRatio:N,holdingForFade:U,collisionBoxArray:V,partiallyEvaluatedTextSize:$,collisionGroup:W}=t.parameters,ae=S.get("text-optional"),ne=S.get("icon-optional"),oe=y.aF(S,"text-overlap","text-allow-overlap"),he=oe==="always",ge=y.aF(S,"icon-overlap","icon-allow-overlap"),de=ge==="always",xe=S.get("text-rotation-alignment")==="map",Me=S.get("text-pitch-alignment")==="map",fe=S.get("icon-text-fit")!=="none",ze=S.get("symbol-z-order")==="viewport-y",Ve=he&&(de||!x.hasIconData()||ne),Ne=de&&(he||!x.hasTextData()||ae);!x.collisionArrays&&V&&x.deserializeCollisionBoxes(V);const Fe=this.retainedQueryData[x.bucketInstanceId].tileID,He=this._getTerrainElevationFunc(Fe),gt=this.transform.getFastPathSimpleProjectionMatrix(Fe),yt=(st,Bt,oi)=>{var Gi,yr;if(c[st.crossTileID])return;if(U)return void(this.placements[st.crossTileID]=new ja(!1,!1,!1));let nr=!1,$r=!1,jr=!0,mi=null,_r={box:null,placeable:!1,offscreen:null,occluded:!1},Hr={placeable:!1},wn=null,gn=null,ia=null,ps=0,Pa=0,ms=0;Bt.textFeatureIndex?ps=Bt.textFeatureIndex:st.useRuntimeCollisionCircles&&(ps=st.featureIndex),Bt.verticalTextFeatureIndex&&(Pa=Bt.verticalTextFeatureIndex);const gs=Bt.textBox;if(gs){const Fn=Dr=>{let Xr=y.ao.horizontal;if(x.allowVerticalPlacement&&!Dr&&this.prevPlacement){const ma=this.prevPlacement.placedOrientations[st.crossTileID];ma&&(this.placedOrientations[st.crossTileID]=ma,Xr=ma,this.markUsedOrientation(x,Xr,st))}return Xr},_s=(Dr,Xr)=>{if(x.allowVerticalPlacement&&st.numVerticalGlyphVertices>0&&Bt.verticalTextBox){for(const ma of x.writingModes)if(ma===y.ao.vertical?(_r=Xr(),Hr=_r):_r=Dr(),_r&&_r.placeable)break}else _r=Dr()},ra=st.textAnchorOffsetStartIndex,No=st.textAnchorOffsetEndIndex;if(No===ra){const Dr=(Xr,ma)=>{const Lr=this.collisionIndex.placeCollisionBox(Xr,oe,N,Fe,k,Me,xe,C,W.predicate,He,void 0,gt);return Lr&&Lr.placeable&&(this.markUsedOrientation(x,ma,st),this.placedOrientations[st.crossTileID]=ma),Lr};_s(()=>Dr(gs,y.ao.horizontal),()=>{const Xr=Bt.verticalTextBox;return x.allowVerticalPlacement&&st.numVerticalGlyphVertices>0&&Xr?Dr(Xr,y.ao.vertical):{box:null,offscreen:null}}),Fn(_r&&_r.placeable)}else{let Dr=y.aE[(yr=(Gi=this.prevPlacement)===null||Gi===void 0?void 0:Gi.variableOffsets[st.crossTileID])===null||yr===void 0?void 0:yr.anchor];const Xr=(Lr,Vo,Uo)=>{const Ia=Lr.x2-Lr.x1,xr=Lr.y2-Lr.y1,so=st.textBoxScale,Wa=fe&&ge==="never"?Vo:null;let rn=null,Go=oe==="never"?1:2,Dh="never";Dr&&Go++;for(let xs=0;xs<Go;xs++){for(let vs=ra;vs<No;vs++){const zr=x.textAnchorOffsets.get(vs);if(Dr&&zr.textAnchor!==Dr)continue;const Ka=this.attemptAnchorPlacement(zr,Lr,Ia,xr,so,xe,Me,N,Fe,k,W,Dh,st,x,Uo,C,P,Wa,He);if(Ka&&(rn=Ka.placedGlyphBoxes,rn&&rn.placeable))return nr=!0,mi=Ka.shift,rn}Dr?Dr=null:Dh=oe}return f&&!rn&&(rn={box:this.collisionIndex.placeCollisionBox(gs,"always",N,Fe,k,Me,xe,C,W.predicate,He,void 0,gt).box,offscreen:!1,placeable:!1,occluded:!1}),rn};_s(()=>Xr(gs,Bt.iconBox,y.ao.horizontal),()=>{const Lr=Bt.verticalTextBox;return x.allowVerticalPlacement&&(!_r||!_r.placeable)&&st.numVerticalGlyphVertices>0&&Lr?Xr(Lr,Bt.verticalIconBox,y.ao.vertical):{box:null,occluded:!0,offscreen:null}}),_r&&(nr=_r.placeable,jr=_r.offscreen);const ma=Fn(_r&&_r.placeable);if(!nr&&this.prevPlacement){const Lr=this.prevPlacement.variableOffsets[st.crossTileID];Lr&&(this.variableOffsets[st.crossTileID]=Lr,this.markUsedJustification(x,Lr.anchor,st,ma))}}}if(wn=_r,nr=wn&&wn.placeable,jr=wn&&wn.offscreen,st.useRuntimeCollisionCircles){const Fn=x.text.placedSymbolArray.get(st.centerJustifiedTextSymbolIndex),_s=y.ap(x.textSizeData,$,Fn),ra=S.get("text-padding");gn=this.collisionIndex.placeCollisionCircles(oe,Fn,x.lineVertexArray,x.glyphOffsetArray,_s,k,O,f,Me,W.predicate,st.collisionCircleDiameter,ra,C,He),gn.circles.length&&gn.collisionDetected&&!f&&y.w("Collisions detected, but collision boxes are not shown"),nr=he||gn.circles.length>0&&!gn.collisionDetected,jr=jr&&gn.offscreen}if(Bt.iconFeatureIndex&&(ms=Bt.iconFeatureIndex),Bt.iconBox){const Fn=_s=>this.collisionIndex.placeCollisionBox(_s,ge,N,Fe,k,Me,xe,P,W.predicate,He,fe&&mi?mi:void 0,gt);Hr&&Hr.placeable&&Bt.verticalIconBox?(ia=Fn(Bt.verticalIconBox),$r=ia.placeable):(ia=Fn(Bt.iconBox),$r=ia.placeable),jr=jr&&ia.offscreen}const ys=ae||st.numHorizontalGlyphVertices===0&&st.numVerticalGlyphVertices===0,Ds=ne||st.numIconVertices===0;ys||Ds?Ds?ys||($r=$r&&nr):nr=$r&&nr:$r=nr=$r&&nr;const jo=$r&&ia.placeable;if(nr&&wn.placeable&&this.collisionIndex.insertCollisionBox(wn.box,oe,S.get("text-ignore-placement"),x.bucketInstanceId,Hr&&Hr.placeable&&Pa?Pa:ps,W.ID),jo&&this.collisionIndex.insertCollisionBox(ia.box,ge,S.get("icon-ignore-placement"),x.bucketInstanceId,ms,W.ID),gn&&nr&&this.collisionIndex.insertCollisionCircles(gn.circles,oe,S.get("text-ignore-placement"),x.bucketInstanceId,ps,W.ID),f&&this.storeCollisionData(x.bucketInstanceId,oi,Bt,wn,ia,gn),st.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(x.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[st.crossTileID]=new ja((nr||Ve)&&!(wn!=null&&wn.occluded),($r||Ne)&&!(ia!=null&&ia.occluded),jr||x.justReloaded),c[st.crossTileID]=!0};if(ze){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const st=x.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Bt=st.length-1;Bt>=0;--Bt){const oi=st[Bt];yt(x.symbolInstances.get(oi),x.collisionArrays[oi],oi)}}else for(let st=t.symbolInstanceStart;st<t.symbolInstanceEnd;st++)yt(x.symbolInstances.get(st),x.collisionArrays[st],st);x.justReloaded=!1}storeCollisionData(t,c,f,x,S,C){if(f.textBox||f.iconBox){let P,k;this.collisionBoxArrays.has(t)?P=this.collisionBoxArrays.get(t):(P=new Map,this.collisionBoxArrays.set(t,P)),P.has(c)?k=P.get(c):(k={text:null,icon:null},P.set(c,k)),f.textBox&&(k.text=x.box),f.iconBox&&(k.icon=S.box)}if(C){let P=this.collisionCircleArrays[t];P===void 0&&(P=this.collisionCircleArrays[t]=[]);for(let k=0;k<C.circles.length;k+=4)P.push(C.circles[k+0]-Br),P.push(C.circles[k+1]-Br),P.push(C.circles[k+2]),P.push(C.collisionDetected?1:0)}}markUsedJustification(t,c,f,x){let S;S=x===y.ao.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[y.aG(c)];const C=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const P of C)P>=0&&(t.text.placedSymbolArray.get(P).crossTileID=S>=0&&P!==S?0:f.crossTileID)}markUsedOrientation(t,c,f){const x=c===y.ao.horizontal||c===y.ao.horizontalOnly?c:0,S=c===y.ao.vertical?c:0,C=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const P of C)t.text.placedSymbolArray.get(P).placedOrientation=x;f.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let f=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const x=c?c.symbolFadeChange(t):1,S=c?c.opacities:{},C=c?c.variableOffsets:{},P=c?c.placedOrientations:{};for(const k in this.placements){const O=this.placements[k],N=S[k];N?(this.opacities[k]=new tr(N,x,O.text,O.icon),f=f||O.text!==N.text.placed||O.icon!==N.icon.placed):(this.opacities[k]=new tr(null,x,O.text,O.icon,O.skipFade),f=f||O.text||O.icon)}for(const k in S){const O=S[k];if(!this.opacities[k]){const N=new tr(O,x,!1,!1);N.isHidden()||(this.opacities[k]=N,f=f||O.text.placed||O.icon.placed)}}for(const k in C)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=C[k]);for(const k in P)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=P[k]);if(c&&c.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:t)}updateLayerOpacities(t,c){const f={};for(const x of c){const S=x.getBucket(t);S&&x.latestFeatureIndex&&t.id===S.layerIds[0]&&this.updateBucketOpacities(S,x.tileID,f,x.collisionBoxArray)}}updateBucketOpacities(t,c,f,x){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const S=t.layers[0],C=S.layout,P=new tr(null,0,!1,!1,!0),k=C.get("text-allow-overlap"),O=C.get("icon-allow-overlap"),N=S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"),U=C.get("text-rotation-alignment")==="map",V=C.get("text-pitch-alignment")==="map",$=C.get("icon-text-fit")!=="none",W=new tr(null,0,k&&(O||!t.hasIconData()||C.get("icon-optional")),O&&(k||!t.hasTextData()||C.get("text-optional")),!0);!t.collisionArrays&&x&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(x);const ae=(oe,he,ge)=>{for(let de=0;de<he/4;de++)oe.opacityVertexArray.emplaceBack(ge);oe.hasVisibleVertices=oe.hasVisibleVertices||ge!==Ss},ne=this.collisionBoxArrays.get(t.bucketInstanceId);for(let oe=0;oe<t.symbolInstances.length;oe++){const he=t.symbolInstances.get(oe),{numHorizontalGlyphVertices:ge,numVerticalGlyphVertices:de,crossTileID:xe}=he;let Me=this.opacities[xe];f[xe]?Me=P:Me||(Me=W,this.opacities[xe]=Me),f[xe]=!0;const fe=he.numIconVertices>0,ze=this.placedOrientations[he.crossTileID],Ve=ze===y.ao.vertical,Ne=ze===y.ao.horizontal||ze===y.ao.horizontalOnly;if(ge>0||de>0){const He=Zl(Me.text);ae(t.text,ge,Ve?Ss:He),ae(t.text,de,Ne?Ss:He);const gt=Me.text.isHidden();[he.rightJustifiedTextSymbolIndex,he.centerJustifiedTextSymbolIndex,he.leftJustifiedTextSymbolIndex].forEach(Bt=>{Bt>=0&&(t.text.placedSymbolArray.get(Bt).hidden=gt||Ve?1:0)}),he.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(he.verticalPlacedTextSymbolIndex).hidden=gt||Ne?1:0);const yt=this.variableOffsets[he.crossTileID];yt&&this.markUsedJustification(t,yt.anchor,he,ze);const st=this.placedOrientations[he.crossTileID];st&&(this.markUsedJustification(t,"left",he,st),this.markUsedOrientation(t,st,he))}if(fe){const He=Zl(Me.icon),gt=!($&&he.verticalPlacedIconSymbolIndex&&Ve);he.placedIconSymbolIndex>=0&&(ae(t.icon,he.numIconVertices,gt?He:Ss),t.icon.placedSymbolArray.get(he.placedIconSymbolIndex).hidden=Me.icon.isHidden()),he.verticalPlacedIconSymbolIndex>=0&&(ae(t.icon,he.numVerticalIconVertices,gt?Ss:He),t.icon.placedSymbolArray.get(he.verticalPlacedIconSymbolIndex).hidden=Me.icon.isHidden())}const Fe=ne&&ne.has(oe)?ne.get(oe):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const He=t.collisionArrays[oe];if(He){let gt=new y.P(0,0);if(He.textBox||He.verticalTextBox){let yt=!0;if(N){const st=this.variableOffsets[xe];st?(gt=Na(st.anchor,st.width,st.height,st.textOffset,st.textBoxScale),U&&gt._rotate(V?-this.transform.bearingInRadians:this.transform.bearingInRadians)):yt=!1}if(He.textBox||He.verticalTextBox){let st;He.textBox&&(st=Ve),He.verticalTextBox&&(st=Ne),Ic(t.textCollisionBox.collisionVertexArray,Me.text.placed,!yt||st,Fe.text,gt.x,gt.y)}}if(He.iconBox||He.verticalIconBox){const yt=!!(!Ne&&He.verticalIconBox);let st;He.iconBox&&(st=yt),He.verticalIconBox&&(st=!yt),Ic(t.iconCollisionBox.collisionVertexArray,Me.icon.placed,st,Fe.icon,$?gt.x:0,$?gt.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,c){const f=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*f>t}setStale(){this.stale=!0}}function Ic(b,t,c,f,x,S){f&&f.length!==0||(f=[0,0,0,0]);const C=f[0]-Br,P=f[1]-Br,k=f[2]-Br,O=f[3]-Br;b.emplaceBack(t?1:0,c?1:0,x||0,S||0,C,P),b.emplaceBack(t?1:0,c?1:0,x||0,S||0,k,P),b.emplaceBack(t?1:0,c?1:0,x||0,S||0,k,O),b.emplaceBack(t?1:0,c?1:0,x||0,S||0,C,O)}const ef=Math.pow(2,25),hd=Math.pow(2,24),br=Math.pow(2,17),Mu=Math.pow(2,16),Gl=Math.pow(2,9),ql=Math.pow(2,8),dd=Math.pow(2,1);function Zl(b){if(b.opacity===0&&!b.placed)return 0;if(b.opacity===1&&b.placed)return 4294967295;const t=b.placed?1:0,c=Math.floor(127*b.opacity);return c*ef+t*hd+c*br+t*Mu+c*Gl+t*ql+c*dd+t}const Ss=0;class wa{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,c,f,x,S){const C=this._bucketParts;for(;this._currentTileIndex<t.length;)if(c.getBucketParts(C,x,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((P,k)=>P.sortKey-k.sortKey));this._currentPartIndex<C.length;)if(c.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,S())return!0;return!1}}class Au{constructor(t,c,f,x,S,C,P,k){this.placement=new ls(t,c,C,P,k),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(t,c,f){const x=Le.now(),S=()=>!this._forceFullPlacement&&Le.now()-x>2;for(;this._currentPlacementIndex>=0;){const C=c[t[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=P)&&(!C.maxzoom||C.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new wa(C)),this._inProgressLayer.continuePlacement(f[C.source],this.placement,this._showCollisionBoxes,C,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const $l=512/y.$/2;class Cu{constructor(t,c,f){this.tileID=t,this.bucketInstanceId=f,this._symbolsByKey={};const x=new Map;for(let S=0;S<c.length;S++){const C=c.get(S),P=C.key,k=x.get(P);k?k.push(C):x.set(P,[C])}for(const[S,C]of x){const P={positions:C.map(k=>({x:Math.floor(k.anchorX*$l),y:Math.floor(k.anchorY*$l)})),crossTileIDs:C.map(k=>k.crossTileID)};if(P.positions.length>128){const k=new y.aI(P.positions.length,16,Uint16Array);for(const{x:O,y:N}of P.positions)k.add(O,N);k.finish(),delete P.positions,P.index=k}this._symbolsByKey[S]=P}}getScaledCoordinates(t,c){const{x:f,y:x,z:S}=this.tileID.canonical,{x:C,y:P,z:k}=c.canonical,O=$l/Math.pow(2,k-S),N=(P*y.$+t.anchorY)*O,U=x*y.$*$l;return{x:Math.floor((C*y.$+t.anchorX)*O-f*y.$*$l),y:Math.floor(N-U)}}findMatches(t,c,f){const x=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let S=0;S<t.length;S++){const C=t.get(S);if(C.crossTileID)continue;const P=this._symbolsByKey[C.key];if(!P)continue;const k=this.getScaledCoordinates(C,c);if(P.index){const O=P.index.range(k.x-x,k.y-x,k.x+x,k.y+x).sort();for(const N of O){const U=P.crossTileIDs[N];if(!f[U]){f[U]=!0,C.crossTileID=U;break}}}else if(P.positions)for(let O=0;O<P.positions.length;O++){const N=P.positions[O],U=P.crossTileIDs[O];if(Math.abs(N.x-k.x)<=x&&Math.abs(N.y-k.y)<=x&&!f[U]){f[U]=!0,C.crossTileID=U;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Jo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class tf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const c=Math.round((t-this.lng)/360);if(c!==0)for(const f in this.indexes){const x=this.indexes[f],S={};for(const C in x){const P=x[C];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+c),S[P.tileID.key]=P}this.indexes[f]=S}this.lng=t}addBucket(t,c,f){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let S=0;S<c.symbolInstances.length;S++)c.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const x=this.usedCrossTileIDs[t.overscaledZ];for(const S in this.indexes){const C=this.indexes[S];if(Number(S)>t.overscaledZ)for(const P in C){const k=C[P];k.tileID.isChildOf(t)&&k.findMatches(c.symbolInstances,t,x)}else{const P=C[t.scaledTo(Number(S)).key];P&&P.findMatches(c.symbolInstances,t,x)}}for(let S=0;S<c.symbolInstances.length;S++){const C=c.symbolInstances.get(S);C.crossTileID||(C.crossTileID=f.generate(),x[C.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Cu(t,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(t,c){for(const f of c.getCrossTileIDsLists())for(const x of f)delete this.usedCrossTileIDs[t][x]}removeStaleBuckets(t){let c=!1;for(const f in this.indexes){const x=this.indexes[f];for(const S in x)t[x[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,x[S]),delete x[S],c=!0)}return c}}class Us{constructor(){this.layerIndexes={},this.crossTileIDs=new Jo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,c,f){let x=this.layerIndexes[t.id];x===void 0&&(x=this.layerIndexes[t.id]=new tf);let S=!1;const C={};x.handleWrapJump(f);for(const P of c){const k=P.getBucket(t);k&&t.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(P.tileID,k,this.crossTileIDs)&&(S=!0),C[k.bucketInstanceId]=!0)}return x.removeStaleBuckets(C)&&(S=!0),S}pruneUnusedLayers(t){const c={};t.forEach(f=>{c[f]=!0});for(const f in this.layerIndexes)c[f]||delete this.layerIndexes[f]}}var cs="void main() {fragColor=vec4(1.0);}";const Sa={prelude:Ai(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Ai("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Ai("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Ai(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Ai(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ai(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ai(cs,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Ai(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Ai(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ai("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ai("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Ai(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Ai(cs,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Ai(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Ai(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Ai(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Ai(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ai(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ai(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ai(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ai(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Ai(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ai(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ai(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ai(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ai(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Ai(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ai(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ai(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ai("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Ai("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Ai("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Ai("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Ai(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Ai("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Ai(b,t){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=t.match(/in ([\w]+) ([\w]+)/g),x=b.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=S?S.concat(x):x,P={};return{fragmentSource:b=b.replace(c,(k,O,N,U,V)=>(P[V]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${N} ${U} ${V};
#else
uniform ${N} ${U} u_${V};
#endif
`:`
#ifdef HAS_UNIFORM_u_${V}
    ${N} ${U} ${V} = u_${V};
#endif
`)),vertexSource:t=t.replace(c,(k,O,N,U,V)=>{const $=U==="float"?"vec2":"vec4",W=V.match(/color/)?"color":$;return P[V]?O==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${N} ${$} a_${V};
out ${N} ${U} ${V};
#else
uniform ${N} ${U} u_${V};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${N} ${U} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${W}(a_${V}, u_${V}_t);
#else
    ${N} ${U} ${V} = u_${V};
#endif
`:O==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${N} ${$} a_${V};
#else
uniform ${N} ${U} u_${V};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${N} ${U} ${V} = a_${V};
#else
    ${N} ${U} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${N} ${U} ${V} = unpack_mix_${W}(a_${V}, u_${V}_t);
#else
    ${N} ${U} ${V} = u_${V};
#endif
`}),staticAttributes:f,staticUniforms:C}}class Gs{constructor(t,c,f){this.vertexBuffer=t,this.indexBuffer=c,this.segments=f}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Tn=y.aJ([{name:"a_pos",type:"Int16",components:2}]);const fo="#define PROJECTION_MERCATOR",po="mercator";class pi{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return po}get shaderDefine(){return fo}get shaderPreludeCode(){return Sa.projectionMercator}get vertexShaderPreludeCode(){return Sa.projectionMercator.vertexSource}get subdivisionGranularity(){return y.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,c,f,x,S){if(this._cachedMesh)return this._cachedMesh;const C=new y.aL;C.emplaceBack(0,0),C.emplaceBack(y.$,0),C.emplaceBack(0,y.$),C.emplaceBack(y.$,y.$);const P=t.createVertexBuffer(C,Tn.members),k=y.aM.simpleSegment(0,0,4,2),O=new y.aN;O.emplaceBack(1,0,2),O.emplaceBack(1,2,3);const N=t.createIndexBuffer(O);return this._cachedMesh=new Gs(P,N,k),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Va{constructor(t=0,c=0,f=0,x=0){if(isNaN(t)||t<0||isNaN(c)||c<0||isNaN(f)||f<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=c,this.left=f,this.right=x}interpolate(t,c,f){return c.top!=null&&t.top!=null&&(this.top=y.C.number(t.top,c.top,f)),c.bottom!=null&&t.bottom!=null&&(this.bottom=y.C.number(t.bottom,c.bottom,f)),c.left!=null&&t.left!=null&&(this.left=y.C.number(t.left,c.left,f)),c.right!=null&&t.right!=null&&(this.right=y.C.number(t.right,c.right,f)),this}getCenter(t,c){const f=y.ah((this.left+t-this.right)/2,0,t),x=y.ah((this.top+c-this.bottom)/2,0,c);return new y.P(f,x)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Va(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function kc(b,t){if(!b.renderWorldCopies||b.lngRange)return;const c=t.lng-b.center.lng;t.lng+=c>180?-360:c<-180?360:0}function mo(b){return Math.max(0,Math.floor(b))}class Jr{constructor(t,c,f,x,S,C){this._callbacks=t,this._tileSize=512,this._renderWorldCopies=C===void 0||!!C,this._minZoom=c||0,this._maxZoom=f||22,this._minPitch=x??0,this._maxPitch=S??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new y.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=mo(this._zoom),this._scale=y.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Va,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,c,f){this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=mo(this._zoom),this._scale=y.af(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Va(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!f&&t.autoCalculateNearFarZ,c&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new y.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const c=y.aO(t,-180,180)*Math.PI/180;var f,x,S,C,P,k,O,N,U;this._bearingInRadians!==c&&(this._unmodified=!1,this._bearingInRadians=c,this._calcMatrices(),this._rotationMatrix=pe(),f=this._rotationMatrix,S=-this._bearingInRadians,C=(x=this._rotationMatrix)[0],P=x[1],k=x[2],O=x[3],N=Math.sin(S),U=Math.cos(S),f[0]=C*U+k*N,f[1]=P*U+O*N,f[2]=C*-N+k*U,f[3]=P*-N+O*U)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const c=y.ah(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==c&&(this._unmodified=!1,this._pitchInRadians=c,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const c=t/180*Math.PI;this._rollInRadians!==c&&(this._unmodified=!1,this._rollInRadians=c,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return y.aP(this._fovInRadians)}setFov(t){t=y.ah(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=y.ae(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const c=this.getConstrained(this._center,t).zoom;this._zoom!==c&&(this._unmodified=!1,this._zoom=c,this._tileZoom=Math.max(0,Math.floor(c)),this._scale=y.af(c),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,c){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=c,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,c,f){this._unmodified=!1,this._edgeInsets.interpolate(t,c,f),this._constrain(),this._calcMatrices()}resize(t,c,f=!0){this._width=t,this._height=c,f&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new xi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-y.ai,y.ai])}getConstrained(t,c){return this._callbacks.getConstrained(t,c)}getCameraQueryGeometry(t,c){if(c.length===1)return[c[0],t];{const{minX:f,minY:x,maxX:S,maxY:C}=y.a2.fromPoints(c).extend(t);return[new y.P(f,x),new y.P(S,x),new y.P(S,C),new y.P(f,C),new y.P(f,x)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:c,zoom:f}=this.getConstrained(this.center,this.zoom);this.setCenter(c),this.setZoom(f),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=y.ag(new Float64Array(16));y.N(t,t,[this._width/2,-this._height/2,1]),y.M(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=y.ag(new Float64Array(16)),y.N(t,t,[1,-1,1]),y.M(t,t,[-1,-1,0]),y.N(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,c,f,x){const S=f!==void 0?f:this.bearing,C=x=x!==void 0?x:this.pitch,P=y.a1.fromLngLat(t,c),k=-Math.cos(y.ae(C)),O=Math.sin(y.ae(C)),N=O*Math.sin(y.ae(S)),U=-O*Math.cos(y.ae(S));let V=this.elevation;const $=c-V;let W;k*$>=0||Math.abs(k)<.1?(W=1e4,V=c+W*k):W=-$/k;let ae,ne,oe=y.aQ(1,P.y),he=0;do{if(he+=1,he>10)break;ne=W/oe,ae=new y.a1(P.x+N*ne,P.y+U*ne),oe=1/ae.meterInMercatorCoordinateUnits()}while(Math.abs(W-ne*oe)>1e-12);return{center:ae.toLngLat(),elevation:V,zoom:y.ak(this.height/2/Math.tan(this.fovInRadians/2)/ne/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const c=y.aj(1,this.center.lat)*this.worldSize,f=this.cameraToCenterDistance/c,x=y.a1.fromLngLat(this.center,this.elevation),S=je(this.center,this.elevation,this.pitch,this.bearing,f);this._elevation=t;const C=this.calculateCenterFromCameraLngLatAlt(S.toLngLat(),y.aQ(S.z,x.y),this.bearing,this.pitch);this._elevation=C.elevation,this._center=C.center,this.setZoom(C.zoom)}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=y.aj(1,this.center.lat)*this.worldSize;return je(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const c=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/c,t.canonical.y/c,1/c/y.$,1/c/y.$]}}class Mn{constructor(t,c){this.min=t,this.max=c,this.center=y.aR([],y.aS([],this.min,this.max),.5)}quadrant(t){const c=[t%2==0,t<2],f=y.aT(this.min),x=y.aT(this.max);for(let S=0;S<c.length;S++)f[S]=c[S]?this.min[S]:this.center[S],x[S]=c[S]?this.center[S]:this.max[S];return x[2]=this.max[2],new Mn(f,x)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let c=!0;for(let f=0;f<t.planes.length;f++){const x=this.intersectsPlane(t.planes[f]);if(x===0)return 0;x===1&&(c=!1)}return c?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let c=t[3],f=t[3];for(let x=0;x<3;x++)t[x]>0?(c+=t[x]*this.min[x],f+=t[x]*this.max[x]):(f+=t[x]*this.min[x],c+=t[x]*this.max[x]);return c>=0?2:f<0?0:1}}class on{distanceToTile2d(t,c,f,x){const S=x.distanceX([t,c]),C=x.distanceY([t,c]);return Math.hypot(S,C)}getWrap(t,c,f){return f}getTileBoundingVolume(t,c,f,x){var S,C;let P=0,k=0;if(x!=null&&x.terrain){const N=new y.Z(t.z,c,t.z,t.x,t.y),U=x.terrain.getMinMaxElevation(N);P=(S=U.minElevation)!==null&&S!==void 0?S:Math.min(0,f),k=(C=U.maxElevation)!==null&&C!==void 0?C:Math.max(0,f)}const O=1<<t.z;return new Mn([c+t.x/O,t.y/O,P],[c+(t.x+1)/O,(t.y+1)/O,k])}allowVariableZoom(t,c){const f=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,x=y.ah(78.5-f/2,0,60);return!!c.terrain||t.pitch>x}allowWorldCopies(){return!0}prepareNextFrame(){}}class mn{constructor(t,c,f){this.points=t,this.planes=c,this.aabb=f}static fromInvProjectionMatrix(t,c=1,f=0,x,S){const C=S?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],P=Math.pow(2,f),k=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(V=>function($,W,ae,ne){const oe=y.aw([],$,W),he=1/oe[3]/ae*ne;return y.aY(oe,oe,[he,he,1/oe[3],he])}(V,t,c,P));x&&function(V,$,W,ae){const ne=ae?4:0,oe=ae?0:4;let he=0;const ge=[],de=[];for(let fe=0;fe<4;fe++){const ze=y.aU([],V[fe+oe],V[fe+ne]),Ve=y.aZ(ze);y.aR(ze,ze,1/Ve),ge.push(Ve),de.push(ze)}for(let fe=0;fe<4;fe++){const ze=y.a_(V[fe+ne],de[fe],W);he=ze!==null&&ze>=0?Math.max(he,ze):Math.max(he,ge[fe])}const xe=function(fe,ze){const Ve=y.aU([],fe[ze[0]],fe[ze[1]]),Ne=y.aU([],fe[ze[2]],fe[ze[1]]),Fe=[0,0,0,0];return y.aV(Fe,y.aW([],Ve,Ne)),Fe[3]=-y.aX(Fe,fe[ze[0]]),Fe}(V,$),Me=function(fe,ze){const Ve=y.a$(fe),Ne=y.b0([],fe,1/Ve),Fe=y.aU([],ze,y.aR([],Ne,y.aX(ze,Ne))),He=y.a$(Fe);if(He>0){const gt=Math.sqrt(1-Ne[3]*Ne[3]),yt=y.aR([],Ne,-Ne[3]),st=y.aS([],yt,y.aR([],Fe,gt/He));return y.b1(ze,st)}return null}(W,xe);if(Me!==null){const fe=Me/y.aX(de[0],xe);he=Math.min(he,fe)}for(let fe=0;fe<4;fe++){const ze=Math.min(he,ge[fe]);V[fe+oe]=[V[fe+ne][0]+de[fe][0]*ze,V[fe+ne][1]+de[fe][1]*ze,V[fe+ne][2]+de[fe][2]*ze,1]}}(k,C[0],x,S);const O=C.map(V=>{const $=y.aU([],k[V[0]],k[V[1]]),W=y.aU([],k[V[2]],k[V[1]]),ae=y.aV([],y.aW([],$,W)),ne=-y.aX(ae,k[V[1]]);return ae.concat(ne)}),N=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],U=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const V of k)for(let $=0;$<3;$++)N[$]=Math.min(N[$],V[$]),U[$]=Math.max(U[$],V[$]);return new mn(k,O,new Mn(N,U))}}class ir{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,c,f){return this._helper.interpolatePadding(t,c,f)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,c,f=!0){this._helper.resize(t,c,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,c){this._helper.overrideNearFarZ(t,c)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,c){}constructor(t,c,f,x,S){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Jr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(C,P)=>this.getConstrained(C,P)},t,c,f,x,S),this._coveringTilesDetailsProvider=new on}clone(){const t=new ir;return t.apply(this),t}apply(t,c,f){this._helper.apply(t,c,f)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const c=[new y.b2(0,t)];if(this._helper._renderWorldCopies){const f=this.screenPointToMercatorCoordinate(new y.P(0,0)),x=this.screenPointToMercatorCoordinate(new y.P(this._helper._width,0)),S=this.screenPointToMercatorCoordinate(new y.P(this._helper._width,this._helper._height)),C=this.screenPointToMercatorCoordinate(new y.P(0,this._helper._height)),P=Math.floor(Math.min(f.x,x.x,S.x,C.x)),k=Math.floor(Math.max(f.x,x.x,S.x,C.x)),O=1;for(let N=P-O;N<=k+O;N++)N!==0&&c.push(new y.b2(N,t))}return c}getCameraFrustum(){return mn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const c=this.screenPointToLocation(this.centerPoint,t),f=t?t.getElevationForLngLatZoom(c,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(f)}setLocationAtPoint(t,c){const f=y.aj(this.elevation,this.center.lat),x=this.screenPointToMercatorCoordinateAtZ(c,f),S=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,f),C=y.a1.fromLngLat(t),P=new y.a1(C.x-(x.x-S.x),C.y-(x.y-S.y));this.setCenter(P==null?void 0:P.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,c){return c?this.coordinatePoint(y.a1.fromLngLat(t),c.getElevationForLngLatZoom(t,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(y.a1.fromLngLat(t))}screenPointToLocation(t,c){var f;return(f=this.screenPointToMercatorCoordinate(t,c))===null||f===void 0?void 0:f.toLngLat()}screenPointToMercatorCoordinate(t,c){if(c){const f=c.pointCoordinate(t);if(f!=null)return f}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,c){const f=c||0,x=[t.x,t.y,0,1],S=[t.x,t.y,1,1];y.aw(x,x,this._pixelMatrixInverse),y.aw(S,S,this._pixelMatrixInverse);const C=x[3],P=S[3],k=x[1]/C,O=S[1]/P,N=x[2]/C,U=S[2]/P,V=N===U?0:(f-N)/(U-N);return new y.a1(y.C.number(x[0]/C,S[0]/P,V)/this.worldSize,y.C.number(k,O,V)/this.worldSize,f)}coordinatePoint(t,c=0,f=this._pixelMatrix){const x=[t.x*this.worldSize,t.y*this.worldSize,c,1];return y.aw(x,x,f),new y.P(x[0]/x[3],x[1]/x[3])}getBounds(){const t=Math.max(0,this._helper._height/2-Ae(this));return new xi().extend(this.screenPointToLocation(new y.P(0,t))).extend(this.screenPointToLocation(new y.P(this._helper._width,t))).extend(this.screenPointToLocation(new y.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new y.P(0,this._helper._height)))}isPointOnMapSurface(t,c){return c?c.pointCoordinate(t)!=null:t.y>this.height/2-Ae(this)}calculatePosMatrix(t,c=!1,f){var x;const S=(x=t.key)!==null&&x!==void 0?x:y.b3(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),C=c?this._alignedPosMatrixCache:this._posMatrixCache;if(C.has(S)){const O=C.get(S);return f?O.f32:O.f64}const P=Pe(t,this.worldSize);y.O(P,c?this._alignedProjMatrix:this._viewProjMatrix,P);const k={f64:P,f32:new Float32Array(P)};return C.set(S,k),f?k.f32:k.f64}calculateFogMatrix(t){const c=t.key,f=this._fogMatrixCacheF32;if(f.has(c))return f.get(c);const x=Pe(t,this.worldSize);return y.O(x,this._fogMatrix,x),f.set(c,new Float32Array(x)),f.get(c)}getConstrained(t,c){c=y.ah(+c,this.minZoom,this.maxZoom);const f={center:new y.S(t.lng,t.lat),zoom:c};let x=this._helper._lngRange;!this._helper._renderWorldCopies&&x===null&&(x=[-179.9999999999,179.9999999999]);const S=this.tileSize*y.af(f.zoom);let C=0,P=S,k=0,O=S,N=0,U=0;const{x:V,y:$}=this.size;if(this._helper._latRange){const ge=this._helper._latRange;C=y.U(ge[1])*S,P=y.U(ge[0])*S,P-C<$&&(N=$/(P-C))}x&&(k=y.aO(y.V(x[0])*S,0,S),O=y.aO(y.V(x[1])*S,0,S),O<k&&(O+=S),O-k<V&&(U=V/(O-k)));const{x:W,y:ae}=re(S,t);let ne,oe;const he=Math.max(U||0,N||0);if(he){const ge=new y.P(U?(O+k)/2:W,N?(P+C)/2:ae);return f.center=me(S,ge).wrap(),f.zoom+=y.ak(he),f}if(this._helper._latRange){const ge=$/2;ae-ge<C&&(oe=C+ge),ae+ge>P&&(oe=P-ge)}if(x){const ge=(k+O)/2;let de=W;this._helper._renderWorldCopies&&(de=y.aO(W,ge-S/2,ge+S/2));const xe=V/2;de-xe<k&&(ne=k+xe),de+xe>O&&(ne=O-xe)}if(ne!==void 0||oe!==void 0){const ge=new y.P(ne??W,oe??ae);f.center=me(S,ge).wrap()}return f}calculateCenterFromCameraLngLatAlt(t,c,f,x){return this._helper.calculateCenterFromCameraLngLatAlt(t,c,f,x)}_calculateNearFarZIfNeeded(t,c,f){if(!this._helper.autoCalculateNearFarZ)return;const x=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),S=t-x*this._helper._pixelPerMeter/Math.cos(c),C=x<0?S:t,P=Math.PI/2+this.pitchInRadians,k=y.ae(this.fov)*(Math.abs(Math.cos(y.ae(this.roll)))*this.height+Math.abs(Math.sin(y.ae(this.roll)))*this.width)/this.height*(.5+f.y/this.height),O=Math.sin(k)*C/Math.sin(y.ah(Math.PI-P-k,.01,Math.PI-.01)),N=Ae(this),U=Math.atan(N/this._helper.cameraToCenterDistance),V=y.ae(.75),$=U>V?2*U*(.5+f.y/(2*N)):V,W=Math.sin($)*C/Math.sin(y.ah(Math.PI-P-$,.01,Math.PI-.01)),ae=Math.min(O,W);this._helper._farZ=1.01*(Math.cos(Math.PI/2-c)*ae+C),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,c=re(this.worldSize,this.center),f=c.x,x=c.y;this._helper._pixelPerMeter=y.aj(1,this.center.lat)*this.worldSize;const S=y.ae(Math.min(this.pitch,ee)),C=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(S));let P;this._calculateNearFarZIfNeeded(C,S,t),P=new Float64Array(16),y.b4(P,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),y.aq(this._invProjMatrix,P),P[8]=2*-t.x/this._helper._width,P[9]=2*t.y/this._helper._height,this._projectionMatrix=y.b5(P),y.N(P,P,[1,-1,1]),y.M(P,P,[0,0,-this._helper.cameraToCenterDistance]),y.b6(P,P,-this.rollInRadians),y.b7(P,P,this.pitchInRadians),y.b6(P,P,-this.bearingInRadians),y.M(P,P,[-f,-x,0]),this._mercatorMatrix=y.N([],P,[this.worldSize,this.worldSize,this.worldSize]),y.N(P,P,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=y.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,P),y.M(P,P,[0,0,-this.elevation]),this._viewProjMatrix=P,this._invViewProjMatrix=y.aq([],P);const k=[0,0,-1,1];y.aw(k,k,this._invViewProjMatrix),this._cameraPosition=[k[0]/k[3],k[1]/k[3],k[2]/k[3]],this._fogMatrix=new Float64Array(16),y.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,C,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,y.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),y.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),y.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),y.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),y.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),y.M(this._fogMatrix,this._fogMatrix,[-f,-x,0]),y.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),y.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=y.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,P);const O=this._helper._width%2/2,N=this._helper._height%2/2,U=Math.cos(this.bearingInRadians),V=Math.sin(-this.bearingInRadians),$=f-Math.round(f)+U*O+V*N,W=x-Math.round(x)+U*N+V*O,ae=new Float64Array(P);if(y.M(ae,ae,[$>.5?$-1:$,W>.5?W-1:W,0]),this._alignedProjMatrix=ae,P=y.aq(new Float64Array(16),this._pixelMatrix),!P)throw new Error("failed to invert matrix");this._pixelMatrixInverse=P,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new y.P(0,0)),c=[t.x*this.worldSize,t.y*this.worldSize,0,1];return y.aw(c,c,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=y.aj(1,this.center.lat)*this.worldSize;return je(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,c){const f=y.a1.fromLngLat(t),x=[f.x*this.worldSize,f.y*this.worldSize,c,1];return y.aw(x,x,this._viewProjMatrix),x[2]/x[3]}getProjectionData(t){const{overscaledTileID:c,aligned:f,applyTerrainMatrix:x}=t,S=this._helper.getMercatorTileCoordinates(c),C=c?this.calculatePosMatrix(c,f,!0):null;let P;return P=c&&c.terrainRttPosMatrix32f&&x?c.terrainRttPosMatrix32f:C||y.b8(),{mainMatrix:P,tileMercatorCoords:S,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:P}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,c,f){return 1}transformLightDirection(t){return y.aT(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,c,f,x){const S=this.calculatePosMatrix(f);let C;x?(C=[t,c,x(t,c),1],y.aw(C,C,S)):(C=[t,c,0,1],ho(C,C,S));const P=C[3];return{point:new y.P(C[0]/P,C[1]/P),signedDistanceFromCamera:P,isOccluded:!1}}populateCache(t){for(const c of t)this.calculatePosMatrix(c)}getMatrixForModel(t,c){const f=y.a1.fromLngLat(t,c),x=f.meterInMercatorCoordinateUnits(),S=y.b9();return y.M(S,S,[f.x,f.y,f.z]),y.b6(S,S,Math.PI),y.b7(S,S,Math.PI/2),y.N(S,S,[-x,x,x]),S}getProjectionDataForCustomLayer(t=!0){const c=new y.Z(0,0,0,0,0),f=this.getProjectionData({overscaledTileID:c,applyGlobeMatrix:t}),x=Pe(c,this.worldSize);y.O(x,this._viewProjMatrix,x),f.tileMercatorCoords=[0,0,1,1];const S=[y.$,y.$,this.worldSize/this._helper.pixelsPerMeter],C=y.ba();return y.N(C,x,S),f.fallbackMatrix=C,f.mainMatrix=C,f}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function qs(){y.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Dn(b){if(b.useSlerp)if(b.k<1){const t=y.bb(b.startEulerAngles.roll,b.startEulerAngles.pitch,b.startEulerAngles.bearing),c=y.bb(b.endEulerAngles.roll,b.endEulerAngles.pitch,b.endEulerAngles.bearing),f=new Float64Array(4);y.bc(f,t,c,b.k);const x=y.bd(f);b.tr.setRoll(x.roll),b.tr.setPitch(x.pitch),b.tr.setBearing(x.bearing)}else b.tr.setRoll(b.endEulerAngles.roll),b.tr.setPitch(b.endEulerAngles.pitch),b.tr.setBearing(b.endEulerAngles.bearing);else b.tr.setRoll(y.C.number(b.startEulerAngles.roll,b.endEulerAngles.roll,b.k)),b.tr.setPitch(y.C.number(b.startEulerAngles.pitch,b.endEulerAngles.pitch,b.k)),b.tr.setBearing(y.C.number(b.startEulerAngles.bearing,b.endEulerAngles.bearing,b.k))}function An(b,t,c,f,x){const S=x.padding,C=re(x.worldSize,c.getNorthWest()),P=re(x.worldSize,c.getNorthEast()),k=re(x.worldSize,c.getSouthEast()),O=re(x.worldSize,c.getSouthWest()),N=y.ae(-f),U=C.rotate(N),V=P.rotate(N),$=k.rotate(N),W=O.rotate(N),ae=new y.P(Math.max(U.x,V.x,W.x,$.x),Math.max(U.y,V.y,W.y,$.y)),ne=new y.P(Math.min(U.x,V.x,W.x,$.x),Math.min(U.y,V.y,W.y,$.y)),oe=ae.sub(ne),he=(x.width-(S.left+S.right+t.left+t.right))/oe.x,ge=(x.height-(S.top+S.bottom+t.top+t.bottom))/oe.y;if(ge<0||he<0)return void qs();const de=Math.min(y.ak(x.scale*Math.min(he,ge)),b.maxZoom),xe=y.P.convert(b.offset),Me=new y.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(y.ae(f)),fe=xe.add(Me).mult(x.scale/y.af(de));return{center:me(x.worldSize,C.add(k).div(2).sub(fe)),zoom:de,bearing:f}}class Gr{get useGlobeControls(){return!1}handlePanInertia(t,c){return{easingOffset:t,easingCenter:c.center}}handleMapControlsRollPitchBearingZoom(t,c){t.bearingDelta&&c.setBearing(c.bearing+t.bearingDelta),t.pitchDelta&&c.setPitch(c.pitch+t.pitchDelta),t.rollDelta&&c.setRoll(c.roll+t.rollDelta),t.zoomDelta&&c.setZoom(c.zoom+t.zoomDelta)}handleMapControlsPan(t,c,f){t.around.distSqr(c.centerPoint)<.01||c.setLocationAtPoint(f,t.around)}cameraForBoxAndBearing(t,c,f,x,S){return An(t,c,f,x,S)}handleJumpToCenterZoom(t,c){t.zoom!==(c.zoom!==void 0?+c.zoom:t.zoom)&&t.setZoom(+c.zoom),c.center!==void 0&&t.setCenter(y.S.convert(c.center))}handleEaseTo(t,c){const f=t.zoom,x=t.padding,S={roll:t.roll,pitch:t.pitch,bearing:t.bearing},C={roll:c.roll===void 0?t.roll:c.roll,pitch:c.pitch===void 0?t.pitch:c.pitch,bearing:c.bearing===void 0?t.bearing:c.bearing},P=c.zoom!==void 0,k=!t.isPaddingEqual(c.padding);let O=!1;const N=P?+c.zoom:t.zoom;let U=t.centerPoint.add(c.offsetAsPoint);const V=t.screenPointToLocation(U),{center:$,zoom:W}=t.getConstrained(y.S.convert(c.center||V),N??f);kc(t,$);const ae=re(t.worldSize,V),ne=re(t.worldSize,$).sub(ae),oe=y.af(W-f);return O=W!==f,{easeFunc:he=>{if(O&&t.setZoom(y.C.number(f,W,he)),y.be(S,C)||Dn({startEulerAngles:S,endEulerAngles:C,tr:t,k:he,useSlerp:S.roll!=C.roll}),k&&(t.interpolatePadding(x,c.padding,he),U=t.centerPoint.add(c.offsetAsPoint)),c.around)t.setLocationAtPoint(c.around,c.aroundPoint);else{const ge=y.af(t.zoom-f),de=W>f?Math.min(2,oe):Math.max(.5,oe),xe=Math.pow(de,1-he),Me=me(t.worldSize,ae.add(ne.mult(he*xe)).mult(ge));t.setLocationAtPoint(t.renderWorldCopies?Me.wrap():Me,U)}},isZooming:O,elevationCenter:$}}handleFlyTo(t,c){const f=c.zoom!==void 0,x=t.zoom,S=t.getConstrained(y.S.convert(c.center||c.locationAtOffset),f?+c.zoom:x),C=S.center,P=S.zoom;kc(t,C);const k=re(t.worldSize,c.locationAtOffset),O=re(t.worldSize,C).sub(k),N=O.mag(),U=y.af(P-x);let V;if(c.minZoom!==void 0){const $=Math.min(+c.minZoom,x,P),W=t.getConstrained(C,$).zoom;V=y.af(W-x)}return{easeFunc:($,W,ae,ne)=>{t.setZoom($===1?P:x+y.ak(W));const oe=$===1?C:me(t.worldSize,k.add(O.mult(ae)).mult(W));t.setLocationAtPoint(t.renderWorldCopies?oe.wrap():oe,ne)},scaleOfZoom:U,targetCenter:C,scaleOfMinZoom:V,pixelPathLength:N}}}class wr{constructor(t,c,f){this.blendFunction=t,this.blendColor=c,this.mask=f}}wr.Replace=[1,0],wr.disabled=new wr(wr.Replace,y.bf.transparent,[!1,!1,!1,!1]),wr.unblended=new wr(wr.Replace,y.bf.transparent,[!0,!0,!0,!0]),wr.alphaBlended=new wr([1,771],y.bf.transparent,[!0,!0,!0,!0]);const Ts=2305;class ii{constructor(t,c,f){this.enable=t,this.mode=c,this.frontFace=f}}ii.disabled=new ii(!1,1029,Ts),ii.backCCW=new ii(!0,1029,Ts),ii.frontCCW=new ii(!0,1028,Ts);class ri{constructor(t,c,f){this.func=t,this.mask=c,this.range=f}}ri.ReadOnly=!1,ri.ReadWrite=!0,ri.disabled=new ri(519,ri.ReadOnly,[0,1]);const Ua=7680;class Li{constructor(t,c,f,x,S,C){this.test=t,this.ref=c,this.mask=f,this.fail=x,this.depthFail=S,this.pass=C}}Li.disabled=new Li({func:519,mask:0},0,0,Ua,Ua,Ua);const fr=new WeakMap;function Xn(b){var t;if(fr.has(b))return fr.get(b);{const c=(t=b.getParameter(b.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return fr.set(b,c),c}}class Yn{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const c=t.context,f=c.gl;this._texFormat=f.RGBA,this._texType=f.UNSIGNED_BYTE;const x=new y.aL;x.emplaceBack(-1,-1),x.emplaceBack(2,-1),x.emplaceBack(-1,2);const S=new y.aN;S.emplaceBack(0,1,2),this._fullscreenTriangle=new Gs(c.createVertexBuffer(x,Tn.members),c.createIndexBuffer(S),y.aM.simpleSegment(0,0,x.length,S.length)),this._resultBuffer=new Uint8Array(4),c.activeTexture.set(f.TEXTURE1);const C=f.createTexture();f.bindTexture(f.TEXTURE_2D,C),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texImage2D(f.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=c.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(C),Xn(f)&&(this._pbo=f.createBuffer(),f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.bufferData(f.PIXEL_PACK_BUFFER,4,f.STREAM_READ),f.bindBuffer(f.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,c){const f=this._updateCount;return this._readbackQueue?f>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():f>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,c),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,c=t.gl;t.activeTexture.set(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,c){const f=this._cachedRenderContext.context,x=f.gl;if(this._bindFramebuffer(),f.viewport.set([0,0,this._texWidth,this._texHeight]),f.clear({color:y.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(f,x.TRIANGLES,ri.disabled,Li.disabled,wr.unblended,ii.disabled,((S,C)=>({u_input:S,u_output_expected:C}))(t,c),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Xn(x)){x.bindBuffer(x.PIXEL_PACK_BUFFER,this._pbo),x.readBuffer(x.COLOR_ATTACHMENT0),x.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),x.bindBuffer(x.PIXEL_PACK_BUFFER,null);const S=x.fenceSync(x.SYNC_GPU_COMMANDS_COMPLETE,0);x.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:S}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Xn(t)){const c=t.clientWaitSync(this._readbackQueue.sync,0,0);if(c===t.WAIT_FAILED)return y.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(c===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Yn._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let c=0;return c+=t[0]/256,c+=t[1]/65536,c+=t[2]/16777216,t[3]<127&&(c=-c),c/128}}const el=y.$/128;function fd(b,t){const c=b.granularity!==void 0?Math.max(b.granularity,1):1,f=c+(b.generateBorders?2:0),x=c+(b.extendToNorthPole||b.generateBorders?1:0)+(b.extendToSouthPole||b.generateBorders?1:0),S=f+1,C=x+1,P=b.generateBorders?-1:0,k=b.generateBorders||b.extendToNorthPole?-1:0,O=c+(b.generateBorders?1:0),N=c+(b.generateBorders||b.extendToSouthPole?1:0),U=S*C,V=f*x*6,$=S*C>65536;if($&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const W=$||t==="32bit",ae=new Int16Array(2*U);let ne=0;for(let ge=k;ge<=N;ge++)for(let de=P;de<=O;de++){let xe=de/c*y.$;de===-1&&(xe=-el),de===c+1&&(xe=y.$+el);let Me=ge/c*y.$;ge===-1&&(Me=b.extendToNorthPole?y.bh:-el),ge===c+1&&(Me=b.extendToSouthPole?y.bi:y.$+el),ae[ne++]=xe,ae[ne++]=Me}const oe=W?new Uint32Array(V):new Uint16Array(V);let he=0;for(let ge=0;ge<x;ge++)for(let de=0;de<f;de++){const xe=de+1+ge*S,Me=de+(ge+1)*S,fe=de+1+(ge+1)*S;oe[he++]=de+ge*S,oe[he++]=Me,oe[he++]=xe,oe[he++]=xe,oe[he++]=Me,oe[he++]=fe}return{vertices:ae.buffer.slice(0),indices:oe.buffer.slice(0),uses32bitIndices:W}}const go=new y.aK({fill:new y.bj(128,2),line:new y.bj(512,0),tile:new y.bj(128,32),stencil:new y.bj(128,1),circle:3});class tl{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Sa.projectionGlobe}get vertexShaderPreludeCode(){return Sa.projectionMercator.vertexSource}get subdivisionGranularity(){return go}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new Yn(t));const c=y.U(this._errorQueryLatitudeDegrees),f=2*Math.atan(Math.exp(Math.PI-c*Math.PI*2))-.5*Math.PI,x=this._errorMeasurement.updateErrorLoop(c,f),S=Le.now();x!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=x,this._errorMeasurementLastChangeTime=S);const C=Math.min(Math.max((S-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=y.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,y.bl(C))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,c,f,x,S){const C=(S==="stencil"?go.stencil:go.tile).getGranularityForZoomLevel(c.z);return this._getMesh(t,{granularity:C,generateBorders:f,extendToNorthPole:c.y===0&&x,extendToSouthPole:c.y===(1<<c.z)-1&&x})}_getMesh(t,c){const f=this._getMeshKey(c);if(f in this._tileMeshCache)return this._tileMeshCache[f];const x=function(S,C){const P=fd(C,"16bit"),k=y.aL.deserialize({arrayBuffer:P.vertices,length:P.vertices.byteLength/2/2}),O=y.aN.deserialize({arrayBuffer:P.indices,length:P.indices.byteLength/2/3});return new Gs(S.createVertexBuffer(k,Tn.members),S.createIndexBuffer(O),y.aM.simpleSegment(0,0,k.length,O.length))}(t,c);return this._tileMeshCache[f]=x,x}recalculate(t){}hasTransition(){const t=Le.now();let c=!1;return c=c||(t-this._errorMeasurementLastChangeTime)/1e3<.7,c=c||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,c}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const yo=new y.r({type:new y.D(y.v.projection.type)});class _o extends y.E{constructor(t){super(),this._transitionable=new y.t(yo),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new y.F(0)),this._mercatorProjection=new pi,this._verticalPerspectiveProjection=new tl}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof y.bm){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,c,f,x,S){return this.currentProjection.getMeshFromTileID(t,c,f,x,S)}setProjection(t){this._transitionable.setValue("type",(t==null?void 0:t.type)||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Rc(b){const t=il(b.worldSize,b.center.lat);return 2*Math.PI*t}function Ta(b,t,c,f,x){const S=1/(1<<x),C=t/y.$*S+f*S,P=y.bo((b/y.$*S+c*S)*Math.PI*2+Math.PI,2*Math.PI),k=2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI,O=Math.cos(k),N=new Float64Array(3);return N[0]=Math.sin(P)*O,N[1]=Math.sin(k),N[2]=Math.cos(P)*O,N}function Rr(b){return function(t,c){const f=Math.cos(c),x=new Float64Array(3);return x[0]=Math.sin(t)*f,x[1]=Math.sin(c),x[2]=Math.cos(t)*f,x}(b.lng*Math.PI/180,b.lat*Math.PI/180)}function il(b,t){return b/(2*Math.PI)/Math.cos(t*Math.PI/180)}function xo(b){const t=Math.asin(b[1])/Math.PI*180,c=Math.sqrt(b[0]*b[0]+b[2]*b[2]);if(c>1e-6){const f=b[0]/c,x=Math.acos(b[2]/c),S=(f>0?x:-x)/Math.PI*180;return new y.S(y.aO(S,-180,180),t)}return new y.S(0,t)}function vo(b){return Math.cos(b*Math.PI/180)}function en(b,t){const c=vo(b),f=vo(t);return y.ak(f/c)}function Mh(b,t){const c=b.rotate(t.bearingInRadians),f=t.zoom+en(t.center.lat,0),x=y.bk(1/vo(t.center.lat),1/vo(Math.min(Math.abs(t.center.lat),60)),y.bn(f,7,3,0,1)),S=360/Rc({worldSize:t.worldSize,center:{lat:t.center.lat}});return new y.S(t.center.lng-c.x*S*x,y.ah(t.center.lat+c.y*S,-y.ai,y.ai))}function Ms(b){const t=.5*b,c=Math.sin(t),f=Math.cos(t);return Math.log(c+f)-Math.log(f-c)}function Eu(b,t,c,f){const x=b.lat+c*f;if(Math.abs(c)>1){const S=(Math.sign(b.lat+c)!==Math.sign(b.lat)?-Math.abs(b.lat):Math.abs(b.lat))*Math.PI/180,C=Math.abs(b.lat+c)*Math.PI/180,P=Ms(S+f*(C-S)),k=Ms(S),O=Ms(C);return new y.S(b.lng+t*((P-k)/(O-k)),x)}return new y.S(b.lng+t*f,x)}class rf{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,c,f,x){const S=`${t.z}_${t.x}_${t.y}_${x!=null&&x.terrain?"t":""}`,C=this._cache.get(S);if(C)return C;const P=this._cachePrevious.get(S);if(P)return this._cache.set(S,P),P;const k=this._boundingVolumeFactory(t,c,f,x);return this._cache.set(S,k),this._hadAnyChanges=!0,k}}class Dc{constructor(t,c,f,x){this.min=f,this.max=x,this.points=t,this.planes=c}static fromAabb(t,c){const f=[];for(let x=0;x<8;x++)f.push([1&~x?t[0]:c[0],(x>>1&1)==1?c[1]:t[1],(x>>2&1)==1?c[2]:t[2]]);return new Dc(f,[[-1,0,0,c[0]],[1,0,0,-t[0]],[0,-1,0,c[1]],[0,1,0,-t[1]],[0,0,-1,c[2]],[0,0,1,-t[2]]],t,c)}static fromCenterSizeAngles(t,c,f){const x=y.br([],f[0],f[1],f[2]),S=y.bs([],[c[0],0,0],x),C=y.bs([],[0,c[1],0],x),P=y.bs([],[0,0,c[2]],x),k=[...t],O=[...t];for(let U=0;U<8;U++)for(let V=0;V<3;V++){const $=t[V]+S[V]*(1&~U?-1:1)+C[V]*((U>>1&1)==1?1:-1)+P[V]*((U>>2&1)==1?1:-1);k[V]=Math.min(k[V],$),O[V]=Math.max(O[V],$)}const N=[];for(let U=0;U<8;U++){const V=[...t];y.aS(V,V,y.aR([],S,1&~U?-1:1)),y.aS(V,V,y.aR([],C,(U>>1&1)==1?1:-1)),y.aS(V,V,y.aR([],P,(U>>2&1)==1?1:-1)),N.push(V)}return new Dc(N,[[...S,-y.aX(S,N[0])],[...C,-y.aX(C,N[0])],[...P,-y.aX(P,N[0])],[-S[0],-S[1],-S[2],-y.aX(S,N[7])],[-C[0],-C[1],-C[2],-y.aX(C,N[7])],[-P[0],-P[1],-P[2],-y.aX(P,N[7])]],k,O)}intersectsFrustum(t){let c=!0;const f=this.points.length,x=this.planes.length,S=t.planes.length,C=t.points.length;for(let P=0;P<S;P++){const k=t.planes[P];let O=0;for(let N=0;N<f;N++){const U=this.points[N];k[0]*U[0]+k[1]*U[1]+k[2]*U[2]+k[3]>=0&&O++}if(O===0)return 0;O<f&&(c=!1)}if(c)return 2;for(let P=0;P<x;P++){const k=this.planes[P];let O=0;for(let N=0;N<C;N++){const U=t.points[N];k[0]*U[0]+k[1]*U[1]+k[2]*U[2]+k[3]>=0&&O++}if(O===0)return 0}return 1}intersectsPlane(t){const c=this.points.length;let f=0;for(let x=0;x<c;x++){const S=this.points[x];t[0]*S[0]+t[1]*S[1]+t[2]*S[2]+t[3]>=0&&f++}return f===c?2:f===0?0:1}}function Un(b,t,c){const f=b-t;return f<0?-f:Math.max(0,f-c)}function zu(b,t,c,f,x){const S=b-c;let C;return C=S<0?Math.min(-S,1+S-x):S>1?Math.min(Math.max(S-x,0),1-S):0,Math.max(C,Un(t,f,x))}class As{constructor(){this._boundingVolumeCache=new rf(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,c,f,x){const S=1<<f.z,C=1/S,P=f.x/S,k=f.y/S;let O=2;return O=Math.min(O,zu(t,c,P,k,C)),O=Math.min(O,zu(t,c,P+.5,-k-C,C)),O=Math.min(O,zu(t,c,P+.5,2-k-C,C)),O}getWrap(t,c,f){const x=1<<c.z,S=1/x,C=c.x/x,P=Un(t.x,C,S),k=Un(t.x,C-1,S),O=Un(t.x,C+1,S),N=Math.min(P,k,O);return N===O?1:N===k?-1:0}allowVariableZoom(t,c){return Dt(t,c)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,c,f,x){return this._boundingVolumeCache.getTileBoundingVolume(t,c,f,x)}_computeTileBoundingVolume(t,c,f,x){var S,C;let P=0,k=0;if(x!=null&&x.terrain){const O=new y.Z(t.z,c,t.z,t.x,t.y),N=x.terrain.getMinMaxElevation(O);P=(S=N.minElevation)!==null&&S!==void 0?S:Math.min(0,f),k=(C=N.maxElevation)!==null&&C!==void 0?C:Math.max(0,f)}if(P/=y.bu,k/=y.bu,P+=1,k+=1,t.z<=0)return Dc.fromAabb([-k,-k,-k],[k,k,k]);if(t.z===1)return Dc.fromAabb([t.x===0?-k:0,t.y===0?0:-k,-k],[t.x===0?0:k,t.y===0?k:0,k]);{const O=[Ta(0,0,t.x,t.y,t.z),Ta(y.$,0,t.x,t.y,t.z),Ta(y.$,y.$,t.x,t.y,t.z),Ta(0,y.$,t.x,t.y,t.z)],N=[];for(const Fe of O)N.push(y.aR([],Fe,k));if(k!==P)for(const Fe of O)N.push(y.aR([],Fe,P));t.y===0&&N.push([0,1,0]),t.y===(1<<t.z)-1&&N.push([0,-1,0]);const U=[1,1,1],V=[-1,-1,-1];for(const Fe of N)for(let He=0;He<3;He++)U[He]=Math.min(U[He],Fe[He]),V[He]=Math.max(V[He],Fe[He]);const $=Ta(y.$/2,y.$/2,t.x,t.y,t.z),W=y.aW([],[0,1,0],$);y.aV(W,W);const ae=y.aW([],$,W);y.aV(ae,ae);const ne=y.aW([],O[2],O[1]);y.aV(ne,ne);const oe=y.aW([],O[0],O[3]);y.aV(oe,oe),N.push(y.aR([],$,k)),t.y>=(1<<t.z)/2&&N.push(y.aR([],Ta(y.$/2,0,t.x,t.y,t.z),k)),t.y<(1<<t.z)/2&&N.push(y.aR([],Ta(y.$/2,y.$,t.x,t.y,t.z),k));const he=Hl($,N),ge=Hl(ae,N),de=[-$[0],-$[1],-$[2],he.max],xe=[$[0],$[1],$[2],-he.min],Me=[-ae[0],-ae[1],-ae[2],ge.max],fe=[ae[0],ae[1],ae[2],-ge.min],ze=[...ne,0],Ve=[...oe,0],Ne=[];return t.y===0?Ne.push(y.bt(Ve,ze,de),y.bt(Ve,ze,xe)):Ne.push(y.bt(Me,ze,de),y.bt(Me,ze,xe),y.bt(Me,Ve,de),y.bt(Me,Ve,xe)),t.y===(1<<t.z)-1?Ne.push(y.bt(Ve,ze,de),y.bt(Ve,ze,xe)):Ne.push(y.bt(fe,ze,de),y.bt(fe,ze,xe),y.bt(fe,Ve,de),y.bt(fe,Ve,xe)),new Dc(Ne,[de,xe,Me,fe,ze,Ve],U,V)}}}function Hl(b,t){let c=1/0,f=-1/0;for(const x of t){const S=y.aX(b,x);c=Math.min(c,S),f=Math.max(f,S)}return{min:c,max:f}}class Lc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,c,f){return this._helper.interpolatePadding(t,c,f)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,c){this._helper.resize(t,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,c){this._helper.overrideNearFarZ(t,c)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(){this._cachedClippingPlane=y.bv(),this._projectionMatrix=y.b9(),this._globeViewProjMatrix32f=y.b8(),this._globeViewProjMatrixNoCorrection=y.b9(),this._globeViewProjMatrixNoCorrectionInverted=y.b9(),this._globeProjMatrixInverted=y.b9(),this._cameraPosition=y.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Jr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,c)=>this.getConstrained(t,c)}),this._coveringTilesDetailsProvider=new As}clone(){const t=new Lc;return t.apply(this),t}apply(t,c){this._globeLatitudeErrorCorrectionRadians=c||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=y.bp();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:c,applyGlobeMatrix:f}=t,x=this._helper.getMercatorTileCoordinates(c);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:x,clippingPlane:this._cachedClippingPlane,projectionTransition:f?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const c=this.pitchInRadians,f=this.cameraToCenterDistance/t,x=Math.sin(c)*f,S=Math.cos(c)*f+1,C=1/Math.sqrt(x*x+S*S)*1;let P=-x,k=S;const O=Math.sqrt(P*P+k*k);P/=O,k/=O;const N=[0,P,k];y.bw(N,N,[0,0,0],-this.bearingInRadians),y.bx(N,N,[0,0,0],-1*this.center.lat*Math.PI/180),y.by(N,N,[0,0,0],this.center.lng*Math.PI/180);const U=1/y.aZ(N);return y.aR(N,N,U),[...N,-C*U]}isLocationOccluded(t){return!this.isSurfacePointVisible(Rr(t))}transformLightDirection(t){const c=this._helper._center.lng*Math.PI/180,f=this._helper._center.lat*Math.PI/180,x=Math.cos(f),S=[Math.sin(c)*x,Math.sin(f),Math.cos(c)*x],C=[S[2],0,-S[0]],P=[0,0,0];y.aW(P,C,S),y.aV(C,C),y.aV(P,P);const k=[0,0,0];return y.aV(k,[C[0]*t[0]+P[0]*t[1]+S[0]*t[2],C[1]*t[0]+P[1]*t[1]+S[1]*t[2],C[2]*t[0]+P[2]*t[1]+S[2]*t[2]]),k}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,c,f){const x=function(P,k,O){const N=1/(1<<O.z);return new y.a1(P/y.$*N+O.x*N,k/y.$*N+O.y*N)}(t,c,f.canonical),S=(C=x.y,[y.bo(x.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI]);var C;return this.getCircleRadiusCorrection()/Math.cos(S[1])}projectTileCoordinates(t,c,f,x){const S=f.canonical,C=Ta(t,c,S.x,S.y,S.z),P=1+(x?x(t,c):0)/y.bu,k=[C[0]*P,C[1]*P,C[2]*P,1];y.aw(k,k,this._globeViewProjMatrixNoCorrection);const O=this._cachedClippingPlane,N=O[0]*C[0]+O[1]*C[1]+O[2]*C[2]+O[3]<0;return{point:new y.P(k[0]/k[3],k[1]/k[3]),signedDistanceFromCamera:k[3],isOccluded:N}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=il(this.worldSize,this.center.lat),c=y.ba(),f=y.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),y.b4(c,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const x=this.centerOffset;c[8]=2*-x.x/this._helper._width,c[9]=2*x.y/this._helper._height,this._projectionMatrix=y.b5(c),this._globeProjMatrixInverted=y.ba(),y.aq(this._globeProjMatrixInverted,c),y.M(c,c,[0,0,-this.cameraToCenterDistance]),y.b6(c,c,this.rollInRadians),y.b7(c,c,-this.pitchInRadians),y.b6(c,c,this.bearingInRadians),y.M(c,c,[0,0,-t]);const S=y.bp();S[0]=t,S[1]=t,S[2]=t,y.b7(f,c,this.center.lat*Math.PI/180),y.bz(f,f,-this.center.lng*Math.PI/180),y.N(f,f,S),this._globeViewProjMatrixNoCorrection=f,y.b7(c,c,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),y.bz(c,c,-this.center.lng*Math.PI/180),y.N(c,c,S),this._globeViewProjMatrix32f=new Float32Array(c),this._globeViewProjMatrixNoCorrectionInverted=y.ba(),y.aq(this._globeViewProjMatrixNoCorrectionInverted,f);const C=y.bp();this._cameraPosition=y.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/t,y.bw(this._cameraPosition,this._cameraPosition,C,-this.rollInRadians),y.bx(this._cameraPosition,this._cameraPosition,C,this.pitchInRadians),y.bw(this._cameraPosition,this._cameraPosition,C,-this.bearingInRadians),y.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),y.bx(this._cameraPosition,this._cameraPosition,C,-this.center.lat*Math.PI/180),y.by(this._cameraPosition,this._cameraPosition,C,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const P=y.b5(this._globeViewProjMatrixNoCorrectionInverted);y.N(P,P,[1,1,-1]),this._cachedFrustum=mn.fromInvProjectionMatrix(P,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){y.w("calculateFogMatrix is not supported on globe projection.");const c=y.ba();return y.ag(c),c}getVisibleUnwrappedCoordinates(t){return[new y.b2(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&y.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,c){if(!this._globeViewProjMatrixNoCorrection)return 1;const f=Rr(t);y.aR(f,f,1+c/y.bu);const x=y.bv();return y.aw(x,[f[0],f[1],f[2],1],this._globeViewProjMatrixNoCorrection),x[2]/x[3]}populateCache(t){}getBounds(){const t=.5*this.width,c=.5*this.height,f=[new y.P(0,0),new y.P(t,0),new y.P(this.width,0),new y.P(this.width,c),new y.P(this.width,this.height),new y.P(t,this.height),new y.P(0,this.height),new y.P(0,c)],x=[];for(const U of f)x.push(this.unprojectScreenPoint(U));let S=0,C=0,P=0,k=0;const O=this.center;for(const U of x){const V=y.bA(O.lng,U.lng),$=y.bA(O.lat,U.lat);V<C&&(C=V),V>S&&(S=V),$<k&&(k=$),$>P&&(P=$)}const N=[O.lng+C,O.lat+k,O.lng+S,O.lat+P];return this.isSurfacePointOnScreen([0,1,0])&&(N[3]=90,N[0]=-180,N[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(N[1]=-90,N[0]=-180,N[2]=180),new xi(N)}getConstrained(t,c){const f=y.ah(t.lat,-y.ai,y.ai),x=y.ah(+c,this.minZoom+en(0,f),this.maxZoom);return{center:new y.S(t.lng,f),zoom:x}}calculateCenterFromCameraLngLatAlt(t,c,f,x){return this._helper.calculateCenterFromCameraLngLatAlt(t,c,f,x)}setLocationAtPoint(t,c){const f=Rr(this.unprojectScreenPoint(c)),x=Rr(t),S=y.bp();y.bB(S);const C=y.bp();y.by(C,f,S,-this.center.lng*Math.PI/180),y.bx(C,C,S,this.center.lat*Math.PI/180);const P=x[0]*x[0]+x[2]*x[2],k=C[0]*C[0];if(P<k)return;const O=Math.sqrt(P-k),N=-O,U=y.bC(x[0],x[2],C[0],O),V=y.bC(x[0],x[2],C[0],N),$=y.bp();y.by($,x,S,-U);const W=y.bC($[1],$[2],C[1],C[2]),ae=y.bp();y.by(ae,x,S,-V);const ne=y.bC(ae[1],ae[2],C[1],C[2]),oe=.5*Math.PI,he=W>=-oe&&W<=oe,ge=ne>=-oe&&ne<=oe;let de,xe;if(he&&ge){const Ve=this.center.lng*Math.PI/180,Ne=this.center.lat*Math.PI/180;y.bD(U,Ve)+y.bD(W,Ne)<y.bD(V,Ve)+y.bD(ne,Ne)?(de=U,xe=W):(de=V,xe=ne)}else if(he)de=U,xe=W;else{if(!ge)return;de=V,xe=ne}const Me=de/Math.PI*180,fe=xe/Math.PI*180,ze=this.center.lat;this.setCenter(new y.S(Me,y.ah(fe,-90,90))),this.setZoom(this.zoom+en(ze,this.center.lat))}locationToScreenPoint(t,c){const f=Rr(t);if(c){const x=c.getElevationForLngLatZoom(t,this._helper._tileZoom);y.aR(f,f,1+x/y.bu)}return this._projectSurfacePointToScreen(f)}_projectSurfacePointToScreen(t){const c=y.bv();return y.aw(c,[...t,1],this._globeViewProjMatrixNoCorrection),c[0]/=c[3],c[1]/=c[3],new y.P((.5*c[0]+.5)*this.width,(.5*-c[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,c){if(c){const f=c.pointCoordinate(t);if(f)return f}return y.a1.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,c){var f;return(f=this.screenPointToMercatorCoordinate(t,c))===null||f===void 0?void 0:f.toLngLat()}isPointOnMapSurface(t,c){const f=this._cameraPosition,x=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(f,x)}getRayDirectionFromPixel(t){const c=y.bv();c[0]=t.x/this.width*2-1,c[1]=-1*(t.y/this.height*2-1),c[2]=1,c[3]=1,y.aw(c,c,this._globeViewProjMatrixNoCorrectionInverted),c[0]/=c[3],c[1]/=c[3],c[2]/=c[3];const f=y.bp();f[0]=c[0]-this._cameraPosition[0],f[1]=c[1]-this._cameraPosition[1],f[2]=c[2]-this._cameraPosition[2];const x=y.bp();return y.aV(x,f),x}isSurfacePointVisible(t){const c=this._cachedClippingPlane;return c[0]*t[0]+c[1]*t[1]+c[2]*t[2]+c[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const c=y.bv();return y.aw(c,[...t,1],this._globeViewProjMatrixNoCorrection),c[0]/=c[3],c[1]/=c[3],c[2]/=c[3],c[0]>-1&&c[0]<1&&c[1]>-1&&c[1]<1&&c[2]>-1&&c[2]<1}rayPlanetIntersection(t,c){const f=y.aX(t,c),x=y.bp(),S=y.bp();y.aR(S,c,f),y.aU(x,t,S);const C=1-y.aX(x,x);if(C<0)return null;const P=y.aX(t,t)-1,k=-f+(f<0?1:-1)*Math.sqrt(C),O=P/k,N=k;return{tMin:Math.min(O,N),tMax:Math.max(O,N)}}unprojectScreenPoint(t){const c=this._cameraPosition,f=this.getRayDirectionFromPixel(t),x=this.rayPlanetIntersection(c,f);if(x){const N=y.bp();y.aS(N,c,[f[0]*x.tMin,f[1]*x.tMin,f[2]*x.tMin]);const U=y.bp();return y.aV(U,N),xo(U)}const S=this._cachedClippingPlane,C=S[0]*f[0]+S[1]*f[1]+S[2]*f[2],P=-y.b1(S,c)/C,k=y.bp();if(P>0)y.aS(k,c,[f[0]*P,f[1]*P,f[2]*P]);else{const N=y.bp();y.aS(N,c,[2*f[0],2*f[1],2*f[2]]);const U=y.b1(this._cachedClippingPlane,N);y.aU(k,N,[this._cachedClippingPlane[0]*U,this._cachedClippingPlane[1]*U,this._cachedClippingPlane[2]*U])}const O=function(N){const U=y.bp();return U[0]=N[0]*-N[3],U[1]=N[1]*-N[3],U[2]=N[2]*-N[3],{center:U,radius:Math.sqrt(1-N[3]*N[3])}}(S);return xo(function(N,U,V){const $=y.bp();y.aU($,V,N);const W=y.bp();return y.bq(W,N,$,U/y.a$($)),W}(O.center,O.radius,k))}getMatrixForModel(t,c){const f=y.S.convert(t),x=1/y.bu,S=y.b9();return y.bz(S,S,f.lng/180*Math.PI),y.b7(S,S,-f.lat/180*Math.PI),y.M(S,S,[0,0,1+c/y.bu]),y.b7(S,S,.5*Math.PI),y.N(S,S,[x,x,x]),S}getProjectionDataForCustomLayer(t=!0){const c=this.getProjectionData({overscaledTileID:new y.Z(0,0,0,0,0),applyGlobeMatrix:t});return c.tileMercatorCoords=[0,0,1,1],c}getFastPathSimpleProjectionMatrix(t){}}class rl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,c,f){return this._helper.interpolatePadding(t,c,f)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,c,f=!0){this._helper.resize(t,c,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,c){this._helper.overrideNearFarZ(t,c)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,c){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=c,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Jr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,c)=>this.getConstrained(t,c)}),this._globeness=1,this._mercatorTransform=new ir,this._verticalPerspectiveTransform=new Lc}clone(){const t=new rl;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const c=this._mercatorTransform.getProjectionData(t),f=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?f.mainMatrix:c.mainMatrix,clippingPlane:f.clippingPlane,tileMercatorCoords:f.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:c.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return y.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return y.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,c,f){const x=this._mercatorTransform.getPitchedTextCorrection(t,c,f),S=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,c,f);return y.bk(x,S,this._globeness)}projectTileCoordinates(t,c,f,x){return this.currentTransform.projectTileCoordinates(t,c,f,x)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,c){return this.currentTransform.lngLatToCameraDepth(t,c)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}getConstrained(t,c){return this.currentTransform.getConstrained(t,c)}calculateCenterFromCameraLngLatAlt(t,c,f,x){return this._helper.calculateCenterFromCameraLngLatAlt(t,c,f,x)}setLocationAtPoint(t,c){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,c),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,c),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,c){return this.currentTransform.locationToScreenPoint(t,c)}screenPointToMercatorCoordinate(t,c){return this.currentTransform.screenPointToMercatorCoordinate(t,c)}screenPointToLocation(t,c){return this.currentTransform.screenPointToLocation(t,c)}isPointOnMapSurface(t,c){return this.currentTransform.isPointOnMapSurface(t,c)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,c){return this.currentTransform.getMatrixForModel(t,c)}getProjectionDataForCustomLayer(t=!0){const c=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return c;const f=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return f.fallbackMatrix=c.mainMatrix,f}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Cn{get useGlobeControls(){return!0}handlePanInertia(t,c){const f=Mh(t,c);return Math.abs(f.lng-c.center.lng)>180&&(f.lng=c.center.lng+179.5*Math.sign(f.lng-c.center.lng)),{easingCenter:f,easingOffset:new y.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,c){const f=t.around,x=c.screenPointToLocation(f);t.bearingDelta&&c.setBearing(c.bearing+t.bearingDelta),t.pitchDelta&&c.setPitch(c.pitch+t.pitchDelta),t.rollDelta&&c.setRoll(c.roll+t.rollDelta);const S=c.zoom;t.zoomDelta&&c.setZoom(c.zoom+t.zoomDelta);const C=c.zoom-S;if(C===0)return;const P=y.bA(c.center.lng,x.lng),k=P/(Math.abs(P/180)+1),O=y.bA(c.center.lat,x.lat),N=c.getRayDirectionFromPixel(f),U=c.cameraPosition,V=-1*y.aX(U,N),$=y.bp();y.aS($,U,[N[0]*V,N[1]*V,N[2]*V]);const W=y.aZ($)-1,ae=Math.exp(.5*-Math.max(W-.3,0)),ne=il(c.worldSize,c.center.lat)/Math.min(c.width,c.height),oe=y.bn(ne,.9,.5,1,.25),he=(1-y.af(-C))*Math.min(ae,oe),ge=c.center.lat,de=c.zoom,xe=new y.S(c.center.lng+k*he,y.ah(c.center.lat+O*he,-y.ai,y.ai));c.setLocationAtPoint(x,f);const Me=c.center,fe=y.bn(Math.abs(P),45,85,0,1),ze=y.bn(ne,.75,.35,0,1),Ve=Math.pow(Math.max(fe,ze),.25),Ne=y.bA(Me.lng,xe.lng),Fe=y.bA(Me.lat,xe.lat);c.setCenter(new y.S(Me.lng+Ne*Ve,Me.lat+Fe*Ve).wrap()),c.setZoom(de+en(ge,c.center.lat))}handleMapControlsPan(t,c,f){if(!t.panDelta)return;const x=c.center.lat,S=c.zoom;c.setCenter(Mh(t.panDelta,c).wrap()),c.setZoom(S+en(x,c.center.lat))}cameraForBoxAndBearing(t,c,f,x,S){const C=An(t,c,f,x,S),P=c.left/S.width*2-1,k=(S.width-c.right)/S.width*2-1,O=c.top/S.height*-2+1,N=(S.height-c.bottom)/S.height*-2+1,U=y.bA(f.getWest(),f.getEast())<0,V=U?f.getEast():f.getWest(),$=U?f.getWest():f.getEast(),W=Math.max(f.getNorth(),f.getSouth()),ae=Math.min(f.getNorth(),f.getSouth()),ne=V+.5*y.bA(V,$),oe=W+.5*y.bA(W,ae),he=S.clone();he.setCenter(C.center),he.setBearing(C.bearing),he.setPitch(0),he.setRoll(0),he.setZoom(C.zoom);const ge=he.modelViewProjectionMatrix,de=[Rr(f.getNorthWest()),Rr(f.getNorthEast()),Rr(f.getSouthWest()),Rr(f.getSouthEast()),Rr(new y.S($,oe)),Rr(new y.S(V,oe)),Rr(new y.S(ne,W)),Rr(new y.S(ne,ae))],xe=Rr(C.center);let Me=Number.POSITIVE_INFINITY;for(const fe of de)P<0&&(Me=Cn.getLesserNonNegativeNonNull(Me,Cn.solveVectorScale(fe,xe,ge,"x",P))),k>0&&(Me=Cn.getLesserNonNegativeNonNull(Me,Cn.solveVectorScale(fe,xe,ge,"x",k))),O>0&&(Me=Cn.getLesserNonNegativeNonNull(Me,Cn.solveVectorScale(fe,xe,ge,"y",O))),N<0&&(Me=Cn.getLesserNonNegativeNonNull(Me,Cn.solveVectorScale(fe,xe,ge,"y",N)));if(Number.isFinite(Me)&&Me!==0)return C.zoom=he.zoom+y.ak(Me),C;qs()}handleJumpToCenterZoom(t,c){const f=t.center.lat,x=t.getConstrained(c.center?y.S.convert(c.center):t.center,t.zoom).center;t.setCenter(x.wrap());const S=c.zoom!==void 0?+c.zoom:t.zoom+en(f,x.lat);t.zoom!==S&&t.setZoom(S)}handleEaseTo(t,c){const f=t.zoom,x=t.center,S=t.padding,C={roll:t.roll,pitch:t.pitch,bearing:t.bearing},P={roll:c.roll===void 0?t.roll:c.roll,pitch:c.pitch===void 0?t.pitch:c.pitch,bearing:c.bearing===void 0?t.bearing:c.bearing},k=c.zoom!==void 0,O=!t.isPaddingEqual(c.padding);let N=!1;const U=c.center?y.S.convert(c.center):x,V=t.getConstrained(U,f).center;kc(t,V);const $=t.clone();$.setCenter(V),$.setZoom(k?+c.zoom:f+en(x.lat,U.lat)),$.setBearing(c.bearing);const W=new y.P(y.ah(t.centerPoint.x+c.offsetAsPoint.x,0,t.width),y.ah(t.centerPoint.y+c.offsetAsPoint.y,0,t.height));$.setLocationAtPoint(V,W);const ae=(c.offset&&c.offsetAsPoint.mag())>0?$.center:V,ne=k?+c.zoom:f+en(x.lat,ae.lat),oe=f+en(x.lat,0),he=ne+en(ae.lat,0),ge=y.bA(x.lng,ae.lng),de=y.bA(x.lat,ae.lat),xe=y.af(he-oe);return N=ne!==f,{easeFunc:Me=>{if(y.be(C,P)||Dn({startEulerAngles:C,endEulerAngles:P,tr:t,k:Me,useSlerp:C.roll!=P.roll}),O&&t.interpolatePadding(S,c.padding,Me),c.around)y.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(c.around,c.aroundPoint);else{const fe=he>oe?Math.min(2,xe):Math.max(.5,xe),ze=Math.pow(fe,1-Me),Ve=Eu(x,ge,de,Me*ze);t.setCenter(Ve.wrap())}if(N){const fe=y.C.number(oe,he,Me)+en(0,t.center.lat);t.setZoom(fe)}},isZooming:N,elevationCenter:ae}}handleFlyTo(t,c){const f=c.zoom!==void 0,x=t.center,S=t.zoom,C=t.padding,P=!t.isPaddingEqual(c.padding),k=t.getConstrained(y.S.convert(c.center||c.locationAtOffset),S).center,O=f?+c.zoom:t.zoom+en(t.center.lat,k.lat),N=t.clone();N.setCenter(k),N.setZoom(O),N.setBearing(c.bearing);const U=new y.P(y.ah(t.centerPoint.x+c.offsetAsPoint.x,0,t.width),y.ah(t.centerPoint.y+c.offsetAsPoint.y,0,t.height));N.setLocationAtPoint(k,U);const V=N.center;kc(t,V);const $=function(de,xe,Me){const fe=Rr(xe),ze=Rr(Me),Ve=y.aX(fe,ze),Ne=Math.acos(Ve),Fe=Rc(de);return Ne/(2*Math.PI)*Fe}(t,x,V),W=S+en(x.lat,0),ae=O+en(V.lat,0),ne=y.af(ae-W);let oe;if(typeof c.minZoom=="number"){const de=+c.minZoom+en(V.lat,0),xe=Math.min(de,W,ae)+en(0,V.lat),Me=t.getConstrained(V,xe).zoom+en(V.lat,0);oe=y.af(Me-W)}const he=y.bA(x.lng,V.lng),ge=y.bA(x.lat,V.lat);return{easeFunc:(de,xe,Me,fe)=>{const ze=Eu(x,he,ge,Me);P&&t.interpolatePadding(C,c.padding,de);const Ve=de===1?V:ze;t.setCenter(Ve.wrap());const Ne=W+y.ak(xe);t.setZoom(de===1?O:Ne+en(0,Ve.lat))},scaleOfZoom:ne,targetCenter:V,scaleOfMinZoom:oe,pixelPathLength:$}}static solveVectorScale(t,c,f,x,S){const C=x==="x"?[f[0],f[4],f[8],f[12]]:[f[1],f[5],f[9],f[13]],P=[f[3],f[7],f[11],f[15]],k=t[0]*C[0]+t[1]*C[1]+t[2]*C[2],O=t[0]*P[0]+t[1]*P[1]+t[2]*P[2],N=c[0]*C[0]+c[1]*C[1]+c[2]*C[2],U=c[0]*P[0]+c[1]*P[1]+c[2]*P[2];return N+S*O===k+S*U||P[3]*(k-N)+C[3]*(U-O)+k*U==N*O?null:(N+C[3]-S*U-S*P[3])/(N-k-S*U+S*O)}static getLesserNonNegativeNonNull(t,c){return c!==null&&c>=0&&c<t?c:t}}class Bc{constructor(t){this._globe=t,this._mercatorCameraHelper=new Gr,this._verticalPerspectiveCameraHelper=new Cn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,c){return this.currentHelper.handlePanInertia(t,c)}handleMapControlsRollPitchBearingZoom(t,c){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,c)}handleMapControlsPan(t,c,f){this.currentHelper.handleMapControlsPan(t,c,f)}cameraForBoxAndBearing(t,c,f,x,S){return this.currentHelper.cameraForBoxAndBearing(t,c,f,x,S)}handleJumpToCenterZoom(t,c){this.currentHelper.handleJumpToCenterZoom(t,c)}handleEaseTo(t,c){return this.currentHelper.handleEaseTo(t,c)}handleFlyTo(t,c){return this.currentHelper.handleFlyTo(t,c)}}const Oc=(b,t)=>y.y(b,t&&t.filter(c=>c.identifier!=="source.canvas")),Xl=y.bE();class Yl extends y.E{constructor(t,c={}){var f,x;super(),this._rtlPluginLoaded=()=>{for(const C in this.sourceCaches){const P=this.sourceCaches[C].getSource().type;P!=="vector"&&P!=="geojson"||this.sourceCaches[C].reload()}},this.map=t,this.dispatcher=new Zt(bi(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(C,P)=>this.getGlyphs(C,P)),this.dispatcher.registerMessageHandler("GI",(C,P)=>this.getImages(C,P)),this.imageManager=new ui,this.imageManager.setEventedParent(this);const S=((f=t._container)===null||f===void 0?void 0:f.lang)||typeof document<"u"&&((x=document.documentElement)===null||x===void 0?void 0:x.lang)||void 0;this.glyphManager=new ft(t._requestManager,c.localIdeographFontFamily,S),this.lineAtlas=new _t(256,512),this.crossTileSymbolIndex=new Us,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",y.bG()),pn().on(Vl,this._rtlPluginLoaded),this.on("data",C=>{if(C.dataType!=="source"||C.sourceDataType!=="metadata")return;const P=this.sourceCaches[C.sourceId];if(!P)return;const k=P.getSource();if(k&&k.vectorLayerIds)for(const O in this._layers){const N=this._layers[O];N.source===k.id&&this._validateLayer(N)}})}setGlobalStateProperty(t,c){var f,x,S;this._checkLoaded();const C=c===null?(S=(x=(f=this.stylesheet.state)===null||f===void 0?void 0:f[t])===null||x===void 0?void 0:x.default)!==null&&S!==void 0?S:null:c;if(y.bH(C,this._globalState[t]))return this;this._globalState[t]=C,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const c=[];for(const f in t)!y.bH(this._globalState[f],t[f].default)&&(c.push(f),this._globalState[f]=t[f].default);this._applyGlobalStateChanges(c)}_applyGlobalStateChanges(t){if(t.length===0)return;const c=new Set;for(const f in this._layers){const x=this._layers[f],S=x.getLayoutAffectingGlobalStateRefs(),C=x.getPaintAffectingGlobalStateRefs();for(const P of t)if(S.has(P)&&c.add(x.source),C.has(P))for(const{name:k,value:O}of C.get(P))this._updatePaintProperty(x,k,O)}for(const f in this.sourceCaches)c.has(f)&&(this._reloadSource(f),this._changed=!0)}loadURL(t,c={},f){this.fire(new y.l("dataloading",{dataType:"style"})),c.validate=typeof c.validate!="boolean"||c.validate;const x=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const S=this._loadStyleRequest;y.j(x,this._loadStyleRequest).then(C=>{this._loadStyleRequest=null,this._load(C.data,c,f)}).catch(C=>{this._loadStyleRequest=null,C&&!S.signal.aborted&&this.fire(new y.k(C))})}loadJSON(t,c={},f){this.fire(new y.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Le.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,c.validate=c.validate!==!1,this._load(t,c,f)}).catch(()=>{})}loadEmpty(){this.fire(new y.l("dataloading",{dataType:"style"})),this._load(Xl,{validate:!1})}_load(t,c,f){var x,S,C;let P=c.transformStyle?c.transformStyle(f,t):t;if(!c.validate||!Oc(this,y.z(P))){P=Object.assign({},P),this._loaded=!0,this.stylesheet=P;for(const k in P.sources)this.addSource(k,P.sources[k],{validate:!1});P.sprite?this._loadSprite(P.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(P.glyphs),this._createLayers(),this.light=new Qe(this.stylesheet.light),this._setProjectionInternal(((x=this.stylesheet.projection)===null||x===void 0?void 0:x.type)||"mercator"),this.sky=new Be(this.stylesheet.sky),this.map.setTerrain((S=this.stylesheet.terrain)!==null&&S!==void 0?S:null),this.setGlobalState((C=this.stylesheet.state)!==null&&C!==void 0?C:null),this.fire(new y.l("data",{dataType:"style"})),this.fire(new y.l("style.load"))}}_createLayers(){const t=y.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(c=>c.id),this._layers={},this._serializedLayers=null;for(const c of t){const f=y.bJ(c);f.setEventedParent(this,{layer:{id:c.id}}),this._layers[c.id]=f}}_loadSprite(t,c=!1,f=void 0){let x;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(S,C,P,k){return y._(this,void 0,void 0,function*(){const O=Gt(S),N=P>1?"@2x":"",U={},V={};for(const{id:$,url:W}of O){const ae=C.transformRequest(ti(W,N,".json"),"SpriteJSON");U[$]=y.j(ae,k);const ne=C.transformRequest(ti(W,N,".png"),"SpriteImage");V[$]=St.getImage(ne,k)}return yield Promise.all([...Object.values(U),...Object.values(V)]),function($,W){return y._(this,void 0,void 0,function*(){const ae={};for(const ne in $){ae[ne]={};const oe=Le.getImageCanvasContext((yield W[ne]).data),he=(yield $[ne]).data;for(const ge in he){const{width:de,height:xe,x:Me,y:fe,sdf:ze,pixelRatio:Ve,stretchX:Ne,stretchY:Fe,content:He,textFitWidth:gt,textFitHeight:yt}=he[ge];ae[ne][ge]={data:null,pixelRatio:Ve,sdf:ze,stretchX:Ne,stretchY:Fe,content:He,textFitWidth:gt,textFitHeight:yt,spriteData:{width:de,height:xe,x:Me,y:fe,context:oe}}}}return ae})}(U,V)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(S=>{if(this._spriteRequest=null,S)for(const C in S){this._spritesImagesIds[C]=[];const P=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter(k=>!(k in S)):[];for(const k of P)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in S[C]){const O=C==="default"?k:`${C}:${k}`;this._spritesImagesIds[C].push(O),O in this.imageManager.images?this.imageManager.updateImage(O,S[C][k],!1):this.imageManager.addImage(O,S[C][k]),c&&(this._changedImages[O]=!0)}}}).catch(S=>{this._spriteRequest=null,x=S,this.fire(new y.k(x))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),c&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new y.l("data",{dataType:"style"})),f&&f(x)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new y.l("data",{dataType:"style"}))}_validateLayer(t){const c=this.sourceCaches[t.source];if(!c)return;const f=t.sourceLayer;if(!f)return;const x=c.getSource();(x.type==="geojson"||x.vectorLayerIds&&x.vectorLayerIds.indexOf(f)===-1)&&this.fire(new y.k(new Error(`Source layer "${f}" does not exist on source "${x.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,c=!1){const f=this._serializedAllLayers();if(!t||t.length===0)return Object.values(c?y.bK(f):f);const x=[];for(const S of t)if(f[S]){const C=c?y.bK(f[S]):f[S];x.push(C)}return x}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const c=Object.keys(this._layers);for(const f of c){const x=this._layers[f];x.type!=="custom"&&(t[f]=x.serialize())}return t}hasTransitions(){var t,c,f;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((c=this.sky)===null||c===void 0)&&c.hasTransition()||!((f=this.projection)===null||f===void 0)&&f.hasTransition())return!0;for(const x in this.sourceCaches)if(this.sourceCaches[x].hasTransition())return!0;for(const x in this._layers)if(this._layers[x].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const c=this._changed;if(c){const x=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(x.length||S.length)&&this._updateWorkerLayers(x,S);for(const C in this._updatedSources){const P=this._updatedSources[C];if(P==="reload")this._reloadSource(C);else{if(P!=="clear")throw new Error(`Invalid action ${P}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const f={};for(const x in this.sourceCaches){const S=this.sourceCaches[x];f[x]=S.used,S.used=!1}for(const x of this._order){const S=this._layers[x];S.recalculate(t,this._availableImages),!S.isHidden(t.zoom)&&S.source&&(this.sourceCaches[S.source].used=!0)}for(const x in f){const S=this.sourceCaches[x];!!f[x]!=!!S.used&&S.fire(new y.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:x}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,c&&this.fire(new y.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const c in this.sourceCaches)this.sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,c){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,c={}){var f;this._checkLoaded();const x=this.serialize();if(t=c.transformStyle?c.transformStyle(x,t):t,((f=c.validate)===null||f===void 0||f)&&Oc(this,y.z(t)))return!1;(t=y.bK(t)).layers=y.bI(t.layers);const S=y.bL(x,t),C=this._getOperationsToPerform(S);if(C.unimplemented.length>0)throw new Error(`Unimplemented: ${C.unimplemented.join(", ")}.`);if(C.operations.length===0)return!1;for(const P of C.operations)P();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const c=[],f=[];for(const x of t)switch(x.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":c.push(()=>this.addLayer.apply(this,x.args));break;case"removeLayer":c.push(()=>this.removeLayer.apply(this,x.args));break;case"setPaintProperty":c.push(()=>this.setPaintProperty.apply(this,x.args));break;case"setLayoutProperty":c.push(()=>this.setLayoutProperty.apply(this,x.args));break;case"setFilter":c.push(()=>this.setFilter.apply(this,x.args));break;case"addSource":c.push(()=>this.addSource.apply(this,x.args));break;case"removeSource":c.push(()=>this.removeSource.apply(this,x.args));break;case"setLayerZoomRange":c.push(()=>this.setLayerZoomRange.apply(this,x.args));break;case"setLight":c.push(()=>this.setLight.apply(this,x.args));break;case"setGeoJSONSourceData":c.push(()=>this.setGeoJSONSourceData.apply(this,x.args));break;case"setGlyphs":c.push(()=>this.setGlyphs.apply(this,x.args));break;case"setSprite":c.push(()=>this.setSprite.apply(this,x.args));break;case"setTerrain":c.push(()=>this.map.setTerrain.apply(this,x.args));break;case"setSky":c.push(()=>this.setSky.apply(this,x.args));break;case"setProjection":this.setProjection.apply(this,x.args);break;case"setGlobalState":c.push(()=>this.setGlobalState.apply(this,x.args));break;case"setTransition":c.push(()=>{});break;default:f.push(x.command)}return{operations:c,unimplemented:f}}addImage(t,c){if(this.getImage(t))return this.fire(new y.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,c),this._afterImageUpdated(t)}updateImage(t,c){this.imageManager.updateImage(t,c)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new y.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new y.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,c,f={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(y.z.source,`sources.${t}`,c,null,f))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const x=this.sourceCaches[t]=new Ti(t,c,this.dispatcher);x.style=this,x.setEventedParent(this,()=>({isSourceLoaded:x.loaded(),source:x.serialize(),sourceId:t})),x.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===t)return this.fire(new y.k(new Error(`Source "${t}" cannot be removed while layer "${f}" is using it.`)));const c=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],c.fire(new y.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),c.setEventedParent(null),c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,c){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const f=this.sourceCaches[t].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(c),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,c,f={}){this._checkLoaded();const x=t.id;if(this.getLayer(x))return void this.fire(new y.k(new Error(`Layer "${x}" already exists on this map.`)));let S;if(t.type==="custom"){if(Oc(this,y.bM(t)))return;S=y.bJ(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(x,t.source),t=y.bK(t),t=y.e(t,{source:x})),this._validate(y.z.layer,`layers.${x}`,t,{arrayIndex:-1},f))return;S=y.bJ(t),this._validateLayer(S),S.setEventedParent(this,{layer:{id:x}})}const C=c?this._order.indexOf(c):this._order.length;if(c&&C===-1)this.fire(new y.k(new Error(`Cannot add layer "${x}" before non-existing layer "${c}".`)));else{if(this._order.splice(C,0,x),this._layerOrderChanged=!0,this._layers[x]=S,this._removedLayers[x]&&S.source&&S.type!=="custom"){const P=this._removedLayers[x];delete this._removedLayers[x],P.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}moveLayer(t,c){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new y.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===c)return;const f=this._order.indexOf(t);this._order.splice(f,1);const x=c?this._order.indexOf(c):this._order.length;c&&x===-1?this.fire(new y.k(new Error(`Cannot move layer "${t}" before non-existing layer "${c}".`))):(this._order.splice(x,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const c=this._layers[t];if(!c)return void this.fire(new y.k(new Error(`Cannot remove non-existing layer "${t}".`)));c.setEventedParent(null);const f=this._order.indexOf(t);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=c,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],c.onRemove&&c.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,c,f){this._checkLoaded();const x=this.getLayer(t);x?x.minzoom===c&&x.maxzoom===f||(c!=null&&(x.minzoom=c),f!=null&&(x.maxzoom=f),this._updateLayer(x)):this.fire(new y.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,c,f={}){this._checkLoaded();const x=this.getLayer(t);if(x){if(!y.bH(x.filter,c))return c==null?(x.setFilter(void 0),void this._updateLayer(x)):void(this._validate(y.z.filter,`layers.${x.id}.filter`,c,null,f)||(x.setFilter(y.bK(c)),this._updateLayer(x)))}else this.fire(new y.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return y.bK(this.getLayer(t).filter)}setLayoutProperty(t,c,f,x={}){this._checkLoaded();const S=this.getLayer(t);S?y.bH(S.getLayoutProperty(c),f)||(S.setLayoutProperty(c,f,x),this._updateLayer(S)):this.fire(new y.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,c){const f=this.getLayer(t);if(f)return f.getLayoutProperty(c);this.fire(new y.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,c,f,x={}){this._checkLoaded();const S=this.getLayer(t);S?y.bH(S.getPaintProperty(c),f)||this._updatePaintProperty(S,c,f,x):this.fire(new y.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,c,f,x={}){t.setPaintProperty(c,f,x)&&this._updateLayer(t),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,c){return this.getLayer(t).getPaintProperty(c)}setFeatureState(t,c){this._checkLoaded();const f=t.source,x=t.sourceLayer,S=this.sourceCaches[f];if(S===void 0)return void this.fire(new y.k(new Error(`The source '${f}' does not exist in the map's style.`)));const C=S.getSource().type;C==="geojson"&&x?this.fire(new y.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||x?(t.id===void 0&&this.fire(new y.k(new Error("The feature id parameter must be provided."))),S.setFeatureState(x,t.id,c)):this.fire(new y.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,c){this._checkLoaded();const f=t.source,x=this.sourceCaches[f];if(x===void 0)return void this.fire(new y.k(new Error(`The source '${f}' does not exist in the map's style.`)));const S=x.getSource().type,C=S==="vector"?t.sourceLayer:void 0;S!=="vector"||C?c&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new y.k(new Error("A feature id is required to remove its specific state property."))):x.removeFeatureState(C,t.id,c):this.fire(new y.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const c=t.source,f=t.sourceLayer,x=this.sourceCaches[c];if(x!==void 0)return x.getSource().type!=="vector"||f?(t.id===void 0&&this.fire(new y.k(new Error("The feature id parameter must be provided."))),x.getFeatureState(f,t.id)):void this.fire(new y.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new y.k(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return y.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=y.bN(this.sourceCaches,S=>S.serialize()),c=this._serializeByIds(this._order,!0),f=this.map.getTerrain()||void 0,x=this.stylesheet;return y.bO({version:x.version,name:x.name,metadata:x.metadata,light:x.light,sky:x.sky,center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch,sprite:x.sprite,glyphs:x.glyphs,transition:x.transition,projection:x.projection,sources:t,layers:c,terrain:f},S=>S!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const c=C=>this._layers[C].type==="fill-extrusion",f={},x=[];for(let C=this._order.length-1;C>=0;C--){const P=this._order[C];if(c(P)){f[P]=C;for(const k of t){const O=k[P];if(O)for(const N of O)x.push(N)}}}x.sort((C,P)=>P.intersectionZ-C.intersectionZ);const S=[];for(let C=this._order.length-1;C>=0;C--){const P=this._order[C];if(c(P))for(let k=x.length-1;k>=0;k--){const O=x[k].feature;if(f[O.layer.id]<C)break;S.push(O),x.pop()}else for(const k of t){const O=k[P];if(O)for(const N of O)S.push(N.feature)}}return S}queryRenderedFeatures(t,c,f){c&&c.filter&&this._validate(y.z.filter,"queryRenderedFeatures.filter",c.filter,null,c);const x={};if(c&&c.layers){if(!(Array.isArray(c.layers)||c.layers instanceof Set))return this.fire(new y.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const O of c.layers){const N=this._layers[O];if(!N)return this.fire(new y.k(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];x[N.source]=!0}}const S=[];c.availableImages=this._availableImages;const C=this._serializedAllLayers(),P=c.layers instanceof Set?c.layers:Array.isArray(c.layers)?new Set(c.layers):null,k=Object.assign(Object.assign({},c),{layers:P});for(const O in this.sourceCaches)c.layers&&!x[O]||S.push(kr(this.sourceCaches[O],this._layers,C,t,k,f,this.map.terrain?(N,U,V)=>this.map.terrain.getElevation(N,U,V):void 0));return this.placement&&S.push(function(O,N,U,V,$,W,ae){const ne={},oe=W.queryRenderedSymbols(V),he=[];for(const ge of Object.keys(oe).map(Number))he.push(ae[ge]);he.sort(jn);for(const ge of he){const de=ge.featureIndex.lookupSymbolFeatures(oe[ge.bucketInstanceId],N,ge.bucketIndex,ge.sourceLayerIndex,$.filter,$.layers,$.availableImages,O);for(const xe in de){const Me=ne[xe]=ne[xe]||[],fe=de[xe];fe.sort((ze,Ve)=>{const Ne=ge.featureSortOrder;if(Ne){const Fe=Ne.indexOf(ze.featureIndex);return Ne.indexOf(Ve.featureIndex)-Fe}return Ve.featureIndex-ze.featureIndex});for(const ze of fe)Me.push(ze)}}return function(ge,de,xe){for(const Me in ge)for(const fe of ge[Me])Hn(fe,xe[de[Me].source]);return ge}(ne,O,U)}(this._layers,C,this.sourceCaches,t,k,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(t,c){c&&c.filter&&this._validate(y.z.filter,"querySourceFeatures.filter",c.filter,null,c);const f=this.sourceCaches[t];return f?function(x,S){const C=x.getRenderableIds().map(O=>x.getTileByID(O)),P=[],k={};for(let O=0;O<C.length;O++){const N=C[O],U=N.tileID.canonical.key;k[U]||(k[U]=!0,N.querySourceFeatures(P,S))}return P}(f,c):[]}getLight(){return this.light.getLight()}setLight(t,c={}){this._checkLoaded();const f=this.light.getLight();let x=!1;for(const C in t)if(!y.bH(t[C],f[C])){x=!0;break}if(!x)return;const S={now:Le.now(),transition:y.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,c),this.light.updateTransitions(S)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,c={}){this._checkLoaded();const f=this.getSky();let x=!1;if(!t&&!f)return;if(t&&!f)x=!0;else if(!t&&f)x=!0;else for(const C in t)if(!y.bH(t[C],f[C])){x=!0;break}if(!x)return;const S={now:Le.now(),transition:y.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,c),this.sky.updateTransitions(S)}_setProjectionInternal(t){const c=function(f){if(Array.isArray(f)){const x=new _o({type:f});return{projection:x,transform:new rl,cameraHelper:new Bc(x)}}switch(f){case"mercator":return{projection:new pi,transform:new ir,cameraHelper:new Gr};case"globe":{const x=new _o({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:x,transform:new rl,cameraHelper:new Bc(x)}}case"vertical-perspective":return{projection:new tl,transform:new Lc,cameraHelper:new Cn};default:return y.w(`Unknown projection name: ${f}. Falling back to mercator projection.`),{projection:new pi,transform:new ir,cameraHelper:new Gr}}}(t);this.projection=c.projection,this.map.migrateProjection(c.transform,c.cameraHelper);for(const f in this.sourceCaches)this.sourceCaches[f].reload()}_validate(t,c,f,x,S={}){return(!S||S.validate!==!1)&&Oc(this,t.call(y.z,y.e({key:c,style:this.serialize(),value:f,styleSpec:y.v},x)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),pn().off(Vl,this._rtlPluginLoaded);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this.sourceCaches){const f=this.sourceCaches[c];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const c in this.sourceCaches)this.sourceCaches[c].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,c,f,x,S=!1){let C=!1,P=!1;const k={};for(const O of this._order){const N=this._layers[O];if(N.type!=="symbol")continue;if(!k[N.source]){const V=this.sourceCaches[N.source];k[N.source]=V.getRenderableIds(!0).map($=>V.getTileByID($)).sort(($,W)=>W.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(W.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(N,k[N.source],t.center.lng);C=C||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Le.now(),t.zoom))&&(this.pauseablePlacement=new Au(t,this.map.terrain,this._order,S,c,f,x,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Le.now()),P=!0),C&&this.pauseablePlacement.placement.setStale()),P||C)for(const O of this._order){const N=this._layers[O];N.type==="symbol"&&this.placement.updateLayerOpacities(N,k[N.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Le.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,c){return y._(this,void 0,void 0,function*(){const f=yield this.imageManager.getImages(c.icons);this._updateTilesForChangedImages();const x=this.sourceCaches[c.source];return x&&x.setDependencies(c.tileID.key,c.type,c.icons),f})}getGlyphs(t,c){return y._(this,void 0,void 0,function*(){const f=yield this.glyphManager.getGlyphs(c.stacks),x=this.sourceCaches[c.source];return x&&x.setDependencies(c.tileID.key,c.type,[""]),f})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,c={}){this._checkLoaded(),t&&this._validate(y.z.glyphs,"glyphs",t,null,c)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,c,f={},x){this._checkLoaded();const S=[{id:t,url:c}],C=[...Gt(this.stylesheet.sprite),...S];this._validate(y.z.sprite,"sprite",C,null,f)||(this.stylesheet.sprite=C,this._loadSprite(S,!0,x))}removeSprite(t){this._checkLoaded();const c=Gt(this.stylesheet.sprite);if(c.find(f=>f.id===t)){if(this._spritesImagesIds[t])for(const f of this._spritesImagesIds[t])this.imageManager.removeImage(f),this._changedImages[f]=!0;c.splice(c.findIndex(f=>f.id===t),1),this.stylesheet.sprite=c.length>0?c:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new y.l("data",{dataType:"style"}))}else this.fire(new y.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Gt(this.stylesheet.sprite)}setSprite(t,c={},f){this._checkLoaded(),t&&this._validate(y.z.sprite,"sprite",t,null,c)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,f):(this._unloadSprite(),f&&f(null)))}}var Fc=y.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class us{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,c,f,x,S,C,P,k,O){this.context=t;let N=this.boundPaintVertexBuffers.length!==x.length;for(let U=0;!N&&U<x.length;U++)this.boundPaintVertexBuffers[U]!==x[U]&&(N=!0);!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==f||N||this.boundIndexBuffer!==S||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==P||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==O?this.freshBind(c,f,x,S,C,P,k,O):(t.bindVertexArray.set(this.vao),P&&P.bind(),S&&S.dynamicDraw&&S.bind(),k&&k.bind(),O&&O.bind())}freshBind(t,c,f,x,S,C,P,k){const O=t.numAttributes,N=this.context,U=N.gl;this.vao&&this.destroy(),this.vao=N.createVertexArray(),N.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=x,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=P,this.boundDynamicVertexBuffer3=k,c.enableAttributes(U,t);for(const V of f)V.enableAttributes(U,t);C&&C.enableAttributes(U,t),P&&P.enableAttributes(U,t),k&&k.enableAttributes(U,t),c.bind(),c.setVertexAttribPointers(U,t,S);for(const V of f)V.bind(),V.setVertexAttribPointers(U,t,S);C&&(C.bind(),C.setVertexAttribPointers(U,t,S)),x&&x.bind(),P&&(P.bind(),P.setVertexAttribPointers(U,t,S)),k&&(k.bind(),k.setVertexAttribPointers(U,t,S)),N.currentNumAttributes=O}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Pu=(b,t,c,f,x)=>({u_texture:0,u_ele_delta:b,u_fog_matrix:t,u_fog_color:c?c.properties.get("fog-color"):y.bf.white,u_fog_ground_blend:c?c.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:x?0:c?c.calculateFogBlendOpacity(f):0,u_horizon_color:c?c.properties.get("horizon-color"):y.bf.white,u_horizon_fog_blend:c?c.properties.get("horizon-fog-blend"):1,u_is_globe_mode:x?1:0}),Ah={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function bo(b){const t=[];for(let c=0;c<b.length;c++){if(b[c]===null)continue;const f=b[c].split(" ");t.push(f.pop())}return t}class wo{constructor(t,c,f,x,S,C,P,k,O=[]){const N=t.gl;this.program=N.createProgram();const U=bo(c.staticAttributes),V=f?f.getBinderAttributes():[],$=U.concat(V),W=Sa.prelude.staticUniforms?bo(Sa.prelude.staticUniforms):[],ae=P.staticUniforms?bo(P.staticUniforms):[],ne=c.staticUniforms?bo(c.staticUniforms):[],oe=f?f.getBinderUniforms():[],he=W.concat(ae).concat(ne).concat(oe),ge=[];for(const Ne of he)ge.indexOf(Ne)<0&&ge.push(Ne);const de=f?f.defines():[];Xn(N)&&de.unshift("#version 300 es"),S&&de.push("#define OVERDRAW_INSPECTOR;"),C&&de.push("#define TERRAIN3D;"),k&&de.push(k),O&&de.push(...O);let xe=de.concat(Sa.prelude.fragmentSource,P.fragmentSource,c.fragmentSource).join(`
`),Me=de.concat(Sa.prelude.vertexSource,P.vertexSource,c.vertexSource).join(`
`);Xn(N)||(xe=function(Ne){return Ne.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(xe),Me=function(Ne){return Ne.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Me));const fe=N.createShader(N.FRAGMENT_SHADER);if(N.isContextLost())return void(this.failedToCreate=!0);if(N.shaderSource(fe,xe),N.compileShader(fe),!N.getShaderParameter(fe,N.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${N.getShaderInfoLog(fe)}`);N.attachShader(this.program,fe);const ze=N.createShader(N.VERTEX_SHADER);if(N.isContextLost())return void(this.failedToCreate=!0);if(N.shaderSource(ze,Me),N.compileShader(ze),!N.getShaderParameter(ze,N.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${N.getShaderInfoLog(ze)}`);N.attachShader(this.program,ze),this.attributes={};const Ve={};this.numAttributes=$.length;for(let Ne=0;Ne<this.numAttributes;Ne++)$[Ne]&&(N.bindAttribLocation(this.program,Ne,$[Ne]),this.attributes[$[Ne]]=Ne);if(N.linkProgram(this.program),!N.getProgramParameter(this.program,N.LINK_STATUS))throw new Error(`Program failed to link: ${N.getProgramInfoLog(this.program)}`);N.deleteShader(ze),N.deleteShader(fe);for(let Ne=0;Ne<ge.length;Ne++){const Fe=ge[Ne];if(Fe&&!Ve[Fe]){const He=N.getUniformLocation(this.program,Fe);He&&(Ve[Fe]=He)}}this.fixedUniforms=x(t,Ve),this.terrainUniforms=((Ne,Fe)=>({u_depth:new y.bP(Ne,Fe.u_depth),u_terrain:new y.bP(Ne,Fe.u_terrain),u_terrain_dim:new y.bg(Ne,Fe.u_terrain_dim),u_terrain_matrix:new y.bR(Ne,Fe.u_terrain_matrix),u_terrain_unpack:new y.bS(Ne,Fe.u_terrain_unpack),u_terrain_exaggeration:new y.bg(Ne,Fe.u_terrain_exaggeration)}))(t,Ve),this.projectionUniforms=((Ne,Fe)=>({u_projection_matrix:new y.bR(Ne,Fe.u_projection_matrix),u_projection_tile_mercator_coords:new y.bS(Ne,Fe.u_projection_tile_mercator_coords),u_projection_clipping_plane:new y.bS(Ne,Fe.u_projection_clipping_plane),u_projection_transition:new y.bg(Ne,Fe.u_projection_transition),u_projection_fallback_matrix:new y.bR(Ne,Fe.u_projection_fallback_matrix)}))(t,Ve),this.binderUniforms=f?f.getUniforms(t,Ve):[]}draw(t,c,f,x,S,C,P,k,O,N,U,V,$,W,ae,ne,oe,he,ge){const de=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(f),t.setStencilMode(x),t.setColorMode(S),t.setCullFace(C),k){t.activeTexture.set(de.TEXTURE2),de.bindTexture(de.TEXTURE_2D,k.depthTexture),t.activeTexture.set(de.TEXTURE3),de.bindTexture(de.TEXTURE_2D,k.texture);for(const Me in this.terrainUniforms)this.terrainUniforms[Me].set(k[Me])}if(O)for(const Me in O)this.projectionUniforms[Ah[Me]].set(O[Me]);if(P)for(const Me in this.fixedUniforms)this.fixedUniforms[Me].set(P[Me]);ne&&ne.setUniforms(t,this.binderUniforms,W,{zoom:ae});let xe=0;switch(c){case de.LINES:xe=2;break;case de.TRIANGLES:xe=3;break;case de.LINE_STRIP:xe=1}for(const Me of $.get()){const fe=Me.vaos||(Me.vaos={});(fe[N]||(fe[N]=new us)).bind(t,this,U,ne?ne.getPaintVertexBuffers():[],V,Me.vertexOffset,oe,he,ge),de.drawElements(c,Me.primitiveLength*xe,de.UNSIGNED_SHORT,Me.primitiveOffset*xe*2)}}}function So(b,t,c){const f=1/y.aC(c,1,t.transform.tileZoom),x=Math.pow(2,c.tileID.overscaledZ),S=c.tileSize*Math.pow(2,t.transform.tileZoom)/x,C=S*(c.tileID.canonical.x+c.tileID.wrap*x),P=S*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[f,b.fromScale,b.toScale],u_fade:b.t,u_pixel_coord_upper:[C>>16,P>>16],u_pixel_coord_lower:[65535&C,65535&P]}}const Ln=(b,t,c,f)=>{const x=b.style.light,S=x.properties.get("position"),C=[S.x,S.y,S.z],P=y.bV();x.properties.get("anchor")==="viewport"&&y.bW(P,b.transform.bearingInRadians),y.bX(C,C,P);const k=b.transform.transformLightDirection(C),O=x.properties.get("color");return{u_lightpos:C,u_lightpos_globe:k,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[O.r,O.g,O.b],u_vertical_gradient:+t,u_opacity:c,u_fill_translate:f}},Iu=(b,t,c,f,x,S,C)=>y.e(Ln(b,t,c,f),So(S,b,C),{u_height_factor:-Math.pow(2,x.overscaledZ)/C.tileSize/8}),nl=(b,t,c,f)=>y.e(So(t,b,c),{u_fill_translate:f}),Wl=(b,t)=>({u_world:b,u_fill_translate:t}),Cs=(b,t,c,f,x)=>y.e(nl(b,t,c,x),{u_world:f}),Kl=(b,t,c,f,x)=>{const S=b.transform;let C,P,k=0;if(c.paint.get("circle-pitch-alignment")==="map"){const O=y.aC(t,1,S.zoom);C=!0,P=[O,O],k=O/(y.$*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*x}else C=!1,P=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(c.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+C,u_device_pixel_ratio:b.pixelRatio,u_extrude_scale:P,u_globe_extrude_scale:k,u_translate:f}},jc=b=>({u_pixel_extrude_scale:[1/b.width,1/b.height]}),al=b=>({u_viewport_size:[b.width,b.height]}),Si=(b,t=1)=>({u_color:b,u_overlay:0,u_overlay_scale:t}),ku=(b,t,c,f)=>{const x=y.aC(b,1,t)/(y.$*Math.pow(2,b.tileID.overscaledZ))*2*Math.PI*f;return{u_extrude_scale:y.aC(b,1,t),u_intensity:c,u_globe_extrude_scale:x}},pd=(b,t,c,f)=>{const x=y.L();y.bY(x,0,b.width,b.height,0,0,1);const S=b.context.gl;return{u_matrix:x,u_world:[S.drawingBufferWidth,S.drawingBufferHeight],u_image:c,u_color_ramp:f,u_opacity:t.paint.get("heatmap-opacity")}},md=(b,t,c)=>{const f=c.paint.get("hillshade-accent-color");let x;switch(c.paint.get("hillshade-method")){case"basic":x=4;break;case"combined":x=1;break;case"igor":x=2;break;case"multidirectional":x=3;break;default:x=0}const S=c.getIlluminationProperties();for(let C=0;C<S.directionRadians.length;C++)c.paint.get("hillshade-illumination-anchor")==="viewport"&&(S.directionRadians[C]+=b.transform.bearingInRadians);return{u_image:0,u_latrange:Jl(0,t.tileID),u_exaggeration:c.paint.get("hillshade-exaggeration"),u_altitudes:S.altitudeRadians,u_azimuths:S.directionRadians,u_accent:f,u_method:x,u_highlights:S.highlightColor,u_shadows:S.shadowColor}},Ql=(b,t)=>{const c=t.stride,f=y.L();return y.bY(f,0,y.$,-y.$,0,0,1),y.M(f,f,[0,-y.$,0]),{u_matrix:f,u_image:1,u_dimension:[c,c],u_zoom:b.overscaledZ,u_unpack:t.getUnpackVector()}};function Jl(b,t){const c=Math.pow(2,t.canonical.z),f=t.canonical.y;return[new y.a1(0,f/c).toLngLat().lat,new y.a1(0,(f+1)/c).toLngLat().lat]}const Nc=(b,t,c=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:c,u_opacity:b.paint.get("color-relief-opacity")}),Ru=(b,t,c,f)=>{const x=b.transform;return{u_translation:sl(b,t,c),u_ratio:f/y.aC(t,1,x.zoom),u_device_pixel_ratio:b.pixelRatio,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},Du=(b,t,c,f,x)=>y.e(Ru(b,t,c,f),{u_image:0,u_image_height:x}),Lu=(b,t,c,f,x)=>{const S=b.transform,C=Zs(t,S);return{u_translation:sl(b,t,c),u_texsize:t.imageAtlasTexture.size,u_ratio:f/y.aC(t,1,S.zoom),u_device_pixel_ratio:b.pixelRatio,u_image:0,u_scale:[C,x.fromScale,x.toScale],u_fade:x.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Es=(b,t,c,f,x,S)=>{const C=b.lineAtlas,P=Zs(t,b.transform),k=c.layout.get("line-cap")==="round",O=C.getDash(x.from,k),N=C.getDash(x.to,k),U=O.width*S.fromScale,V=N.width*S.toScale;return y.e(Ru(b,t,c,f),{u_patternscale_a:[P/U,-O.height/2],u_patternscale_b:[P/V,-N.height/2],u_sdfgamma:C.width/(256*Math.min(U,V)*b.pixelRatio)/2,u_image:0,u_tex_y_a:O.y,u_tex_y_b:N.y,u_mix:S.t})};function Zs(b,t){return 1/y.aC(b,1,t.tileZoom)}function sl(b,t,c){return y.aD(b.transform,t,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const ol=(b,t,c,f,x)=>{return{u_tl_parent:b,u_scale_parent:t,u_buffer_scale:1,u_fade_t:c.mix,u_opacity:c.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(C=f.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(S=f.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:gd(f.paint.get("raster-hue-rotate")),u_coords_top:[x[0].x,x[0].y,x[1].x,x[1].y],u_coords_bottom:[x[3].x,x[3].y,x[2].x,x[2].y]};var S,C};function gd(b){b*=Math.PI/180;const t=Math.sin(b),c=Math.cos(b);return[(2*c+1)/3,(-Math.sqrt(3)*t-c+1)/3,(Math.sqrt(3)*t-c+1)/3]}const To=(b,t,c,f,x,S,C,P,k,O,N,U,V)=>{const $=C.transform;return{u_is_size_zoom_constant:+(b==="constant"||b==="source"),u_is_size_feature_constant:+(b==="constant"||b==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:$.width/$.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_label_plane_matrix:P,u_coord_matrix:k,u_is_text:+N,u_pitch_with_map:+f,u_is_along_line:x,u_is_variable_anchor:S,u_texsize:U,u_texture:0,u_translation:O,u_pitched_scale:V}},Bu=(b,t,c,f,x,S,C,P,k,O,N,U,V,$)=>{const W=C.transform;return y.e(To(b,t,c,f,x,S,C,P,k,O,N,U,$),{u_gamma_scale:f?Math.cos(W.pitch*Math.PI/180)*W.cameraToCenterDistance:1,u_device_pixel_ratio:C.pixelRatio,u_is_halo:1})},Ch=(b,t,c,f,x,S,C,P,k,O,N,U,V)=>y.e(Bu(b,t,c,f,x,S,C,P,k,O,!0,N,0,V),{u_texsize_icon:U,u_texture_icon:1}),Eh=(b,t)=>({u_opacity:b,u_color:t}),nf=(b,t,c,f,x)=>y.e(function(S,C,P,k){const O=P.imageManager.getPattern(S.from.toString()),N=P.imageManager.getPattern(S.to.toString()),{width:U,height:V}=P.imageManager.getPixelSize(),$=Math.pow(2,k.tileID.overscaledZ),W=k.tileSize*Math.pow(2,P.transform.tileZoom)/$,ae=W*(k.tileID.canonical.x+k.tileID.wrap*$),ne=W*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[U,V],u_mix:C.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/y.aC(k,1,P.transform.tileZoom),u_pixel_coord_upper:[ae>>16,ne>>16],u_pixel_coord_lower:[65535&ae,65535&ne]}}(c,x,t,f),{u_opacity:b}),ec=(b,t)=>{},la={fillExtrusion:(b,t)=>({u_lightpos:new y.bT(b,t.u_lightpos),u_lightpos_globe:new y.bT(b,t.u_lightpos_globe),u_lightintensity:new y.bg(b,t.u_lightintensity),u_lightcolor:new y.bT(b,t.u_lightcolor),u_vertical_gradient:new y.bg(b,t.u_vertical_gradient),u_opacity:new y.bg(b,t.u_opacity),u_fill_translate:new y.bU(b,t.u_fill_translate)}),fillExtrusionPattern:(b,t)=>({u_lightpos:new y.bT(b,t.u_lightpos),u_lightpos_globe:new y.bT(b,t.u_lightpos_globe),u_lightintensity:new y.bg(b,t.u_lightintensity),u_lightcolor:new y.bT(b,t.u_lightcolor),u_vertical_gradient:new y.bg(b,t.u_vertical_gradient),u_height_factor:new y.bg(b,t.u_height_factor),u_opacity:new y.bg(b,t.u_opacity),u_fill_translate:new y.bU(b,t.u_fill_translate),u_image:new y.bP(b,t.u_image),u_texsize:new y.bU(b,t.u_texsize),u_pixel_coord_upper:new y.bU(b,t.u_pixel_coord_upper),u_pixel_coord_lower:new y.bU(b,t.u_pixel_coord_lower),u_scale:new y.bT(b,t.u_scale),u_fade:new y.bg(b,t.u_fade)}),fill:(b,t)=>({u_fill_translate:new y.bU(b,t.u_fill_translate)}),fillPattern:(b,t)=>({u_image:new y.bP(b,t.u_image),u_texsize:new y.bU(b,t.u_texsize),u_pixel_coord_upper:new y.bU(b,t.u_pixel_coord_upper),u_pixel_coord_lower:new y.bU(b,t.u_pixel_coord_lower),u_scale:new y.bT(b,t.u_scale),u_fade:new y.bg(b,t.u_fade),u_fill_translate:new y.bU(b,t.u_fill_translate)}),fillOutline:(b,t)=>({u_world:new y.bU(b,t.u_world),u_fill_translate:new y.bU(b,t.u_fill_translate)}),fillOutlinePattern:(b,t)=>({u_world:new y.bU(b,t.u_world),u_image:new y.bP(b,t.u_image),u_texsize:new y.bU(b,t.u_texsize),u_pixel_coord_upper:new y.bU(b,t.u_pixel_coord_upper),u_pixel_coord_lower:new y.bU(b,t.u_pixel_coord_lower),u_scale:new y.bT(b,t.u_scale),u_fade:new y.bg(b,t.u_fade),u_fill_translate:new y.bU(b,t.u_fill_translate)}),circle:(b,t)=>({u_camera_to_center_distance:new y.bg(b,t.u_camera_to_center_distance),u_scale_with_map:new y.bP(b,t.u_scale_with_map),u_pitch_with_map:new y.bP(b,t.u_pitch_with_map),u_extrude_scale:new y.bU(b,t.u_extrude_scale),u_device_pixel_ratio:new y.bg(b,t.u_device_pixel_ratio),u_globe_extrude_scale:new y.bg(b,t.u_globe_extrude_scale),u_translate:new y.bU(b,t.u_translate)}),collisionBox:(b,t)=>({u_pixel_extrude_scale:new y.bU(b,t.u_pixel_extrude_scale)}),collisionCircle:(b,t)=>({u_viewport_size:new y.bU(b,t.u_viewport_size)}),debug:(b,t)=>({u_color:new y.bQ(b,t.u_color),u_overlay:new y.bP(b,t.u_overlay),u_overlay_scale:new y.bg(b,t.u_overlay_scale)}),depth:ec,clippingMask:ec,heatmap:(b,t)=>({u_extrude_scale:new y.bg(b,t.u_extrude_scale),u_intensity:new y.bg(b,t.u_intensity),u_globe_extrude_scale:new y.bg(b,t.u_globe_extrude_scale)}),heatmapTexture:(b,t)=>({u_matrix:new y.bR(b,t.u_matrix),u_world:new y.bU(b,t.u_world),u_image:new y.bP(b,t.u_image),u_color_ramp:new y.bP(b,t.u_color_ramp),u_opacity:new y.bg(b,t.u_opacity)}),hillshade:(b,t)=>({u_image:new y.bP(b,t.u_image),u_latrange:new y.bU(b,t.u_latrange),u_exaggeration:new y.bg(b,t.u_exaggeration),u_altitudes:new y.b_(b,t.u_altitudes),u_azimuths:new y.b_(b,t.u_azimuths),u_accent:new y.bQ(b,t.u_accent),u_method:new y.bP(b,t.u_method),u_shadows:new y.bZ(b,t.u_shadows),u_highlights:new y.bZ(b,t.u_highlights)}),hillshadePrepare:(b,t)=>({u_matrix:new y.bR(b,t.u_matrix),u_image:new y.bP(b,t.u_image),u_dimension:new y.bU(b,t.u_dimension),u_zoom:new y.bg(b,t.u_zoom),u_unpack:new y.bS(b,t.u_unpack)}),colorRelief:(b,t)=>({u_image:new y.bP(b,t.u_image),u_unpack:new y.bS(b,t.u_unpack),u_dimension:new y.bU(b,t.u_dimension),u_elevation_stops:new y.bP(b,t.u_elevation_stops),u_color_stops:new y.bP(b,t.u_color_stops),u_color_ramp_size:new y.bP(b,t.u_color_ramp_size),u_opacity:new y.bg(b,t.u_opacity)}),line:(b,t)=>({u_translation:new y.bU(b,t.u_translation),u_ratio:new y.bg(b,t.u_ratio),u_device_pixel_ratio:new y.bg(b,t.u_device_pixel_ratio),u_units_to_pixels:new y.bU(b,t.u_units_to_pixels)}),lineGradient:(b,t)=>({u_translation:new y.bU(b,t.u_translation),u_ratio:new y.bg(b,t.u_ratio),u_device_pixel_ratio:new y.bg(b,t.u_device_pixel_ratio),u_units_to_pixels:new y.bU(b,t.u_units_to_pixels),u_image:new y.bP(b,t.u_image),u_image_height:new y.bg(b,t.u_image_height)}),linePattern:(b,t)=>({u_translation:new y.bU(b,t.u_translation),u_texsize:new y.bU(b,t.u_texsize),u_ratio:new y.bg(b,t.u_ratio),u_device_pixel_ratio:new y.bg(b,t.u_device_pixel_ratio),u_image:new y.bP(b,t.u_image),u_units_to_pixels:new y.bU(b,t.u_units_to_pixels),u_scale:new y.bT(b,t.u_scale),u_fade:new y.bg(b,t.u_fade)}),lineSDF:(b,t)=>({u_translation:new y.bU(b,t.u_translation),u_ratio:new y.bg(b,t.u_ratio),u_device_pixel_ratio:new y.bg(b,t.u_device_pixel_ratio),u_units_to_pixels:new y.bU(b,t.u_units_to_pixels),u_patternscale_a:new y.bU(b,t.u_patternscale_a),u_patternscale_b:new y.bU(b,t.u_patternscale_b),u_sdfgamma:new y.bg(b,t.u_sdfgamma),u_image:new y.bP(b,t.u_image),u_tex_y_a:new y.bg(b,t.u_tex_y_a),u_tex_y_b:new y.bg(b,t.u_tex_y_b),u_mix:new y.bg(b,t.u_mix)}),raster:(b,t)=>({u_tl_parent:new y.bU(b,t.u_tl_parent),u_scale_parent:new y.bg(b,t.u_scale_parent),u_buffer_scale:new y.bg(b,t.u_buffer_scale),u_fade_t:new y.bg(b,t.u_fade_t),u_opacity:new y.bg(b,t.u_opacity),u_image0:new y.bP(b,t.u_image0),u_image1:new y.bP(b,t.u_image1),u_brightness_low:new y.bg(b,t.u_brightness_low),u_brightness_high:new y.bg(b,t.u_brightness_high),u_saturation_factor:new y.bg(b,t.u_saturation_factor),u_contrast_factor:new y.bg(b,t.u_contrast_factor),u_spin_weights:new y.bT(b,t.u_spin_weights),u_coords_top:new y.bS(b,t.u_coords_top),u_coords_bottom:new y.bS(b,t.u_coords_bottom)}),symbolIcon:(b,t)=>({u_is_size_zoom_constant:new y.bP(b,t.u_is_size_zoom_constant),u_is_size_feature_constant:new y.bP(b,t.u_is_size_feature_constant),u_size_t:new y.bg(b,t.u_size_t),u_size:new y.bg(b,t.u_size),u_camera_to_center_distance:new y.bg(b,t.u_camera_to_center_distance),u_pitch:new y.bg(b,t.u_pitch),u_rotate_symbol:new y.bP(b,t.u_rotate_symbol),u_aspect_ratio:new y.bg(b,t.u_aspect_ratio),u_fade_change:new y.bg(b,t.u_fade_change),u_label_plane_matrix:new y.bR(b,t.u_label_plane_matrix),u_coord_matrix:new y.bR(b,t.u_coord_matrix),u_is_text:new y.bP(b,t.u_is_text),u_pitch_with_map:new y.bP(b,t.u_pitch_with_map),u_is_along_line:new y.bP(b,t.u_is_along_line),u_is_variable_anchor:new y.bP(b,t.u_is_variable_anchor),u_texsize:new y.bU(b,t.u_texsize),u_texture:new y.bP(b,t.u_texture),u_translation:new y.bU(b,t.u_translation),u_pitched_scale:new y.bg(b,t.u_pitched_scale)}),symbolSDF:(b,t)=>({u_is_size_zoom_constant:new y.bP(b,t.u_is_size_zoom_constant),u_is_size_feature_constant:new y.bP(b,t.u_is_size_feature_constant),u_size_t:new y.bg(b,t.u_size_t),u_size:new y.bg(b,t.u_size),u_camera_to_center_distance:new y.bg(b,t.u_camera_to_center_distance),u_pitch:new y.bg(b,t.u_pitch),u_rotate_symbol:new y.bP(b,t.u_rotate_symbol),u_aspect_ratio:new y.bg(b,t.u_aspect_ratio),u_fade_change:new y.bg(b,t.u_fade_change),u_label_plane_matrix:new y.bR(b,t.u_label_plane_matrix),u_coord_matrix:new y.bR(b,t.u_coord_matrix),u_is_text:new y.bP(b,t.u_is_text),u_pitch_with_map:new y.bP(b,t.u_pitch_with_map),u_is_along_line:new y.bP(b,t.u_is_along_line),u_is_variable_anchor:new y.bP(b,t.u_is_variable_anchor),u_texsize:new y.bU(b,t.u_texsize),u_texture:new y.bP(b,t.u_texture),u_gamma_scale:new y.bg(b,t.u_gamma_scale),u_device_pixel_ratio:new y.bg(b,t.u_device_pixel_ratio),u_is_halo:new y.bP(b,t.u_is_halo),u_translation:new y.bU(b,t.u_translation),u_pitched_scale:new y.bg(b,t.u_pitched_scale)}),symbolTextAndIcon:(b,t)=>({u_is_size_zoom_constant:new y.bP(b,t.u_is_size_zoom_constant),u_is_size_feature_constant:new y.bP(b,t.u_is_size_feature_constant),u_size_t:new y.bg(b,t.u_size_t),u_size:new y.bg(b,t.u_size),u_camera_to_center_distance:new y.bg(b,t.u_camera_to_center_distance),u_pitch:new y.bg(b,t.u_pitch),u_rotate_symbol:new y.bP(b,t.u_rotate_symbol),u_aspect_ratio:new y.bg(b,t.u_aspect_ratio),u_fade_change:new y.bg(b,t.u_fade_change),u_label_plane_matrix:new y.bR(b,t.u_label_plane_matrix),u_coord_matrix:new y.bR(b,t.u_coord_matrix),u_is_text:new y.bP(b,t.u_is_text),u_pitch_with_map:new y.bP(b,t.u_pitch_with_map),u_is_along_line:new y.bP(b,t.u_is_along_line),u_is_variable_anchor:new y.bP(b,t.u_is_variable_anchor),u_texsize:new y.bU(b,t.u_texsize),u_texsize_icon:new y.bU(b,t.u_texsize_icon),u_texture:new y.bP(b,t.u_texture),u_texture_icon:new y.bP(b,t.u_texture_icon),u_gamma_scale:new y.bg(b,t.u_gamma_scale),u_device_pixel_ratio:new y.bg(b,t.u_device_pixel_ratio),u_is_halo:new y.bP(b,t.u_is_halo),u_translation:new y.bU(b,t.u_translation),u_pitched_scale:new y.bg(b,t.u_pitched_scale)}),background:(b,t)=>({u_opacity:new y.bg(b,t.u_opacity),u_color:new y.bQ(b,t.u_color)}),backgroundPattern:(b,t)=>({u_opacity:new y.bg(b,t.u_opacity),u_image:new y.bP(b,t.u_image),u_pattern_tl_a:new y.bU(b,t.u_pattern_tl_a),u_pattern_br_a:new y.bU(b,t.u_pattern_br_a),u_pattern_tl_b:new y.bU(b,t.u_pattern_tl_b),u_pattern_br_b:new y.bU(b,t.u_pattern_br_b),u_texsize:new y.bU(b,t.u_texsize),u_mix:new y.bg(b,t.u_mix),u_pattern_size_a:new y.bU(b,t.u_pattern_size_a),u_pattern_size_b:new y.bU(b,t.u_pattern_size_b),u_scale_a:new y.bg(b,t.u_scale_a),u_scale_b:new y.bg(b,t.u_scale_b),u_pixel_coord_upper:new y.bU(b,t.u_pixel_coord_upper),u_pixel_coord_lower:new y.bU(b,t.u_pixel_coord_lower),u_tile_units_to_pixels:new y.bg(b,t.u_tile_units_to_pixels)}),terrain:(b,t)=>({u_texture:new y.bP(b,t.u_texture),u_ele_delta:new y.bg(b,t.u_ele_delta),u_fog_matrix:new y.bR(b,t.u_fog_matrix),u_fog_color:new y.bQ(b,t.u_fog_color),u_fog_ground_blend:new y.bg(b,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new y.bg(b,t.u_fog_ground_blend_opacity),u_horizon_color:new y.bQ(b,t.u_horizon_color),u_horizon_fog_blend:new y.bg(b,t.u_horizon_fog_blend),u_is_globe_mode:new y.bg(b,t.u_is_globe_mode)}),terrainDepth:(b,t)=>({u_ele_delta:new y.bg(b,t.u_ele_delta)}),terrainCoords:(b,t)=>({u_texture:new y.bP(b,t.u_texture),u_terrain_coords_id:new y.bg(b,t.u_terrain_coords_id),u_ele_delta:new y.bg(b,t.u_ele_delta)}),projectionErrorMeasurement:(b,t)=>({u_input:new y.bg(b,t.u_input),u_output_expected:new y.bg(b,t.u_output_expected)}),atmosphere:(b,t)=>({u_sun_pos:new y.bT(b,t.u_sun_pos),u_atmosphere_blend:new y.bg(b,t.u_atmosphere_blend),u_globe_position:new y.bT(b,t.u_globe_position),u_globe_radius:new y.bg(b,t.u_globe_radius),u_inv_proj_matrix:new y.bR(b,t.u_inv_proj_matrix)}),sky:(b,t)=>({u_sky_color:new y.bQ(b,t.u_sky_color),u_horizon_color:new y.bQ(b,t.u_horizon_color),u_horizon:new y.bU(b,t.u_horizon),u_horizon_normal:new y.bU(b,t.u_horizon_normal),u_sky_horizon_blend:new y.bg(b,t.u_sky_horizon_blend),u_sky_blend:new y.bg(b,t.u_sky_blend)})};class tc{constructor(t,c,f){this.context=t;const x=t.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const c=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ll={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class hs{constructor(t,c,f,x){this.length=c.length,this.attributes=f,this.itemSize=c.bytesPerElement,this.dynamicDraw=x,this.context=t;const S=t.gl;this.buffer=S.createBuffer(),t.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,c){for(let f=0;f<this.attributes.length;f++){const x=c.attributes[this.attributes[f].name];x!==void 0&&t.enableVertexAttribArray(x)}}setVertexAttribPointers(t,c,f){for(let x=0;x<this.attributes.length;x++){const S=this.attributes[x],C=c.attributes[S.name];C!==void 0&&t.vertexAttribPointer(C,S.components,t[ll[S.type]],!1,this.itemSize,S.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ui{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ou extends Ui{getDefault(){return y.bf.transparent}set(t){const c=this.current;(t.r!==c.r||t.g!==c.g||t.b!==c.b||t.a!==c.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class cl extends Ui{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class zh extends Ui{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ul extends Ui{getDefault(){return[!0,!0,!0,!0]}set(t){const c=this.current;(t[0]!==c[0]||t[1]!==c[1]||t[2]!==c[2]||t[3]!==c[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class $s extends Ui{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Sr extends Ui{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Mo extends Ui{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const c=this.current;(t.func!==c.func||t.ref!==c.ref||t.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ga extends Ui{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const c=this.current;(t[0]!==c[0]||t[1]!==c[1]||t[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ao extends Ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;t?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=t,this.dirty=!1}}class Co extends Ui{getDefault(){return[0,1]}set(t){const c=this.current;(t[0]!==c[0]||t[1]!==c[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Fu extends Ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;t?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=t,this.dirty=!1}}class ic extends Ui{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Hs extends Ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;t?c.enable(c.BLEND):c.disable(c.BLEND),this.current=t,this.dirty=!1}}class Eo extends Ui{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const c=this.current;(t[0]!==c[0]||t[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class rc extends Ui{getDefault(){return y.bf.transparent}set(t){const c=this.current;(t.r!==c.r||t.g!==c.g||t.b!==c.b||t.a!==c.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Vc extends Ui{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Ph extends Ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;t?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=t,this.dirty=!1}}class hl extends Ui{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Uc extends Ui{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class dl extends Ui{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class En extends Ui{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ju extends Ui{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const c=this.current;(t[0]!==c[0]||t[1]!==c[1]||t[2]!==c[2]||t[3]!==c[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class qa extends Ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Nu extends Ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class zn extends Ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Wn extends Ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Xs extends Ui{getDefault(){return null}set(t){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class fl extends Ui{getDefault(){return null}set(t){var c;if(t===this.current&&!this.dirty)return;const f=this.gl;Xn(f)?f.bindVertexArray(t):(c=f.getExtension("OES_vertex_array_object"))===null||c===void 0||c.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class pl extends Ui{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ml extends Ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class zo extends Ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class qr extends Ui{constructor(t,c){super(t),this.context=t,this.parent=c}getDefault(){return null}}class Za extends qr{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class nc extends qr{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ni extends qr{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Gc="Framebuffer is not complete";class Ma{constructor(t,c,f,x,S){this.context=t,this.width=c,this.height=f;const C=t.gl,P=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new Za(t,P),x)this.depthAttachment=S?new ni(t,P):new nc(t,P);else if(S)throw new Error("Stencil cannot be set without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error(Gc)}destroy(){const t=this.context.gl,c=this.colorAttachment.get();if(c&&t.deleteTexture(c),this.depthAttachment){const f=this.depthAttachment.get();f&&t.deleteRenderbuffer(f)}t.deleteFramebuffer(this.framebuffer)}}class qc{constructor(t){var c,f;if(this.gl=t,this.clearColor=new Ou(this),this.clearDepth=new cl(this),this.clearStencil=new zh(this),this.colorMask=new ul(this),this.depthMask=new $s(this),this.stencilMask=new Sr(this),this.stencilFunc=new Mo(this),this.stencilOp=new Ga(this),this.stencilTest=new Ao(this),this.depthRange=new Co(this),this.depthTest=new Fu(this),this.depthFunc=new ic(this),this.blend=new Hs(this),this.blendFunc=new Eo(this),this.blendColor=new rc(this),this.blendEquation=new Vc(this),this.cullFace=new Ph(this),this.cullFaceSide=new hl(this),this.frontFace=new Uc(this),this.program=new dl(this),this.activeTexture=new En(this),this.viewport=new ju(this),this.bindFramebuffer=new qa(this),this.bindRenderbuffer=new Nu(this),this.bindTexture=new zn(this),this.bindVertexBuffer=new Wn(this),this.bindElementBuffer=new Xs(this),this.bindVertexArray=new fl(this),this.pixelStoreUnpack=new pl(this),this.pixelStoreUnpackPremultiplyAlpha=new ml(this),this.pixelStoreUnpackFlipY=new zo(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Xn(t)){this.HALF_FLOAT=t.HALF_FLOAT;const x=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(c=t.RGBA16F)!==null&&c!==void 0?c:x==null?void 0:x.RGBA16F_EXT,this.RGB16F=(f=t.RGB16F)!==null&&f!==void 0?f:x==null?void 0:x.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const x=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=x==null?void 0:x.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,c){return new tc(this,t,c)}createVertexBuffer(t,c,f){return new hs(this,t,c,f)}createRenderbuffer(t,c,f){const x=this.gl,S=x.createRenderbuffer();return this.bindRenderbuffer.set(S),x.renderbufferStorage(x.RENDERBUFFER,t,c,f),this.bindRenderbuffer.set(null),S}createFramebuffer(t,c,f,x){return new Ma(this,t,c,f,x)}clear({color:t,depth:c,stencil:f}){const x=this.gl;let S=0;t&&(S|=x.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(S|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),f!==void 0&&(S|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),x.clear(S)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){y.bH(t.blendFunction,wr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Xn(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var c;return Xn(this.gl)?this.gl.deleteVertexArray(t):(c=this.gl.getExtension("OES_vertex_array_object"))===null||c===void 0?void 0:c.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Kn;function yd(b,t,c,f,x){const S=b.context,C=b.transform,P=S.gl,k=b.useProgram("collisionBox"),O=[];let N=0,U=0;for(let oe=0;oe<f.length;oe++){const he=f[oe],ge=t.getTile(he).getBucket(c);if(!ge)continue;const de=x?ge.textCollisionBox:ge.iconCollisionBox,xe=ge.collisionCircleArray;xe.length>0&&(O.push({circleArray:xe,circleOffset:U,coord:he}),N+=xe.length/4,U=N),de&&k.draw(S,P.LINES,ri.disabled,Li.disabled,b.colorModeForRenderPass(),ii.disabled,jc(b.transform),b.style.map.terrain&&b.style.map.terrain.getTerrainData(he),C.getProjectionData({overscaledTileID:he,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),c.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,null,b.transform.zoom,null,null,de.collisionVertexBuffer)}if(!x||!O.length)return;const V=b.useProgram("collisionCircle"),$=new y.b$;$.resize(4*N),$._trim();let W=0;for(const oe of O)for(let he=0;he<oe.circleArray.length/4;he++){const ge=4*he,de=oe.circleArray[ge+0],xe=oe.circleArray[ge+1],Me=oe.circleArray[ge+2],fe=oe.circleArray[ge+3];$.emplace(W++,de,xe,Me,fe,0),$.emplace(W++,de,xe,Me,fe,1),$.emplace(W++,de,xe,Me,fe,2),$.emplace(W++,de,xe,Me,fe,3)}(!Kn||Kn.length<2*N)&&(Kn=function(oe){const he=2*oe,ge=new y.c1;ge.resize(he),ge._trim();for(let de=0;de<he;de++){const xe=6*de;ge.uint16[xe+0]=4*de+0,ge.uint16[xe+1]=4*de+1,ge.uint16[xe+2]=4*de+2,ge.uint16[xe+3]=4*de+2,ge.uint16[xe+4]=4*de+3,ge.uint16[xe+5]=4*de+0}return ge}(N));const ae=S.createIndexBuffer(Kn,!0),ne=S.createVertexBuffer($,y.c0.members,!0);for(const oe of O){const he=al(b.transform);V.draw(S,P.TRIANGLES,ri.disabled,Li.disabled,b.colorModeForRenderPass(),ii.disabled,he,b.style.map.terrain&&b.style.map.terrain.getTerrainData(oe.coord),null,c.id,ne,ae,y.aM.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,b.transform.zoom,null,null,null)}ne.destroy(),ae.destroy()}const Vu=y.ag(new Float32Array(16));function zs(b,t,c,f,x,S){const{horizontalAlign:C,verticalAlign:P}=y.aH(b);return new y.P((-(C-.5)*t/x+f[0])*S,(-(P-.5)*c/x+f[1])*S)}function Ih(b,t,c,f,x,S){const C=t.tileAnchorPoint.add(new y.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let P=f.mult(S);c||(P=P.rotate(-x));const k=C.add(P);return Bi(k.x,k.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(c){const P=lr(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(b),k=Math.atan(P.y/P.x)+(P.x<0?Math.PI:0);return b.add(f.rotate(k))}return b.add(f)}function Zc(b,t,c,f,x,S,C,P,k,O,N,U){const V=b.text.placedSymbolArray,$=b.text.dynamicLayoutVertexArray,W=b.icon.dynamicLayoutVertexArray,ae={};$.clear();for(let ne=0;ne<V.length;ne++){const oe=V.get(ne),he=oe.hidden||!oe.crossTileID||b.allowVerticalPlacement&&!oe.placedOrientation?null:f[oe.crossTileID];if(he){const ge=new y.P(oe.anchorX,oe.anchorY),de={getElevation:U,width:x.width,height:x.height,pitchedLabelPlaneMatrix:S,pitchWithMap:c,transform:x,tileAnchorPoint:ge,translation:O,unwrappedTileID:N},xe=c?or(ge.x,ge.y,de):lr(ge.x,ge.y,de),Me=pt(x.cameraToCenterDistance,xe.signedDistanceFromCamera);let fe=y.ap(b.textSizeData,P,oe)*Me/y.aB;c&&(fe*=b.tilePixelRatio/C);const{width:ze,height:Ve,anchor:Ne,textOffset:Fe,textBoxScale:He}=he,gt=zs(Ne,ze,Ve,Fe,He,fe),yt=x.getPitchedTextCorrection(ge.x+O[0],ge.y+O[1],N),st=Ih(xe.point,de,t,gt,-x.bearingInRadians,yt),Bt=b.allowVerticalPlacement&&oe.placedOrientation===y.ao.vertical?Math.PI/2:0;for(let oi=0;oi<oe.numGlyphs;oi++)y.av($,st,Bt);k&&oe.associatedIconIndex>=0&&(ae[oe.associatedIconIndex]={shiftedAnchor:st,angle:Bt})}else Fa(oe.numGlyphs,$)}if(k){W.clear();const ne=b.icon.placedSymbolArray;for(let oe=0;oe<ne.length;oe++){const he=ne.get(oe);if(he.hidden)Fa(he.numGlyphs,W);else{const ge=ae[oe];if(ge)for(let de=0;de<he.numGlyphs;de++)y.av(W,ge.shiftedAnchor,ge.angle);else Fa(he.numGlyphs,W)}}b.icon.dynamicLayoutVertexBuffer.updateData(W)}b.text.dynamicLayoutVertexBuffer.updateData($)}function Gn(b,t,c){return c.iconsInText&&t?"symbolTextAndIcon":b?"symbolSDF":"symbolIcon"}function Mt(b,t,c,f,x,S,C,P,k,O,N,U,V){const $=b.context,W=$.gl,ae=b.transform,ne=P==="map",oe=k==="map",he=P!=="viewport"&&c.layout.get("symbol-placement")!=="point",ge=ne&&!oe&&!he,de=!c.layout.get("symbol-sort-key").isConstant();let xe=!1;const Me=b.getDepthModeForSublayer(0,ri.ReadOnly),fe=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ze=[],Ve=ae.getCircleRadiusCorrection();for(const Ne of f){const Fe=t.getTile(Ne),He=Fe.getBucket(c);if(!He)continue;const gt=x?He.text:He.icon;if(!gt||!gt.segments.get().length||!gt.hasVisibleVertices)continue;const yt=gt.programConfigurations.get(c.id),st=x||He.sdfIcons,Bt=x?He.textSizeData:He.iconSizeData,oi=oe||ae.pitch!==0,Gi=b.useProgram(Gn(st,x,He),yt),yr=y.an(Bt,ae.zoom),nr=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ne);let $r,jr,mi,_r,Hr=[0,0],wn=null;if(x)jr=Fe.glyphAtlasTexture,mi=W.LINEAR,$r=Fe.glyphAtlasTexture.size,He.iconsInText&&(Hr=Fe.imageAtlasTexture.size,wn=Fe.imageAtlasTexture,_r=oi||b.options.rotating||b.options.zooming||Bt.kind==="composite"||Bt.kind==="camera"?W.LINEAR:W.NEAREST);else{const Dr=c.layout.get("icon-size").constantOr(0)!==1||He.iconsNeedLinear;jr=Fe.imageAtlasTexture,mi=st||b.options.rotating||b.options.zooming||Dr||oi?W.LINEAR:W.NEAREST,$r=Fe.imageAtlasTexture.size}const gn=y.aC(Fe,1,b.transform.zoom),ia=Mi(ne,b.transform,gn),ps=y.L();y.aq(ps,ia);const Pa=Lt(oe,ne,b.transform,gn),ms=y.aD(ae,Fe,S,C),gs=ae.getProjectionData({overscaledTileID:Ne,applyGlobeMatrix:!V,applyTerrainMatrix:!0}),ys=fe&&He.hasTextData(),Ds=c.layout.get("icon-text-fit")!=="none"&&ys&&He.hasIconData();if(he){const Dr=b.style.map.terrain?(ma,Lr)=>b.style.map.terrain.getElevation(Ne,ma,Lr):null,Xr=c.layout.get("text-rotation-alignment")==="map";Ur(He,b,x,ia,ps,oe,O,Xr,Ne.toUnwrapped(),ae.width,ae.height,ms,Dr)}const jo=x&&fe||Ds,Fn=he||jo?Vu:oe?ia:b.transform.clipSpaceToPixelsMatrix,_s=st&&c.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ra;ra=st?He.iconsInText?Ch(Bt.kind,yr,ge,oe,he,jo,b,Fn,Pa,ms,$r,Hr,Ve):Bu(Bt.kind,yr,ge,oe,he,jo,b,Fn,Pa,ms,x,$r,0,Ve):To(Bt.kind,yr,ge,oe,he,jo,b,Fn,Pa,ms,x,$r,Ve);const No={program:Gi,buffers:gt,uniformValues:ra,projectionData:gs,atlasTexture:jr,atlasTextureIcon:wn,atlasInterpolation:mi,atlasInterpolationIcon:_r,isSDF:st,hasHalo:_s};if(de&&He.canOverlap){xe=!0;const Dr=gt.segments.get();for(const Xr of Dr)ze.push({segments:new y.aM([Xr]),sortKey:Xr.sortKey,state:No,terrainData:nr})}else ze.push({segments:gt.segments,sortKey:0,state:No,terrainData:nr})}xe&&ze.sort((Ne,Fe)=>Ne.sortKey-Fe.sortKey);for(const Ne of ze){const Fe=Ne.state;if($.activeTexture.set(W.TEXTURE0),Fe.atlasTexture.bind(Fe.atlasInterpolation,W.CLAMP_TO_EDGE),Fe.atlasTextureIcon&&($.activeTexture.set(W.TEXTURE1),Fe.atlasTextureIcon&&Fe.atlasTextureIcon.bind(Fe.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),Fe.isSDF){const He=Fe.uniformValues;Fe.hasHalo&&(He.u_is_halo=1,Po(Fe.buffers,Ne.segments,c,b,Fe.program,Me,N,U,He,Fe.projectionData,Ne.terrainData)),He.u_is_halo=0}Po(Fe.buffers,Ne.segments,c,b,Fe.program,Me,N,U,Fe.uniformValues,Fe.projectionData,Ne.terrainData)}}function Po(b,t,c,f,x,S,C,P,k,O,N){const U=f.context;x.draw(U,U.gl.TRIANGLES,S,C,P,ii.backCCW,k,N,O,c.id,b.layoutVertexBuffer,b.indexBuffer,t,c.paint,f.transform.zoom,b.programConfigurations.get(c.id),b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer)}function gl(b,t,c,f,x){const S=b.context,C=S.gl,P=Li.disabled,k=new wr([C.ONE,C.ONE],y.bf.transparent,[!0,!0,!0,!0]),O=t.getBucket(c);if(!O)return;const N=f.key;let U=c.heatmapFbos.get(N);U||(U=vn(S,t.tileSize,t.tileSize),c.heatmapFbos.set(N,U)),S.bindFramebuffer.set(U.framebuffer),S.viewport.set([0,0,t.tileSize,t.tileSize]),S.clear({color:y.bf.transparent});const V=O.programConfigurations.get(c.id),$=b.useProgram("heatmap",V,!x),W=b.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ae=b.style.map.terrain.getTerrainData(f);$.draw(S,C.TRIANGLES,ri.disabled,P,k,ii.disabled,ku(t,b.transform.zoom,c.paint.get("heatmap-intensity"),1),ae,W,c.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,c.paint,b.transform.zoom,V)}function Aa(b,t,c,f,x){const S=b.context,C=S.gl,P=b.transform;S.setColorMode(b.colorModeForRenderPass());const k=ca(S,t),O=c.key,N=t.heatmapFbos.get(O);if(!N)return;S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,N.colorAttachment.get()),S.activeTexture.set(C.TEXTURE1),k.bind(C.LINEAR,C.CLAMP_TO_EDGE);const U=P.getProjectionData({overscaledTileID:c,applyTerrainMatrix:x,applyGlobeMatrix:!f});b.useProgram("heatmapTexture").draw(S,C.TRIANGLES,ri.disabled,Li.disabled,b.colorModeForRenderPass(),ii.disabled,pd(b,t,0,1),null,U,t.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments,t.paint,P.zoom),N.destroy(),t.heatmapFbos.delete(O)}function vn(b,t,c){var f,x;const S=b.gl,C=S.createTexture();S.bindTexture(S.TEXTURE_2D,C),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.LINEAR);const P=(f=b.HALF_FLOAT)!==null&&f!==void 0?f:S.UNSIGNED_BYTE,k=(x=b.RGBA16F)!==null&&x!==void 0?x:S.RGBA;S.texImage2D(S.TEXTURE_2D,0,k,t,c,0,S.RGBA,P,null);const O=b.createFramebuffer(t,c,!1,!1);return O.colorAttachment.set(C),O}function ca(b,t){return t.colorRampTexture||(t.colorRampTexture=new y.T(b,t.colorRamp,b.gl.RGBA)),t.colorRampTexture}function $a(b,t,c,f,x){if(!c||!f||!f.imageAtlas)return;const S=f.imageAtlas.patternPositions;let C=S[c.to.toString()],P=S[c.from.toString()];if(!C&&P&&(C=P),!P&&C&&(P=C),!C||!P){const k=x.getPaintProperty(t);C=S[k],P=S[k]}C&&P&&b.setConstantPatternPositions(C,P)}function ds(b,t,c,f,x,S,C,P){const k=b.context.gl,O="fill-pattern",N=c.paint.get(O),U=N&&N.constantOr(1),V=c.getCrossfadeParameters();let $,W,ae,ne,oe;const he=b.transform,ge=c.paint.get("fill-translate"),de=c.paint.get("fill-translate-anchor");C?(W=U&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=k.LINES):(W=U?"fillPattern":"fill",$=k.TRIANGLES);const xe=N.constantOr(null);for(const Me of f){const fe=t.getTile(Me);if(U&&!fe.patternsLoaded())continue;const ze=fe.getBucket(c);if(!ze)continue;const Ve=ze.programConfigurations.get(c.id),Ne=b.useProgram(W,Ve),Fe=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Me);U&&(b.context.activeTexture.set(k.TEXTURE0),fe.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Ve.updatePaintBuffers(V)),$a(Ve,O,xe,fe,c);const He=he.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),gt=y.aD(he,fe,ge,de);if(C){ne=ze.indexBuffer2,oe=ze.segments2;const st=[k.drawingBufferWidth,k.drawingBufferHeight];ae=W==="fillOutlinePattern"&&U?Cs(b,V,fe,st,gt):Wl(st,gt)}else ne=ze.indexBuffer,oe=ze.segments,ae=U?nl(b,V,fe,gt):{u_fill_translate:gt};const yt=b.stencilModeForClipping(Me);Ne.draw(b.context,$,x,yt,S,ii.backCCW,ae,Fe,He,c.id,ze.layoutVertexBuffer,ne,oe,c.paint,b.transform.zoom,Ve)}}function Io(b,t,c,f,x,S,C,P){const k=b.context,O=k.gl,N="fill-extrusion-pattern",U=c.paint.get(N),V=U.constantOr(1),$=c.getCrossfadeParameters(),W=c.paint.get("fill-extrusion-opacity"),ae=U.constantOr(null),ne=b.transform;for(const oe of f){const he=t.getTile(oe),ge=he.getBucket(c);if(!ge)continue;const de=b.style.map.terrain&&b.style.map.terrain.getTerrainData(oe),xe=ge.programConfigurations.get(c.id),Me=b.useProgram(V?"fillExtrusionPattern":"fillExtrusion",xe);V&&(b.context.activeTexture.set(O.TEXTURE0),he.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),xe.updatePaintBuffers($));const fe=ne.getProjectionData({overscaledTileID:oe,applyGlobeMatrix:!P,applyTerrainMatrix:!0});$a(xe,N,ae,he,c);const ze=y.aD(ne,he,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ve=c.paint.get("fill-extrusion-vertical-gradient"),Ne=V?Iu(b,Ve,W,ze,oe,$,he):Ln(b,Ve,W,ze);Me.draw(k,k.gl.TRIANGLES,x,S,C,ii.backCCW,Ne,de,fe,c.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,c.paint,b.transform.zoom,xe,b.style.map.terrain&&ge.centroidVertexBuffer)}}function ko(b,t,c,f,x,S,C,P,k){var O;const N=b.style.projection,U=b.context,V=b.transform,$=U.gl,W=[`#define NUM_ILLUMINATION_SOURCES ${c.paint.get("hillshade-highlight-color").values.length}`],ae=b.useProgram("hillshade",null,!1,W),ne=!b.options.moving;for(const oe of f){const he=t.getTile(oe),ge=he.fbo;if(!ge)continue;const de=N.getMeshFromTileID(U,oe.canonical,P,!0,"raster"),xe=(O=b.style.map.terrain)===null||O===void 0?void 0:O.getTerrainData(oe);U.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,ge.colorAttachment.get());const Me=V.getProjectionData({overscaledTileID:oe,aligned:ne,applyGlobeMatrix:!k,applyTerrainMatrix:!0});ae.draw(U,$.TRIANGLES,S,x[oe.overscaledZ],C,ii.backCCW,md(b,he,c),xe,Me,c.id,de.vertexBuffer,de.indexBuffer,de.segments)}}function ac(b,t,c,f,x,S,C,P,k){var O;const N=b.style.projection,U=b.context,V=b.transform,$=U.gl,W=b.useProgram("colorRelief"),ae=!b.options.moving;let ne=!0,oe=0;for(const he of f){const ge=t.getTile(he),de=ge.dem;if(ne){const Ne=$.getParameter($.MAX_TEXTURE_SIZE),{elevationTexture:Fe,colorTexture:He}=c.getColorRampTextures(U,Ne,de.getUnpackVector());U.activeTexture.set($.TEXTURE1),Fe.bind($.NEAREST,$.CLAMP_TO_EDGE),U.activeTexture.set($.TEXTURE4),He.bind($.LINEAR,$.CLAMP_TO_EDGE),ne=!1,oe=Fe.size[0]}if(!de||!de.data)continue;const xe=de.stride,Me=de.getPixels();if(U.activeTexture.set($.TEXTURE0),U.pixelStoreUnpackPremultiplyAlpha.set(!1),ge.demTexture=ge.demTexture||b.getTileTexture(xe),ge.demTexture){const Ne=ge.demTexture;Ne.update(Me,{premultiply:!1}),Ne.bind($.LINEAR,$.CLAMP_TO_EDGE)}else ge.demTexture=new y.T(U,Me,$.RGBA,{premultiply:!1}),ge.demTexture.bind($.LINEAR,$.CLAMP_TO_EDGE);const fe=N.getMeshFromTileID(U,he.canonical,P,!0,"raster"),ze=(O=b.style.map.terrain)===null||O===void 0?void 0:O.getTerrainData(he),Ve=V.getProjectionData({overscaledTileID:he,aligned:ae,applyGlobeMatrix:!k,applyTerrainMatrix:!0});W.draw(U,$.TRIANGLES,S,x[he.overscaledZ],C,ii.backCCW,Nc(c,ge.dem,oe),ze,Ve,c.id,fe.vertexBuffer,fe.indexBuffer,fe.segments)}}const sc=[new y.P(0,0),new y.P(y.$,0),new y.P(y.$,y.$),new y.P(0,y.$)];function ln(b,t,c,f,x,S,C,P,k=!1,O=!1){const N=f[f.length-1].overscaledZ,U=b.context,V=U.gl,$=b.useProgram("raster"),W=b.transform,ae=b.style.projection,ne=b.colorModeForRenderPass(),oe=!b.options.moving;for(const he of f){const ge=b.getDepthModeForSublayer(he.overscaledZ-N,c.paint.get("raster-opacity")===1?ri.ReadWrite:ri.ReadOnly,V.LESS),de=t.getTile(he);de.registerFadeDuration(c.paint.get("raster-fade-duration"));const xe=t.findLoadedParent(he,0),Me=t.findLoadedSibling(he),fe=Zr(de,xe||Me||null,t,c,b.transform,b.style.map.terrain);let ze,Ve;const Ne=c.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR;U.activeTexture.set(V.TEXTURE0),de.texture.bind(Ne,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),U.activeTexture.set(V.TEXTURE1),xe?(xe.texture.bind(Ne,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),ze=Math.pow(2,xe.tileID.overscaledZ-de.tileID.overscaledZ),Ve=[de.tileID.canonical.x*ze%1,de.tileID.canonical.y*ze%1]):de.texture.bind(Ne,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),de.texture.useMipmap&&U.extTextureFilterAnisotropic&&b.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);const Fe=b.style.map.terrain&&b.style.map.terrain.getTerrainData(he),He=W.getProjectionData({overscaledTileID:he,aligned:oe,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),gt=ol(Ve||[0,0],ze||1,fe,c,P),yt=ae.getMeshFromTileID(U,he.canonical,S,C,"raster");$.draw(U,V.TRIANGLES,ge,x?x[he.overscaledZ]:Li.disabled,ne,k?ii.frontCCW:ii.backCCW,gt,Fe,He,c.id,yt.vertexBuffer,yt.indexBuffer,yt.segments)}}function Zr(b,t,c,f,x,S){const C=f.paint.get("raster-fade-duration");if(!S&&C>0){const P=Le.now(),k=(P-b.timeAdded)/C,O=t?(P-t.timeAdded)/C:-1,N=c.getSource(),U=Dt(x,{tileSize:N.tileSize,roundZoom:N.roundZoom}),V=!t||Math.abs(t.tileID.overscaledZ-U)>Math.abs(b.tileID.overscaledZ-U),$=V&&b.refreshedUponExpiration?1:y.ah(V?k:1-O,0,1);return b.refreshedUponExpiration&&k>=1&&(b.refreshedUponExpiration=!1),t?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}const Wi=new y.bf(1,0,0,1),yl=new y.bf(0,1,0,1),Ha=new y.bf(0,0,1,1),$c=new y.bf(1,0,1,1),_l=new y.bf(0,1,1,1);function Hc(b,t,c,f){ua(b,0,t+c/2,b.transform.width,c,f)}function Or(b,t,c,f){ua(b,t-c/2,0,c,b.transform.height,f)}function ua(b,t,c,f,x,S){const C=b.context,P=C.gl;P.enable(P.SCISSOR_TEST),P.scissor(t*b.pixelRatio,c*b.pixelRatio,f*b.pixelRatio,x*b.pixelRatio),C.clear({color:S}),P.disable(P.SCISSOR_TEST)}function qn(b,t,c){const f=b.context,x=f.gl,S=b.useProgram("debug"),C=ri.disabled,P=Li.disabled,k=b.colorModeForRenderPass(),O="$debug",N=b.style.map.terrain&&b.style.map.terrain.getTerrainData(c);f.activeTexture.set(x.TEXTURE0);const U=t.getTileByID(c.key).latestRawTileData,V=Math.floor((U&&U.byteLength||0)/1024),$=t.getTile(c).tileSize,W=512/Math.min($,512)*(c.overscaledZ/b.transform.zoom)*.5;let ae=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(ae+=` => ${c.overscaledZ}`),function(oe,he){oe.initDebugOverlayCanvas();const ge=oe.debugOverlayCanvas,de=oe.context.gl,xe=oe.debugOverlayCanvas.getContext("2d");xe.clearRect(0,0,ge.width,ge.height),xe.shadowColor="white",xe.shadowBlur=2,xe.lineWidth=1.5,xe.strokeStyle="white",xe.textBaseline="top",xe.font="bold 36px Open Sans, sans-serif",xe.fillText(he,5,5),xe.strokeText(he,5,5),oe.debugOverlayTexture.update(ge),oe.debugOverlayTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE)}(b,`${ae} ${V}kB`);const ne=b.transform.getProjectionData({overscaledTileID:c,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(f,x.TRIANGLES,C,P,wr.alphaBlended,ii.disabled,Si(y.bf.transparent,W),null,ne,O,b.debugBuffer,b.quadTriangleIndexBuffer,b.debugSegments),S.draw(f,x.LINE_STRIP,C,P,k,ii.disabled,Si(y.bf.red),N,ne,O,b.debugBuffer,b.tileBorderIndexBuffer,b.debugSegments)}function Xc(b,t,c,f){const{isRenderingGlobe:x}=f,S=b.context,C=S.gl,P=b.transform,k=b.colorModeForRenderPass(),O=b.getDepthModeFor3D(),N=b.useProgram("terrain");S.bindFramebuffer.set(null),S.viewport.set([0,0,b.width,b.height]);for(const U of c){const V=t.getTerrainMesh(U.tileID),$=b.renderToTexture.getTexture(U),W=t.getTerrainData(U.tileID);S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,$.texture);const ae=t.getMeshFrameDelta(P.zoom),ne=P.calculateFogMatrix(U.tileID.toUnwrapped()),oe=Pu(ae,ne,b.style.sky,P.pitch,x),he=P.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});N.draw(S,C.TRIANGLES,O,Li.disabled,k,ii.backCCW,oe,W,he,"terrain",V.vertexBuffer,V.indexBuffer,V.segments)}}function Ys(b,t){if(!t.mesh){const c=new y.aL;c.emplaceBack(-1,-1),c.emplaceBack(1,-1),c.emplaceBack(1,1),c.emplaceBack(-1,1);const f=new y.aN;f.emplaceBack(0,1,2),f.emplaceBack(0,2,3),t.mesh=new Gs(b.createVertexBuffer(c,Tn.members),b.createIndexBuffer(f),y.aM.simpleSegment(0,0,c.length,f.length))}return t.mesh}class Yc{constructor(t,c){this.context=new qc(t),this.transform=c,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:y.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ti.maxUnderzooming+Ti.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Us}resize(t,c,f){if(this.width=Math.floor(t*f),this.height=Math.floor(c*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style._order)this.style._layers[x].resize()}setup(){const t=this.context,c=new y.aL;c.emplaceBack(0,0),c.emplaceBack(y.$,0),c.emplaceBack(0,y.$),c.emplaceBack(y.$,y.$),this.tileExtentBuffer=t.createVertexBuffer(c,Tn.members),this.tileExtentSegments=y.aM.simpleSegment(0,0,4,2);const f=new y.aL;f.emplaceBack(0,0),f.emplaceBack(y.$,0),f.emplaceBack(0,y.$),f.emplaceBack(y.$,y.$),this.debugBuffer=t.createVertexBuffer(f,Tn.members),this.debugSegments=y.aM.simpleSegment(0,0,4,5);const x=new y.c6;x.emplaceBack(0,0,0,0),x.emplaceBack(y.$,0,y.$,0),x.emplaceBack(0,y.$,0,y.$),x.emplaceBack(y.$,y.$,y.$,y.$),this.rasterBoundsBuffer=t.createVertexBuffer(x,Fc.members),this.rasterBoundsSegments=y.aM.simpleSegment(0,0,4,2);const S=new y.aL;S.emplaceBack(0,0),S.emplaceBack(y.$,0),S.emplaceBack(0,y.$),S.emplaceBack(y.$,y.$),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(S,Tn.members),this.rasterBoundsSegmentsPosOnly=y.aM.simpleSegment(0,0,4,5);const C=new y.aL;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(C,Tn.members),this.viewportSegments=y.aM.simpleSegment(0,0,4,2);const P=new y.c7;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(P);const k=new y.aN;k.emplaceBack(1,0,2),k.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(k);const O=this.context.gl;this.stencilClearMode=new Li({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.tileExtentMesh=new Gs(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,c=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=y.L();y.bY(f,0,this.width,this.height,0,0,1),y.N(f,f,[c.drawingBufferWidth,c.drawingBufferHeight,0]);const x={mainMatrix:f,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:f};this.useProgram("clippingMask",null,!0).draw(t,c.TRIANGLES,ri.disabled,this.stencilClearMode,wr.disabled,ii.disabled,null,null,x,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,c,f){if(this.currentStencilSource===t.source||!t.isTileClipped()||!c||!c.length)return;this.currentStencilSource=t.source,this.nextStencilID+c.length>256&&this.clearStencil();const x=this.context;x.setColorMode(wr.disabled),x.setDepthMode(ri.disabled);const S={};for(const C of c)S[C.key]=this.nextStencilID++;this._renderTileMasks(S,c,f,!0),this._renderTileMasks(S,c,f,!1),this._tileClippingMaskIDs=S}_renderTileMasks(t,c,f,x){const S=this.context,C=S.gl,P=this.style.projection,k=this.transform,O=this.useProgram("clippingMask");for(const N of c){const U=t[N.key],V=this.style.map.terrain&&this.style.map.terrain.getTerrainData(N),$=P.getMeshFromTileID(this.context,N.canonical,x,!0,"stencil"),W=k.getProjectionData({overscaledTileID:N,applyGlobeMatrix:!f,applyTerrainMatrix:!0});O.draw(S,C.TRIANGLES,ri.disabled,new Li({func:C.ALWAYS,mask:0},U,255,C.KEEP,C.KEEP,C.REPLACE),wr.disabled,f?ii.disabled:ii.backCCW,null,V,W,"$clipping",$.vertexBuffer,$.indexBuffer,$.segments)}}_renderTilesDepthBuffer(){const t=this.context,c=t.gl,f=this.style.projection,x=this.transform,S=this.useProgram("depth"),C=this.getDepthModeFor3D(),P=ke(x,{tileSize:x.tileSize});for(const k of P){const O=this.style.map.terrain&&this.style.map.terrain.getTerrainData(k),N=f.getMeshFromTileID(this.context,k.canonical,!0,!0,"raster"),U=x.getProjectionData({overscaledTileID:k,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(t,c.TRIANGLES,C,Li.disabled,wr.disabled,ii.backCCW,null,O,U,"$clipping",N.vertexBuffer,N.indexBuffer,N.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,c=this.context.gl;return new Li({func:c.NOTEQUAL,mask:255},t,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(t){const c=this.context.gl;return new Li({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,c.KEEP,c.KEEP,c.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const c=this.context.gl,f=t.sort((C,P)=>P.overscaledZ-C.overscaledZ),x=f[f.length-1].overscaledZ,S=f[0].overscaledZ-x+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const C={};for(let P=0;P<S;P++)C[P+x]=new Li({func:c.GEQUAL,mask:255},P+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=S,[C,f]}return[{[x]:Li.disabled},f]}stencilConfigForOverlapTwoPass(t){const c=this.context.gl,f=t.sort((C,P)=>P.overscaledZ-C.overscaledZ),x=f[f.length-1].overscaledZ,S=f[0].overscaledZ-x+1;if(this.clearStencil(),S>1){const C={},P={};for(let k=0;k<S;k++)C[k+x]=new Li({func:c.GREATER,mask:255},S+1+k,255,c.KEEP,c.KEEP,c.REPLACE),P[k+x]=new Li({func:c.GREATER,mask:255},1+k,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID=2*S+1,[C,P,f]}return this.nextStencilID=3,[{[x]:new Li({func:c.GREATER,mask:255},2,255,c.KEEP,c.KEEP,c.REPLACE)},{[x]:new Li({func:c.GREATER,mask:255},1,255,c.KEEP,c.KEEP,c.REPLACE)},f]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new wr([t.CONSTANT_COLOR,t.ONE],new y.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?wr.unblended:wr.alphaBlended}getDepthModeForSublayer(t,c,f){if(!this.opaquePassEnabledForLayer())return ri.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ri(f||this.context.gl.LEQUAL,c,[x,x])}getDepthModeFor3D(){return new ri(this.context.gl.LEQUAL,ri.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,c){var f,x;this.style=t,this.options=c,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(Le.now()),this.imageManager.beginFrame();const S=this.style._order,C=this.style.sourceCaches,P={},k={},O={},N={isRenderingToTexture:!1,isRenderingGlobe:((f=t.projection)===null||f===void 0?void 0:f.transitionState)>0};for(const V in C){const $=C[V];$.used&&$.prepare(this.context),P[V]=$.getVisibleCoordinates(!1),k[V]=P[V].slice().reverse(),O[V]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let V=0;V<S.length;V++)if(this.style._layers[S[V]].is3D()){this.opaquePassCutoff=V;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const V of S){const $=this.style._layers[V];if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const W=k[$.source];($.type==="custom"||W.length)&&this.renderLayer(this,C[$.source],$,W,N)}if((x=this.style.projection)===null||x===void 0||x.updateGPUdependent({context:this.context,useProgram:V=>this.useProgram(V)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:c.showOverdrawInspector?y.bf.black:y.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(V,$){const W=V.context,ae=W.gl,ne=((Me,fe,ze)=>{const Ve=Math.cos(fe.rollInRadians),Ne=Math.sin(fe.rollInRadians),Fe=Ae(fe),He=fe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Me.properties.get("sky-color"),u_horizon_color:Me.properties.get("horizon-color"),u_horizon:[(fe.width/2-Fe*Ne)*ze,(fe.height/2+Fe*Ve)*ze],u_horizon_normal:[-Ne,Ve],u_sky_horizon_blend:Me.properties.get("sky-horizon-blend")*fe.height/2*ze,u_sky_blend:He}})($,V.style.map.transform,V.pixelRatio),oe=new ri(ae.LEQUAL,ri.ReadWrite,[0,1]),he=Li.disabled,ge=V.colorModeForRenderPass(),de=V.useProgram("sky"),xe=Ys(W,$);de.draw(W,ae.TRIANGLES,oe,he,ge,ii.disabled,ne,null,void 0,"sky",xe.vertexBuffer,xe.indexBuffer,xe.segments)}(this,this.style.sky),this._showOverdrawInspector=c.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const V=this.style._layers[S[this.currentLayer]],$=C[V.source],W=P[V.source];this._renderTileClippingMasks(V,W,!1),this.renderLayer(this,$,V,W,N)}this.renderPass="translucent";let U=!1;for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const V=this.style._layers[S[this.currentLayer]],$=C[V.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(V,N))continue;this.opaquePassEnabledForLayer()||U||(U=!0,N.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const W=(V.type==="symbol"?O:k)[V.source];this._renderTileClippingMasks(V,P[V.source],!!this.renderToTexture),this.renderLayer(this,$,V,W,N)}if(N.isRenderingGlobe&&function(V,$,W){const ae=V.context,ne=ae.gl,oe=V.useProgram("atmosphere"),he=new ri(ne.LEQUAL,ri.ReadOnly,[0,1]),ge=V.transform,de=function(He,gt){const yt=He.properties.get("position"),st=[-yt.x,-yt.y,-yt.z],Bt=y.ag(new Float64Array(16));return He.properties.get("anchor")==="map"&&(y.b6(Bt,Bt,gt.rollInRadians),y.b7(Bt,Bt,-gt.pitchInRadians),y.b6(Bt,Bt,gt.bearingInRadians),y.b7(Bt,Bt,gt.center.lat*Math.PI/180),y.bz(Bt,Bt,-gt.center.lng*Math.PI/180)),y.c5(st,st,Bt),st}(W,V.transform),xe=ge.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Me=$.properties.get("atmosphere-blend")*xe.projectionTransition;if(Me===0)return;const fe=il(ge.worldSize,ge.center.lat),ze=ge.inverseProjectionMatrix,Ve=new Float64Array(4);Ve[3]=1,y.aw(Ve,Ve,ge.modelViewProjectionMatrix),Ve[0]/=Ve[3],Ve[1]/=Ve[3],Ve[2]/=Ve[3],Ve[3]=1,y.aw(Ve,Ve,ze),Ve[0]/=Ve[3],Ve[1]/=Ve[3],Ve[2]/=Ve[3],Ve[3]=1;const Ne=((He,gt,yt,st,Bt)=>({u_sun_pos:He,u_atmosphere_blend:gt,u_globe_position:yt,u_globe_radius:st,u_inv_proj_matrix:Bt}))(de,Me,[Ve[0],Ve[1],Ve[2]],fe,ze),Fe=Ys(ae,$);oe.draw(ae,ne.TRIANGLES,he,Li.disabled,wr.alphaBlended,ii.disabled,Ne,null,null,"atmosphere",Fe.vertexBuffer,Fe.indexBuffer,Fe.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const V=function($,W){let ae=null;const ne=Object.values($._layers).flatMap(de=>de.source&&!de.isHidden(W)?[$.sourceCaches[de.source]]:[]),oe=ne.filter(de=>de.getSource().type==="vector"),he=ne.filter(de=>de.getSource().type!=="vector"),ge=de=>{(!ae||ae.getSource().maxzoom<de.getSource().maxzoom)&&(ae=de)};return oe.forEach(de=>ge(de)),ae||he.forEach(de=>ge(de)),ae}(this.style,this.transform.zoom);V&&function($,W,ae){for(let ne=0;ne<ae.length;ne++)qn($,W,ae[ne])}(this,V,V.getVisibleCoordinates())}this.options.showPadding&&function(V){const $=V.transform.padding;Hc(V,V.transform.height-($.top||0),3,Wi),Hc(V,$.bottom||0,3,yl),Or(V,$.left||0,3,Ha),Or(V,V.transform.width-($.right||0),3,$c);const W=V.transform.centerPoint;(function(ae,ne,oe,he){ua(ae,ne-1,oe-10,2,20,he),ua(ae,ne-10,oe-1,20,2,he)})(V,W.x,V.transform.height-W.y,_l)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const c=this.terrainFacilitator.matrix,f=this.transform.modelViewProjectionMatrix;let x=this.terrainFacilitator.dirty;x||(x=t?!y.c8(c,f):!y.c9(c,f)),x||(x=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),x&&(y.ca(c,f),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(S,C){const P=S.context,k=P.gl,O=S.transform,N=wr.unblended,U=new ri(k.LEQUAL,ri.ReadWrite,[0,1]),V=C.sourceCache.getRenderableTiles(),$=S.useProgram("terrainDepth");P.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),P.clear({color:y.bf.transparent,depth:1});for(const W of V){const ae=C.getTerrainMesh(W.tileID),ne=C.getTerrainData(W.tileID),oe=O.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),he={u_ele_delta:C.getMeshFrameDelta(O.zoom)};$.draw(P,k.TRIANGLES,U,Li.disabled,N,ii.backCCW,he,ne,oe,"terrain",ae.vertexBuffer,ae.indexBuffer,ae.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain),function(S,C){const P=S.context,k=P.gl,O=S.transform,N=wr.unblended,U=new ri(k.LEQUAL,ri.ReadWrite,[0,1]),V=C.getCoordsTexture(),$=C.sourceCache.getRenderableTiles(),W=S.useProgram("terrainCoords");P.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),P.clear({color:y.bf.transparent,depth:1}),C.coordsIndex=[];for(const ae of $){const ne=C.getTerrainMesh(ae.tileID),oe=C.getTerrainData(ae.tileID);P.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,V.texture);const he={u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(O.zoom)},ge=O.getProjectionData({overscaledTileID:ae.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});W.draw(P,k.TRIANGLES,U,Li.disabled,N,ii.backCCW,he,oe,ge,"terrain",ne.vertexBuffer,ne.indexBuffer,ne.segments),C.coordsIndex.push(ae.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain))}renderLayer(t,c,f,x,S){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||(x||[]).length)&&(this.id=f.id,y.cb(f)?function(C,P,k,O,N,U){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:V}=U,$=Li.disabled,W=C.colorModeForRenderPass();(k._unevaluatedLayout.hasValue("text-variable-anchor")||k._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ae,ne,oe,he,ge,de,xe,Me,fe){const ze=ne.transform,Ve=ne.style.map.terrain,Ne=ge==="map",Fe=de==="map";for(const He of ae){const gt=he.getTile(He),yt=gt.getBucket(oe);if(!yt||!yt.text||!yt.text.segments.get().length)continue;const st=y.an(yt.textSizeData,ze.zoom),Bt=y.aC(gt,1,ne.transform.zoom),oi=Mi(Ne,ne.transform,Bt),Gi=oe.layout.get("icon-text-fit")!=="none"&&yt.hasIconData();if(st){const yr=Math.pow(2,ze.zoom-gt.tileID.overscaledZ),nr=Ve?($r,jr)=>Ve.getElevation(He,$r,jr):null;Zc(yt,Ne,Fe,fe,ze,oi,yr,st,Gi,y.aD(ze,gt,xe,Me),He.toUnwrapped(),nr)}}}(O,C,k,P,k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),N),k.paint.get("icon-opacity").constantOr(1)!==0&&Mt(C,P,k,O,!1,k.paint.get("icon-translate"),k.paint.get("icon-translate-anchor"),k.layout.get("icon-rotation-alignment"),k.layout.get("icon-pitch-alignment"),k.layout.get("icon-keep-upright"),$,W,V),k.paint.get("text-opacity").constantOr(1)!==0&&Mt(C,P,k,O,!0,k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.layout.get("text-keep-upright"),$,W,V),P.map.showCollisionBoxes&&(yd(C,P,k,O,!0),yd(C,P,k,O,!1))}(t,c,f,x,this.style.placement.variableOffsets,S):y.cc(f)?function(C,P,k,O,N){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:U}=N,V=k.paint.get("circle-opacity"),$=k.paint.get("circle-stroke-width"),W=k.paint.get("circle-stroke-opacity"),ae=!k.layout.get("circle-sort-key").isConstant();if(V.constantOr(1)===0&&($.constantOr(1)===0||W.constantOr(1)===0))return;const ne=C.context,oe=ne.gl,he=C.transform,ge=C.getDepthModeForSublayer(0,ri.ReadOnly),de=Li.disabled,xe=C.colorModeForRenderPass(),Me=[],fe=he.getCircleRadiusCorrection();for(let ze=0;ze<O.length;ze++){const Ve=O[ze],Ne=P.getTile(Ve),Fe=Ne.getBucket(k);if(!Fe)continue;const He=k.paint.get("circle-translate"),gt=k.paint.get("circle-translate-anchor"),yt=y.aD(he,Ne,He,gt),st=Fe.programConfigurations.get(k.id),Bt=C.useProgram("circle",st),oi=Fe.layoutVertexBuffer,Gi=Fe.indexBuffer,yr=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Ve),nr={programConfiguration:st,program:Bt,layoutVertexBuffer:oi,indexBuffer:Gi,uniformValues:Kl(C,Ne,k,yt,fe),terrainData:yr,projectionData:he.getProjectionData({overscaledTileID:Ve,applyGlobeMatrix:!U,applyTerrainMatrix:!0})};if(ae){const $r=Fe.segments.get();for(const jr of $r)Me.push({segments:new y.aM([jr]),sortKey:jr.sortKey,state:nr})}else Me.push({segments:Fe.segments,sortKey:0,state:nr})}ae&&Me.sort((ze,Ve)=>ze.sortKey-Ve.sortKey);for(const ze of Me){const{programConfiguration:Ve,program:Ne,layoutVertexBuffer:Fe,indexBuffer:He,uniformValues:gt,terrainData:yt,projectionData:st}=ze.state;Ne.draw(ne,oe.TRIANGLES,ge,de,xe,ii.backCCW,gt,yt,st,k.id,Fe,He,ze.segments,k.paint,C.transform.zoom,Ve)}}(t,c,f,x,S):y.cd(f)?function(C,P,k,O,N){if(k.paint.get("heatmap-opacity")===0)return;const U=C.context,{isRenderingToTexture:V,isRenderingGlobe:$}=N;if(C.style.map.terrain){for(const W of O){const ae=P.getTile(W);P.hasRenderableParent(W)||(C.renderPass==="offscreen"?gl(C,ae,k,W,$):C.renderPass==="translucent"&&Aa(C,k,W,V,$))}U.viewport.set([0,0,C.width,C.height])}else C.renderPass==="offscreen"?function(W,ae,ne,oe){const he=W.context,ge=he.gl,de=W.transform,xe=Li.disabled,Me=new wr([ge.ONE,ge.ONE],y.bf.transparent,[!0,!0,!0,!0]);(function(fe,ze,Ve){const Ne=fe.gl;fe.activeTexture.set(Ne.TEXTURE1),fe.viewport.set([0,0,ze.width/4,ze.height/4]);let Fe=Ve.heatmapFbos.get(y.c2);Fe?(Ne.bindTexture(Ne.TEXTURE_2D,Fe.colorAttachment.get()),fe.bindFramebuffer.set(Fe.framebuffer)):(Fe=vn(fe,ze.width/4,ze.height/4),Ve.heatmapFbos.set(y.c2,Fe))})(he,W,ne),he.clear({color:y.bf.transparent});for(let fe=0;fe<oe.length;fe++){const ze=oe[fe];if(ae.hasRenderableParent(ze))continue;const Ve=ae.getTile(ze),Ne=Ve.getBucket(ne);if(!Ne)continue;const Fe=Ne.programConfigurations.get(ne.id),He=W.useProgram("heatmap",Fe),gt=de.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),yt=de.getCircleRadiusCorrection();He.draw(he,ge.TRIANGLES,ri.disabled,xe,Me,ii.backCCW,ku(Ve,de.zoom,ne.paint.get("heatmap-intensity"),yt),null,gt,ne.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,ne.paint,de.zoom,Fe)}he.viewport.set([0,0,W.width,W.height])}(C,P,k,O):C.renderPass==="translucent"&&function(W,ae){const ne=W.context,oe=ne.gl;ne.setColorMode(W.colorModeForRenderPass());const he=ae.heatmapFbos.get(y.c2);he&&(ne.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_2D,he.colorAttachment.get()),ne.activeTexture.set(oe.TEXTURE1),ca(ne,ae).bind(oe.LINEAR,oe.CLAMP_TO_EDGE),W.useProgram("heatmapTexture").draw(ne,oe.TRIANGLES,ri.disabled,Li.disabled,W.colorModeForRenderPass(),ii.disabled,pd(W,ae,0,1),null,null,ae.id,W.viewportBuffer,W.quadTriangleIndexBuffer,W.viewportSegments,ae.paint,W.transform.zoom))}(C,k)}(t,c,f,x,S):y.ce(f)?function(C,P,k,O,N){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:U}=N,V=k.paint.get("line-opacity"),$=k.paint.get("line-width");if(V.constantOr(1)===0||$.constantOr(1)===0)return;const W=C.getDepthModeForSublayer(0,ri.ReadOnly),ae=C.colorModeForRenderPass(),ne=k.paint.get("line-dasharray"),oe=k.paint.get("line-pattern"),he=oe.constantOr(1),ge=k.paint.get("line-gradient"),de=k.getCrossfadeParameters(),xe=he?"linePattern":ne?"lineSDF":ge?"lineGradient":"line",Me=C.context,fe=Me.gl,ze=C.transform;let Ve=!0;for(const Ne of O){const Fe=P.getTile(Ne);if(he&&!Fe.patternsLoaded())continue;const He=Fe.getBucket(k);if(!He)continue;const gt=He.programConfigurations.get(k.id),yt=C.context.program.get(),st=C.useProgram(xe,gt),Bt=Ve||st.program!==yt,oi=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Ne),Gi=oe.constantOr(null);if(Gi&&Fe.imageAtlas){const mi=Fe.imageAtlas,_r=mi.patternPositions[Gi.to.toString()],Hr=mi.patternPositions[Gi.from.toString()];_r&&Hr&&gt.setConstantPatternPositions(_r,Hr)}const yr=ze.getProjectionData({overscaledTileID:Ne,applyGlobeMatrix:!U,applyTerrainMatrix:!0}),nr=ze.getPixelScale(),$r=he?Lu(C,Fe,k,nr,de):ne?Es(C,Fe,k,nr,ne,de):ge?Du(C,Fe,k,nr,He.lineClipsArray.length):Ru(C,Fe,k,nr);if(he)Me.activeTexture.set(fe.TEXTURE0),Fe.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),gt.updatePaintBuffers(de);else if(ne&&(Bt||C.lineAtlas.dirty))Me.activeTexture.set(fe.TEXTURE0),C.lineAtlas.bind(Me);else if(ge){const mi=He.gradients[k.id];let _r=mi.texture;if(k.gradientVersion!==mi.version){let Hr=256;if(k.stepInterpolant){const wn=P.getSource().maxzoom,gn=Ne.canonical.z===wn?Math.ceil(1<<C.transform.maxZoom-Ne.canonical.z):1;Hr=y.ah(y.c3(He.maxLineLength/y.$*1024*gn),256,Me.maxTextureSize)}mi.gradient=y.c4({expression:k.gradientExpression(),evaluationKey:"lineProgress",resolution:Hr,image:mi.gradient||void 0,clips:He.lineClipsArray}),mi.texture?mi.texture.update(mi.gradient):mi.texture=new y.T(Me,mi.gradient,fe.RGBA),mi.version=k.gradientVersion,_r=mi.texture}Me.activeTexture.set(fe.TEXTURE0),_r.bind(k.stepInterpolant?fe.NEAREST:fe.LINEAR,fe.CLAMP_TO_EDGE)}const jr=C.stencilModeForClipping(Ne);st.draw(Me,fe.TRIANGLES,W,jr,ae,ii.disabled,$r,oi,yr,k.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,k.paint,C.transform.zoom,gt,He.layoutVertexBuffer2),Ve=!1}}(t,c,f,x,S):y.cf(f)?function(C,P,k,O,N){const U=k.paint.get("fill-color"),V=k.paint.get("fill-opacity");if(V.constantOr(1)===0)return;const{isRenderingToTexture:$}=N,W=C.colorModeForRenderPass(),ae=k.paint.get("fill-pattern"),ne=C.opaquePassEnabledForLayer()&&!ae.constantOr(1)&&U.constantOr(y.bf.transparent).a===1&&V.constantOr(0)===1?"opaque":"translucent";if(C.renderPass===ne){const oe=C.getDepthModeForSublayer(1,C.renderPass==="opaque"?ri.ReadWrite:ri.ReadOnly);ds(C,P,k,O,oe,W,!1,$)}if(C.renderPass==="translucent"&&k.paint.get("fill-antialias")){const oe=C.getDepthModeForSublayer(k.getPaintProperty("fill-outline-color")?2:0,ri.ReadOnly);ds(C,P,k,O,oe,W,!0,$)}}(t,c,f,x,S):y.cg(f)?function(C,P,k,O,N){const U=k.paint.get("fill-extrusion-opacity");if(U===0)return;const{isRenderingToTexture:V}=N;if(C.renderPass==="translucent"){const $=new ri(C.context.gl.LEQUAL,ri.ReadWrite,C.depthRangeFor3D);if(U!==1||k.paint.get("fill-extrusion-pattern").constantOr(1))Io(C,P,k,O,$,Li.disabled,wr.disabled,V),Io(C,P,k,O,$,C.stencilModeFor3D(),C.colorModeForRenderPass(),V);else{const W=C.colorModeForRenderPass();Io(C,P,k,O,$,Li.disabled,W,V)}}}(t,c,f,x,S):y.ch(f)?function(C,P,k,O,N){if(C.renderPass!=="offscreen"&&C.renderPass!=="translucent")return;const{isRenderingToTexture:U}=N,V=C.context,$=C.style.projection.useSubdivision,W=C.getDepthModeForSublayer(0,ri.ReadOnly),ae=C.colorModeForRenderPass();if(C.renderPass==="offscreen")(function(ne,oe,he,ge,de,xe,Me){const fe=ne.context,ze=fe.gl;for(const Ve of he){const Ne=oe.getTile(Ve),Fe=Ne.dem;if(!Fe||!Fe.data||!Ne.needsHillshadePrepare)continue;const He=Fe.dim,gt=Fe.stride,yt=Fe.getPixels();if(fe.activeTexture.set(ze.TEXTURE1),fe.pixelStoreUnpackPremultiplyAlpha.set(!1),Ne.demTexture=Ne.demTexture||ne.getTileTexture(gt),Ne.demTexture){const Bt=Ne.demTexture;Bt.update(yt,{premultiply:!1}),Bt.bind(ze.NEAREST,ze.CLAMP_TO_EDGE)}else Ne.demTexture=new y.T(fe,yt,ze.RGBA,{premultiply:!1}),Ne.demTexture.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);fe.activeTexture.set(ze.TEXTURE0);let st=Ne.fbo;if(!st){const Bt=new y.T(fe,{width:He,height:He,data:null},ze.RGBA);Bt.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),st=Ne.fbo=fe.createFramebuffer(He,He,!0,!1),st.colorAttachment.set(Bt.texture)}fe.bindFramebuffer.set(st.framebuffer),fe.viewport.set([0,0,He,He]),ne.useProgram("hillshadePrepare").draw(fe,ze.TRIANGLES,de,xe,Me,ii.disabled,Ql(Ne.tileID,Fe),null,null,ge.id,ne.rasterBoundsBuffer,ne.quadTriangleIndexBuffer,ne.rasterBoundsSegments),Ne.needsHillshadePrepare=!1}})(C,P,O,k,W,Li.disabled,ae),V.viewport.set([0,0,C.width,C.height]);else if(C.renderPass==="translucent")if($){const[ne,oe,he]=C.stencilConfigForOverlapTwoPass(O);ko(C,P,k,he,ne,W,ae,!1,U),ko(C,P,k,he,oe,W,ae,!0,U)}else{const[ne,oe]=C.getStencilConfigForOverlapAndUpdateStencilID(O);ko(C,P,k,oe,ne,W,ae,!1,U)}}(t,c,f,x,S):y.ci(f)?function(C,P,k,O,N){if(C.renderPass!=="translucent"||!O.length)return;const{isRenderingToTexture:U}=N,V=C.style.projection.useSubdivision,$=C.getDepthModeForSublayer(0,ri.ReadOnly),W=C.colorModeForRenderPass();if(V){const[ae,ne,oe]=C.stencilConfigForOverlapTwoPass(O);ac(C,P,k,oe,ae,$,W,!1,U),ac(C,P,k,oe,ne,$,W,!0,U)}else{const[ae,ne]=C.getStencilConfigForOverlapAndUpdateStencilID(O);ac(C,P,k,ne,ae,$,W,!1,U)}}(t,c,f,x,S):y.cj(f)?function(C,P,k,O,N){if(C.renderPass!=="translucent"||k.paint.get("raster-opacity")===0||!O.length)return;const{isRenderingToTexture:U}=N,V=P.getSource(),$=C.style.projection.useSubdivision;if(V instanceof ns)ln(C,P,k,O,null,!1,!1,V.tileCoords,V.flippedWindingOrder,U);else if($){const[W,ae,ne]=C.stencilConfigForOverlapTwoPass(O);ln(C,P,k,ne,W,!1,!0,sc,!1,U),ln(C,P,k,ne,ae,!0,!0,sc,!1,U)}else{const[W,ae]=C.getStencilConfigForOverlapAndUpdateStencilID(O);ln(C,P,k,ae,W,!1,!0,sc,!1,U)}}(t,c,f,x,S):y.ck(f)?function(C,P,k,O,N){const U=k.paint.get("background-color"),V=k.paint.get("background-opacity");if(V===0)return;const{isRenderingToTexture:$}=N,W=C.context,ae=W.gl,ne=C.style.projection,oe=C.transform,he=oe.tileSize,ge=k.paint.get("background-pattern");if(C.isPatternMissing(ge))return;const de=!ge&&U.a===1&&V===1&&C.opaquePassEnabledForLayer()?"opaque":"translucent";if(C.renderPass!==de)return;const xe=Li.disabled,Me=C.getDepthModeForSublayer(0,de==="opaque"?ri.ReadWrite:ri.ReadOnly),fe=C.colorModeForRenderPass(),ze=C.useProgram(ge?"backgroundPattern":"background"),Ve=O||ke(oe,{tileSize:he,terrain:C.style.map.terrain});ge&&(W.activeTexture.set(ae.TEXTURE0),C.imageManager.bind(C.context));const Ne=k.getCrossfadeParameters();for(const Fe of Ve){const He=oe.getProjectionData({overscaledTileID:Fe,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),gt=ge?nf(V,C,ge,{tileID:Fe,tileSize:he},Ne):Eh(V,U),yt=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Fe),st=ne.getMeshFromTileID(W,Fe.canonical,!1,!0,"raster");ze.draw(W,ae.TRIANGLES,Me,xe,fe,ii.backCCW,gt,yt,He,k.id,st.vertexBuffer,st.indexBuffer,st.segments)}}(t,0,f,x,S):y.cl(f)&&function(C,P,k,O){const{isRenderingGlobe:N}=O,U=C.context,V=k.implementation,$=C.style.projection,W=C.transform,ae=W.getProjectionDataForCustomLayer(N),ne={farZ:W.farZ,nearZ:W.nearZ,fov:W.fov*Math.PI/180,modelViewProjectionMatrix:W.modelViewProjectionMatrix,projectionMatrix:W.projectionMatrix,shaderData:{variantName:$.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${$.shaderPreludeCode.vertexSource}`,define:$.shaderDefine},defaultProjectionData:ae},oe=V.renderingMode?V.renderingMode:"2d";if(C.renderPass==="offscreen"){const he=V.prerender;he&&(C.setCustomLayerDefaults(),U.setColorMode(C.colorModeForRenderPass()),he.call(V,U.gl,ne),U.setDirty(),C.setBaseState())}else if(C.renderPass==="translucent"){C.setCustomLayerDefaults(),U.setColorMode(C.colorModeForRenderPass()),U.setStencilMode(Li.disabled);const he=oe==="3d"?C.getDepthModeFor3D():C.getDepthModeForSublayer(0,ri.ReadOnly);U.setDepthMode(he),V.render(U.gl,ne),U.setDirty(),C.setBaseState(),U.bindFramebuffer.set(null)}}(t,0,f,S))}saveTileTexture(t){const c=this._tileTextures[t.size[0]];c?c.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const c=this._tileTextures[t];return c&&c.length>0?c.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const c=this.imageManager.getPattern(t.from.toString()),f=this.imageManager.getPattern(t.to.toString());return!c||!f}useProgram(t,c,f=!1,x=[]){this.cache=this.cache||{};const S=!!this.style.map.terrain,C=this.style.projection,P=f?Sa.projectionMercator:C.shaderPreludeCode,k=f?fo:C.shaderDefine,O=t+(c?c.cacheKey:"")+`/${f?po:C.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(S?"/terrain":"")+(x?`/${x.join("/")}`:"");return this.cache[O]||(this.cache[O]=new wo(this.context,Sa[t],c,la[t],this._showOverdrawInspector,S,P,k,x)),this.cache[O]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:c}=this.context.gl;return this.width!==t||this.height!==c}}function Ca(b,t){let c,f=!1,x=null,S=null;const C=()=>{x=null,f&&(b.apply(S,c),x=setTimeout(C,t),f=!1)};return(...P)=>(f=!0,S=this,c=P,x||C(),x)}class Ea{constructor(t){this._getCurrentHash=()=>{const c=window.location.hash.replace("#","");if(this._hashName){let f;return c.split("&").map(x=>x.split("=")).forEach(x=>{x[0]===this._hashName&&(f=x)}),(f&&f[1]||"").split("/")}return c.split("/")},this._onHashChange=()=>{const c=this._getCurrentHash();if(!this._isValidHash(c))return!1;const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:f,pitch:+(c[4]||0)}),!0},this._updateHashUnthrottled=()=>{const c=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,c)},this._removeHash=()=>{const c=this._getCurrentHash();if(c.length===0)return;const f=c.join("/");let x=f;x.split("&").length>0&&(x=x.split("&")[0]),this._hashName&&(x=`${this._hashName}=${f}`);let S=window.location.hash.replace(x,"");S.startsWith("#&")?S=S.slice(0,1)+S.slice(2):S==="#"&&(S="");let C=window.location.href.replace(/(#.+)?$/,S);C=C.replace("&&","&"),window.history.replaceState(window.history.state,null,C)},this._updateHash=Ca(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const c=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,x=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,x),C=Math.round(c.lng*S)/S,P=Math.round(c.lat*S)/S,k=this._map.getBearing(),O=this._map.getPitch();let N="";if(N+=t?`/${C}/${P}/${f}`:`${f}/${P}/${C}`,(k||O)&&(N+="/"+Math.round(10*k)/10),O&&(N+=`/${Math.round(O)}`),this._hashName){const U=this._hashName;let V=!1;const $=window.location.hash.slice(1).split("&").map(W=>{const ae=W.split("=")[0];return ae===U?(V=!0,`${ae}=${N}`):W}).filter(W=>W);return V||$.push(`${U}=${N}`),`#${$.join("&")}`}return`#${N}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new y.S(+t[2],+t[1])}catch{return!1}const c=+t[0],f=+(t[3]||0),x=+(t[4]||0);return c>=this._map.getMinZoom()&&c<=this._map.getMaxZoom()&&f>=-180&&f<=180&&x>=this._map.getMinPitch()&&x<=this._map.getMaxPitch()}}const Bn={linearity:.3,easing:y.cm(0,0,.3,1)},Ps=y.e({deceleration:2500,maxSpeed:1400},Bn),Wc=y.e({deceleration:20,maxSpeed:1400},Bn),kh=y.e({deceleration:1e3,maxSpeed:360},Bn),Kc=y.e({deceleration:1e3,maxSpeed:90},Bn),Qc=y.e({deceleration:1e3,maxSpeed:360},Bn);class Ws{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Le.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,c=Le.now();for(;t.length>0&&c-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,roll:0,pan:new y.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)c.zoom+=S.zoomDelta||0,c.bearing+=S.bearingDelta||0,c.pitch+=S.pitchDelta||0,c.roll+=S.rollDelta||0,S.panDelta&&c.pan._add(S.panDelta),S.around&&(c.around=S.around),S.pinchAround&&(c.pinchAround=S.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(c.pan.mag()){const S=Ro(c.pan.mag(),f,y.e({},Ps,t||{})),C=c.pan.mult(S.amount/c.pan.mag()),P=this._map.cameraHelper.handlePanInertia(C,this._map.transform);x.center=P.easingCenter,x.offset=P.easingOffset,Cr(x,S)}if(c.zoom){const S=Ro(c.zoom,f,Wc);x.zoom=this._map.transform.zoom+S.amount,Cr(x,S)}if(c.bearing){const S=Ro(c.bearing,f,kh);x.bearing=this._map.transform.bearing+y.ah(S.amount,-179,179),Cr(x,S)}if(c.pitch){const S=Ro(c.pitch,f,Kc);x.pitch=this._map.transform.pitch+S.amount,Cr(x,S)}if(c.roll){const S=Ro(c.roll,f,Qc);x.roll=this._map.transform.roll+y.ah(S.amount,-179,179),Cr(x,S)}if(x.zoom||x.bearing){const S=c.pinchAround===void 0?c.around:c.pinchAround;x.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),y.e(x,{noMoveStart:!0})}}function Cr(b,t){(!b.duration||b.duration<t.duration)&&(b.duration=t.duration,b.easing=t.easing)}function Ro(b,t,c){const{maxSpeed:f,linearity:x,deceleration:S}=c,C=y.ah(b*x/(t/1e3),-f,f),P=Math.abs(C)/(S*x);return{easing:c.easing,duration:1e3*P,amount:C*(P/2)}}class Qn extends y.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,c,f,x={}){f=f instanceof MouseEvent?f:new MouseEvent(t,f);const S=Se.mousePos(c.getCanvas(),f),C=c.unproject(S);super(t,y.e({point:S,lngLat:C,originalEvent:f},x)),this._defaultPrevented=!1,this.target=c}}class Jc extends y.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,c,f){const x=t==="touchend"?f.changedTouches:f.touches,S=Se.touchPos(c.getCanvasContainer(),x),C=S.map(k=>c.unproject(k)),P=S.reduce((k,O,N,U)=>k.add(O.div(U.length)),new y.P(0,0));super(t,{points:S,point:P,lngLats:C,lngLat:c.unproject(P),originalEvent:f}),this._defaultPrevented=!1}}class _d extends y.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,c,f){super(t,{originalEvent:f}),this._defaultPrevented=!1}}class Ks{constructor(t,c){this._map=t,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new _d(t.type,this._map,t))}mousedown(t,c){return this._mousedownPos=c,this._firePreventable(new Qn(t.type,this._map,t))}mouseup(t){this._map.fire(new Qn(t.type,this._map,t))}click(t,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||this._map.fire(new Qn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Qn(t.type,this._map,t))}mouseover(t){this._map.fire(new Qn(t.type,this._map,t))}mouseout(t){this._map.fire(new Qn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Jc(t.type,this._map,t))}touchmove(t){this._map.fire(new Jc(t.type,this._map,t))}touchend(t){this._map.fire(new Jc(t.type,this._map,t))}touchcancel(t){this._map.fire(new Jc(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vi{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Qn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Qn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Is{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(y.P.convert(t),this._map.terrain)}}class Do{constructor(t,c){this._map=t,this._tr=new Is(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,c){this.isEnabled()&&t.shiftKey&&t.button===0&&(Se.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(t,c){if(!this._active)return;const f=c;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=f,this._box||(this._box=Se.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const S=Math.min(x.x,f.x),C=Math.max(x.x,f.x),P=Math.min(x.y,f.y),k=Math.max(x.y,f.y);Se.setTransform(this._box,`translate(${S}px,${P}px)`),this._box.style.width=C-S+"px",this._box.style.height=k-P+"px"}mouseupWindow(t,c){if(!this._active||t.button!==0)return;const f=this._startPos,x=c;if(this.reset(),Se.suppressClick(),f.x!==x.x||f.y!==x.y)return this._map.fire(new y.l("boxzoomend",{originalEvent:t})),{cameraAnimation:S=>S.fitScreenCoordinates(f,x,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Se.remove(this._box),this._box=null),Se.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,c){return this._map.fire(new y.l(t,{originalEvent:c}))}}function Qs(b,t){if(b.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${b.length}, points ${t.length}`);const c={};for(let f=0;f<b.length;f++)c[b[f].identifier]=t[f];return c}class Uu{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,c,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),f.length===this.numTouches&&(this.centroid=function(x){const S=new y.P(0,0);for(const C of x)S._add(C);return S.div(x.length)}(c),this.touches=Qs(f,c)))}touchmove(t,c,f){if(this.aborted||!this.centroid)return;const x=Qs(f,c);for(const S in this.touches){const C=x[S];(!C||C.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(t,c,f){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class bn{constructor(t){this.singleTap=new Uu(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,c,f){this.singleTap.touchstart(t,c,f)}touchmove(t,c,f){this.singleTap.touchmove(t,c,f)}touchend(t,c,f){const x=this.singleTap.touchend(t,c,f);if(x){const S=t.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(x)<30;if(S&&C||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Jn{constructor(t){this._tr=new Is(t),this._zoomIn=new bn({numTouches:1,numTaps:2}),this._zoomOut=new bn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,c,f){this._zoomIn.touchstart(t,c,f),this._zoomOut.touchstart(t,c,f)}touchmove(t,c,f){this._zoomIn.touchmove(t,c,f),this._zoomOut.touchmove(t,c,f)}touchend(t,c,f){const x=this._zoomIn.touchend(t,c,f),S=this._zoomOut.touchend(t,c,f),C=this._tr;return x?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:C.zoom+1,around:C.unproject(x)},{originalEvent:t})}):S?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:C.zoom-1,around:C.unproject(S)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ha{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const c=this._moveFunction(...t);if(c.bearingDelta||c.pitchDelta||c.rollDelta||c.around||c.panDelta)return this._active=!0,c}dragStart(t,c){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(c)?c[0]:c,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,c){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const x=Array.isArray(c)?c[0]:c;return!this._moved&&x.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=x,this._move(f,x))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Se.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const da=0,Ft=2,Qt={[da]:1,[Ft]:2};class za{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const c=Se.mouseButton(t);this._eventButton=c}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(c,f){const x=Qt[f];return c.buttons===void 0||(c.buttons&x)!==x}(t,this._eventButton)}isValidEndEvent(t){return Se.mouseButton(t)===this._eventButton}}class Gu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class oc{constructor(t=new za({checkCorrectEvent:()=>!0}),c=new Gu){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=c}_executeRelevantHandler(t,c,f){return t instanceof MouseEvent?c(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?f(t):void 0}startMove(t){this._executeRelevantHandler(t,c=>this.mouseMoveStateManager.startMove(c),c=>this.oneFingerTouchMoveStateManager.startMove(c))}endMove(t){this._executeRelevantHandler(t,c=>this.mouseMoveStateManager.endMove(c),c=>this.oneFingerTouchMoveStateManager.endMove(c))}isValidStartEvent(t){return this._executeRelevantHandler(t,c=>this.mouseMoveStateManager.isValidStartEvent(c),c=>this.oneFingerTouchMoveStateManager.isValidStartEvent(c))}isValidMoveEvent(t){return this._executeRelevantHandler(t,c=>this.mouseMoveStateManager.isValidMoveEvent(c),c=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(c))}isValidEndEvent(t){return this._executeRelevantHandler(t,c=>this.mouseMoveStateManager.isValidEndEvent(c),c=>this.oneFingerTouchMoveStateManager.isValidEndEvent(c))}}const Pn=b=>{b.mousedown=b.dragStart,b.mousemoveWindow=b.dragMove,b.mouseup=b.dragEnd,b.contextmenu=t=>{t.preventDefault()}};class Js{constructor(t,c){this._clickTolerance=t.clickTolerance||1,this._map=c,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new y.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,c,f){return this._calculateTransform(t,c,f)}touchmove(t,c,f){if(this._active){if(!this._shouldBePrevented(f.length))return t.preventDefault(),this._calculateTransform(t,c,f);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,c,f){this._calculateTransform(t,c,f),this._active&&this._shouldBePrevented(f.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,c,f){f.length>0&&(this._active=!0);const x=Qs(f,c),S=new y.P(0,0),C=new y.P(0,0);let P=0;for(const O in x){const N=x[O],U=this._touches[O];U&&(S._add(N),C._add(N.sub(U)),P++,x[O]=N)}if(this._touches=x,this._shouldBePrevented(P)||!C.mag())return;const k=C.div(P);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(P),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,c,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([c[0],c[1]]))}touchmove(t,c,f){if(!this._firstTwoTouches)return;t.preventDefault();const[x,S]=this._firstTwoTouches,C=At(f,c,x),P=At(f,c,S);if(!C||!P)return;const k=this._aroundCenter?null:C.add(P).div(2);return this._move([C,P],k,t)}touchend(t,c,f){if(!this._firstTwoTouches)return;const[x,S]=this._firstTwoTouches,C=At(f,c,x),P=At(f,c,S);C&&P||(this._active&&Se.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function At(b,t,c){for(let f=0;f<b.length;f++)if(b[f].identifier===c)return t[f]}function Lo(b,t){return Math.log(b/t)/Math.LN2}class Er extends cn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,c){const f=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Lo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Lo(this._distance,f),pinchAround:c}}}function Fr(b,t){return 180*b.angleWith(t)/Math.PI}class xl extends cn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,c,f){const x=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Fr(this._vector,x),pinchAround:c}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const c=25/(Math.PI*this._minDiameter)*360,f=Fr(t,this._startVector);return Math.abs(f)<c}}function fa(b){return Math.abs(b.y)>Math.abs(b.x)}class lc extends cn{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,c,f){super.touchstart(t,c,f),this._currentTouchCount=f.length}_start(t){this._lastPoints=t,fa(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,c,f){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const x=t[0].sub(this._lastPoints[0]),S=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(x,S,f.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(x.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(t,c,f){if(this._valid!==void 0)return this._valid;const x=t.mag()>=2,S=c.mag()>=2;if(!x&&!S)return;if(!x||!S)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const C=t.y>0==c.y>0;return fa(t)&&fa(c)&&C}}const ki={panStep:100,bearingStep:15,pitchStep:10};class Xa{constructor(t){this._tr=new Is(t);const c=ki;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let c=0,f=0,x=0,S=0,C=0;switch(t.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:t.shiftKey?f=-1:(t.preventDefault(),S=-1);break;case 39:t.shiftKey?f=1:(t.preventDefault(),S=1);break;case 38:t.shiftKey?x=1:(t.preventDefault(),C=-1);break;case 40:t.shiftKey?x=-1:(t.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(f=0,x=0),{cameraAnimation:P=>{const k=this._tr;P.easeTo({duration:300,easeId:"keyboardHandler",easing:qu,zoom:c?Math.round(k.zoom)+c*(t.shiftKey?2:1):k.zoom,bearing:k.bearing+f*this._bearingStep,pitch:k.pitch+x*this._pitchStep,offset:[-S*this._panStep,-C*this._panStep],center:k.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function qu(b){return b*(2-b)}const eo=4.000244140625,to=1/450;class ks{constructor(t,c){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=t,this._tr=new Is(t),this._triggerRenderFrame=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=to}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let c=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const f=Le.now(),x=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,c!==0&&c%eo==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(x*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),t.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=t,this._delta-=c,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Se.mousePos(this._map.getCanvas(),t),f=this._tr;this._aroundPoint=this._aroundCenter?f.transform.locationToScreenPoint(y.S.convert(f.center)):c,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const P=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=P),typeof this._targetZoom=="number"&&(this._targetZoom+=P)}if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>eo?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&k!==0&&(k=1/k);const O=typeof this._targetZoom!="number"?t.scale:y.af(this._targetZoom);this._targetZoom=t.getConstrained(t.getCameraLngLat(),y.ak(O*k)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const c=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,f=this._startZoom,x=this._easing;let S,C=!1;if(this._type==="wheel"&&f&&x){const P=Le.now()-this._lastWheelEventTime,k=Math.min((P+5)/200,1),O=x(k);S=y.C.number(f,c,O),k<1?this._frameId||(this._frameId=!0):C=!0}else S=c,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=S,{noInertia:!0,needsRenderFrame:!C,zoomDelta:S-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let c=y.co;if(this._prevEase){const f=this._prevEase,x=(Le.now()-f.start)/f.duration,S=f.easing(x+.01)-f.easing(x),C=.27/Math.sqrt(S*S+1e-4)*.01,P=Math.sqrt(.0729-C*C);c=y.cm(C,P,.25,1)}return this._prevEase={start:Le.now(),duration:t,easing:c},c}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Bo{constructor(t,c){this._clickZoom=t,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class cc{constructor(t){this._tr=new Is(t),this.reset()}reset(){this._active=!1}dblclick(t,c){return t.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(c)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class eu{constructor(){this._tap=new bn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,c,f){if(!this._swipePoint)if(this._tapTime){const x=c[0],S=t.timeStamp-this._tapTime<500,C=this._tapPoint.dist(x)<30;S&&C?f.length>0&&(this._swipePoint=x,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(t,c,f)}touchmove(t,c,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const x=c[0],S=x.y-this._swipePoint.y;return this._swipePoint=x,t.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(t,c,f)}touchend(t,c,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const x=this._tap.touchend(t,c,f);x&&(this._tapTime=t.timeStamp,this._tapPoint=x)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vl{constructor(t,c,f){this._el=t,this._mousePan=c,this._touchPan=f}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class bl{constructor(t,c,f,x){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=c,this._mousePitch=f,this._mouseRoll=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Zu{constructor(t,c,f,x){this._el=t,this._touchZoom=c,this._touchRotate=f,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class $u{constructor(t,c){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=c,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=Se.create("div","maplibregl-cooperative-gesture-screen",t);let c=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(c=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const f=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),x=document.createElement("div");x.className="maplibregl-desktop-message",x.textContent=c,this._container.appendChild(x);const S=document.createElement("div");S.className="maplibregl-mobile-message",S.textContent=f,this._container.appendChild(S),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Se.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,c){this._enabled&&(this._map.fire(new y.l("cooperativegestureprevented",{gestureType:t,originalEvent:c})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const On=b=>b.zoom||b.drag||b.roll||b.pitch||b.rotate;class rr extends y.l{}function io(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta||b.rollDelta}class uc{constructor(t,c){this.handleWindowEvent=x=>{this.handleEvent(x,`${x.type}Window`)},this.handleEvent=(x,S)=>{if(x.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const C=x.type==="renderFrame"?void 0:x,P={needsRenderFrame:!1},k={},O={};for(const{handlerName:V,handler:$,allowed:W}of this._handlers){if(!$.isEnabled())continue;let ae;if(this._blockedByActive(O,W,V))$.reset();else if($[S||x.type]){if(y.cp(x,S||x.type)){const ne=Se.mousePos(this._map.getCanvas(),x);ae=$[S||x.type](x,ne)}else if(y.cq(x,S||x.type)){const ne=this._getMapTouches(x.touches),oe=Se.touchPos(this._map.getCanvas(),ne);ae=$[S||x.type](x,oe,ne)}else y.cr(S||x.type)||(ae=$[S||x.type](x));this.mergeHandlerResult(P,k,ae,V,C),ae&&ae.needsRenderFrame&&this._triggerRenderFrame()}(ae||$.isActive())&&(O[V]=$)}const N={};for(const V in this._previousActiveHandlers)O[V]||(N[V]=C);this._previousActiveHandlers=O,(Object.keys(N).length||io(P))&&(this._changes.push([P,k,N]),this._triggerRenderFrame()),(Object.keys(O).length||io(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=P;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ws(t),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(c);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,S,C]of this._listeners)Se.addEventListener(x,S,x===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[t,c,f]of this._listeners)Se.removeEventListener(t,c,t===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(t){const c=this._map,f=c.getCanvasContainer();this._add("mapEvent",new Ks(c,t));const x=c.boxZoom=new Do(c,t);this._add("boxZoom",x),t.interactive&&t.boxZoom&&x.enable();const S=c.cooperativeGestures=new $u(c,t.cooperativeGestures);this._add("cooperativeGestures",S),t.cooperativeGestures&&S.enable();const C=new Jn(c),P=new cc(c);c.doubleClickZoom=new Bo(P,C),this._add("tapZoom",C),this._add("clickZoom",P),t.interactive&&t.doubleClickZoom&&c.doubleClickZoom.enable();const k=new eu;this._add("tapDragZoom",k);const O=c.touchPitch=new lc(c);this._add("touchPitch",O),t.interactive&&t.touchPitch&&c.touchPitch.enable(t.touchPitch);const N=()=>c.project(c.getCenter()),U=function({enable:de,clickTolerance:xe,aroundCenter:Me=!0,minPixelCenterThreshold:fe=100,rotateDegreesPerPixelMoved:ze=.8},Ve){const Ne=new za({checkCorrectEvent:Fe=>Se.mouseButton(Fe)===0&&Fe.ctrlKey||Se.mouseButton(Fe)===2&&!Fe.ctrlKey});return new ha({clickTolerance:xe,move:(Fe,He)=>{const gt=Ve();if(Me&&Math.abs(gt.y-Fe.y)>fe)return{bearingDelta:y.cn(new y.P(Fe.x,He.y),He,gt)};let yt=(He.x-Fe.x)*ze;return Me&&He.y<gt.y&&(yt=-yt),{bearingDelta:yt}},moveStateManager:Ne,enable:de,assignEvents:Pn})}(t,N),V=function({enable:de,clickTolerance:xe,pitchDegreesPerPixelMoved:Me=-.5}){const fe=new za({checkCorrectEvent:ze=>Se.mouseButton(ze)===0&&ze.ctrlKey||Se.mouseButton(ze)===2});return new ha({clickTolerance:xe,move:(ze,Ve)=>({pitchDelta:(Ve.y-ze.y)*Me}),moveStateManager:fe,enable:de,assignEvents:Pn})}(t),$=function({enable:de,clickTolerance:xe,rollDegreesPerPixelMoved:Me=.3},fe){const ze=new za({checkCorrectEvent:Ve=>Se.mouseButton(Ve)===2&&Ve.ctrlKey});return new ha({clickTolerance:xe,move:(Ve,Ne)=>{const Fe=fe();let He=(Ne.x-Ve.x)*Me;return Ne.y<Fe.y&&(He=-He),{rollDelta:He}},moveStateManager:ze,enable:de,assignEvents:Pn})}(t,N);c.dragRotate=new bl(t,U,V,$),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",V,["mouseRotate","mouseRoll"]),this._add("mouseRoll",$,["mousePitch"]),t.interactive&&t.dragRotate&&c.dragRotate.enable();const W=function({enable:de,clickTolerance:xe}){const Me=new za({checkCorrectEvent:fe=>Se.mouseButton(fe)===0&&!fe.ctrlKey});return new ha({clickTolerance:xe,move:(fe,ze)=>({around:ze,panDelta:ze.sub(fe)}),activateOnStart:!0,moveStateManager:Me,enable:de,assignEvents:Pn})}(t),ae=new Js(t,c);c.dragPan=new vl(f,W,ae),this._add("mousePan",W),this._add("touchPan",ae,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&c.dragPan.enable(t.dragPan);const ne=new xl,oe=new Er;c.touchZoomRotate=new Zu(f,oe,ne,k),this._add("touchRotate",ne,["touchPan","touchZoom"]),this._add("touchZoom",oe,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&c.touchZoomRotate.enable(t.touchZoomRotate);const he=c.scrollZoom=new ks(c,()=>this._triggerRenderFrame());this._add("scrollZoom",he,["mousePan"]),t.interactive&&t.scrollZoom&&c.scrollZoom.enable(t.scrollZoom);const ge=c.keyboard=new Xa(c);this._add("keyboard",ge),t.interactive&&t.keyboard&&c.keyboard.enable(),this._add("blockableMapEvent",new vi(c))}_add(t,c,f){this._handlers.push({handlerName:t,handler:c,allowed:f}),this._handlersById[t]=c}stop(t){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!On(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,c,f){for(const x in t)if(x!==f&&(!c||c.indexOf(x)<0))return!0;return!1}_getMapTouches(t){const c=[];for(const f of t)this._el.contains(f.target)&&c.push(f);return c}mergeHandlerResult(t,c,f,x,S){if(!f)return;y.e(t,f);const C={handlerName:x,originalEvent:f.originalEvent||S};f.zoomDelta!==void 0&&(c.zoom=C),f.panDelta!==void 0&&(c.drag=C),f.rollDelta!==void 0&&(c.roll=C),f.pitchDelta!==void 0&&(c.pitch=C),f.bearingDelta!==void 0&&(c.rotate=C)}_applyChanges(){const t={},c={},f={};for(const[x,S,C]of this._changes)x.panDelta&&(t.panDelta=(t.panDelta||new y.P(0,0))._add(x.panDelta)),x.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+x.pitchDelta),x.rollDelta&&(t.rollDelta=(t.rollDelta||0)+x.rollDelta),x.around!==void 0&&(t.around=x.around),x.pinchAround!==void 0&&(t.pinchAround=x.pinchAround),x.noInertia&&(t.noInertia=x.noInertia),y.e(c,S),y.e(f,C);this._updateMapTransform(t,c,f),this._changes=[]}_updateMapTransform(t,c,f){const x=this._map,S=x._getTransformForUpdate(),C=x.terrain;if(!(io(t)||C&&this._terrainMovement))return this._fireEvents(c,f,!0);x._stop(!0);let{panDelta:P,zoomDelta:k,bearingDelta:O,pitchDelta:N,rollDelta:U,around:V,pinchAround:$}=t;$!==void 0&&(V=$),V=V||x.transform.centerPoint,C&&!S.isPointOnMapSurface(V)&&(V=S.centerPoint);const W={panDelta:P,zoomDelta:k,rollDelta:U,pitchDelta:N,bearingDelta:O,around:V};this._map.cameraHelper.useGlobeControls&&!S.isPointOnMapSurface(V)&&(V=S.centerPoint);const ae=V.distSqr(S.centerPoint)<.01?S.center:S.screenPointToLocation(P?V.sub(P):V);C?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(W,S),this._terrainMovement||!c.drag&&!c.zoom?c.drag&&this._terrainMovement?S.setCenter(S.screenPointToLocation(S.centerPoint.sub(P))):this._map.cameraHelper.handleMapControlsPan(W,S,ae):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(W,S,ae))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(W,S),this._map.cameraHelper.handleMapControlsPan(W,S,ae)),x._applyUpdatedTransform(S),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(c,f,!0)}_fireEvents(t,c,f){const x=On(this._eventsInProgress),S=On(t),C={};for(const U in t){const{originalEvent:V}=t[U];this._eventsInProgress[U]||(C[`${U}start`]=V),this._eventsInProgress[U]=t[U]}!x&&S&&this._fireEvent("movestart",S.originalEvent);for(const U in C)this._fireEvent(U,C[U]);S&&this._fireEvent("move",S.originalEvent);for(const U in t){const{originalEvent:V}=t[U];this._fireEvent(U,V)}const P={};let k;for(const U in this._eventsInProgress){const{handlerName:V,originalEvent:$}=this._eventsInProgress[U];this._handlersById[V].isActive()||(delete this._eventsInProgress[U],k=c[V]||$,P[`${U}end`]=k)}for(const U in P)this._fireEvent(U,P[U]);const O=On(this._eventsInProgress),N=(x||S)&&!O;if(N&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const U=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&U.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(U)}if(f&&N){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;!U||!U.essential&&Le.prefersReducedMotion?(this._map.fire(new y.l("moveend",{originalEvent:k})),V(this._map.getBearing())&&this._map.resetNorth()):(V(U.bearing||this._map.getBearing())&&(U.bearing=0),U.freezeElevation=!0,this._map.easeTo(U,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(t,c){this._map.fire(new y.l(t,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new rr("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class tu extends y.E{constructor(t,c,f){super(),this._renderFrameCallback=()=>{const x=Math.min((Le.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(x)),x<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=f.bearingSnap,this.cameraHelper=c,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(t,c){t.apply(this.transform),this.transform=t,this.cameraHelper=c}getCenter(){return new y.S(this.transform.center.lng,this.transform.center.lat)}setCenter(t,c){return this.jumpTo({center:t},c)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,c){return this.jumpTo({elevation:t},c),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,c,f){return t=y.P.convert(t).mult(-1),this.panTo(this.transform.center,y.e({offset:t},c),f)}panTo(t,c,f){return this.easeTo(y.e({center:t},c),f)}getZoom(){return this.transform.zoom}setZoom(t,c){return this.jumpTo({zoom:t},c),this}zoomTo(t,c,f){return this.easeTo(y.e({zoom:t},c),f)}zoomIn(t,c){return this.zoomTo(this.getZoom()+1,t,c),this}zoomOut(t,c){return this.zoomTo(this.getZoom()-1,t,c),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,c){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new y.l("movestart",c)).fire(new y.l("move",c)).fire(new y.l("moveend",c))),this}getBearing(){return this.transform.bearing}setBearing(t,c){return this.jumpTo({bearing:t},c),this}getPadding(){return this.transform.padding}setPadding(t,c){return this.jumpTo({padding:t},c),this}rotateTo(t,c,f){return this.easeTo(y.e({bearing:t},c),f)}resetNorth(t,c){return this.rotateTo(0,y.e({duration:1e3},t),c),this}resetNorthPitch(t,c){return this.easeTo(y.e({bearing:0,pitch:0,roll:0,duration:1e3},t),c),this}snapToNorth(t,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,c):this}getPitch(){return this.transform.pitch}setPitch(t,c){return this.jumpTo({pitch:t},c),this}getRoll(){return this.transform.roll}setRoll(t,c){return this.jumpTo({roll:t},c),this}cameraForBounds(t,c){t=xi.convert(t).adjustAntiMeridian();const f=c&&c.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),f,c)}_cameraForBoxAndBearing(t,c,f,x){const S={top:0,bottom:0,right:0,left:0};if(typeof(x=y.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},x)).padding=="number"){const O=x.padding;x.padding={top:O,bottom:O,right:O,left:O}}const C=y.e(S,x.padding);x.padding=C;const P=this.transform,k=new xi(t,c);return this.cameraHelper.cameraForBoxAndBearing(x,C,k,f,P)}fitBounds(t,c,f){return this._fitInternal(this.cameraForBounds(t,c),c,f)}fitScreenCoordinates(t,c,f,x,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(y.P.convert(t)),this.transform.screenPointToLocation(y.P.convert(c)),f,x),x,S)}_fitInternal(t,c,f){return t?(delete(c=y.e(t,c)).padding,c.linear?this.easeTo(c,f):this.flyTo(c,f)):this}jumpTo(t,c){this.stop();const f=this._getTransformForUpdate();let x=!1,S=!1,C=!1;const P=f.zoom;this.cameraHelper.handleJumpToCenterZoom(f,t);const k=f.zoom!==P;return"elevation"in t&&f.elevation!==+t.elevation&&f.setElevation(+t.elevation),"bearing"in t&&f.bearing!==+t.bearing&&(x=!0,f.setBearing(+t.bearing)),"pitch"in t&&f.pitch!==+t.pitch&&(S=!0,f.setPitch(+t.pitch)),"roll"in t&&f.roll!==+t.roll&&(C=!0,f.setRoll(+t.roll)),t.padding==null||f.isPaddingEqual(t.padding)||f.setPadding(t.padding),this._applyUpdatedTransform(f),this.fire(new y.l("movestart",c)).fire(new y.l("move",c)),k&&this.fire(new y.l("zoomstart",c)).fire(new y.l("zoom",c)).fire(new y.l("zoomend",c)),x&&this.fire(new y.l("rotatestart",c)).fire(new y.l("rotate",c)).fire(new y.l("rotateend",c)),S&&this.fire(new y.l("pitchstart",c)).fire(new y.l("pitch",c)).fire(new y.l("pitchend",c)),C&&this.fire(new y.l("rollstart",c)).fire(new y.l("roll",c)).fire(new y.l("rollend",c)),this.fire(new y.l("moveend",c))}calculateCameraOptionsFromTo(t,c,f,x=0){const S=y.a1.fromLngLat(t,c),C=y.a1.fromLngLat(f,x),P=C.x-S.x,k=C.y-S.y,O=C.z-S.z,N=Math.hypot(P,k,O);if(N===0)throw new Error("Can't calculate camera options with same From and To");const U=Math.hypot(P,k),V=y.ak(this.transform.cameraToCenterDistance/N/this.transform.tileSize),$=180*Math.atan2(P,-k)/Math.PI;let W=180*Math.acos(U/N)/Math.PI;return W=O<0?90-W:90+W,{center:C.toLngLat(),elevation:x,zoom:V,pitch:W,bearing:$}}calculateCameraOptionsFromCameraLngLatAltRotation(t,c,f,x,S){const C=this.transform.calculateCenterFromCameraLngLatAlt(t,c,f,x);return{center:C.center,elevation:C.elevation,zoom:C.zoom,bearing:f,pitch:x,roll:S}}easeTo(t,c){this._stop(!1,t.easeId),((t=y.e({offset:[0,0],duration:500,easing:y.co},t)).animate===!1||!t.essential&&Le.prefersReducedMotion)&&(t.duration=0);const f=this._getTransformForUpdate(),x=this.getBearing(),S=f.pitch,C=f.roll,P="bearing"in t?this._normalizeBearing(t.bearing,x):x,k="pitch"in t?+t.pitch:S,O="roll"in t?this._normalizeBearing(t.roll,C):C,N="padding"in t?t.padding:f.padding,U=y.P.convert(t.offset);let V,$;t.around&&(V=y.S.convert(t.around),$=f.locationToScreenPoint(V));const W={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ae=this.cameraHelper.handleEaseTo(f,{bearing:P,pitch:k,roll:O,padding:N,around:V,aroundPoint:$,offsetAsPoint:U,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||x!==P,this._pitching=this._pitching||k!==S,this._rolling=this._rolling||O!==C,this._padding=!f.isPaddingEqual(N),this._zooming=this._zooming||ae.isZooming,this._easeId=t.easeId,this._prepareEase(c,t.noMoveStart,W),this.terrain&&this._prepareElevation(ae.elevationCenter),this._ease(ne=>{ae.easeFunc(ne),this.terrain&&!t.freezeElevation&&this._updateElevation(ne),this._applyUpdatedTransform(f),this._fireMoveEvents(c)},ne=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(c,ne)},t),this}_prepareEase(t,c,f={}){this._moving=!0,c||f.moving||this.fire(new y.l("movestart",t)),this._zooming&&!f.zooming&&this.fire(new y.l("zoomstart",t)),this._rotating&&!f.rotating&&this.fire(new y.l("rotatestart",t)),this._pitching&&!f.pitching&&this.fire(new y.l("pitchstart",t)),this._rolling&&!f.rolling&&this.fire(new y.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const c=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&c!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(f-(c-(f*t+this._elevationStart))/(1-t)),this._elevationTarget=c}this.transform.setElevation(y.C.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const c=t.getCameraLngLat(),f=t.getCameraAltitude(),x=this.terrain?this.terrain.getElevationForLngLatZoom(c,t.zoom):0;if(f<x){const S=this.calculateCameraOptionsFromTo(c,x,t.center,t.elevation);return{pitch:S.pitch,zoom:S.zoom}}return{}}_applyUpdatedTransform(t){const c=[];if(c.push(x=>this._elevateCameraIfInsideTerrain(x)),this.transformCameraUpdate&&c.push(x=>this.transformCameraUpdate(x)),!c.length)return;const f=t.clone();for(const x of c){const S=f.clone(),{center:C,zoom:P,roll:k,pitch:O,bearing:N,elevation:U}=x(S);C&&S.setCenter(C),U!==void 0&&S.setElevation(U),P!==void 0&&S.setZoom(P),k!==void 0&&S.setRoll(k),O!==void 0&&S.setPitch(O),N!==void 0&&S.setBearing(N),f.apply(S)}this.transform.apply(f)}_fireMoveEvents(t){this.fire(new y.l("move",t)),this._zooming&&this.fire(new y.l("zoom",t)),this._rotating&&this.fire(new y.l("rotate",t)),this._pitching&&this.fire(new y.l("pitch",t)),this._rolling&&this.fire(new y.l("roll",t))}_afterEase(t,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId;const f=this._zooming,x=this._rotating,S=this._pitching,C=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,f&&this.fire(new y.l("zoomend",t)),x&&this.fire(new y.l("rotateend",t)),S&&this.fire(new y.l("pitchend",t)),C&&this.fire(new y.l("rollend",t)),this.fire(new y.l("moveend",t))}flyTo(t,c){if(!t.essential&&Le.prefersReducedMotion){const He=y.Q(t,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(He,c)}this.stop(),t=y.e({offset:[0,0],speed:1.2,curve:1.42,easing:y.co},t);const f=this._getTransformForUpdate(),x=f.bearing,S=f.pitch,C=f.roll,P=f.padding,k="bearing"in t?this._normalizeBearing(t.bearing,x):x,O="pitch"in t?+t.pitch:S,N="roll"in t?this._normalizeBearing(t.roll,C):C,U="padding"in t?t.padding:f.padding,V=y.P.convert(t.offset);let $=f.centerPoint.add(V);const W=f.screenPointToLocation($),ae=this.cameraHelper.handleFlyTo(f,{bearing:k,pitch:O,roll:N,padding:U,locationAtOffset:W,offsetAsPoint:V,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let ne=t.curve;const oe=Math.max(f.width,f.height),he=oe/ae.scaleOfZoom,ge=ae.pixelPathLength;typeof ae.scaleOfMinZoom=="number"&&(ne=Math.sqrt(oe/ae.scaleOfMinZoom/ge*2));const de=ne*ne;function xe(He){const gt=(he*he-oe*oe+(He?-1:1)*de*de*ge*ge)/(2*(He?he:oe)*de*ge);return Math.log(Math.sqrt(gt*gt+1)-gt)}function Me(He){return(Math.exp(He)-Math.exp(-He))/2}function fe(He){return(Math.exp(He)+Math.exp(-He))/2}const ze=xe(!1);let Ve=function(He){return fe(ze)/fe(ze+ne*He)},Ne=function(He){return oe*((fe(ze)*(Me(gt=ze+ne*He)/fe(gt))-Me(ze))/de)/ge;var gt},Fe=(xe(!0)-ze)/ne;if(Math.abs(ge)<2e-6||!isFinite(Fe)){if(Math.abs(oe-he)<1e-6)return this.easeTo(t,c);const He=he<oe?-1:1;Fe=Math.abs(Math.log(he/oe))/ne,Ne=()=>0,Ve=gt=>Math.exp(He*ne*gt)}return t.duration="duration"in t?+t.duration:1e3*Fe/("screenSpeed"in t?+t.screenSpeed/ne:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=x!==k,this._pitching=O!==S,this._rolling=N!==C,this._padding=!f.isPaddingEqual(U),this._prepareEase(c,!1),this.terrain&&this._prepareElevation(ae.targetCenter),this._ease(He=>{const gt=He*Fe,yt=1/Ve(gt),st=Ne(gt);this._rotating&&f.setBearing(y.C.number(x,k,He)),this._pitching&&f.setPitch(y.C.number(S,O,He)),this._rolling&&f.setRoll(y.C.number(C,N,He)),this._padding&&(f.interpolatePadding(P,U,He),$=f.centerPoint.add(V)),ae.easeFunc(He,yt,st,$),this.terrain&&!t.freezeElevation&&this._updateElevation(He),this._applyUpdatedTransform(f),this._fireMoveEvents(c)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(c)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,c){var f;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,c)}return t||(f=this.handlers)===null||f===void 0||f.stop(!1),this}_ease(t,c,f){f.animate===!1||f.duration===0?(t(1),c()):(this._easeStart=Le.now(),this._easeOptions=f,this._onEaseFrame=t,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,c){t=y.aO(t,-180,180);const f=Math.abs(t-c);return Math.abs(t-360-c)<f&&(t-=360),Math.abs(t+360-c)<f&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(y.S.convert(t),this.transform.tileZoom):null}}const fs={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class zi{constructor(t=fs){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=c=>{!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"&&c.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=Se.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Se.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Se.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Se.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,c){const f=this._map._getUIString(`AttributionControl.${c}`);t.title=f,t.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(x=>typeof x!="string"?"":x)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const c=this._map.style.sourceCaches;for(const x in c){const S=c[x];if(S.used||S.usedForTerrain){const C=S.getSource();C.attribution&&t.indexOf(C.attribution)<0&&t.push(C.attribution)}}t=t.filter(x=>String(x).trim()),t.sort((x,S)=>x.length-S.length),t=t.filter((x,S)=>{for(let C=S+1;C<t.length;C++)if(t[C].indexOf(x)>=0)return!1;return!0});const f=t.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,t.length?(this._innerContainer.innerHTML=Se.sanitize(f),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class cr{constructor(t={}){this._updateCompact=()=>{const c=this._container.children;if(c.length){const f=c[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=Se.create("div","maplibregl-ctrl");const c=Se.create("a","maplibregl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://maplibre.org/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Se.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class pr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const c=++this._id;return this._queue.push({callback:t,id:c,cancelled:!1}),c}remove(t){const c=this._currentlyRunning,f=c?this._queue.concat(c):this._queue;for(const x of f)if(x.id===t)return void(x.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const c=this._currentlyRunning=this._queue;this._queue=[];for(const f of c)if(!f.cancelled&&(f.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var wl=y.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class Ot extends y.E{constructor(t){super(),this._lastTilesetChange=Le.now(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,c){this.sourceCache.update(t,c),this._renderableTilesKeys=[];const f={};for(const x of ke(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:c,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))f[x.key]=!0,this._renderableTilesKeys.push(x.key),this._tiles[x.key]||(x.terrainRttPosMatrix32f=new Float64Array(16),y.bY(x.terrainRttPosMatrix32f,0,y.$,y.$,0,0,1),this._tiles[x.key]=new ba(x,this.tileSize),this._lastTilesetChange=Le.now());for(const x in this._tiles)f[x]||delete this._tiles[x]}freeRtt(t){for(const c in this._tiles){const f=this._tiles[c];(!t||f.tileID.equals(t)||f.tileID.isChildOf(t)||t.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,c){return c?this._getTerrainCoordsForTileRanges(t,c):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const c={};for(const f of this._renderableTilesKeys){const x=this._tiles[f].tileID,S=t.clone(),C=y.ba();if(x.canonical.equals(t.canonical))y.bY(C,0,y.$,y.$,0,0,1);else if(x.canonical.isChildOf(t.canonical)){const P=x.canonical.z-t.canonical.z,k=x.canonical.x-(x.canonical.x>>P<<P),O=x.canonical.y-(x.canonical.y>>P<<P),N=y.$>>P;y.bY(C,0,N,N,0,0,1),y.M(C,C,[-k*N,-O*N,0])}else{if(!t.canonical.isChildOf(x.canonical))continue;{const P=t.canonical.z-x.canonical.z,k=t.canonical.x-(t.canonical.x>>P<<P),O=t.canonical.y-(t.canonical.y>>P<<P),N=y.$>>P;y.bY(C,0,y.$,y.$,0,0,1),y.M(C,C,[k*N,O*N,0]),y.N(C,C,[1/2**P,1/2**P,0])}}S.terrainRttPosMatrix32f=new Float32Array(C),c[f]=S}return c}_getTerrainCoordsForTileRanges(t,c){const f={};for(const x of this._renderableTilesKeys){const S=this._tiles[x].tileID;if(!this._isWithinTileRanges(S,c))continue;const C=t.clone(),P=y.ba();if(S.canonical.z===t.canonical.z){const k=t.canonical.x-S.canonical.x,O=t.canonical.y-S.canonical.y;y.bY(P,0,y.$,y.$,0,0,1),y.M(P,P,[k*y.$,O*y.$,0])}else if(S.canonical.z>t.canonical.z){const k=S.canonical.z-t.canonical.z,O=S.canonical.x-(S.canonical.x>>k<<k),N=S.canonical.y-(S.canonical.y>>k<<k),U=t.canonical.x-(S.canonical.x>>k),V=t.canonical.y-(S.canonical.y>>k),$=y.$>>k;y.bY(P,0,$,$,0,0,1),y.M(P,P,[-O*$+U*y.$,-N*$+V*y.$,0])}else{const k=t.canonical.z-S.canonical.z,O=t.canonical.x-(t.canonical.x>>k<<k),N=t.canonical.y-(t.canonical.y>>k<<k),U=(t.canonical.x>>k)-S.canonical.x,V=(t.canonical.y>>k)-S.canonical.y,$=y.$<<k;y.bY(P,0,$,$,0,0,1),y.M(P,P,[O*y.$+U*$,N*y.$+V*$,0])}C.terrainRttPosMatrix32f=new Float32Array(P),f[x]=C}return f}getSourceTile(t,c){const f=this.sourceCache._source;let x=t.overscaledZ-this.deltaZoom;if(x>f.maxzoom&&(x=f.maxzoom),x<f.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(x).key);let S=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!S||!S.dem)&&c)for(;x>=f.minzoom&&(!S||!S.dem);)S=this.sourceCache.getTileByID(t.scaledTo(x--).key);return S}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,c){return c[t.canonical.z]&&t.canonical.x>=c[t.canonical.z].minTileX&&t.canonical.x<=c[t.canonical.z].maxTileX&&t.canonical.y>=c[t.canonical.z].minTileY&&t.canonical.y<=c[t.canonical.z].maxTileY}}class Ht{constructor(t,c,f){this._meshCache={},this.painter=t,this.sourceCache=new Ot(c),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,c,f,x=y.$){var S;if(!(c>=0&&c<x&&f>=0&&f<x))return 0;const C=this.getTerrainData(t),P=(S=C.tile)===null||S===void 0?void 0:S.dem;if(!P)return 0;const k=y.cs([],[c/x*y.$,f/x*y.$],C.u_terrain_matrix),O=[k[0]*P.dim,k[1]*P.dim],N=Math.floor(O[0]),U=Math.floor(O[1]),V=O[0]-N,$=O[1]-U;return P.get(N,U)*(1-V)*(1-$)+P.get(N+1,U)*V*(1-$)+P.get(N,U+1)*(1-V)*$+P.get(N+1,U+1)*V*$}getElevationForLngLatZoom(t,c){if(!y.ct(c,t.wrap()))return 0;const{tileID:f,mercatorX:x,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(t,c);return this.getElevation(f,x%y.$,S%y.$,y.$)}getElevation(t,c,f,x=y.$){return this.getDEMElevation(t,c,f,x)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const x=this.painter.context,S=new y.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new y.T(x,S,x.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new y.T(x,new y.R({width:1,height:1}),x.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=y.ag([])}const c=this.sourceCache.getSourceTile(t,!0);if(c&&c.dem&&(!c.demTexture||c.needsTerrainPrepare)){const x=this.painter.context;c.demTexture=this.painter.getTileTexture(c.dem.stride),c.demTexture?c.demTexture.update(c.dem.getPixels(),{premultiply:!1}):c.demTexture=new y.T(x,c.dem.getPixels(),x.gl.RGBA,{premultiply:!1}),c.demTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),c.needsTerrainPrepare=!1}const f=c&&c+c.tileID.key+t.key;if(f&&!this._demMatrixCache[f]){const x=this.sourceCache.sourceCache._source.maxzoom;let S=t.canonical.z-c.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=x?S=t.canonical.z-x:y.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=t.canonical.x-(t.canonical.x>>S<<S),P=t.canonical.y-(t.canonical.y>>S<<S),k=y.cu(new Float64Array(16),[1/(y.$<<S),1/(y.$<<S),0]);y.M(k,k,[C*y.$,P*y.$,0]),this._demMatrixCache[t.key]={matrix:k,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:c&&c.dem&&c.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:c&&c.dem&&c.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(c&&c.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:c}}getFramebuffer(t){const c=this.painter,f=c.width/devicePixelRatio,x=c.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===x||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new y.T(c.context,{width:f,height:x,data:null},c.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(c.context.gl.NEAREST,c.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new y.T(c.context,{width:f,height:x,data:null},c.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(c.context.gl.NEAREST,c.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=c.context.createFramebuffer(f,x,!0,!1),this._fbo.depthAttachment.set(c.context.createRenderbuffer(c.context.gl.DEPTH_COMPONENT16,f,x))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const c=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,C=0;S<this._coordsTextureSize;S++)for(let P=0;P<this._coordsTextureSize;P++,C+=4)c[C+0]=255&P,c[C+1]=255&S,c[C+2]=P>>8<<4|S>>8,c[C+3]=0;const f=new y.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(c.buffer)),x=new y.T(t,f,t.gl.RGBA,{premultiply:!1});return x.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=x,x}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const c=new Uint8Array(4),f=this.painter.context,x=f.gl,S=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),C=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),P=Math.round(this.painter.height/devicePixelRatio);f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),x.readPixels(S,P-C-1,1,1,x.RGBA,x.UNSIGNED_BYTE,c),f.bindFramebuffer.set(null);const k=c[0]+(c[2]>>4<<8),O=c[1]+((15&c[2])<<8),N=this.coordsIndex[255-c[3]],U=N&&this.sourceCache.getTileByID(N);if(!U)return null;const V=this._coordsTextureSize,$=(1<<U.tileID.canonical.z)*V;return new y.a1((U.tileID.canonical.x*V+k)/$+U.tileID.wrap,(U.tileID.canonical.y*V+O)/$,this.getElevation(U.tileID,k,O,V))}depthAtPoint(t){const c=new Uint8Array(4),f=this.painter.context,x=f.gl;return f.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),x.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,x.RGBA,x.UNSIGNED_BYTE,c),f.bindFramebuffer.set(null),(c[0]/16777216+c[1]/65536+c[2]/256+c[3])/256}getTerrainMesh(t){var c;const f=((c=this.painter.style.projection)===null||c===void 0?void 0:c.transitionState)>0,x=f&&t.canonical.y===0,S=f&&t.canonical.y===(1<<t.canonical.z)-1,C=`m_${x?"n":""}_${S?"s":""}`;if(this._meshCache[C])return this._meshCache[C];const P=this.painter.context,k=new y.cv,O=new y.aN,N=this.meshSize,U=y.$/N,V=N*N;for(let fe=0;fe<=N;fe++)for(let ze=0;ze<=N;ze++)k.emplaceBack(ze*U,fe*U,0);for(let fe=0;fe<V;fe+=N+1)for(let ze=0;ze<N;ze++)O.emplaceBack(ze+fe,N+ze+fe+1,N+ze+fe+2),O.emplaceBack(ze+fe,N+ze+fe+2,ze+fe+1);const $=k.length,W=$+(N+1),ae=(N+1)*N,ne=x?y.bh:0,oe=x?0:1,he=S?y.bi:y.$,ge=S?0:1;for(let fe=0;fe<=N;fe++)k.emplaceBack(fe*U,ne,oe);for(let fe=0;fe<=N;fe++)k.emplaceBack(fe*U,he,ge);for(let fe=0;fe<N;fe++)O.emplaceBack(ae+fe,W+fe,W+fe+1),O.emplaceBack(ae+fe,W+fe+1,ae+fe+1),O.emplaceBack(0+fe,$+fe+1,$+fe),O.emplaceBack(0+fe,0+fe+1,$+fe+1);const de=k.length,xe=de+2*(N+1);for(const fe of[0,1])for(let ze=0;ze<=N;ze++)for(const Ve of[0,1])k.emplaceBack(fe*y.$,ze*U,Ve);for(let fe=0;fe<2*N;fe+=2)O.emplaceBack(de+fe,de+fe+1,de+fe+3),O.emplaceBack(de+fe,de+fe+3,de+fe+2),O.emplaceBack(xe+fe,xe+fe+3,xe+fe+1),O.emplaceBack(xe+fe,xe+fe+2,xe+fe+3);const Me=new Gs(P.createVertexBuffer(k,wl.members),P.createIndexBuffer(O),y.aM.simpleSegment(0,0,k.length,O.length));return this._meshCache[C]=Me,Me}getMeshFrameDelta(t){return 2*Math.PI*y.bu/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,c){var f;const{tileID:x}=this._getOverscaledTileIDFromLngLatZoom(t,c);return(f=this.getMinMaxElevation(x).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(t){const c=this.getTerrainData(t).tile,f={minElevation:null,maxElevation:null};return c&&c.dem&&(f.minElevation=c.dem.min*this.exaggeration,f.maxElevation=c.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(t,c){const f=y.a1.fromLngLat(t.wrap()),x=(1<<c)*y.$,S=f.x*x,C=f.y*x,P=Math.floor(S/y.$),k=Math.floor(C/y.$);return{tileID:new y.Z(c,0,c,P,k),mercatorX:S,mercatorY:C}}}class Sl{constructor(t,c,f){this._context=t,this._size=c,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const c=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new y.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),c.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),c.colorAttachment.set(f.texture),{id:t,fbo:c,texture:f,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(c=>t.id!==c),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const c of this._recentlyUsed)if(!this._objects[c].inUse)return this._objects[c];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Ya={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class ro{constructor(t,c){this.painter=t,this.terrain=c,this.pool=new Sl(t.context,30,c.sourceCache.tileSize*c.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,c){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(f=>!t._layers[f].isHidden(c)),this._coordsAscending={};for(const f in t.sourceCaches){this._coordsAscending[f]={};const x=t.sourceCaches[f].getVisibleCoordinates(),S=t.sourceCaches[f].getSource(),C=S instanceof ns?S.terrainTileRanges:null;for(const P of x){const k=this.terrain.sourceCache.getTerrainCoords(P,C);for(const O in k)this._coordsAscending[f][O]||(this._coordsAscending[f][O]=[]),this._coordsAscending[f][O].push(k[O])}}this._coordsAscendingStr={};for(const f of t._order){const x=t._layers[f],S=x.source;if(Ya[x.type]&&!this._coordsAscendingStr[S]){this._coordsAscendingStr[S]={};for(const C in this._coordsAscending[S])this._coordsAscendingStr[S][C]=this._coordsAscending[S][C].map(P=>P.key).sort().join()}}for(const f of this._renderableTiles)for(const x in this._coordsAscendingStr){const S=this._coordsAscendingStr[x][f.tileID.key];S&&S!==f.rttCoords[x]&&(f.rtt=[])}}renderLayer(t,c){if(t.isHidden(this.painter.transform.zoom))return!1;const f=Object.assign(Object.assign({},c),{isRenderingToTexture:!0}),x=t.type,S=this.painter,C=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Ya[x]&&(this._prevType&&Ya[this._prevType]||this._stacks.push([]),this._prevType=x,this._stacks[this._stacks.length-1].push(t.id),!C))return!0;if(Ya[this._prevType]||Ya[x]&&C){this._prevType=x;const P=this._stacks.length-1,k=this._stacks[P]||[];for(const O of this._renderableTiles){if(this.pool.isFull()&&(Xc(this.painter,this.terrain,this._rttTiles,f),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(O),O.rtt[P]){const U=this.pool.getObjectForId(O.rtt[P].id);if(U.stamp===O.rtt[P].stamp){this.pool.useObject(U);continue}}const N=this.pool.getOrCreateFreeObject();this.pool.useObject(N),this.pool.stampObject(N),O.rtt[P]={id:N.id,stamp:N.stamp},S.context.bindFramebuffer.set(N.fbo.framebuffer),S.context.clear({color:y.bf.transparent,stencil:0}),S.currentStencilSource=void 0;for(let U=0;U<k.length;U++){const V=S.style._layers[k[U]],$=V.source?this._coordsAscending[V.source][O.tileID.key]:[O.tileID];S.context.viewport.set([0,0,N.fbo.width,N.fbo.height]),S._renderTileClippingMasks(V,$,!0),S.renderLayer(S,S.style.sourceCaches[V.source],V,$,f),V.source&&(O.rttCoords[V.source]=this._coordsAscendingStr[V.source][O.tileID.key])}}return Xc(this.painter,this.terrain,this._rttTiles,f),this._rttTiles=[],this.pool.freeAllObjects(),Ya[x]}return!1}}const ea={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},tn=se,pa={hash:!1,interactive:!0,bearingSnap:7,attributionControl:fs,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:y.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Rh={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class hc{constructor(t,c,f=!1){this.mousedown=S=>{this.startMove(S,Se.mousePos(this.element,S)),Se.addEventListener(window,"mousemove",this.mousemove),Se.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.move(S,Se.mousePos(this.element,S))},this.mouseup=S=>{this._rotatePitchHandler.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Se.touchPos(this.element,S.targetTouches)[0],this.startMove(S,this._startPos),Se.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Se.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=Se.touchPos(this.element,S.targetTouches)[0],this.move(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=c;const x=new oc;this._rotatePitchHandler=new ha({clickTolerance:3,move:(S,C)=>{const P=c.getBoundingClientRect(),k=new y.P((P.bottom-P.top)/2,(P.right-P.left)/2);return{bearingDelta:y.cn(new y.P(S.x,C.y),C,k),pitchDelta:f?-.5*(C.y-S.y):void 0}},moveStateManager:x,enable:!0,assignEvents:()=>{}}),this.map=t,Se.addEventListener(c,"mousedown",this.mousedown),Se.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),Se.addEventListener(c,"touchcancel",this.reset)}startMove(t,c){this._rotatePitchHandler.dragStart(t,c),Se.disableDrag()}move(t,c){const f=this.map,{bearingDelta:x,pitchDelta:S}=this._rotatePitchHandler.dragMove(t,c)||{};x&&f.setBearing(f.getBearing()+x),S&&f.setPitch(f.getPitch()+S)}off(){const t=this.element;Se.removeEventListener(t,"mousedown",this.mousedown),Se.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),Se.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Se.removeEventListener(window,"touchend",this.touchend),Se.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){Se.enableDrag(),Se.removeEventListener(window,"mousemove",this.mousemove),Se.removeEventListener(window,"mouseup",this.mouseup),Se.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Se.removeEventListener(window,"touchend",this.touchend)}}let mr;function un(b,t,c,f=!1){if(f||!c.getCoveringTilesDetailsProvider().allowWorldCopies())return b==null?void 0:b.wrap();const x=new y.S(b.lng,b.lat);if(b=new y.S(b.lng,b.lat),t){const S=new y.S(b.lng-360,b.lat),C=new y.S(b.lng+360,b.lat),P=c.locationToScreenPoint(b).distSqr(t);c.locationToScreenPoint(S).distSqr(t)<P?b=S:c.locationToScreenPoint(C).distSqr(t)<P&&(b=C)}for(;Math.abs(b.lng-c.center.lng)>180;){const S=c.locationToScreenPoint(b);if(S.x>=0&&S.y>=0&&S.x<=c.width&&S.y<=c.height)break;b.lng>c.center.lng?b.lng-=360:b.lng+=360}return b.lng!==x.lng&&c.isPointOnMapSurface(c.locationToScreenPoint(b))?b:x}const iu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Tl(b,t,c){const f=b.classList;for(const x in iu)f.remove(`maplibregl-${c}-anchor-${x}`);f.add(`maplibregl-${c}-anchor-${t}`)}class Ml extends y.E{constructor(t){if(super(),this._onKeyPress=c=>{const f=c.code,x=c.charCode||c.keyCode;f!=="Space"&&f!=="Enter"&&x!==32&&x!==13||this.togglePopup()},this._onMapClick=c=>{const f=c.originalEvent.target,x=this._element;this._popup&&(f===x||x.contains(f))&&this.togglePopup()},this._update=c=>{if(!this._map)return;const f=this._map.loaded()&&!this._map.isMoving();((c==null?void 0:c.type)==="terrain"||(c==null?void 0:c.type)==="render"&&!f)&&this._map.once("render",this._update),this._lngLat=un(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let x="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?x=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(x=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||c&&c.type!=="moveend"||(this._pos=this._pos.round()),Se.setTransform(this._element,`${iu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${x}`),Le.frameAsync(new AbortController).then(()=>{this._updateOpacity(c&&c.type==="moveend")}).catch(()=>{})},this._onMove=c=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.l("dragstart"))),this.fire(new y.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.l("dragend")),this._state="inactive"},this._addDragHandler=c=>{this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=y.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Se.create("div");const c=Se.createNS("http://www.w3.org/2000/svg","svg"),f=41,x=27;c.setAttributeNS(null,"display","block"),c.setAttributeNS(null,"height",`${f}px`),c.setAttributeNS(null,"width",`${x}px`),c.setAttributeNS(null,"viewBox",`0 0 ${x} ${f}`);const S=Se.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const C=Se.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const P=Se.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const oe of k){const he=Se.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",oe.rx),he.setAttributeNS(null,"ry",oe.ry),P.appendChild(he)}const O=Se.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill",this._color);const N=Se.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),O.appendChild(N);const U=Se.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"opacity","0.25"),U.setAttributeNS(null,"fill","#000000");const V=Se.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),U.appendChild(V);const $=Se.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");const W=Se.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ae=Se.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#000000"),ae.setAttributeNS(null,"opacity","0.25"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962");const ne=Se.createNS("http://www.w3.org/2000/svg","circle");ne.setAttributeNS(null,"fill","#FFFFFF"),ne.setAttributeNS(null,"cx","5.5"),ne.setAttributeNS(null,"cy","5.5"),ne.setAttributeNS(null,"r","5.4999962"),W.appendChild(ae),W.appendChild(ne),C.appendChild(P),C.appendChild(O),C.appendChild(U),C.appendChild($),C.appendChild(W),c.appendChild(C),c.setAttributeNS(null,"height",f*this._scale+"px"),c.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(c),this._offset=y.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",c=>{c.preventDefault()}),this._element.addEventListener("mousedown",c=>{c.preventDefault()}),Tl(this._element,this._anchor,"marker"),t&&t.className)for(const c of t.className.split(" "))this._element.classList.add(c);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Se.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=y.S.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const x=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var c,f;const x=(c=this._map)===null||c===void 0?void 0:c.terrain,S=this._map.transform.isLocationOccluded(this._lngLat);if(!x||S){const $=S?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==$&&(this._element.style.opacity=$))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const C=this._map,P=C.terrain.depthAtPoint(this._pos),k=C.terrain.getElevationForLngLatZoom(this._lngLat,C.transform.tileZoom);if(C.transform.lngLatToCameraDepth(this._lngLat,k)-P<.006)return void(this._element.style.opacity=this._opacity);const O=-this._offset.y/C.transform.pixelsPerMeter,N=Math.sin(C.getPitch()*Math.PI/180)*O,U=C.terrain.depthAtPoint(new y.P(this._pos.x,this._pos.y-this._offset.y)),V=C.transform.lngLatToCameraDepth(this._lngLat,k+N)-U>.006;!((f=this._popup)===null||f===void 0)&&f.isOpen()&&V&&this._popup.remove(),this._element.style.opacity=V?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=y.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,c){return(this._opacity===void 0||t===void 0&&c===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),c!==void 0&&(this._opacityWhenCovered=c),this._map&&this._updateOpacity(!0),this}}const ta={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let gr=0,Oo=!1;const Fo={maxWidth:100,unit:"metric"};function dc(b,t,c){const f=c&&c.maxWidth||100,x=b._container.clientHeight/2,S=b._container.clientWidth/2,C=b.unproject([S-f/2,x]),P=b.unproject([S+f/2,x]),k=Math.round(b.project(P).x-b.project(C).x),O=Math.min(f,k,b._container.clientWidth),N=C.distanceTo(P);if(c&&c.unit==="imperial"){const U=3.2808*N;U>5280?no(t,O,U/5280,b._getUIString("ScaleControl.Miles")):no(t,O,U,b._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?no(t,O,N/1852,b._getUIString("ScaleControl.NauticalMiles")):N>=1e3?no(t,O,N/1e3,b._getUIString("ScaleControl.Kilometers")):no(t,O,N,b._getUIString("ScaleControl.Meters"))}function no(b,t,c,f){const x=function(S){const C=Math.pow(10,`${Math.floor(S)}`.length-1);let P=S/C;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(k){const O=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*O)/O}(P),C*P}(c);b.style.width=t*(x/c)+"px",b.innerHTML=`${x}&nbsp;${f}`}const Rs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},ao=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Al(b){if(b){if(typeof b=="number"){const t=Math.round(Math.abs(b)/Math.SQRT2);return{center:new y.P(0,0),top:new y.P(0,b),"top-left":new y.P(t,t),"top-right":new y.P(-t,t),bottom:new y.P(0,-b),"bottom-left":new y.P(t,-t),"bottom-right":new y.P(-t,-t),left:new y.P(b,0),right:new y.P(-b,0)}}if(b instanceof y.P||Array.isArray(b)){const t=y.P.convert(b);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:y.P.convert(b.center||[0,0]),top:y.P.convert(b.top||[0,0]),"top-left":y.P.convert(b["top-left"]||[0,0]),"top-right":y.P.convert(b["top-right"]||[0,0]),bottom:y.P.convert(b.bottom||[0,0]),"bottom-left":y.P.convert(b["bottom-left"]||[0,0]),"bottom-right":y.P.convert(b["bottom-right"]||[0,0]),left:y.P.convert(b.left||[0,0]),right:y.P.convert(b.right||[0,0])}}return Al(new y.P(0,0))}const Hu=se;F.AJAXError=y.cz,F.Event=y.l,F.Evented=y.E,F.LngLat=y.S,F.MercatorCoordinate=y.a1,F.Point=y.P,F.addProtocol=y.cA,F.config=y.a,F.removeProtocol=y.cB,F.AttributionControl=zi,F.BoxZoomHandler=Do,F.CanvasSource=as,F.CooperativeGesturesHandler=$u,F.DoubleClickZoomHandler=Bo,F.DragPanHandler=vl,F.DragRotateHandler=bl,F.EdgeInsets=Va,F.FullscreenControl=class extends y.E{constructor(b={}){super(),this._onFullscreenChange=()=>{var t;let c=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=c==null?void 0:c.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)c=c.shadowRoot.fullscreenElement;c===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:y.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=Se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Se.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const b=this._fullscreenButton=Se.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Se.create("span","maplibregl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.title=b}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new y.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new y.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},F.GeoJSONSource=Nn,F.GeolocateControl=class extends y.E{constructor(b){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new y.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new y.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const c=new y.S(t.coords.longitude,t.coords.latitude),f=t.coords.accuracy,x=this._map.getBearing(),S=y.e({bearing:x},this.options.fitBoundsOptions),C=xi.fromLngLat(c,f);this._map.fitBounds(C,S,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const c=new y.S(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Oo)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new y.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Se.create("button","maplibregl-ctrl-geolocate",this._container),Se.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){y.w("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Se.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ml({element:this._dotElement}),this._circleElement=Se.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ml({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{const f=(c==null?void 0:c[0])instanceof ResizeObserverEntry;c.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new y.l("trackuserlocationend")),this.fire(new y.l("userlocationlostfocus")))})}},this.options=y.e({},ta,b)}onAdd(b){return this._map=b,this._container=Se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return y._(this,arguments,void 0,function*(t=!1){if(mr!==void 0&&!t)return mr;if(window.navigator.permissions===void 0)return mr=!!window.navigator.geolocation,mr;try{mr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{mr=!!window.navigator.geolocation}return mr})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Se.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,gr=0,Oo=!1}_isOutOfMapMaxBounds(b){const t=this._map.getMaxBounds(),c=b.coords;return t&&(c.longitude<t.getWest()||c.longitude>t.getEast()||c.latitude<t.getSouth()||c.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const b=this._map.getBounds(),t=b.getSouthEast(),c=b.getNorthEast(),f=t.distanceTo(c),x=Math.ceil(this._accuracy/(f/this._map._container.clientHeight)*2);this._circleElement.style.width=`${x}px`,this._circleElement.style.height=`${x}px`}trigger(){if(!this._setup)return y.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":gr--,Oo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new y.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.l("trackuserlocationstart")),this.fire(new y.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let b;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),gr++,gr>1?(b={maximumAge:6e5,timeout:0},Oo=!0):(b=this.options.positionOptions,Oo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,b)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},F.GlobeControl=class{constructor(){this._toggleProjection=()=>{var b;const t=(b=this._map.getProjection())===null||b===void 0?void 0:b.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var b;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((b=this._map.getProjection())===null||b===void 0?void 0:b.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(b){return this._map=b,this._container=Se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Se.create("button","maplibregl-ctrl-globe",this._container),Se.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Se.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},F.Hash=Ea,F.ImageSource=ns,F.KeyboardHandler=Xa,F.LngLatBounds=xi,F.LogoControl=cr,F.Map=class extends tu{constructor(b){var t,c;y.cw.mark(y.cx.create);const f=Object.assign(Object.assign(Object.assign({},pa),b),{canvasContextAttributes:Object.assign(Object.assign({},pa.canvasContextAttributes),b.canvasContextAttributes)});if(f.minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const x=new ir,S=new Gr;if(f.minZoom!==void 0&&x.setMinZoom(f.minZoom),f.maxZoom!==void 0&&x.setMaxZoom(f.maxZoom),f.minPitch!==void 0&&x.setMinPitch(f.minPitch),f.maxPitch!==void 0&&x.setMaxPitch(f.maxPitch),f.renderWorldCopies!==void 0&&x.setRenderWorldCopies(f.renderWorldCopies),super(x,S,{bearingSnap:f.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new pr,this._controls=[],this._mapId=y.a7(),this._contextLost=P=>{P.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new y.l("webglcontextlost",{originalEvent:P}))},this._contextRestored=P=>{this._setupPainter(),this.resize(),this._update(),this.fire(new y.l("webglcontextrestored",{originalEvent:P}))},this._onMapScroll=P=>{if(P.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=f.interactive,this._maxTileCacheSize=f.maxTileCacheSize,this._maxTileCacheZoomLevels=f.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},f.canvasContextAttributes),this._trackResize=f.trackResize===!0,this._bearingSnap=f.bearingSnap,this._centerClampedToGround=f.centerClampedToGround,this._refreshExpiredTiles=f.refreshExpiredTiles===!0,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions===!0,this._collectResourceTiming=f.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},ea),f.locale),this._clickTolerance=f.clickTolerance,this._overridePixelRatio=f.pixelRatio,this._maxCanvasSize=f.maxCanvasSize,this.transformCameraUpdate=f.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=f.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=St.addThrottleControl(()=>this.isMoving()),this._requestManager=new Rt(f.transformRequest),typeof f.container=="string"){if(this._container=document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let P=!1;const k=Ca(O=>{this._trackResize&&!this._removed&&(this.resize(O),this.redraw())},50);this._resizeObserver=new ResizeObserver(O=>{P?k(O):P=!0}),this._resizeObserver.observe(this._container)}this.handlers=new uc(this,f),this._hash=f.hash&&new Ea(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,elevation:f.elevation,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,roll:f.roll}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,y.e({},f.fitBoundsOptions,{duration:0}))));const C=typeof f.style=="string"||((c=(t=f.style)===null||t===void 0?void 0:t.projection)===null||c===void 0?void 0:c.type)!=="globe";this.resize(null,C),this._localIdeographFontFamily=f.localIdeographFontFamily,this._validateStyle=f.validateStyle,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new zi(typeof f.attributionControl=="boolean"?void 0:f.attributionControl)),f.maplibreLogo&&this.addControl(new cr,f.logoPosition),this.on("style.load",()=>{if(C||this._resizeTransform(),this.transform.unmodified){const P=y.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(P)}}),this.on("data",P=>{this._update(P.dataType==="style"),this.fire(new y.l(`${P.dataType}data`,P))}),this.on("dataloading",P=>{this.fire(new y.l(`${P.dataType}dataloading`,P))}),this.on("dataabort",P=>{this.fire(new y.l("sourcedataabort",P))})}_getMapId(){return this._mapId}setGlobalStateProperty(b,t){return this.style.setGlobalStateProperty(b,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(b,t){if(t===void 0&&(t=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new y.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=b.onAdd(this);this._controls.push(b);const f=this._controlPositions[t];return t.indexOf("bottom")!==-1?f.insertBefore(c,f.firstChild):f.appendChild(c),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new y.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(b);return t>-1&&this._controls.splice(t,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}coveringTiles(b){return ke(this.transform,b)}calculateCameraOptionsFromTo(b,t,c,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLatZoom(c,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(b,t,c,f)}resize(b,t=!0){const[c,f]=this._containerDimensions(),x=this._getClampedPixelRatio(c,f);if(this._resizeCanvas(c,f,x),this.painter.resize(c,f,x),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const P=this._getClampedPixelRatio(c,f);this._resizeCanvas(c,f,P),this.painter.resize(c,f,P)}this._resizeTransform(t);const S=!this._moving;return S&&(this.stop(),this.fire(new y.l("movestart",b)).fire(new y.l("move",b))),this.fire(new y.l("resize",b)),S&&this.fire(new y.l("moveend",b)),this}_resizeTransform(b=!0){var t;const[c,f]=this._containerDimensions();this.transform.resize(c,f,b),(t=this._requestedCameraState)===null||t===void 0||t.resize(c,f,b)}_getClampedPixelRatio(b,t){const{0:c,1:f}=this._maxCanvasSize,x=this.getPixelRatio(),S=b*x,C=t*x;return Math.min(S>c?c/S:1,C>f?f/C:1)*x}getPixelRatio(){var b;return(b=this._overridePixelRatio)!==null&&b!==void 0?b:devicePixelRatio}setPixelRatio(b){this._overridePixelRatio=b,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(b){return this.transform.setMaxBounds(xi.convert(b)),this._update()}setMinZoom(b){if((b=b??-2)>=-2&&b<=this.transform.maxZoom)return this.transform.setMinZoom(b),this._update(),this.getZoom()<b&&this.setZoom(b),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b??22)>=this.transform.minZoom)return this.transform.setMaxZoom(b),this._update(),this.getZoom()>b&&this.setZoom(b),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.setMinPitch(b),this._update(),this.getPitch()<b&&this.setPitch(b),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(b>=this.transform.minPitch)return this.transform.setMaxPitch(b),this._update(),this.getPitch()>b&&this.setPitch(b),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.setRenderWorldCopies(b),this._update()}project(b){return this.transform.locationToScreenPoint(y.S.convert(b),this.style&&this.terrain)}unproject(b){return this.transform.screenPointToLocation(y.P.convert(b),this.terrain)}isMoving(){var b;return this._moving||((b=this.handlers)===null||b===void 0?void 0:b.isMoving())}isZooming(){var b;return this._zooming||((b=this.handlers)===null||b===void 0?void 0:b.isZooming())}isRotating(){var b;return this._rotating||((b=this.handlers)===null||b===void 0?void 0:b.isRotating())}_createDelegatedListener(b,t,c){if(b==="mouseenter"||b==="mouseover"){let f=!1;return{layers:t,listener:c,delegates:{mousemove:S=>{const C=t.filter(k=>this.getLayer(k)),P=C.length!==0?this.queryRenderedFeatures(S.point,{layers:C}):[];P.length?f||(f=!0,c.call(this,new Qn(b,this,S.originalEvent,{features:P}))):f=!1},mouseout:()=>{f=!1}}}}if(b==="mouseleave"||b==="mouseout"){let f=!1;return{layers:t,listener:c,delegates:{mousemove:C=>{const P=t.filter(k=>this.getLayer(k));(P.length!==0?this.queryRenderedFeatures(C.point,{layers:P}):[]).length?f=!0:f&&(f=!1,c.call(this,new Qn(b,this,C.originalEvent)))},mouseout:C=>{f&&(f=!1,c.call(this,new Qn(b,this,C.originalEvent)))}}}}{const f=x=>{const S=t.filter(P=>this.getLayer(P)),C=S.length!==0?this.queryRenderedFeatures(x.point,{layers:S}):[];C.length&&(x.features=C,c.call(this,x),delete x.features)};return{layers:t,listener:c,delegates:{[b]:f}}}}_saveDelegatedListener(b,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(t)}_removeDelegatedListener(b,t,c){if(!this._delegatedListeners||!this._delegatedListeners[b])return;const f=this._delegatedListeners[b];for(let x=0;x<f.length;x++){const S=f[x];if(S.listener===c&&S.layers.length===t.length&&S.layers.every(C=>t.includes(C))){for(const C in S.delegates)this.off(C,S.delegates[C]);return void f.splice(x,1)}}}on(b,t,c){if(c===void 0)return super.on(b,t);const f=typeof t=="string"?[t]:t,x=this._createDelegatedListener(b,f,c);this._saveDelegatedListener(b,x);for(const S in x.delegates)this.on(S,x.delegates[S]);return{unsubscribe:()=>{this._removeDelegatedListener(b,f,c)}}}once(b,t,c){if(c===void 0)return super.once(b,t);const f=typeof t=="string"?[t]:t,x=this._createDelegatedListener(b,f,c);for(const S in x.delegates){const C=x.delegates[S];x.delegates[S]=(...P)=>{this._removeDelegatedListener(b,f,c),C(...P)}}this._saveDelegatedListener(b,x);for(const S in x.delegates)this.once(S,x.delegates[S]);return this}off(b,t,c){return c===void 0?super.off(b,t):(this._removeDelegatedListener(b,typeof t=="string"?[t]:t,c),this)}queryRenderedFeatures(b,t){if(!this.style)return[];let c;const f=b instanceof y.P||Array.isArray(b),x=f?b:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(f?{}:b)||{},x instanceof y.P||typeof x[0]=="number")c=[y.P.convert(x)];else{const S=y.P.convert(x[0]),C=y.P.convert(x[1]);c=[S,new y.P(C.x,S.y),C,new y.P(S.x,C.y),S]}return this.style.queryRenderedFeatures(c,t,this.transform)}querySourceFeatures(b,t){return this.style.querySourceFeatures(b,t)}setStyle(b,t){return(t=y.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&b?(this._diffStyle(b,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(b,t))}setTransformRequest(b){return this._requestManager.setTransformRequest(b),this}_getUIString(b){const t=this._locale[b];if(t==null)throw new Error(`Missing UI string '${b}'`);return t}_updateStyle(b,t){var c,f;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(b,t));const x=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!b)),b?(this.style=new Yl(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof b=="string"?this.style.loadURL(b,t,x):this.style.loadJSON(b,t,x),this):((f=(c=this.style)===null||c===void 0?void 0:c.projection)===null||f===void 0||f.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Yl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(b,t){if(typeof b=="string"){const c=this._requestManager.transformRequest(b,"Style");y.j(c,new AbortController).then(f=>{this._updateDiff(f.data,t)}).catch(f=>{f&&this.fire(new y.k(f))})}else typeof b=="object"&&this._updateDiff(b,t)}_updateDiff(b,t){try{this.style.setState(b,t)&&this._update(!0)}catch(c){y.w(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(b,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():y.w("There is no style added to the map.")}addSource(b,t){return this._lazyInitEmptyStyle(),this.style.addSource(b,t),this._update(!0)}isSourceLoaded(b){const t=this.style&&this.style.sourceCaches[b];if(t!==void 0)return t.loaded();this.fire(new y.k(new Error(`There is no source with ID '${b}'`)))}setTerrain(b){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),b){const t=this.style.sourceCaches[b.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${b.source}`);this.terrain===null&&t.reload();for(const c in this.style._layers){const f=this.style._layers[c];f.type==="hillshade"&&f.source===b.source&&y.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),f.type==="color-relief"&&f.source===b.source&&y.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ht(this.painter,t,b),this.painter.renderToTexture=new ro(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=c=>{var f;c.dataType==="style"?this.terrain.sourceCache.freeRtt():c.dataType==="source"&&c.tile&&(c.sourceId!==b.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((f=c.source)===null||f===void 0?void 0:f.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(c.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new y.l("terrain",{terrain:b})),this}getTerrain(){var b,t;return(t=(b=this.terrain)===null||b===void 0?void 0:b.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const b=this.style&&this.style.sourceCaches;for(const t in b){const c=b[t]._tiles;for(const f in c){const x=c[f];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}removeSource(b){return this.style.removeSource(b),this._update(!0)}getSource(b){return this.style.getSource(b)}setSourceTileLodParams(b,t,c){if(c){const f=this.getSource(c);if(!f)throw new Error(`There is no source with ID "${c}", cannot set LOD parameters`);f.calculateTileZoom=ht(Math.max(1,b),Math.max(1,t))}else for(const f in this.style.sourceCaches)this.style.sourceCaches[f].getSource().calculateTileZoom=ht(Math.max(1,b),Math.max(1,t));return this._update(!0),this}refreshTiles(b,t){const c=this.style.sourceCaches[b];if(!c)throw new Error(`There is no source cache with ID "${b}", cannot refresh tile`);t===void 0?c.reload(!0):c.refreshTiles(t.map(f=>new y.a4(f.z,f.x,f.y)))}addImage(b,t,c={}){const{pixelRatio:f=1,sdf:x=!1,stretchX:S,stretchY:C,content:P,textFitWidth:k,textFitHeight:O}=c;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||y.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new y.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:N,height:U,data:V}=t,$=t;return this.style.addImage(b,{data:new y.R({width:N,height:U},new Uint8Array(V)),pixelRatio:f,stretchX:S,stretchY:C,content:P,textFitWidth:k,textFitHeight:O,sdf:x,version:0,userImage:$}),$.onAdd&&$.onAdd(this,b),this}}{const{width:N,height:U,data:V}=Le.getImageData(t);this.style.addImage(b,{data:new y.R({width:N,height:U},V),pixelRatio:f,stretchX:S,stretchY:C,content:P,textFitWidth:k,textFitHeight:O,sdf:x,version:0})}}updateImage(b,t){const c=this.style.getImage(b);if(!c)return this.fire(new y.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=t instanceof HTMLImageElement||y.b(t)?Le.getImageData(t):t,{width:x,height:S,data:C}=f;if(x===void 0||S===void 0)return this.fire(new y.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==c.data.width||S!==c.data.height)return this.fire(new y.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const P=!(t instanceof HTMLImageElement||y.b(t));return c.data.replace(C,P),this.style.updateImage(b,c),this}getImage(b){return this.style.getImage(b)}hasImage(b){return b?!!this.style.getImage(b):(this.fire(new y.k(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(b)}loadImage(b){return St.getImage(this._requestManager.transformRequest(b,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(b,t){return this._lazyInitEmptyStyle(),this.style.addLayer(b,t),this._update(!0)}moveLayer(b,t){return this.style.moveLayer(b,t),this._update(!0)}removeLayer(b){return this.style.removeLayer(b),this._update(!0)}getLayer(b){return this.style.getLayer(b)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(b,t,c){return this.style.setLayerZoomRange(b,t,c),this._update(!0)}setFilter(b,t,c={}){return this.style.setFilter(b,t,c),this._update(!0)}getFilter(b){return this.style.getFilter(b)}setPaintProperty(b,t,c,f={}){return this.style.setPaintProperty(b,t,c,f),this._update(!0)}getPaintProperty(b,t){return this.style.getPaintProperty(b,t)}setLayoutProperty(b,t,c,f={}){return this.style.setLayoutProperty(b,t,c,f),this._update(!0)}getLayoutProperty(b,t){return this.style.getLayoutProperty(b,t)}setGlyphs(b,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(b,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(b,t,c={}){return this._lazyInitEmptyStyle(),this.style.addSprite(b,t,c,f=>{f||this._update(!0)}),this}removeSprite(b){return this._lazyInitEmptyStyle(),this.style.removeSprite(b),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(b,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(b,t,c=>{c||this._update(!0)}),this}setLight(b,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(b,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(b,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(b,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(b,t){return this.style.setFeatureState(b,t),this._update()}removeFeatureState(b,t){return this.style.removeFeatureState(b,t),this._update()}getFeatureState(b){return this.style.getFeatureState(b)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let b=0,t=0;return this._container&&(b=this._container.clientWidth||400,t=this._container.clientHeight||300),[b,t]}_setupContainer(){const b=this._container;b.classList.add("maplibregl-map");const t=this._canvasContainer=Se.create("div","maplibregl-canvas-container",b);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=Se.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const c=this._containerDimensions(),f=this._getClampedPixelRatio(c[0],c[1]);this._resizeCanvas(c[0],c[1],f);const x=this._controlContainer=Se.create("div","maplibregl-control-container",b),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{S[C]=Se.create("div",`maplibregl-ctrl-${C} `,x)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,t,c){this._canvas.width=Math.floor(c*b),this._canvas.height=Math.floor(c*t),this._canvas.style.width=`${b}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const b=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{t={requestedAttributes:b},f&&(t.statusMessage=f.statusMessage,t.type=f.type)},{once:!0});let c=null;if(c=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,b):this._canvas.getContext("webgl2",b)||this._canvas.getContext("webgl",b),!c){const f="Failed to initialize WebGL";throw t?(t.message=f,new Error(JSON.stringify(t))):new Error(f)}this.painter=new Yc(c,this.transform),wt.testSupport(c)}migrateProjection(b,t){super.migrateProjection(b,t),this.painter.transform=b,this.fire(new y.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(b){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_render(b){var t,c,f,x,S;const C=this._idleTriggered?this._fadeDuration:0,P=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(b),this._removed)return;let k=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const U=this.transform.zoom,V=Le.now();this.style.zoomHistory.update(U,V);const $=new y.F(U,{now:V,fadeDuration:C,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),W=$.crossFadingFactor();W===1&&W===this._crossFadingFactor||(k=!0,this._crossFadingFactor=W),this.style.update($)}const O=((c=this.style.projection)===null||c===void 0?void 0:c.transitionState)>0!==P;(f=this.style.projection)===null||f===void 0||f.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((x=this.style.projection)===null||x===void 0?void 0:x.transitionState,(S=this.style.projection)===null||S===void 0?void 0:S.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||O)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,O),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,showPadding:this.showPadding}),this.fire(new y.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,y.cw.mark(y.cx.load),this.fire(new y.l("load"))),this.style&&(this.style.hasTransitions()||k)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const N=this._sourcesDirty||this._styleDirty||this._placementDirty;return N||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.l("idle")),!this._loaded||this._fullyLoaded||N||(this._fullyLoaded=!0,y.cw.mark(y.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var b;this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),St.removeThrottleControl(this._imageQueueHandle),(b=this._resizeObserver)===null||b===void 0||b.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Se.remove(this._canvasContainer),Se.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),y.cw.clearMetrics(),this._removed=!0,this.fire(new y.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Le.frame(this._frameRequest,b=>{y.cw.frame(b),this._frameRequest=null;try{this._render(b)}catch(t){if(!y.cy(t)&&!function(c){return c.message===Gc}(t))throw t}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}get version(){return tn}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(b){return this._lazyInitEmptyStyle(),this.style.setProjection(b),this._update(!0)}},F.MapMouseEvent=Qn,F.MapTouchEvent=Jc,F.MapWheelEvent=_d,F.Marker=Ml,F.NavigationControl=class{constructor(b){this._updateZoomButtons=()=>{const t=this._map.getZoom(),c=t===this._map.getMaxZoom(),f=t===this._map.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,c)=>{const f=this._map._getUIString(`NavigationControl.${c}`);t.title=f,t.setAttribute("aria-label",f)},this.options=y.e({},Rh,b),this._container=Se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),Se.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),Se.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=Se.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new hc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Se.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(b,t){const c=Se.create("button",b,this._container);return c.type="button",c.addEventListener("click",t),c}},F.Popup=class extends y.E{constructor(b){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Se.remove(this._content),this._container&&(Se.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new y.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Se.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Se.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=un(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const c=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let f=this.options.anchor;const x=Al(this.options.offset);if(!f){const C=this._container.offsetWidth,P=this._container.offsetHeight;let k;k=c.y+x.bottom.y<P?["top"]:c.y>this._map.transform.height-P?["bottom"]:[],c.x<C/2?k.push("left"):c.x>this._map.transform.width-C/2&&k.push("right"),f=k.length===0?"bottom":k.join("-")}let S=c.add(x[f]);this.options.subpixelPositioning||(S=S.round()),Se.setTransform(this._container,`${iu[f]} translate(${S.x}px,${S.y}px)`),Tl(this._container,f,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=y.e(Object.create(Rs),b)}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new y.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(b){return this._lngLat=y.S.convert(b),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(document.createTextNode(b))}setHTML(b){const t=document.createDocumentFragment(),c=document.createElement("body");let f;for(c.innerHTML=b;f=c.firstChild,f;)t.appendChild(f);return this.setDOMContent(t)}getMaxWidth(){var b;return(b=this._container)===null||b===void 0?void 0:b.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Se.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(b),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(b){return this._container&&this._container.classList.add(b),this}removeClassName(b){return this._container&&this._container.classList.remove(b),this}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){if(this._container)return this._container.classList.toggle(b)}setSubpixelPositioning(b){this.options.subpixelPositioning=b}_createCloseButton(){this.options.closeButton&&(this._closeButton=Se.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(ao);b&&b.focus()}},F.RasterDEMTileSource=sn,F.RasterTileSource=rs,F.ScaleControl=class{constructor(b){this._onMove=()=>{dc(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,dc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Fo),b)}getDefaultPosition(){return"bottom-left"}onAdd(b){return this._map=b,this._container=Se.create("div","maplibregl-ctrl maplibregl-ctrl-scale",b.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Se.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},F.ScrollZoomHandler=ks,F.Style=Yl,F.TerrainControl=class{constructor(b){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=b}onAdd(b){return this._map=b,this._container=Se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Se.create("button","maplibregl-ctrl-terrain",this._container),Se.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Se.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},F.TwoFingersTouchPitchHandler=lc,F.TwoFingersTouchRotateHandler=xl,F.TwoFingersTouchZoomHandler=Er,F.TwoFingersTouchZoomRotateHandler=Zu,F.VectorTileSource=oa,F.VideoSource=Wo,F.addSourceType=(b,t)=>y._(void 0,void 0,void 0,function*(){if(Ns(b))throw new Error(`A source type called "${b}" already exists.`);((c,f)=>{La[c]=f})(b,t)}),F.clearPrewarmedResources=function(){const b=mt;b&&(b.isPreloaded()&&b.numActive()===1?(b.release(_e),mt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},F.createTileMesh=fd,F.getMaxParallelImageRequests=function(){return y.a.MAX_PARALLEL_IMAGE_REQUESTS},F.getRTLTextPluginStatus=function(){return pn().getRTLTextPluginStatus()},F.getVersion=function(){return Hu},F.getWorkerCount=function(){return rt.workerCount},F.getWorkerUrl=function(){return y.a.WORKER_URL},F.importScriptInWorkers=function(b){return Di().broadcast("IS",b)},F.prewarm=function(){bi().acquire(_e)},F.setMaxParallelImageRequests=function(b){y.a.MAX_PARALLEL_IMAGE_REQUESTS=b},F.setRTLTextPlugin=function(b,t){return pn().setRTLTextPlugin(b,t)},F.setWorkerCount=function(b){rt.workerCount=b},F.setWorkerUrl=function(b){y.a.WORKER_URL=b}});var ie=H;return ie})}(im)),im.exports}var bg=r_();const Mm=mg(bg),n_=pg({__proto__:null,default:Mm},[bg]);var tg={};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.7.0/LICENSE.txt
 */var ig;function a_(){return ig||(ig=1,function(){function D(n,e,r,o){return new(r||(r=Promise))(function(h,p){function g(A){try{M(o.next(A))}catch(z){p(z)}}function v(A){try{M(o.throw(A))}catch(z){p(z)}}function M(A){var z;A.done?h(A.value):(z=A.value,z instanceof r?z:new r(function(I){I(z)})).then(g,v)}M((o=o.apply(n,[])).next())})}function G(n,e){this.x=n,this.y=e}function H(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Z,Q;typeof SuppressedError=="function"&&SuppressedError,G.prototype={clone(){return new G(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,r=n.y-this.y;return e*e+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),r=Math.sin(n),o=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=o,this},_rotateAround(n,e){const r=Math.cos(n),o=Math.sin(n),h=e.y+o*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-o*(this.y-e.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:G},G.convert=function(n){if(n instanceof G)return n;if(Array.isArray(n))return new G(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new G(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var ie=function(){if(Q)return Z;function n(e,r,o,h){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=o,this.p2y=h}return Q=1,Z=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,h=0;h<8;h++){var p=this.sampleCurveX(o)-e;if(Math.abs(p)<r)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=p/g}var v=0,M=1;for(o=e,h=0;h<20&&(p=this.sampleCurveX(o),!(Math.abs(p-e)<r));h++)e>p?v=o:M=o,o=.5*(M-v)+v;return o},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},Z}(),F=H(ie);let y,se;var pe,Ce=typeof Float32Array<"u"?Float32Array:Array;function Ze(n,e,r){var o=e[0],h=e[1],p=e[2],g=e[3];return n[0]=r[0]*o+r[4]*h+r[8]*p+r[12]*g,n[1]=r[1]*o+r[5]*h+r[9]*p+r[13]*g,n[2]=r[2]*o+r[6]*h+r[10]*p+r[14]*g,n[3]=r[3]*o+r[7]*h+r[11]*p+r[15]*g,n}pe=new Ce(4),Ce!=Float32Array&&(pe[0]=0,pe[1]=0,pe[2]=0,pe[3]=0);const Le=8192;function Se(n,e,r){return Math.min(r,Math.max(e,n))}function wt(n,...e){for(const r of e)for(const o in r)n[o]=r[o];return n}function Ut(n,e,r){const o={};for(const h in n)o[h]=e.call(this,n[h],h,n);return o}function Et(n){return Array.isArray(n)?n.map(Et):typeof n=="object"&&n?Ut(n,Et):n}new F(.25,.1,.25,1);const Yt={};function Nt(n){Yt[n]||(typeof console<"u"&&console.warn(n),Yt[n]=!0)}function ot(n,e,r){return(r.y-n.y)*(e.x-n.x)>(e.y-n.y)*(r.x-n.x)}function St(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}function Rt(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}let Gt,ti;function zt(n,e,r,o){return n.addEventListener(e,r,o),{unsubscribe:()=>{n.removeEventListener(e,r,o)}}}function ui(n){return n*Math.PI/180}class Pi{constructor(e,r,o){const h=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(r=g[1])+2*(o=g[2]);for(let M=0;M<this.d*this.d;M++){const A=g[3+M],z=g[3+M+1];h.push(A===z?null:g.subarray(A,z))}const v=g[3+h.length+1];this.keys=g.subarray(g[3+h.length],v),this.bboxes=g.subarray(v),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let g=0;g<this.d*this.d;g++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=o,this.scale=r/e,this.uid=0;const p=o/r*e;this.min=-p,this.max=e+p}insert(e,r,o,h,p){this._forEachCell(r,o,h,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,o,h,p,g){this.cells[p].push(g)}query(e,r,o,h,p){const g=this.min,v=this.max;if(e<=g&&r<=g&&v<=o&&v<=h&&!p)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(e,r,o,h,this._queryCell,M,{},p),M}}_queryCell(e,r,o,h,p,g,v,M){const A=this.cells[p];if(A!==null){const z=this.keys,I=this.bboxes;for(let L=0;L<A.length;L++){const B=A[L];if(v[B]===void 0){const j=4*B;(M?M(I[j+0],I[j+1],I[j+2],I[j+3]):e<=I[j+2]&&r<=I[j+3]&&o>=I[j+0]&&h>=I[j+1])?(v[B]=!0,g.push(z[B])):v[B]=!1}}}}_forEachCell(e,r,o,h,p,g,v,M){const A=this._convertToCellCoord(e),z=this._convertToCellCoord(r),I=this._convertToCellCoord(o),L=this._convertToCellCoord(h);for(let B=A;B<=I;B++)for(let j=z;j<=L;j++){const q=this.d*j+B;if((!M||M(this._convertFromCellCoord(B),this._convertFromCellCoord(j),this._convertFromCellCoord(B+1),this._convertFromCellCoord(j+1)))&&p.call(this,e,r,o,h,q,g,v,M))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const h=new Int32Array(r+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let p=r;for(let g=0;g<e.length;g++){const v=e[g];h[3+g]=p,h.set(v,p),p+=v.length}return h[3+e.length]=p,h.set(this.keys,p),p+=this.keys.length,h[3+e.length+1]=p,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer}static serialize(e,r){const o=e.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(e){return new Pi(e.buffer)}}var $e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ji=["type","source","source-layer","minzoom","maxzoom","filter","layout"];class ft{constructor(e,r,o,h){this.message=(e?`${e}: `:"")+o,h&&(this.identifier=h),r!=null&&r.__line__&&(this.line=r.__line__)}}function fn(n,...e){for(const r of e)for(const o in r)n[o]=r[o];return n}class Ri extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Qe{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[o,h]of r)this.bindings[o]=h}concat(e){return new Qe(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const bt={kind:"null"},Be={kind:"number"},_t={kind:"string"},_e={kind:"boolean"},rt={kind:"color"},It={kind:"projectionDefinition"},mt={kind:"object"},ut={kind:"value"},bi={kind:"collator"},Zt={kind:"formatted"},Di={kind:"padding"},Ei={kind:"colorArray"},kr={kind:"numberArray"},jn={kind:"resolvedImage"},Hn={kind:"variableAnchorOffsetCollection"};function sr(n,e){return{kind:"array",itemType:n,N:e}}function xi(n){if(n.kind==="array"){const e=xi(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Qr=[bt,Be,_t,_e,rt,It,Zt,mt,sr(ut),Di,kr,Ei,jn,Hn];function oa(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!oa(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const r of Qr)if(!oa(r,e))return null}}return`Expected ${xi(n)} but found ${xi(e)} instead.`}function rs(n,e){return e.some(r=>r.kind===n.kind)}function sn(n,e){return e.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}function Nn(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const ns=.96422,Wo=.82521,as=4/29,La=6/29,Ns=3*La*La,Vl=La*La*La,Ko=Math.PI/180,ss=180/Math.PI;function pn(n){return(n%=360)<0&&(n+=360),n}function ba([n,e,r,o]){let h,p;const g=K((.2225045*(n=Ee(n))+.7168786*(e=Ee(e))+.0606169*(r=Ee(r)))/1);n===e&&e===r?h=p=g:(h=K((.4360747*n+.3850649*e+.1430804*r)/ns),p=K((.0139322*n+.0971045*e+.7141733*r)/Wo));const v=116*g-16;return[v<0?0:v,500*(h-g),200*(g-p),o]}function Ee(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function K(n){return n>Vl?Math.pow(n,1/3):n/Ns+as}function ee([n,e,r,o]){let h=(n+16)/116,p=isNaN(e)?h:h+e/500,g=isNaN(r)?h:h-r/200;return h=1*me(h),p=ns*me(p),g=Wo*me(g),[re(3.1338561*p-1.6168667*h-.4906146*g),re(-.9787684*p+1.9161415*h+.033454*g),re(.0719453*p-.2289914*h+1.4052427*g),o]}function re(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function me(n){return n>La?n*n*n:Ns*(n-as)}const Ae=Object.hasOwn||function(n,e){return Object.prototype.hasOwnProperty.call(n,e)};function Pe(n,e){return Ae(n,e)?n[e]:void 0}function je(n){return parseInt(n.padEnd(2,n),16)/255}function Re(n,e){return Je(e?n/100:n,0,1)}function Je(n,e,r){return Math.min(Math.max(e,n),r)}function ht(n){return!n.some(Number.isNaN)}const at={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Dt(n,e,r){return n+r*(e-n)}function ke(n,e,r){return n.map((o,h)=>Dt(o,e[h],r))}class Tt{constructor(e,r,o,h=1,p=!0){this.r=e,this.g=r,this.b=o,this.a=h,p||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[e,r,o,h]))}static parse(e){if(e instanceof Tt)return e;if(typeof e!="string")return;const r=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Pe(at,o);if(h){const[g,v,M]=h;return[g/255,v/255,M/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let v=1;return[je(o.slice(v,v+=g)),je(o.slice(v,v+=g)),je(o.slice(v,v+=g)),je(o.slice(v,v+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[v,M,A,z,I,L,B,j,q,X,J,ue]=g,le=[z||" ",B||" ",X].join("");if(le==="  "||le==="  /"||le===",,"||le===",,,"){const ce=[A,L,q].join(""),Te=ce==="%%%"?100:ce===""?255:0;if(Te){const ye=[Je(+M/Te,0,1),Je(+I/Te,0,1),Je(+j/Te,0,1),J?Re(+J,ue):1];if(ht(ye))return ye}}return}}const p=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[g,v,M,A,z,I,L,B,j]=p,q=[M||" ",z||" ",L].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const X=[+v,Je(+A,0,100),Je(+I,0,100),B?Re(+B,j):1];if(ht(X))return function([J,ue,le,ce]){function Te(ye){const ve=(ye+J/30)%12,we=ue*Math.min(le,1-le);return le-we*Math.max(-1,Math.min(ve-3,9-ve,1))}return J=pn(J),ue/=100,le/=100,[Te(0),Te(8),Te(4),ce]}(X)}}}(e);return r?new Tt(...r,!1):void 0}get rgb(){const{r:e,g:r,b:o,a:h}=this,p=h||1/0;return this.overwriteGetter("rgb",[e/p,r/p,o/p,h])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,o,h,p]=ba(e),g=Math.sqrt(o*o+h*h);return[Math.round(1e4*g)?pn(Math.atan2(h,o)*ss):NaN,g,r,p]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ba(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,o,h]=this.rgb;return`rgba(${[e,r,o].map(p=>Math.round(255*p)).join(",")},${h})`}static interpolate(e,r,o,h="rgb"){switch(h){case"rgb":{const[p,g,v,M]=ke(e.rgb,r.rgb,o);return new Tt(p,g,v,M,!1)}case"hcl":{const[p,g,v,M]=e.hcl,[A,z,I,L]=r.hcl;let B,j;if(isNaN(p)||isNaN(A))isNaN(p)?isNaN(A)?B=NaN:(B=A,v!==1&&v!==0||(j=z)):(B=p,I!==1&&I!==0||(j=g));else{let le=A-p;A>p&&le>180?le-=360:A<p&&p-A>180&&(le+=360),B=p+o*le}const[q,X,J,ue]=function([le,ce,Te,ye]){return le=isNaN(le)?0:le*Ko,ee([Te,Math.cos(le)*ce,Math.sin(le)*ce,ye])}([B,j??Dt(g,z,o),Dt(v,I,o),Dt(M,L,o)]);return new Tt(q,X,J,ue,!1)}case"lab":{const[p,g,v,M]=ee(ke(e.lab,r.lab,o));return new Tt(p,g,v,M,!1)}}}}Tt.black=new Tt(0,0,0,1),Tt.white=new Tt(1,1,1,1),Tt.transparent=new Tt(0,0,0,0),Tt.red=new Tt(1,0,0,1);class Ti{constructor(e,r,o){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const $t=["bottom","center","top"];class hi{constructor(e,r,o,h,p,g){this.text=e,this.image=r,this.scale=o,this.fontStack=h,this.textColor=p,this.verticalAlign=g}}class Ii{constructor(e){this.sections=e}static fromString(e){return new Ii([new hi(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Ii?e:Ii.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Yi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Yi)return e;if(typeof e=="number")return new Yi([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Yi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o){return new Yi(ke(e.values,r.values,o))}}class er{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof er)return e;if(typeof e=="number")return new er([e]);if(Array.isArray(e)){for(const r of e)if(typeof r!="number")return;return new er(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o){return new er(ke(e.values,r.values,o))}}class Mi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Mi)return e;if(typeof e=="string"){const o=Tt.parse(e);return o?new Mi([o]):void 0}if(!Array.isArray(e))return;const r=[];for(const o of e){if(typeof o!="string")return;const h=Tt.parse(o);if(!h)return;r.push(h)}return new Mi(r)}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o,h="rgb"){const p=[];if(e.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let g=0;g<e.values.length;g++)p.push(Tt.interpolate(e.values[g],r.values[g],o,h));return new Mi(p)}}class Lt extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const di=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Bi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Bi)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const o=e[r],h=e[r+1];if(typeof o!="string"||!di.has(o)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new Bi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o){const h=e.values,p=r.values;if(h.length!==p.length)throw new Lt(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${r.toString()}`);const g=[];for(let v=0;v<h.length;v+=2){if(h[v]!==p[v])throw new Lt(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${h[v]}, to[${v}]: ${p[v]}`);g.push(h[v]);const[M,A]=h[v+1],[z,I]=p[v+1];g.push([Dt(M,z,o),Dt(A,I,o)])}return new Bi(g)}}class pt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new pt({name:e,available:!1}):null}}class Ar{constructor(e,r,o){this.from=e,this.to=r,this.transition=o}static interpolate(e,r,o){return new Ar(e,r,o)}static parse(e){return e instanceof Ar?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Ar(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Ar(e.from,e.to,e.transition):typeof e=="string"?new Ar(e,e,1):void 0}}function Ur(n,e,r,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,r,o]:[n,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ba(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Ar||n instanceof Tt||n instanceof Ti||n instanceof Ii||n instanceof Yi||n instanceof er||n instanceof Mi||n instanceof Bi||n instanceof pt)return!0;if(Array.isArray(n)){for(const e of n)if(!Ba(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Ba(n[e]))return!1;return!0}return!1}function dr(n){if(n===null)return bt;if(typeof n=="string")return _t;if(typeof n=="boolean")return _e;if(typeof n=="number")return Be;if(n instanceof Tt)return rt;if(n instanceof Ar)return It;if(n instanceof Ti)return bi;if(n instanceof Ii)return Zt;if(n instanceof Yi)return Di;if(n instanceof er)return kr;if(n instanceof Mi)return Ei;if(n instanceof Bi)return Hn;if(n instanceof pt)return jn;if(Array.isArray(n)){const e=n.length;let r;for(const o of n){const h=dr(o);if(r){if(r===h)continue;r=ut;break}r=h}return sr(r||ut,e)}return mt}function xt(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Tt||n instanceof Ar||n instanceof Ii||n instanceof Yi||n instanceof er||n instanceof Mi||n instanceof Bi||n instanceof pt?n.toString():JSON.stringify(n)}class ai{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ba(e[1]))return r.error("invalid value");const o=e[1];let h=dr(o);const p=r.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new ai(h,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const si={string:_t,number:Be,boolean:_e,object:mt};class lr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o,h=1;const p=e[0];if(p==="array"){let v,M;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in si)||A==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=si[A],h++}else v=ut;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);M=e[2],h++}o=sr(v,M)}else{if(!si[p])throw new Error(`Types doesn't contain name = ${p}`);o=si[p]}const g=[];for(;h<e.length;h++){const v=r.parse(e[h],h,ut);if(!v)return null;g.push(v)}return new lr(o,g)}evaluate(e){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(e);if(!oa(this.type,dr(o)))return o;if(r===this.args.length-1)throw new Lt(`Expected value to be of type ${xi(this.type)}, but found ${xi(dr(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Oa={"to-boolean":_e,"to-color":rt,"to-number":Be,"to-string":_t};class or{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[0];if(!Oa[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return r.error("Expected one argument.");const h=Oa[o],p=[];for(let g=1;g<e.length;g++){const v=r.parse(e[g],g,ut);if(!v)return null;p.push(v)}return new or(h,p)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,o;for(const h of this.args){if(r=h.evaluate(e),o=null,r instanceof Tt)return r;if(typeof r=="string"){const p=e.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Ur(r[0],r[1],r[2],r[3]),!o))return new Tt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Lt(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const o of this.args){r=o.evaluate(e);const h=Yi.parse(r);if(h)return h}throw new Lt(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const o of this.args){r=o.evaluate(e);const h=er.parse(r);if(h)return h}throw new Lt(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const o of this.args){r=o.evaluate(e);const h=Mi.parse(r);if(h)return h}throw new Lt(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const o of this.args){r=o.evaluate(e);const h=Bi.parse(r);if(h)return h}throw new Lt(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const o of this.args){if(r=o.evaluate(e),r===null)return 0;const h=Number(r);if(!isNaN(h))return h}throw new Lt(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Ii.fromString(xt(this.args[0].evaluate(e)));case"resolvedImage":return pt.fromString(xt(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return xt(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const wi=["Unknown","Point","LineString","Polygon"];class Pc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?wi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache.get(e);return r||(r=Tt.parse(e),this._parseColorCache.set(e,r)),r}}class Vn{constructor(e,r,o=[],h,p=new Qe,g=[]){this.registry=e,this.path=o,this.key=o.map(v=>`[${v}]`).join(""),this.scope=p,this.errors=g,this.expectedType=h,this._isConstant=r}parse(e,r,o,h,p={}){return r?this.concat(r,o,h)._parse(e,p):this._parse(e,p)}_parse(e,r){function o(h,p,g){return g==="assert"?new lr(p,[h]):g==="coerce"?new or(p,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[h];if(p){let g=p.parse(e,this);if(!g)return null;if(this.expectedType){const v=this.expectedType,M=g.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||M.kind!=="value"){if(v.kind==="projectionDefinition"&&["string","array"].includes(M.kind)||["color","formatted","resolvedImage"].includes(v.kind)&&["value","string"].includes(M.kind)||["padding","numberArray"].includes(v.kind)&&["value","number","array"].includes(M.kind)||v.kind==="colorArray"&&["value","string","array"].includes(M.kind)||v.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(M.kind))g=o(g,v,r.typeAnnotation||"coerce");else if(this.checkSubtype(v,M))return null}else g=o(g,v,r.typeAnnotation||"assert")}if(!(g instanceof ai)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const v=new Pc;try{g=new ai(g.type,g.evaluate(v))}catch(M){return this.error(M.message),null}}return g}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,o){const h=typeof e=="number"?this.path.concat(e):this.path,p=o?this.scope.concat(o):this.scope;return new Vn(this.registry,this._isConstant,h,r||null,p,this.errors)}error(e,...r){const o=`${this.key}${r.map(h=>`[${h}]`).join("")}`;this.errors.push(new Ri(o,e))}checkSubtype(e,r){const o=oa(e,r);return o&&this.error(o),o}}class os{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let p=1;p<e.length-1;p+=2){const g=e[p];if(typeof g!="string")return r.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=r.parse(e[p+1],p+1);if(!v)return null;o.push([g,v])}const h=r.parse(e[e.length-1],e.length-1,r.expectedType,o);return h?new os(o,h):null}outputDefined(){return this.result.outputDefined()}}class Fa{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=e[1];return r.scope.has(o)?new Fa(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class ho{constructor(e,r,o){this.type=e,this.index=r,this.input=o}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Be),h=r.parse(e[2],2,sr(r.expectedType||ut));return o&&h?new ho(h.type.itemType,o,h):null}evaluate(e){const r=this.index.evaluate(e),o=this.input.evaluate(e);if(r<0)throw new Lt(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new Lt(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new Lt(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Br{constructor(e,r){this.type=_e,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,ut),h=r.parse(e[2],2,ut);return o&&h?rs(o.type,[_e,_t,Be,bt,ut])?new Br(o,h):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${xi(o.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!sn(r,["boolean","string","number","null"]))throw new Lt(`Expected first argument to be of type boolean, string, number or null, but found ${xi(dr(r))} instead.`);if(!sn(o,["string","array"]))throw new Lt(`Expected second argument to be of type array or string, but found ${xi(dr(o))} instead.`);return o.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Ul{constructor(e,r,o){this.type=Be,this.needle=e,this.haystack=r,this.fromIndex=o}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,ut),h=r.parse(e[2],2,ut);if(!o||!h)return null;if(!rs(o.type,[_e,_t,Be,bt,ut]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${xi(o.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,Be);return p?new Ul(o,h,p):null}return new Ul(o,h)}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!sn(r,["boolean","string","number","null"]))throw new Lt(`Expected first argument to be of type boolean, string, number or null, but found ${xi(dr(r))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(e)),sn(o,["string"])){const p=o.indexOf(r,h);return p===-1?-1:[...o.slice(0,p)].length}if(sn(o,["array"]))return o.indexOf(r,h);throw new Lt(`Expected second argument to be of type array or string, but found ${xi(dr(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Sn{constructor(e,r,o,h,p,g){this.inputType=e,this.type=r,this.input=o,this.cases=h,this.outputs=p,this.otherwise=g}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let o,h;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);const p={},g=[];for(let A=2;A<e.length-1;A+=2){let z=e[A];const I=e[A+1];Array.isArray(z)||(z=[z]);const L=r.concat(A);if(z.length===0)return L.error("Expected at least one branch label.");for(const j of z){if(typeof j!="number"&&typeof j!="string")return L.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return L.error("Numeric branch labels must be integer values.");if(o){if(L.checkSubtype(o,dr(j)))return null}else o=dr(j);if(p[String(j)]!==void 0)return L.error("Branch labels must be unique.");p[String(j)]=g.length}const B=r.parse(I,A,h);if(!B)return null;h=h||B.type,g.push(B)}const v=r.parse(e[1],1,ut);if(!v)return null;const M=r.parse(e[e.length-1],e.length-1,h);return M?v.type.kind!=="value"&&r.concat(1).checkSubtype(o,v.type)?null:new Sn(o,h,v,p,g,M):null}evaluate(e){const r=this.input.evaluate(e);return(dr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class tr{constructor(e,r,o){this.type=e,this.branches=r,this.otherwise=o}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const h=[];for(let g=1;g<e.length-1;g+=2){const v=r.parse(e[g],g,_e);if(!v)return null;const M=r.parse(e[g+1],g+1,o);if(!M)return null;h.push([v,M]),o=o||M.type}const p=r.parse(e[e.length-1],e.length-1,o);if(!p)return null;if(!o)throw new Error("Can't infer output type");return new tr(o,h,p)}evaluate(e){for(const[r,o]of this.branches)if(r.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,o]of this.branches)e(r),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class ja{constructor(e,r,o,h){this.type=e,this.input=r,this.beginIndex=o,this.endIndex=h}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,ut),h=r.parse(e[2],2,Be);if(!o||!h)return null;if(!rs(o.type,[sr(ut),_t,ut]))return r.error(`Expected first argument to be of type array or string, but found ${xi(o.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,Be);return p?new ja(o.type,o,h,p):null}return new ja(o.type,o,h)}evaluate(e){const r=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let h;if(this.endIndex&&(h=this.endIndex.evaluate(e)),sn(r,["string"]))return[...r].slice(o,h).join("");if(sn(r,["array"]))return r.slice(o,h);throw new Lt(`Expected first argument to be of type array or string, but found ${xi(dr(r))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Vs(n,e){const r=n.length-1;let o,h,p=0,g=r,v=0;for(;p<=g;)if(v=Math.floor((p+g)/2),o=n[v],h=n[v+1],o<=e){if(v===r||e<h)return v;p=v+1}else{if(!(o>e))throw new Lt("Input is not a number.");g=v-1}return 0}class Qo{constructor(e,r,o){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[h,p]of o)this.labels.push(h),this.outputs.push(p)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(e[1],1,Be);if(!o)return null;const h=[];let p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let g=1;g<e.length;g+=2){const v=g===1?-1/0:e[g],M=e[g+1],A=g,z=g+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(h.length&&h[h.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const I=r.parse(M,z,p);if(!I)return null;p=p||I.type,h.push([v,I])}return new Qo(p,o,h)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return o[0].evaluate(e);const p=r.length;return h>=r[p-1]?o[p-1].evaluate(e):o[Vs(r,h)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Na(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ls,Ic,ef=function(){if(Ic)return ls;function n(e,r,o,h){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=o,this.p2y=h}return Ic=1,ls=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,h=0;h<8;h++){var p=this.sampleCurveX(o)-e;if(Math.abs(p)<r)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=p/g}var v=0,M=1;for(o=e,h=0;h<20&&(p=this.sampleCurveX(o),!(Math.abs(p-e)<r));h++)e>p?v=o:M=o,o=.5*(M-v)+v;return o},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},ls}(),hd=Na(ef);class br{constructor(e,r,o,h,p){this.type=e,this.operator=r,this.interpolation=o,this.input=h,this.labels=[],this.outputs=[];for(const[g,v]of p)this.labels.push(g),this.outputs.push(v)}static interpolationFactor(e,r,o,h){let p=0;if(e.name==="exponential")p=Mu(r,e.base,o,h);else if(e.name==="linear")p=Mu(r,1,o,h);else if(e.name==="cubic-bezier"){const g=e.controlPoints;p=new hd(g[0],g[1],g[2],g[3]).solve(Mu(r,1,o,h))}return p}static parse(e,r){let[o,h,p,...g]=e;if(!Array.isArray(h)||h.length===0)return r.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const A=h[1];if(typeof A!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:A}}else{if(h[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const A=h.slice(1);if(A.length!==4||A.some(z=>typeof z!="number"||z<0||z>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,Be),!p)return null;const v=[];let M=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||r.expectedType==Ei?r.expectedType&&r.expectedType.kind!=="value"&&(M=r.expectedType):M=rt;for(let A=0;A<g.length;A+=2){const z=g[A],I=g[A+1],L=A+3,B=A+4;if(typeof z!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(v.length&&v[v.length-1][0]>=z)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const j=r.parse(I,B,M);if(!j)return null;M=M||j.type,v.push([z,j])}return Nn(M,Be)||Nn(M,It)||Nn(M,rt)||Nn(M,Di)||Nn(M,kr)||Nn(M,Ei)||Nn(M,Hn)||Nn(M,sr(Be))?new br(M,o,h,p,v):r.error(`Type ${xi(M)} is not interpolatable.`)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return o[0].evaluate(e);const p=r.length;if(h>=r[p-1])return o[p-1].evaluate(e);const g=Vs(r,h),v=br.interpolationFactor(this.interpolation,h,r[g],r[g+1]),M=o[g].evaluate(e),A=o[g+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Dt(M,A,v);case"color":return Tt.interpolate(M,A,v);case"padding":return Yi.interpolate(M,A,v);case"colorArray":return Mi.interpolate(M,A,v);case"numberArray":return er.interpolate(M,A,v);case"variableAnchorOffsetCollection":return Bi.interpolate(M,A,v);case"array":return ke(M,A,v);case"projectionDefinition":return Ar.interpolate(M,A,v)}case"interpolate-hcl":switch(this.type.kind){case"color":return Tt.interpolate(M,A,v,"hcl");case"colorArray":return Mi.interpolate(M,A,v,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Tt.interpolate(M,A,v,"lab");case"colorArray":return Mi.interpolate(M,A,v,"lab")}}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Mu(n,e,r,o){const h=o-r,p=n-r;return h===0?0:e===1?p/h:(Math.pow(e,p)-1)/(Math.pow(e,h)-1)}const Gl={color:Tt.interpolate,number:Dt,padding:Yi.interpolate,numberArray:er.interpolate,colorArray:Mi.interpolate,variableAnchorOffsetCollection:Bi.interpolate,array:ke};class ql{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o=null;const h=r.expectedType;h&&h.kind!=="value"&&(o=h);const p=[];for(const v of e.slice(1)){const M=r.parse(v,1+p.length,o,void 0,{typeAnnotation:"omit"});if(!M)return null;o=o||M.type,p.push(M)}if(!o)throw new Error("No output type");const g=h&&p.some(v=>oa(h,v.type));return new ql(g?ut:o,p)}evaluate(e){let r,o=null,h=0;for(const p of this.args)if(h++,o=p.evaluate(e),o&&o instanceof pt&&!o.available&&(r||(r=o.name),o=null,h===this.args.length&&(o=r)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function dd(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Zl(n,e,r,o){return o.compare(e,r)===0}function Ss(n,e,r){const o=n!=="=="&&n!=="!=";return class wg{constructor(p,g,v){this.type=_e,this.lhs=p,this.rhs=g,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const v=p[0];let M=g.parse(p[1],1,ut);if(!M)return null;if(!dd(v,M.type))return g.concat(1).error(`"${v}" comparisons are not supported for type '${xi(M.type)}'.`);let A=g.parse(p[2],2,ut);if(!A)return null;if(!dd(v,A.type))return g.concat(2).error(`"${v}" comparisons are not supported for type '${xi(A.type)}'.`);if(M.type.kind!==A.type.kind&&M.type.kind!=="value"&&A.type.kind!=="value")return g.error(`Cannot compare types '${xi(M.type)}' and '${xi(A.type)}'.`);o&&(M.type.kind==="value"&&A.type.kind!=="value"?M=new lr(A.type,[M]):M.type.kind!=="value"&&A.type.kind==="value"&&(A=new lr(M.type,[A])));let z=null;if(p.length===4){if(M.type.kind!=="string"&&A.type.kind!=="string"&&M.type.kind!=="value"&&A.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(z=g.parse(p[3],3,bi),!z)return null}return new wg(M,A,z)}evaluate(p){const g=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(o&&this.hasUntypedArgument){const M=dr(g),A=dr(v);if(M.kind!==A.kind||M.kind!=="string"&&M.kind!=="number")throw new Lt(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${M.kind}, ${A.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const M=dr(g),A=dr(v);if(M.kind!=="string"||A.kind!=="string")return e(p,g,v)}return this.collator?r(p,g,v,this.collator.evaluate(p)):e(p,g,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const wa=Ss("==",function(n,e,r){return e===r},Zl),Au=Ss("!=",function(n,e,r){return e!==r},function(n,e,r,o){return!Zl(0,e,r,o)}),$l=Ss("<",function(n,e,r){return e<r},function(n,e,r,o){return o.compare(e,r)<0}),Cu=Ss(">",function(n,e,r){return e>r},function(n,e,r,o){return o.compare(e,r)>0}),Jo=Ss("<=",function(n,e,r){return e<=r},function(n,e,r,o){return o.compare(e,r)<=0}),tf=Ss(">=",function(n,e,r){return e>=r},function(n,e,r,o){return o.compare(e,r)>=0});class Us{constructor(e,r,o){this.type=bi,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const h=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,_e);if(!h)return null;const p=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,_e);if(!p)return null;let g=null;return o.locale&&(g=r.parse(o.locale,1,_t),!g)?null:new Us(h,p,g)}evaluate(e){return new Ti(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class cs{constructor(e,r,o,h,p){this.type=_t,this.number=e,this.locale=r,this.currency=o,this.minFractionDigits=h,this.maxFractionDigits=p}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const o=r.parse(e[1],1,Be);if(!o)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return r.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=r.parse(h.locale,1,_t),!p))return null;let g=null;if(h.currency&&(g=r.parse(h.currency,1,_t),!g))return null;let v=null;if(h["min-fraction-digits"]&&(v=r.parse(h["min-fraction-digits"],1,Be),!v))return null;let M=null;return h["max-fraction-digits"]&&(M=r.parse(h["max-fraction-digits"],1,Be),!M)?null:new cs(o,p,g,v,M)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Sa{constructor(e){this.type=Zt,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const h=[];let p=!1;for(let g=1;g<=e.length-1;++g){const v=e[g];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let M=null;if(v["font-scale"]&&(M=r.parse(v["font-scale"],1,Be),!M))return null;let A=null;if(v["text-font"]&&(A=r.parse(v["text-font"],1,sr(_t)),!A))return null;let z=null;if(v["text-color"]&&(z=r.parse(v["text-color"],1,rt),!z))return null;let I=null;if(v["vertical-align"]){if(typeof v["vertical-align"]=="string"&&!$t.includes(v["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${v["vertical-align"]}' instead.`);if(I=r.parse(v["vertical-align"],1,_t),!I)return null}const L=h[h.length-1];L.scale=M,L.font=A,L.textColor=z,L.verticalAlign=I}else{const M=r.parse(e[g],1,ut);if(!M)return null;const A=M.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:M,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Sa(h)}evaluate(e){return new Ii(this.sections.map(r=>{const o=r.content.evaluate(e);return dr(o)===jn?new hi("",o,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(e):null):new hi(xt(o),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null,r.verticalAlign?r.verticalAlign.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor),r.verticalAlign&&e(r.verticalAlign)}outputDefined(){return!1}}class Ai{constructor(e){this.type=jn,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const o=r.parse(e[1],1,_t);return o?new Ai(o):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),o=pt.fromString(r);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(r)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Gs{constructor(e){this.type=Be,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=r.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${xi(o.type)} instead.`):new Gs(o):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Lt(`Expected value to be of type string or array, but found ${xi(dr(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Tn=8192;function fo(n,e){const r=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(r*h*Tn),Math.round(o*h*Tn)]}function po(n,e){const r=Math.pow(2,e.z);return[(h=(n[0]/Tn+e.x)/r,360*h-180),(o=(n[1]/Tn+e.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,h}function pi(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Va(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function kc(n,e,r){return e[1]>n[1]!=r[1]>n[1]&&n[0]<(r[0]-e[0])*(n[1]-e[1])/(r[1]-e[1])+e[0]}function mo(n,e,r){const o=n[0]-e[0],h=n[1]-e[1],p=n[0]-r[0],g=n[1]-r[1];return o*g-p*h==0&&o*p<=0&&h*g<=0}function Jr(n,e,r,o){return(h=[o[0]-r[0],o[1]-r[1]])[0]*(p=[e[0]-n[0],e[1]-n[1]])[1]-h[1]*p[0]!=0&&!(!Dn(n,e,r,o)||!Dn(r,o,n,e));var h,p}function Mn(n,e,r){for(const o of r)for(let h=0;h<o.length-1;++h)if(Jr(n,e,o[h],o[h+1]))return!0;return!1}function on(n,e,r=!1){let o=!1;for(const h of e)for(let p=0;p<h.length-1;p++){if(mo(n,h[p],h[p+1]))return r;kc(n,h[p],h[p+1])&&(o=!o)}return o}function mn(n,e){for(const r of e)if(on(n,r))return!0;return!1}function ir(n,e){for(const r of n)if(!on(r,e))return!1;for(let r=0;r<n.length-1;++r)if(Mn(n[r],n[r+1],e))return!1;return!0}function qs(n,e){for(const r of e)if(ir(n,r))return!0;return!1}function Dn(n,e,r,o){const h=o[0]-r[0],p=o[1]-r[1],g=(n[0]-r[0])*p-h*(n[1]-r[1]),v=(e[0]-r[0])*p-h*(e[1]-r[1]);return g>0&&v<0||g<0&&v>0}function An(n,e,r){const o=[];for(let h=0;h<n.length;h++){const p=[];for(let g=0;g<n[h].length;g++){const v=fo(n[h][g],r);pi(e,v),p.push(v)}o.push(p)}return o}function Gr(n,e,r){const o=[];for(let h=0;h<n.length;h++){const p=An(n[h],e,r);o.push(p)}return o}function wr(n,e,r,o){if(n[0]<r[0]||n[0]>r[2]){const h=.5*o;let p=n[0]-r[0]>h?-o:r[0]-n[0]>h?o:0;p===0&&(p=n[0]-r[2]>h?-o:r[2]-n[0]>h?o:0),n[0]+=p}pi(e,n)}function Ts(n,e,r,o){const h=Math.pow(2,o.z)*Tn,p=[o.x*Tn,o.y*Tn],g=[];for(const v of n)for(const M of v){const A=[M.x+p[0],M.y+p[1]];wr(A,e,r,h),g.push(A)}return g}function ii(n,e,r,o){const h=Math.pow(2,o.z)*Tn,p=[o.x*Tn,o.y*Tn],g=[];for(const M of n){const A=[];for(const z of M){const I=[z.x+p[0],z.y+p[1]];pi(e,I),A.push(I)}g.push(A)}if(e[2]-e[0]<=h/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const M of g)for(const A of M)wr(A,e,r,h)}var v;return g}class ri{constructor(e,r){this.type=_e,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ba(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const h=[];for(const p of o.features){const{type:g,coordinates:v}=p.geometry;g==="Polygon"&&h.push(v),g==="MultiPolygon"&&h.push(...v)}if(h.length)return new ri(o,{type:"MultiPolygon",coordinates:h})}else if(o.type==="Feature"){const h=o.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new ri(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new ri(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,o){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(o.type==="Polygon"){const v=An(o.coordinates,p,g),M=Ts(r.geometry(),h,p,g);if(!Va(h,p))return!1;for(const A of M)if(!on(A,v))return!1}if(o.type==="MultiPolygon"){const v=Gr(o.coordinates,p,g),M=Ts(r.geometry(),h,p,g);if(!Va(h,p))return!1;for(const A of M)if(!mn(A,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,o){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(o.type==="Polygon"){const v=An(o.coordinates,p,g),M=ii(r.geometry(),h,p,g);if(!Va(h,p))return!1;for(const A of M)if(!ir(A,v))return!1}if(o.type==="MultiPolygon"){const v=Gr(o.coordinates,p,g),M=ii(r.geometry(),h,p,g);if(!Va(h,p))return!1;for(const A of M)if(!qs(A,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ua=class{constructor(n=[],e=(r,o)=>r<o?-1:r>o?1:0){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:e,compare:r}=this,o=e[n];for(;n>0;){const h=n-1>>1,p=e[h];if(r(o,p)>=0)break;e[n]=p,n=h}e[n]=o}_down(n){const{data:e,compare:r}=this,o=this.length>>1,h=e[n];for(;n<o;){let p=1+(n<<1);const g=p+1;if(g<this.length&&r(e[g],e[p])<0&&(p=g),r(e[p],h)>=0)break;e[n]=e[p],n=p}e[n]=h}};function Li(n,e,r=0,o=n.length-1,h=Xn){for(;o>r;){if(o-r>600){const M=o-r+1,A=e-r+1,z=Math.log(M),I=.5*Math.exp(2*z/3),L=.5*Math.sqrt(z*I*(M-I)/M)*(A-M/2<0?-1:1);Li(n,e,Math.max(r,Math.floor(e-A*I/M+L)),Math.min(o,Math.floor(e+(M-A)*I/M+L)),h)}const p=n[e];let g=r,v=o;for(fr(n,r,e),h(n[o],p)>0&&fr(n,r,o);g<v;){for(fr(n,g,v),g++,v--;h(n[g],p)<0;)g++;for(;h(n[v],p)>0;)v--}h(n[r],p)===0?fr(n,r,v):(v++,fr(n,v,o)),v<=e&&(r=v+1),e<=v&&(o=v-1)}}function fr(n,e,r){const o=n[e];n[e]=n[r],n[r]=o}function Xn(n,e){return n<e?-1:n>e?1:0}function Yn(n,e){if(n.length<=1)return[n];const r=[];let o,h;for(const p of n){const g=fd(p);g!==0&&(p.area=Math.abs(g),h===void 0&&(h=g<0),h===g<0?(o&&r.push(o),o=[p]):o.push(p))}if(o&&r.push(o),e>1)for(let p=0;p<r.length;p++)r[p].length<=e||(Li(r[p],e,1,r[p].length-1,el),r[p]=r[p].slice(0,e));return r}function el(n,e){return e.area-n.area}function fd(n){let e=0;for(let r,o,h=0,p=n.length,g=p-1;h<p;g=h++)r=n[h],o=n[g],e+=(o.x-r.x)*(r.y+o.y);return e}const go=1/298.257223563,tl=go*(2-go),yo=Math.PI/180;class _o{constructor(e){const r=6378.137*yo*1e3,o=Math.cos(e*yo),h=1/(1-tl*(1-o*o)),p=Math.sqrt(h);this.kx=r*p*o,this.ky=r*p*h*(1-tl)}distance(e,r){const o=this.wrap(e[0]-r[0])*this.kx,h=(e[1]-r[1])*this.ky;return Math.sqrt(o*o+h*h)}pointOnLine(e,r){let o,h,p,g,v=1/0;for(let M=0;M<e.length-1;M++){let A=e[M][0],z=e[M][1],I=this.wrap(e[M+1][0]-A)*this.kx,L=(e[M+1][1]-z)*this.ky,B=0;I===0&&L===0||(B=(this.wrap(r[0]-A)*this.kx*I+(r[1]-z)*this.ky*L)/(I*I+L*L),B>1?(A=e[M+1][0],z=e[M+1][1]):B>0&&(A+=I/this.kx*B,z+=L/this.ky*B)),I=this.wrap(r[0]-A)*this.kx,L=(r[1]-z)*this.ky;const j=I*I+L*L;j<v&&(v=j,o=A,h=z,p=M,g=B)}return{point:[o,h],index:p,t:Math.max(0,Math.min(1,g))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Rc(n,e){return e[0]-n[0]}function Ta(n){return n[1]-n[0]+1}function Rr(n,e){return n[1]>=n[0]&&n[1]<e}function il(n,e){if(n[0]>n[1])return[null,null];const r=Ta(n);if(e){if(r===2)return[n,null];const h=Math.floor(r/2);return[[n[0],n[0]+h],[n[0]+h,n[1]]]}if(r===1)return[n,null];const o=Math.floor(r/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}function xo(n,e){if(!Rr(e,n.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)pi(r,n[o]);return r}function vo(n){const e=[1/0,1/0,-1/0,-1/0];for(const r of n)for(const o of r)pi(e,o);return e}function en(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Mh(n,e,r){if(!en(n)||!en(e))return NaN;let o=0,h=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(h=n[1]-e[3]),n[3]<e[1]&&(h=e[1]-n[3]),r.distance([0,0],[o,h])}function Ms(n,e,r){const o=r.pointOnLine(e,n);return r.distance(n,o.point)}function Eu(n,e,r,o,h){const p=Math.min(Ms(n,[r,o],h),Ms(e,[r,o],h)),g=Math.min(Ms(r,[n,e],h),Ms(o,[n,e],h));return Math.min(p,g)}function rf(n,e,r,o,h){if(!Rr(e,n.length)||!Rr(o,r.length))return 1/0;let p=1/0;for(let g=e[0];g<e[1];++g){const v=n[g],M=n[g+1];for(let A=o[0];A<o[1];++A){const z=r[A],I=r[A+1];if(Jr(v,M,z,I))return 0;p=Math.min(p,Eu(v,M,z,I,h))}}return p}function Dc(n,e,r,o,h){if(!Rr(e,n.length)||!Rr(o,r.length))return NaN;let p=1/0;for(let g=e[0];g<=e[1];++g)for(let v=o[0];v<=o[1];++v)if(p=Math.min(p,h.distance(n[g],r[v])),p===0)return p;return p}function Un(n,e,r){if(on(n,e,!0))return 0;let o=1/0;for(const h of e){const p=h[0],g=h[h.length-1];if(p!==g&&(o=Math.min(o,Ms(n,[g,p],r)),o===0))return o;const v=r.pointOnLine(h,n);if(o=Math.min(o,r.distance(n,v.point)),o===0)return o}return o}function zu(n,e,r,o){if(!Rr(e,n.length))return NaN;for(let p=e[0];p<=e[1];++p)if(on(n[p],r,!0))return 0;let h=1/0;for(let p=e[0];p<e[1];++p){const g=n[p],v=n[p+1];for(const M of r)for(let A=0,z=M.length,I=z-1;A<z;I=A++){const L=M[I],B=M[A];if(Jr(g,v,L,B))return 0;h=Math.min(h,Eu(g,v,L,B,o))}}return h}function As(n,e){for(const r of n)for(const o of r)if(on(o,e,!0))return!0;return!1}function Hl(n,e,r,o=1/0){const h=vo(n),p=vo(e);if(o!==1/0&&Mh(h,p,r)>=o)return o;if(Va(h,p)){if(As(n,e))return 0}else if(As(e,n))return 0;let g=1/0;for(const v of n)for(let M=0,A=v.length,z=A-1;M<A;z=M++){const I=v[z],L=v[M];for(const B of e)for(let j=0,q=B.length,X=q-1;j<q;X=j++){const J=B[X],ue=B[j];if(Jr(I,L,J,ue))return 0;g=Math.min(g,Eu(I,L,J,ue,r))}}return g}function Lc(n,e,r,o,h,p){if(!p)return;const g=Mh(xo(o,p),h,r);g<e&&n.push([g,p,[0,0]])}function rl(n,e,r,o,h,p,g){if(!p||!g)return;const v=Mh(xo(o,p),xo(h,g),r);v<e&&n.push([v,p,g])}function Cn(n,e,r,o,h=1/0){let p=Math.min(o.distance(n[0],r[0][0]),h);if(p===0)return p;const g=new Ua([[0,[0,n.length-1],[0,0]]],Rc),v=vo(r);for(;g.length>0;){const M=g.pop();if(M[0]>=p)continue;const A=M[1],z=e?50:100;if(Ta(A)<=z){if(!Rr(A,n.length))return NaN;if(e){const I=zu(n,A,r,o);if(isNaN(I)||I===0)return I;p=Math.min(p,I)}else for(let I=A[0];I<=A[1];++I){const L=Un(n[I],r,o);if(p=Math.min(p,L),p===0)return 0}}else{const I=il(A,e);Lc(g,p,o,n,v,I[0]),Lc(g,p,o,n,v,I[1])}}return p}function Bc(n,e,r,o,h,p=1/0){let g=Math.min(p,h.distance(n[0],r[0]));if(g===0)return g;const v=new Ua([[0,[0,n.length-1],[0,r.length-1]]],Rc);for(;v.length>0;){const M=v.pop();if(M[0]>=g)continue;const A=M[1],z=M[2],I=e?50:100,L=o?50:100;if(Ta(A)<=I&&Ta(z)<=L){if(!Rr(A,n.length)&&Rr(z,r.length))return NaN;let B;if(e&&o)B=rf(n,A,r,z,h),g=Math.min(g,B);else if(e&&!o){const j=n.slice(A[0],A[1]+1);for(let q=z[0];q<=z[1];++q)if(B=Ms(r[q],j,h),g=Math.min(g,B),g===0)return g}else if(!e&&o){const j=r.slice(z[0],z[1]+1);for(let q=A[0];q<=A[1];++q)if(B=Ms(n[q],j,h),g=Math.min(g,B),g===0)return g}else B=Dc(n,A,r,z,h),g=Math.min(g,B)}else{const B=il(A,e),j=il(z,o);rl(v,g,h,n,r,B[0],j[0]),rl(v,g,h,n,r,B[0],j[1]),rl(v,g,h,n,r,B[1],j[0]),rl(v,g,h,n,r,B[1],j[1])}}return g}function Oc(n){return n.type==="MultiPolygon"?n.coordinates.map(e=>({type:"Polygon",coordinates:e})):n.type==="MultiLineString"?n.coordinates.map(e=>({type:"LineString",coordinates:e})):n.type==="MultiPoint"?n.coordinates.map(e=>({type:"Point",coordinates:e})):[n]}class Xl{constructor(e,r){this.type=Be,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ba(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new Xl(o,o.features.map(h=>Oc(h.geometry)).flat());if(o.type==="Feature")return new Xl(o,Oc(o.geometry));if("type"in o&&"coordinates"in o)return new Xl(o,Oc(o))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,o){const h=r.geometry(),p=h.flat().map(M=>po([M.x,M.y],r.canonical));if(h.length===0)return NaN;const g=new _o(p[0][1]);let v=1/0;for(const M of o){switch(M.type){case"Point":v=Math.min(v,Bc(p,!1,[M.coordinates],!1,g,v));break;case"LineString":v=Math.min(v,Bc(p,!1,M.coordinates,!0,g,v));break;case"Polygon":v=Math.min(v,Cn(p,!1,M.coordinates,g,v))}if(v===0)return v}return v}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,o){const h=r.geometry(),p=h.flat().map(M=>po([M.x,M.y],r.canonical));if(h.length===0)return NaN;const g=new _o(p[0][1]);let v=1/0;for(const M of o){switch(M.type){case"Point":v=Math.min(v,Bc(p,!0,[M.coordinates],!1,g,v));break;case"LineString":v=Math.min(v,Bc(p,!0,M.coordinates,!0,g,v));break;case"Polygon":v=Math.min(v,Cn(p,!0,M.coordinates,g,v))}if(v===0)return v}return v}(e,this.geometries);if(e.geometryType()==="Polygon")return function(r,o){const h=r.geometry();if(h.length===0||h[0].length===0)return NaN;const p=Yn(h,0).map(M=>M.map(A=>A.map(z=>po([z.x,z.y],r.canonical)))),g=new _o(p[0][0][0][1]);let v=1/0;for(const M of o)for(const A of p){switch(M.type){case"Point":v=Math.min(v,Cn([M.coordinates],!1,A,g,v));break;case"LineString":v=Math.min(v,Cn(M.coordinates,!0,A,g,v));break;case"Polygon":v=Math.min(v,Hl(A,M.coordinates,g,v))}if(v===0)return v}return v}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Yl{constructor(e){this.type=ut,this.key=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?r.error("Global state property must be defined."):typeof o!="string"?r.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Yl(o)}evaluate(e){var r;const o=(r=e.globals)===null||r===void 0?void 0:r.globalState;return o&&Object.keys(o).length!==0?Pe(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Fc={"==":wa,"!=":Au,">":Cu,"<":$l,">=":tf,"<=":Jo,array:lr,at:ho,boolean:lr,case:tr,coalesce:ql,collator:Us,format:Sa,image:Ai,in:Br,"index-of":Ul,interpolate:br,"interpolate-hcl":br,"interpolate-lab":br,length:Gs,let:os,literal:ai,match:Sn,number:lr,"number-format":cs,object:lr,slice:ja,step:Qo,string:lr,"to-boolean":or,"to-color":or,"to-number":or,"to-string":or,var:Fa,within:ri,distance:Xl,"global-state":Yl};class us{constructor(e,r,o,h){this.name=e,this.type=r,this._evaluate=o,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const o=e[0],h=us.definitions[o];if(!h)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=g.filter(([A])=>!Array.isArray(A)||A.length===e.length-1);let M=null;for(const[A,z]of v){M=new Vn(r.registry,So,r.path,null,r.scope);const I=[];let L=!1;for(let B=1;B<e.length;B++){const j=e[B],q=Array.isArray(A)?A[B-1]:A.type,X=M.parse(j,1+I.length,q);if(!X){L=!0;break}I.push(X)}if(!L)if(Array.isArray(A)&&A.length!==I.length)M.error(`Expected ${A.length} arguments, but found ${I.length} instead.`);else{for(let B=0;B<I.length;B++){const j=Array.isArray(A)?A[B]:A.type,q=I[B];M.concat(B+1).checkSubtype(j,q.type)}if(M.errors.length===0)return new us(o,p,z,I)}}if(v.length===1)r.errors.push(...M.errors);else{const A=(v.length?v:g).map(([I])=>{return L=I,Array.isArray(L)?`(${L.map(xi).join(", ")})`:`(${xi(L.type)}...)`;var L}).join(" | "),z=[];for(let I=1;I<e.length;I++){const L=r.parse(e[I],1+z.length);if(!L)return null;z.push(xi(L.type))}r.error(`Expected arguments of type ${A}, but found (${z.join(", ")}) instead.`)}return null}static register(e,r){us.definitions=r;for(const o in r)e[o]=us}}function Pu(n,[e,r,o,h]){e=e.evaluate(n),r=r.evaluate(n),o=o.evaluate(n);const p=h?h.evaluate(n):1,g=Ur(e,r,o,p);if(g)throw new Lt(g);return new Tt(e/255,r/255,o/255,p,!1)}function Ah(n,e){return n in e}function bo(n,e){const r=e[n];return r===void 0?null:r}function wo(n){return{type:n}}function So(n){if(n instanceof Fa)return So(n.boundExpression);if(n instanceof us&&n.name==="error"||n instanceof Us||n instanceof ri||n instanceof Xl||n instanceof Yl)return!1;const e=n instanceof or||n instanceof lr;let r=!0;return n.eachChild(o=>{r=e?r&&So(o):r&&o instanceof ai}),!!r&&Ln(n)&&nl(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Ln(n){if(n instanceof us&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof ri||n instanceof Xl)return!1;let e=!0;return n.eachChild(r=>{e&&!Ln(r)&&(e=!1)}),e}function Iu(n){if(n instanceof us&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(r=>{e&&!Iu(r)&&(e=!1)}),e}function nl(n,e){if(n instanceof us&&e.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(o=>{r&&!nl(o,e)&&(r=!1)}),r}function Wl(n){return{result:"success",value:n}}function Cs(n){return{result:"error",value:n}}function Kl(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function jc(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function al(n){return!!n.expression&&n.expression.interpolated}function Si(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function ku(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&dr(n)===mt}function pd(n){return n}function md(n,e){const r=n.stops&&typeof n.stops[0][0]=="object",o=r||!(r||n.property!==void 0),h=n.type||(al(e)?"exponential":"interval"),p=function(z){switch(z.type){case"color":return Tt.parse;case"padding":return Yi.parse;case"numberArray":return er.parse;case"colorArray":return Mi.parse;default:return null}}(e);if(p&&((n=fn({},n)).stops&&(n.stops=n.stops.map(z=>[z[0],p(z[1])])),n.default=p(n.default?n.default:e.default)),n.colorSpace&&(g=n.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var g;const v=function(z){switch(z){case"exponential":return Ru;case"interval":return Nc;case"categorical":return Jl;case"identity":return Du;default:throw new Error(`Unknown function type "${z}"`)}}(h);let M,A;if(h==="categorical"){M=Object.create(null);for(const z of n.stops)M[z[0]]=z[1];A=typeof n.stops[0][0]}if(r){const z={},I=[];for(let j=0;j<n.stops.length;j++){const q=n.stops[j],X=q[0].zoom;z[X]===void 0&&(z[X]={zoom:X,type:n.type,property:n.property,default:n.default,stops:[]},I.push(X)),z[X].stops.push([q[0].value,q[1]])}const L=[];for(const j of I)L.push([z[j].zoom,md(z[j],e)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:br.interpolationFactor.bind(void 0,B),zoomStops:L.map(j=>j[0]),evaluate:({zoom:j},q)=>Ru({stops:L,base:n.base},e,j).evaluate(j,q)}}if(o){const z=h==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:br.interpolationFactor.bind(void 0,z),zoomStops:n.stops.map(I=>I[0]),evaluate:({zoom:I})=>v(n,e,I,M,A)}}return{kind:"source",evaluate(z,I){const L=I&&I.properties?I.properties[n.property]:void 0;return L===void 0?Ql(n.default,e.default):v(n,e,L,M,A)}}}function Ql(n,e,r){return n!==void 0?n:e!==void 0?e:r!==void 0?r:void 0}function Jl(n,e,r,o,h){return Ql(typeof r===h?o[r]:void 0,n.default,e.default)}function Nc(n,e,r){if(Si(r)!=="number")return Ql(n.default,e.default);const o=n.stops.length;if(o===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[o-1][0])return n.stops[o-1][1];const h=Vs(n.stops.map(p=>p[0]),r);return n.stops[h][1]}function Ru(n,e,r){const o=n.base!==void 0?n.base:1;if(Si(r)!=="number")return Ql(n.default,e.default);const h=n.stops.length;if(h===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[h-1][0])return n.stops[h-1][1];const p=Vs(n.stops.map(z=>z[0]),r),g=function(z,I,L,B){const j=B-L,q=z-L;return j===0?0:I===1?q/j:(Math.pow(I,q)-1)/(Math.pow(I,j)-1)}(r,o,n.stops[p][0],n.stops[p+1][0]),v=n.stops[p][1],M=n.stops[p+1][1],A=Gl[e.type]||pd;return typeof v.evaluate=="function"?{evaluate(...z){const I=v.evaluate.apply(void 0,z),L=M.evaluate.apply(void 0,z);if(I!==void 0&&L!==void 0)return A(I,L,g,n.colorSpace)}}:A(v,M,g,n.colorSpace)}function Du(n,e,r){switch(e.type){case"color":r=Tt.parse(r);break;case"formatted":r=Ii.fromString(r.toString());break;case"resolvedImage":r=pt.fromString(r.toString());break;case"padding":r=Yi.parse(r);break;case"colorArray":r=Mi.parse(r);break;case"numberArray":r=er.parse(r);break;default:Si(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Ql(r,n.default,e.default)}us.register(Fc,{error:[{kind:"error"},[_t],(n,[e])=>{throw new Lt(e.evaluate(n))}],typeof:[_t,[ut],(n,[e])=>xi(dr(e.evaluate(n)))],"to-rgba":[sr(Be,4),[rt],(n,[e])=>{const[r,o,h,p]=e.evaluate(n).rgb;return[255*r,255*o,255*h,p]}],rgb:[rt,[Be,Be,Be],Pu],rgba:[rt,[Be,Be,Be,Be],Pu],has:{type:_e,overloads:[[[_t],(n,[e])=>Ah(e.evaluate(n),n.properties())],[[_t,mt],(n,[e,r])=>Ah(e.evaluate(n),r.evaluate(n))]]},get:{type:ut,overloads:[[[_t],(n,[e])=>bo(e.evaluate(n),n.properties())],[[_t,mt],(n,[e,r])=>bo(e.evaluate(n),r.evaluate(n))]]},"feature-state":[ut,[_t],(n,[e])=>bo(e.evaluate(n),n.featureState||{})],properties:[mt,[],n=>n.properties()],"geometry-type":[_t,[],n=>n.geometryType()],id:[ut,[],n=>n.id()],zoom:[Be,[],n=>n.globals.zoom],"heatmap-density":[Be,[],n=>n.globals.heatmapDensity||0],elevation:[Be,[],n=>n.globals.elevation||0],"line-progress":[Be,[],n=>n.globals.lineProgress||0],accumulated:[ut,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Be,wo(Be),(n,e)=>{let r=0;for(const o of e)r+=o.evaluate(n);return r}],"*":[Be,wo(Be),(n,e)=>{let r=1;for(const o of e)r*=o.evaluate(n);return r}],"-":{type:Be,overloads:[[[Be,Be],(n,[e,r])=>e.evaluate(n)-r.evaluate(n)],[[Be],(n,[e])=>-e.evaluate(n)]]},"/":[Be,[Be,Be],(n,[e,r])=>e.evaluate(n)/r.evaluate(n)],"%":[Be,[Be,Be],(n,[e,r])=>e.evaluate(n)%r.evaluate(n)],ln2:[Be,[],()=>Math.LN2],pi:[Be,[],()=>Math.PI],e:[Be,[],()=>Math.E],"^":[Be,[Be,Be],(n,[e,r])=>Math.pow(e.evaluate(n),r.evaluate(n))],sqrt:[Be,[Be],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Be,[Be],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Be,[Be],(n,[e])=>Math.log(e.evaluate(n))],log2:[Be,[Be],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Be,[Be],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Be,[Be],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Be,[Be],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Be,[Be],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Be,[Be],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Be,[Be],(n,[e])=>Math.atan(e.evaluate(n))],min:[Be,wo(Be),(n,e)=>Math.min(...e.map(r=>r.evaluate(n)))],max:[Be,wo(Be),(n,e)=>Math.max(...e.map(r=>r.evaluate(n)))],abs:[Be,[Be],(n,[e])=>Math.abs(e.evaluate(n))],round:[Be,[Be],(n,[e])=>{const r=e.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Be,[Be],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Be,[Be],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[_e,[_t,ut],(n,[e,r])=>n.properties()[e.value]===r.value],"filter-id-==":[_e,[ut],(n,[e])=>n.id()===e.value],"filter-type-==":[_e,[_t],(n,[e])=>n.geometryType()===e.value],"filter-<":[_e,[_t,ut],(n,[e,r])=>{const o=n.properties()[e.value],h=r.value;return typeof o==typeof h&&o<h}],"filter-id-<":[_e,[ut],(n,[e])=>{const r=n.id(),o=e.value;return typeof r==typeof o&&r<o}],"filter->":[_e,[_t,ut],(n,[e,r])=>{const o=n.properties()[e.value],h=r.value;return typeof o==typeof h&&o>h}],"filter-id->":[_e,[ut],(n,[e])=>{const r=n.id(),o=e.value;return typeof r==typeof o&&r>o}],"filter-<=":[_e,[_t,ut],(n,[e,r])=>{const o=n.properties()[e.value],h=r.value;return typeof o==typeof h&&o<=h}],"filter-id-<=":[_e,[ut],(n,[e])=>{const r=n.id(),o=e.value;return typeof r==typeof o&&r<=o}],"filter->=":[_e,[_t,ut],(n,[e,r])=>{const o=n.properties()[e.value],h=r.value;return typeof o==typeof h&&o>=h}],"filter-id->=":[_e,[ut],(n,[e])=>{const r=n.id(),o=e.value;return typeof r==typeof o&&r>=o}],"filter-has":[_e,[ut],(n,[e])=>e.value in n.properties()],"filter-has-id":[_e,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[_e,[sr(_t)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[_e,[sr(ut)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[_e,[_t,sr(ut)],(n,[e,r])=>r.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[_e,[_t,sr(ut)],(n,[e,r])=>function(o,h,p,g){for(;p<=g;){const v=p+g>>1;if(h[v]===o)return!0;h[v]>o?g=v-1:p=v+1}return!1}(n.properties()[e.value],r.value,0,r.value.length-1)],all:{type:_e,overloads:[[[_e,_e],(n,[e,r])=>e.evaluate(n)&&r.evaluate(n)],[wo(_e),(n,e)=>{for(const r of e)if(!r.evaluate(n))return!1;return!0}]]},any:{type:_e,overloads:[[[_e,_e],(n,[e,r])=>e.evaluate(n)||r.evaluate(n)],[wo(_e),(n,e)=>{for(const r of e)if(r.evaluate(n))return!0;return!1}]]},"!":[_e,[_e],(n,[e])=>!e.evaluate(n)],"is-supported-script":[_e,[_t],(n,[e])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(e.evaluate(n))}],upcase:[_t,[_t],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[_t,[_t],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[_t,wo(ut),(n,e)=>e.map(r=>xt(r.evaluate(n))).join("")],"resolved-locale":[_t,[bi],(n,[e])=>e.evaluate(n).resolvedLocale()]});class Lu{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new Pc,this._defaultValue=r?function(o){if(o.type==="color"&&ku(o.default))return new Tt(0,0,0,0);switch(o.type){case"color":return Tt.parse(o.default)||null;case"padding":return Yi.parse(o.default)||null;case"numberArray":return er.parse(o.default)||null;case"colorArray":return Mi.parse(o.default)||null;case"variableAnchorOffsetCollection":return Bi.parse(o.default)||null;case"projectionDefinition":return Ar.parse(o.default)||null;default:return o.default===void 0?null:o.default}}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,o,h,p,g){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=h,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,r,o,h,p,g){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=h,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Lt(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Es(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Fc}function Zs(n,e){const r=new Vn(Fc,So,[],e?function(h){const p={color:rt,string:_t,number:Be,enum:_t,boolean:_e,formatted:Zt,padding:Di,numberArray:kr,colorArray:Ei,projectionDefinition:It,resolvedImage:jn,variableAnchorOffsetCollection:Hn};return h.type==="array"?sr(p[h.value]||ut,h.length):p[h.type]}(e):void 0),o=r.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?Wl(new Lu(o,e)):Cs(r.errors)}class sl{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Iu(r.expression),this.globalStateRefs=Ch(r.expression)}evaluateWithoutErrorHandling(e,r,o,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,h,p,g)}evaluate(e,r,o,h,p,g){return this._styleExpression.evaluate(e,r,o,h,p,g)}}class ol{constructor(e,r,o,h){this.kind=e,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Iu(r.expression),this.globalStateRefs=Ch(r.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,r,o,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,h,p,g)}evaluate(e,r,o,h,p,g){return this._styleExpression.evaluate(e,r,o,h,p,g)}interpolationFactor(e,r,o){return this.interpolationType?br.interpolationFactor(this.interpolationType,e,r,o):0}}function gd(n,e){const r=Zs(n,e);if(r.result==="error")return r;const o=r.value.expression,h=Ln(o);if(!h&&!Kl(e))return Cs([new Ri("","data expressions not supported")]);const p=nl(o,["zoom"]);if(!p&&!jc(e))return Cs([new Ri("","zoom expressions not supported")]);const g=Bu(o);return g||p?g instanceof Ri?Cs([g]):g instanceof br&&!al(e)?Cs([new Ri("",'"interpolate" expressions cannot be used with this property')]):Wl(g?new ol(h?"camera":"composite",r.value,g.labels,g instanceof br?g.interpolation:void 0):new sl(h?"constant":"source",r.value)):Cs([new Ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class To{constructor(e,r){this._parameters=e,this._specification=r,fn(this,md(this._parameters,this._specification))}static deserialize(e){return new To(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Bu(n){let e=null;if(n instanceof os)e=Bu(n.result);else if(n instanceof ql){for(const r of n.args)if(e=Bu(r),e)break}else(n instanceof Qo||n instanceof br)&&n.input instanceof us&&n.input.name==="zoom"&&(e=n);return e instanceof Ri||n.eachChild(r=>{const o=Bu(r);o instanceof Ri?e=o:!e&&o?e=new Ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Ri("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Ch(n,e=new Set){return n instanceof Yl&&e.add(n.key),n.eachChild(r=>{Ch(r,e)}),e}function Eh(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Eh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const nf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ec(n){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Eh(n)||(n=ll(n));const e=Zs(n,nf);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,o,h)=>e.value.evaluate(r,o,{},h),needGeometry:tc(n),getGlobalStateRefs:()=>Ch(e.value.expression)}}function la(n,e){return n<e?-1:n>e?1:0}function tc(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(tc(n[e]))return!0;return!1}function ll(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?hs(n[1],n[2],"=="):e==="!="?cl(hs(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?hs(n[1],n[2],e):e==="any"?(r=n.slice(1),["any"].concat(r.map(ll))):e==="all"?["all"].concat(n.slice(1).map(ll)):e==="none"?["all"].concat(n.slice(1).map(ll).map(cl)):e==="in"?Ui(n[1],n.slice(2)):e==="!in"?cl(Ui(n[1],n.slice(2))):e==="has"?Ou(n[1]):e!=="!has"||cl(Ou(n[1]));var r}function hs(n,e,r){switch(n){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,n,e]}}function Ui(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",n,["literal",e.sort(la)]]:["filter-in-small",n,["literal",e]]}}function Ou(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function cl(n){return["!",n]}function zh(n){const e=typeof n;if(e==="number"||e==="boolean"||e==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let h="[";for(const p of n)h+=`${zh(p)},`;return`${h}]`}const r=Object.keys(n).sort();let o="{";for(let h=0;h<r.length;h++)o+=`${JSON.stringify(r[h])}:${zh(n[r[h]])},`;return`${o}}`}function ul(n){let e="";for(const r of Ji)e+=`/${zh(n[r])}`;return e}function $s(n){const e=n.value;return e?[new ft(n.key,e,"constants have been deprecated as of v8")]:[]}function Sr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Mo(n){if(Array.isArray(n))return n.map(Mo);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const r in n)e[r]=Mo(n[r]);return e}return Sr(n)}function Ga(n){const e=n.key,r=n.value,o=n.valueSpec||{},h=n.objectElementValidators||{},p=n.style,g=n.styleSpec,v=n.validateSpec;let M=[];const A=Si(r);if(A!=="object")return[new ft(e,r,`object expected, ${A} found`)];for(const z in r){const I=z.split(".")[0],L=Pe(o,I)||o["*"];let B;if(Pe(h,I))B=h[I];else if(Pe(o,I))B=v;else if(h["*"])B=h["*"];else{if(!o["*"]){M.push(new ft(e,r[z],`unknown property "${z}"`));continue}B=v}M=M.concat(B({key:(e&&`${e}.`)+z,value:r[z],valueSpec:L,style:p,styleSpec:g,object:r,objectKey:z,validateSpec:v},r))}for(const z in o)h[z]||o[z].required&&o[z].default===void 0&&r[z]===void 0&&M.push(new ft(e,r,`missing required property "${z}"`));return M}function Ao(n){const e=n.value,r=n.valueSpec,o=n.style,h=n.styleSpec,p=n.key,g=n.arrayElementValidator||n.validateSpec;if(Si(e)!=="array")return[new ft(p,e,`array expected, ${Si(e)} found`)];if(r.length&&e.length!==r.length)return[new ft(p,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new ft(p,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let v={type:r.value,values:r.values};h.$version<7&&(v.function=r.function),Si(r.value)==="object"&&(v=r.value);let M=[];for(let A=0;A<e.length;A++)M=M.concat(g({array:e,arrayIndex:A,value:e[A],valueSpec:v,validateSpec:n.validateSpec,style:o,styleSpec:h,key:`${p}[${A}]`}));return M}function Co(n){const e=n.key,r=n.value,o=n.valueSpec;let h=Si(r);return h==="number"&&r!=r&&(h="NaN"),h!=="number"?[new ft(e,r,`number expected, ${h} found`)]:"minimum"in o&&r<o.minimum?[new ft(e,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new ft(e,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function Fu(n){const e=n.valueSpec,r=Sr(n.value.type);let o,h,p,g={};const v=r!=="categorical"&&n.value.property===void 0,M=!v,A=Si(n.value.stops)==="array"&&Si(n.value.stops[0])==="array"&&Si(n.value.stops[0][0])==="object",z=Ga({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(B){if(r==="identity")return[new ft(B.key,B.value,'identity function may not have a "stops" property')];let j=[];const q=B.value;return j=j.concat(Ao({key:B.key,value:q,valueSpec:B.valueSpec,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:I})),Si(q)==="array"&&q.length===0&&j.push(new ft(B.key,q,"array must have at least one stop")),j},default:function(B){return B.validateSpec({key:B.key,value:B.value,valueSpec:e,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec})}}});return r==="identity"&&v&&z.push(new ft(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||z.push(new ft(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!al(n.valueSpec)&&z.push(new ft(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(M&&!Kl(n.valueSpec)?z.push(new ft(n.key,n.value,"property functions not supported")):v&&!jc(n.valueSpec)&&z.push(new ft(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!A||n.value.property!==void 0||z.push(new ft(n.key,n.value,'"property" property is required')),z;function I(B){let j=[];const q=B.value,X=B.key;if(Si(q)!=="array")return[new ft(X,q,`array expected, ${Si(q)} found`)];if(q.length!==2)return[new ft(X,q,`array length 2 expected, length ${q.length} found`)];if(A){if(Si(q[0])!=="object")return[new ft(X,q,`object expected, ${Si(q[0])} found`)];if(q[0].zoom===void 0)return[new ft(X,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new ft(X,q,"object stop key must have value")];if(p&&p>Sr(q[0].zoom))return[new ft(X,q[0].zoom,"stop zoom values must appear in ascending order")];Sr(q[0].zoom)!==p&&(p=Sr(q[0].zoom),h=void 0,g={}),j=j.concat(Ga({key:`${X}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Co,value:L}}))}else j=j.concat(L({key:`${X}[0]`,value:q[0],validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec},q));return Es(Mo(q[1]))?j.concat([new ft(`${X}[1]`,q[1],"expressions are not allowed in function stops.")]):j.concat(B.validateSpec({key:`${X}[1]`,value:q[1],valueSpec:e,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec}))}function L(B,j){const q=Si(B.value),X=Sr(B.value),J=B.value!==null?B.value:j;if(o){if(q!==o)return[new ft(B.key,J,`${q} stop domain type must match previous stop domain type ${o}`)]}else o=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new ft(B.key,J,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&r!=="categorical"){let ue=`number expected, ${q} found`;return Kl(e)&&r===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ft(B.key,J,ue)]}return r!=="categorical"||q!=="number"||isFinite(X)&&Math.floor(X)===X?r!=="categorical"&&q==="number"&&h!==void 0&&X<h?[new ft(B.key,J,"stop domain values must appear in ascending order")]:(h=X,r==="categorical"&&X in g?[new ft(B.key,J,"stop domain values must be unique")]:(g[X]=!0,[])):[new ft(B.key,J,`integer expected, found ${X}`)]}}function ic(n){const e=(n.expressionContext==="property"?gd:Zs)(Mo(n.value),n.valueSpec);if(e.result==="error")return e.value.map(o=>new ft(`${n.key}${o.key}`,n.value,o.message));const r=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new ft(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Iu(r))return[new ft(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Iu(r))return[new ft(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!nl(r,["zoom","feature-state"]))return[new ft(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Ln(r))return[new ft(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hs(n){const e=n.key,r=n.value,o=Si(r);return o!=="string"?[new ft(e,r,`color expected, ${o} found`)]:Tt.parse(String(r))?[]:[new ft(e,r,`color expected, "${r}" found`)]}function Eo(n){const e=n.key,r=n.value,o=n.valueSpec,h=[];return Array.isArray(o.values)?o.values.indexOf(Sr(r))===-1&&h.push(new ft(e,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(Sr(r))===-1&&h.push(new ft(e,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),h}function rc(n){return Eh(Mo(n.value))?ic(fn({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Vc(n)}function Vc(n){const e=n.value,r=n.key;if(Si(e)!=="array")return[new ft(r,e,`array expected, ${Si(e)} found`)];const o=n.styleSpec;let h,p=[];if(e.length<1)return[new ft(r,e,"filter array must have at least 1 element")];switch(p=p.concat(Eo({key:`${r}[0]`,value:e[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),Sr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Sr(e[1])==="$type"&&p.push(new ft(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new ft(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=Si(e[1]),h!=="string"&&p.push(new ft(`${r}[1]`,e[1],`string expected, ${h} found`)));for(let g=2;g<e.length;g++)h=Si(e[g]),Sr(e[1])==="$type"?p=p.concat(Eo({key:`${r}[${g}]`,value:e[g],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&p.push(new ft(`${r}[${g}]`,e[g],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)p=p.concat(Vc({key:`${r}[${g}]`,value:e[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=Si(e[1]),e.length!==2?p.push(new ft(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&p.push(new ft(`${r}[1]`,e[1],`string expected, ${h} found`))}return p}function Ph(n,e){const r=n.key,o=n.validateSpec,h=n.style,p=n.styleSpec,g=n.value,v=n.objectKey,M=p[`${e}_${n.layerType}`];if(!M)return[];const A=v.match(/^(.*)-transition$/);if(e==="paint"&&A&&M[A[1]]&&M[A[1]].transition)return o({key:r,value:g,valueSpec:p.transition,style:h,styleSpec:p});const z=n.valueSpec||M[v];if(!z)return[new ft(r,g,`unknown property "${v}"`)];let I;if(Si(g)==="string"&&Kl(z)&&!z.tokens&&(I=/^{([^}]+)}$/.exec(g)))return[new ft(r,g,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const L=[];return n.layerType==="symbol"&&(v==="text-field"&&h&&!h.glyphs&&L.push(new ft(r,g,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&ku(Mo(g))&&Sr(g.type)==="identity"&&L.push(new ft(r,g,'"text-font" does not support identity functions'))),L.concat(o({key:n.key,value:g,valueSpec:z,style:h,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:v}))}function hl(n){return Ph(n,"paint")}function Uc(n){return Ph(n,"layout")}function dl(n){let e=[];const r=n.value,o=n.key,h=n.style,p=n.styleSpec;if(Si(r)!=="object")return[new ft(o,r,`object expected, ${Si(r)} found`)];r.type||r.ref||e.push(new ft(o,r,'either "type" or "ref" is required'));let g=Sr(r.type);const v=Sr(r.ref);if(r.id){const M=Sr(r.id);for(let A=0;A<n.arrayIndex;A++){const z=h.layers[A];Sr(z.id)===M&&e.push(new ft(o,r.id,`duplicate layer id "${r.id}", previously used at line ${z.id.__line__}`))}}if("ref"in r){let M;["type","source","source-layer","filter","layout"].forEach(A=>{A in r&&e.push(new ft(o,r[A],`"${A}" is prohibited for ref layers`))}),h.layers.forEach(A=>{Sr(A.id)===v&&(M=A)}),M?M.ref?e.push(new ft(o,r.ref,"ref cannot reference another ref layer")):g=Sr(M.type):e.push(new ft(o,r.ref,`ref layer "${v}" not found`))}else if(g!=="background")if(r.source){const M=h.sources&&h.sources[r.source],A=M&&Sr(M.type);M?A==="vector"&&g==="raster"?e.push(new ft(o,r.source,`layer "${r.id}" requires a raster source`)):A!=="raster-dem"&&g==="hillshade"||A!=="raster-dem"&&g==="color-relief"?e.push(new ft(o,r.source,`layer "${r.id}" requires a raster-dem source`)):A==="raster"&&g!=="raster"?e.push(new ft(o,r.source,`layer "${r.id}" requires a vector source`)):A!=="vector"||r["source-layer"]?A==="raster-dem"&&g!=="hillshade"&&g!=="color-relief"?e.push(new ft(o,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):g!=="line"||!r.paint||!r.paint["line-gradient"]||A==="geojson"&&M.lineMetrics||e.push(new ft(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ft(o,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new ft(o,r.source,`source "${r.source}" not found`))}else e.push(new ft(o,r,'missing required property "source"'));return e=e.concat(Ga({key:o,value:r,valueSpec:p.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${o}.type`,value:r.type,valueSpec:p.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:rc,layout:M=>Ga({layer:r,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":A=>Uc(fn({layerType:g},A))}}),paint:M=>Ga({layer:r,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":A=>hl(fn({layerType:g},A))}})}})),e}function En(n){const e=n.value,r=n.key,o=Si(e);return o!=="string"?[new ft(r,e,`string expected, ${o} found`)]:[]}const ju={promoteId:function({key:n,value:e}){if(Si(e)==="string")return En({key:n,value:e});{const r=[];for(const o in e)r.push(...En({key:`${n}.${o}`,value:e[o]}));return r}}};function qa(n){const e=n.value,r=n.key,o=n.styleSpec,h=n.style,p=n.validateSpec;if(!e.type)return[new ft(r,e,'"type" is required')];const g=Sr(e.type);let v;switch(g){case"vector":case"raster":return v=Ga({key:r,value:e,valueSpec:o[`source_${g.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:ju,validateSpec:p}),v;case"raster-dem":return v=function(M){var A;const z=(A=M.sourceName)!==null&&A!==void 0?A:"",I=M.value,L=M.styleSpec,B=L.source_raster_dem,j=M.style;let q=[];const X=Si(I);if(I===void 0)return q;if(X!=="object")return q.push(new ft("source_raster_dem",I,`object expected, ${X} found`)),q;const J=Sr(I.encoding)==="custom",ue=["redFactor","greenFactor","blueFactor","baseShift"],le=M.value.encoding?`"${M.value.encoding}"`:"Default";for(const ce in I)!J&&ue.includes(ce)?q.push(new ft(ce,I[ce],`In "${z}": "${ce}" is only valid when "encoding" is set to "custom". ${le} encoding found`)):B[ce]?q=q.concat(M.validateSpec({key:ce,value:I[ce],valueSpec:B[ce],validateSpec:M.validateSpec,style:j,styleSpec:L})):q.push(new ft(ce,I[ce],`unknown property "${ce}"`));return q}({sourceName:r,value:e,style:n.style,styleSpec:o,validateSpec:p}),v;case"geojson":if(v=Ga({key:r,value:e,valueSpec:o.source_geojson,style:h,styleSpec:o,validateSpec:p,objectElementValidators:ju}),e.cluster)for(const M in e.clusterProperties){const[A,z]=e.clusterProperties[M],I=typeof A=="string"?[A,["accumulated"],["get",M]]:A;v.push(...ic({key:`${r}.${M}.map`,value:z,expressionContext:"cluster-map"})),v.push(...ic({key:`${r}.${M}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return v;case"video":return Ga({key:r,value:e,valueSpec:o.source_video,style:h,validateSpec:p,styleSpec:o});case"image":return Ga({key:r,value:e,valueSpec:o.source_image,style:h,validateSpec:p,styleSpec:o});case"canvas":return[new ft(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Eo({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Nu(n){const e=n.value,r=n.styleSpec,o=r.light,h=n.style;let p=[];const g=Si(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new ft("light",e,`object expected, ${g} found`)]),p;for(const v in e){const M=v.match(/^(.*)-transition$/);p=p.concat(M&&o[M[1]]&&o[M[1]].transition?n.validateSpec({key:v,value:e[v],valueSpec:r.transition,validateSpec:n.validateSpec,style:h,styleSpec:r}):o[v]?n.validateSpec({key:v,value:e[v],valueSpec:o[v],validateSpec:n.validateSpec,style:h,styleSpec:r}):[new ft(v,e[v],`unknown property "${v}"`)])}return p}function zn(n){const e=n.value,r=n.styleSpec,o=r.sky,h=n.style,p=Si(e);if(e===void 0)return[];if(p!=="object")return[new ft("sky",e,`object expected, ${p} found`)];let g=[];for(const v in e)g=g.concat(o[v]?n.validateSpec({key:v,value:e[v],valueSpec:o[v],style:h,styleSpec:r}):[new ft(v,e[v],`unknown property "${v}"`)]);return g}function Wn(n){const e=n.value,r=n.styleSpec,o=r.terrain,h=n.style;let p=[];const g=Si(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new ft("terrain",e,`object expected, ${g} found`)]),p;for(const v in e)p=p.concat(o[v]?n.validateSpec({key:v,value:e[v],valueSpec:o[v],validateSpec:n.validateSpec,style:h,styleSpec:r}):[new ft(v,e[v],`unknown property "${v}"`)]);return p}function Xs(n){let e=[];const r=n.value,o=n.key;if(Array.isArray(r)){const h=[],p=[];for(const g in r)r[g].id&&h.includes(r[g].id)&&e.push(new ft(o,r,`all the sprites' ids must be unique, but ${r[g].id} is duplicated`)),h.push(r[g].id),r[g].url&&p.includes(r[g].url)&&e.push(new ft(o,r,`all the sprites' URLs must be unique, but ${r[g].url} is duplicated`)),p.push(r[g].url),e=e.concat(Ga({key:`${o}[${g}]`,value:r[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return e}return En({key:o,value:r})}function fl(n){return e=n.value,e&&e.constructor===Object?[]:[new ft(n.key,n.value,`object expected, ${Si(n.value)} found`)];var e}const pl={"*":()=>[],array:Ao,boolean:function(n){const e=n.value,r=n.key,o=Si(e);return o!=="boolean"?[new ft(r,e,`boolean expected, ${o} found`)]:[]},number:Co,color:Hs,constants:$s,enum:Eo,filter:rc,function:Fu,layer:dl,object:Ga,source:qa,light:Nu,sky:zn,terrain:Wn,projection:function(n){const e=n.value,r=n.styleSpec,o=r.projection,h=n.style,p=Si(e);if(e===void 0)return[];if(p!=="object")return[new ft("projection",e,`object expected, ${p} found`)];let g=[];for(const v in e)g=g.concat(o[v]?n.validateSpec({key:v,value:e[v],valueSpec:o[v],style:h,styleSpec:r}):[new ft(v,e[v],`unknown property "${v}"`)]);return g},projectionDefinition:function(n){const e=n.key;let r=n.value;r=r instanceof String?r.valueOf():r;const o=Si(r);return o!=="array"||function(h){return Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"}(r)||function(h){return!!["interpolate","step","literal"].includes(h[0])}(r)?["array","string"].includes(o)?[]:[new ft(e,r,`projection expected, invalid type "${o}" found`)]:[new ft(e,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:En,formatted:function(n){return En(n).length===0?[]:ic(n)},resolvedImage:function(n){return En(n).length===0?[]:ic(n)},padding:function(n){const e=n.key,r=n.value;if(Si(r)==="array"){if(r.length<1||r.length>4)return[new ft(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let h=[];for(let p=0;p<r.length;p++)h=h.concat(n.validateSpec({key:`${e}[${p}]`,value:r[p],validateSpec:n.validateSpec,valueSpec:o}));return h}return Co({key:e,value:r,valueSpec:{}})},numberArray:function(n){const e=n.key,r=n.value;if(Si(r)==="array"){const o={type:"number"};if(r.length<1)return[new ft(e,r,"array length at least 1 expected, length 0 found")];let h=[];for(let p=0;p<r.length;p++)h=h.concat(n.validateSpec({key:`${e}[${p}]`,value:r[p],validateSpec:n.validateSpec,valueSpec:o}));return h}return Co({key:e,value:r,valueSpec:{}})},colorArray:function(n){const e=n.key,r=n.value;if(Si(r)==="array"){if(r.length<1)return[new ft(e,r,"array length at least 1 expected, length 0 found")];let o=[];for(let h=0;h<r.length;h++)o=o.concat(Hs({key:`${e}[${h}]`,value:r[h]}));return o}return Hs({key:e,value:r})},variableAnchorOffsetCollection:function(n){const e=n.key,r=n.value,o=Si(r),h=n.styleSpec;if(o!=="array"||r.length<1||r.length%2!=0)return[new ft(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let g=0;g<r.length;g+=2)p=p.concat(Eo({key:`${e}[${g}]`,value:r[g],valueSpec:h.layout_symbol["text-anchor"]})),p=p.concat(Ao({key:`${e}[${g+1}]`,value:r[g+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:h}));return p},sprite:Xs,state:fl};function ml(n){const e=n.value,r=n.valueSpec,o=n.styleSpec;return n.validateSpec=ml,r.expression&&ku(Sr(e))?Fu(n):r.expression&&Es(Mo(e))?ic(n):r.type&&pl[r.type]?pl[r.type](n):Ga(fn({},n,{valueSpec:r.type?o[r.type]:r}))}function zo(n){const e=n.value,r=n.key,o=En(n);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new ft(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new ft(r,e,'"glyphs" url must include a "{range}" token'))),o}function qr(n,e=$e){let r=[];return r=r.concat(ml({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:ml,objectElementValidators:{glyphs:zo,"*":()=>[]}})),n.constants&&(r=r.concat($s({key:"constants",value:n.constants}))),nc(r)}function Za(n){return function(e){return n({...e,validateSpec:ml})}}function nc(n){return[].concat(n).sort((e,r)=>e.line-r.line)}function ni(n){return function(...e){return nc(n.apply(this,e))}}qr.source=ni(Za(qa)),qr.sprite=ni(Za(Xs)),qr.glyphs=ni(Za(zo)),qr.light=ni(Za(Nu)),qr.sky=ni(Za(zn)),qr.terrain=ni(Za(Wn)),qr.state=ni(Za(fl)),qr.layer=ni(Za(dl)),qr.filter=ni(Za(rc)),qr.paintProperty=ni(Za(hl)),qr.layoutProperty=ni(Za(Uc));const Gc="AbortError";function Ma(){return new Error(Gc)}const qc={REGISTERED_PROTOCOLS:{}};function Kn(n,e){qc.REGISTERED_PROTOCOLS[n]=e}function yd(n){delete qc.REGISTERED_PROTOCOLS[n]}const Vu="global-dispatcher";class zs extends Error{constructor(e,r,o,h){super(`AJAXError: ${r} (${e}): ${o}`),this.status=e,this.statusText=r,this.url=o,this.body=h}}const Ih=()=>St(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Zc=function(n,e){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const o=qc.REGISTERED_PROTOCOLS[(r=n.url).substring(0,r.indexOf("://"))];if(o)return o(n,e);if(St(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:Vu},e)}var r;if(!(o=>/^file:/.test(o)||/^file:/.test(Ih())&&!/^\w+:/.test(o))(n.url)){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,h){return D(this,void 0,void 0,function*(){const p=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Ih(),signal:h.signal});let g,v;o.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");try{g=yield fetch(p)}catch(A){throw new zs(0,A.message,o.url,new Blob)}if(!g.ok){const A=yield g.blob();throw new zs(g.status,g.statusText,o.url,A)}v=o.type==="arrayBuffer"||o.type==="image"?g.arrayBuffer():o.type==="json"?g.json():g.text();const M=yield v;if(h.signal.aborted)throw Ma();return{data:M,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}})}(n,e);if(St(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:Vu},e)}return function(o,h){return new Promise((p,g)=>{var v;const M=new XMLHttpRequest;M.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(M.responseType="arraybuffer");for(const A in o.headers)M.setRequestHeader(A,o.headers[A]);o.type==="json"&&(M.responseType="text",!((v=o.headers)===null||v===void 0)&&v.Accept||M.setRequestHeader("Accept","application/json")),M.withCredentials=o.credentials==="include",M.onerror=()=>{g(new Error(M.statusText))},M.onload=()=>{if(!h.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let A=M.response;if(o.type==="json")try{A=JSON.parse(M.response)}catch(z){return void g(z)}p({data:A,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const A=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});g(new zs(M.status,M.statusText,o.url,A))}},h.signal.addEventListener("abort",()=>{M.abort(),g(Ma())}),M.send(o.body)})}(n,e)},Gn={};function Mt(n,e,r={}){if(Gn[n])throw new Error(`${n} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),Gn[n]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Mt("Object",Object),Mt("Set",Set),Mt("TransferableGridIndex",Pi),Mt("Color",Tt),Mt("Error",Error),Mt("AJAXError",zs),Mt("ResolvedImage",pt),Mt("StylePropertyFunction",To),Mt("StyleExpression",Lu,{omit:["_evaluator"]}),Mt("ZoomDependentExpression",ol),Mt("ZoomConstantExpression",sl),Mt("CompoundExpression",us,{omit:["_evaluate"]});for(const n in Fc)Fc[n]._classRegistryKey||Mt(`Expression_${n}`,Fc[n]);function Po(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function gl(n){return n.$name||n.constructor._classRegistryKey}function Aa(n){return!function(e){if(e===null||typeof e!="object")return!1;const r=gl(e);return!(!r||r==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Po(n)||Rt(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function vn(n,e){if(Aa(n))return(Po(n)||Rt(n))&&e&&e.push(n),ArrayBuffer.isView(n)&&e&&e.push(n.buffer),n instanceof ImageData&&e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const p=[];for(const g of n)p.push(vn(g,e));return p}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const r=gl(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!Gn[r])throw new Error(`${r} is not registered.`);const{klass:o}=Gn[r],h=o.serialize?o.serialize(n,e):{};if(o.serialize){if(e&&h===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in n){if(!n.hasOwnProperty(p)||Gn[r].omit.indexOf(p)>=0)continue;const g=n[p];h[p]=Gn[r].shallow.indexOf(p)>=0?g:vn(g,e)}n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(h.$name=r),h}function ca(n){if(Aa(n))return n;if(Array.isArray(n))return n.map(ca);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const e=gl(n)||"Object";if(!Gn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Gn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(n);const o=Object.create(r.prototype);for(const h of Object.keys(n)){if(h==="$name")continue;const p=n[h];o[h]=Gn[e].shallow.indexOf(h)>=0?p:ca(p)}return o}class $a{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const ds={once:!0};class Io{constructor(e,r){this.target=e,this.mapId=r,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new $a(()=>this.process()),this.subscription=zt(this.target,"message",o=>this.receive(o),!1),this.globalScope=St(self)?e:window}registerMessageHandler(e,r){this.messageHandlers[e]=r}sendAsync(e,r){return new Promise((o,h)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10),g=r?zt(r.signal,"abort",()=>{g==null||g.unsubscribe(),delete this.resolveRejects[p];const A={id:p,type:"<cancel>",origin:location.origin,targetMapId:e.targetMapId,sourceMapId:this.mapId};this.target.postMessage(A)},ds):null;this.resolveRejects[p]={resolve:A=>{g==null||g.unsubscribe(),o(A)},reject:A=>{g==null||g.unsubscribe(),h(A)}};const v=[],M=Object.assign(Object.assign({},e),{id:p,sourceMapId:this.mapId,origin:location.origin,data:vn(e.data,v)});this.target.postMessage(M,{transfer:v})})}receive(e){const r=e.data,o=r.id;if(!(r.origin!=="file://"&&location.origin!=="file://"&&r.origin!=="resource://android"&&location.origin!=="resource://android"&&r.origin!==location.origin||r.targetMapId&&this.mapId!==r.targetMapId)){if(r.type==="<cancel>"){delete this.tasks[o];const h=this.abortControllers[o];return delete this.abortControllers[o],void(h&&h.abort())}if(St(self)||r.mustQueue)return this.tasks[o]=r,this.taskQueue.push(o),void this.invoker.trigger();this.processTask(o,r)}}process(){if(this.taskQueue.length===0)return;const e=this.taskQueue.shift(),r=this.tasks[e];delete this.tasks[e],this.taskQueue.length>0&&this.invoker.trigger(),r&&this.processTask(e,r)}processTask(e,r){return D(this,void 0,void 0,function*(){if(r.type==="<response>"){const p=this.resolveRejects[e];return delete this.resolveRejects[e],p?void(r.error?p.reject(ca(r.error)):p.resolve(ca(r.data))):void 0}if(!this.messageHandlers[r.type])return void this.completeTask(e,new Error(`Could not find a registered handler for ${r.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const o=ca(r.data),h=new AbortController;this.abortControllers[e]=h;try{const p=yield this.messageHandlers[r.type](r.sourceMapId,o,h);this.completeTask(e,null,p)}catch(p){this.completeTask(e,p)}})}completeTask(e,r,o){const h=[];delete this.abortControllers[e];const p={id:e,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:r?vn(r):null,data:vn(o,h)};this.target.postMessage(p,{transfer:h})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}}function ko(n,e,r){r[n]&&r[n].indexOf(e)!==-1||(r[n]=r[n]||[],r[n].push(e))}function ac(n,e,r){if(r&&r[n]){const o=r[n].indexOf(e);o!==-1&&r[n].splice(o,1)}}class sc{constructor(e,r={}){wt(this,r),this.type=e}}class ln extends sc{constructor(e,r={}){super("error",wt({error:e},r))}}class Zr{on(e,r){return this._listeners=this._listeners||{},ko(e,r,this._listeners),{unsubscribe:()=>{this.off(e,r)}}}off(e,r){return ac(e,r,this._listeners),ac(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},ko(e,r,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,r){typeof e=="string"&&(e=new sc(e,r||{}));const o=e.type;if(this.listens(o)){e.target=this;const h=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const v of h)v.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const v of p)ac(o,v,this._oneTimeListeners),v.call(this,e);const g=this._eventedParent;g&&(wt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof ln&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}const Wi=qr,yl=Wi.paintProperty,Ha=Wi.layoutProperty;class $c{constructor(){this.first=!0}update(e,r){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const _l=n=>n>=12272&&n<=12287,Hc=n=>n>=12288&&n<=12351,Or=n=>n>=12448&&n<=12543,ua=n=>n>=12736&&n<=12783,qn=n=>n>=12800&&n<=13055,Xc=n=>n>=13056&&n<=13311,Ys=n=>n>=65040&&n<=65055,Yc=n=>n>=65072&&n<=65103,Ca=n=>n>=65104&&n<=65135,Ea=n=>n>=65280&&n<=65519;function Bn(n){for(const e of n)if(Ws(e.charCodeAt(0)))return!0;return!1}function Ps(n){for(const e of n)if(!Kc(e.charCodeAt(0)))return!1;return!0}function Wc(n){const e=n.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(e.join("|"),"u")}const kh=Wc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Kc(n){return!kh.test(String.fromCodePoint(n))}const Qc=Wc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Ws(n){return!(n!==746&&n!==747&&(n<4352||!(Yc(n)&&!(n>=65097&&n<=65103)||Xc(n)||ua(n)||!(!Hc(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||qn(n)||_l(n)||(e=>e>=12688&&e<=12703)(n)||Or(n)&&n!==12540||!(!Ea(n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Ca(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Ys(n)||(e=>e>=19904&&e<=19967)(n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||Qc.test(String.fromCodePoint(n)))))}function Cr(n){return!(Ws(n)||function(e){return!!((r=>r>=128&&r<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(r=>r>=8192&&r<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&e!==9251||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Hc(e)||Or(e)||(r=>r>=57344&&r<=63743)(e)||Yc(e)||Ca(e)||Ea(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}const Ro=Wc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Qn(n){return Ro.test(String.fromCodePoint(n))}function Jc(n,e){return!(!e&&Qn(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(r=>r>=6016&&r<=6143)(n))}function _d(n){for(const e of n)if(Qn(e.charCodeAt(0)))return!0;return!1}const Ks=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Ks.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,e){return D(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const r=n.pluginURL,o=new Promise(p=>{this.loadScriptResolve=p});e(r);const h=new Promise(p=>setTimeout(()=>p(),this.TIMEOUT));if(yield Promise.race([o,h]),this.isParsed()){const p={pluginStatus:"loaded",pluginURL:r};return this.setState(p),p}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)})}};class vi{constructor(e,r){this.zoom=e,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new $c,this.transition=r.transition||{},this.globalState=r.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new $c,this.transition={},this.globalState={})}isSupportedScript(e){return function(r,o){for(const h of r)if(!Jc(h.charCodeAt(0),o))return!1;return!0}(e,Ks.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}class Is{constructor(e,r){this.property=e,this.value=r,this.expression=function(o,h){if(ku(o))return new To(o,h);if(Es(o)){const p=gd(o,h);if(p.result==="error")throw new Error(p.value.map(g=>`${g.key}: ${g.message}`).join(", "));return p.value}{let p=o;return h.type==="color"&&typeof o=="string"?p=Tt.parse(o):h.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?h.type!=="numberArray"||typeof o!="number"&&!Array.isArray(o)?h.type!=="colorArray"||typeof o!="string"&&!Array.isArray(o)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(o)?p=Bi.parse(o):h.type==="projectionDefinition"&&typeof o=="string"&&(p=Ar.parse(o)):p=Mi.parse(o):p=er.parse(o):p=Yi.parse(o),{globalStateRefs:new Set,kind:"constant",evaluate:()=>p}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,r,o){return this.property.possiblyEvaluate(this,e,r,o)}}class Do{constructor(e){this.property=e,this.value=new Is(e,void 0)}transitioned(e,r){return new Uu(this.property,this.value,r,wt({},e.transition,this.transition),e.now)}untransitioned(){return new Uu(this.property,this.value,null,{},0)}}class Qs{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Et(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Do(this._values[e].property)),this._values[e].value=new Is(this._values[e].property,r===null?void 0:Et(r))}getTransition(e){return Et(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Do(this._values[e].property)),this._values[e].transition=Et(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o);const h=this.getTransition(r);h!==void 0&&(e[`${r}-transition`]=h)}return e}transitioned(e,r){const o=new bn(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].transitioned(e,r._values[h]);return o}untransitioned(){const e=new bn(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Uu{constructor(e,r,o,h,p){this.property=e,this.value=r,this.begin=p+h.delay||0,this.end=this.begin+h.duration||0,e.specification.transition&&(h.delay||h.duration)&&(this.prior=o)}possiblyEvaluate(e,r,o){const h=e.now||0,p=this.value.possiblyEvaluate(e,r,o),g=this.prior;if(g){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return g.possiblyEvaluate(e,r,o);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,r,o),p,function(M){if(M<=0)return 0;if(M>=1)return 1;const A=M*M,z=A*M;return 4*(M<.5?z:3*(M-A)+z-.75)}(v))}}return p}}class bn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,o){const h=new da(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,r,o);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Jn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Et(this._values[e].value)}setValue(e,r){this._values[e]=new Is(this._values[e].property,r===null?void 0:Et(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o)}return e}possiblyEvaluate(e,r,o){const h=new da(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,r,o);return h}}class ha{constructor(e,r,o){this.property=e,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,o,h){return this.property.evaluate(this.value,this.parameters,e,r,o,h)}}class da{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ft{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,o){const h=Gl[this.specification.type];return h?h(e,r,o):e}}class Qt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,o,h){return new ha(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},o,h)}:e.expression,r)}interpolate(e,r,o){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new ha(this,{kind:"constant",value:void 0},e.parameters);const h=Gl[this.specification.type];if(h){const p=h(e.value.value,r.value.value,o);return new ha(this,{kind:"constant",value:p},e.parameters)}return e}evaluate(e,r,o,h,p,g){return e.kind==="constant"?e.value:e.evaluate(r,o,h,p,g)}}class za extends Qt{possiblyEvaluate(e,r,o,h){if(e.value===void 0)return new ha(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const p=e.expression.evaluate(r,null,{},o,h),g=e.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,v=this._calculate(g,g,g,r);return new ha(this,{kind:"constant",value:v},r)}if(e.expression.kind==="camera"){const p=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new ha(this,{kind:"constant",value:p},r)}return new ha(this,e.expression,r)}evaluate(e,r,o,h,p,g){if(e.kind==="source"){const v=e.evaluate(r,o,h,p,g);return this._calculate(v,v,v,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},o,h),e.evaluate({zoom:Math.floor(r.zoom)},o,h),e.evaluate({zoom:Math.floor(r.zoom)+1},o,h),r):e.value}_calculate(e,r,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class Gu{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,h){if(e.value!==void 0){if(e.expression.kind==="constant"){const p=e.expression.evaluate(r,null,{},o,h);return this._calculate(p,p,p,r)}return this._calculate(e.expression.evaluate(new vi(Math.floor(r.zoom-1),r)),e.expression.evaluate(new vi(Math.floor(r.zoom),r)),e.expression.evaluate(new vi(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class oc{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,h){return!!e.expression.evaluate(r,null,{},o,h)}interpolate(){return!1}}class Pn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const o=e[r];o.specification.overridable&&this.overridableProperties.push(r);const h=this.defaultPropertyValues[r]=new Is(o,void 0),p=this.defaultTransitionablePropertyValues[r]=new Do(o);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=h.possiblyEvaluate({})}}}Mt("DataDrivenProperty",Qt),Mt("DataConstantProperty",Ft),Mt("CrossFadedDataDrivenProperty",za),Mt("CrossFadedProperty",Gu),Mt("ColorRampProperty",oc);const Js="-transition";class cn extends Zr{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=ec(e.filter)),r.layout&&(this._unevaluatedLayout=new Jn(r.layout)),r.paint)){this._transitionablePaint=new Qs(r.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new da(r.paint)}}setFilter(e){this.filter=e,this._featureFilter=ec(e)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[r];for(const h of o.getGlobalStateRefs())e.add(h)}for(const r of this._featureFilter.getGlobalStateRefs())e.add(r);return e}getPaintAffectingGlobalStateRefs(){var e;const r=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const h=this._transitionablePaint._values[o].value;for(const p of h.getGlobalStateRefs()){const g=(e=r.get(p))!==null&&e!==void 0?e:[];g.push({name:o,value:h.value}),r.set(p,g)}}return r}setLayoutProperty(e,r,o={}){r!=null&&this._validate(Ha,`layers.${this.id}.layout.${e}`,e,r,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Js)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,o={}){if(r!=null&&this._validate(yl,`layers.${this.id}.paint.${e}`,e,r,o))return!1;if(e.endsWith(Js))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const h=this._transitionablePaint._values[e],p=h.property.specification["property-type"]==="cross-faded-data-driven",g=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const M=this._transitionablePaint._values[e].value;return M.isDataDriven()||g||p||this._handleOverridablePaintPropertyUpdate(e,v,M)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),function(r,o){const h={};for(const p in r)o.call(this,r[p],p,r)&&(h[p]=r[p]);return h}(e,(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}_validate(e,r,o,h,p={}){return(!p||p.validate!==!1)&&function(g,v){let M=!1;if(v&&v.length)for(const A of v)g.fire(new ln(new Error(A.message))),M=!0;return M}(this,e.call(Wi,{key:r,layerType:this.type,objectKey:o,value:h,styleSpec:$e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof ha&&Kl(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const At={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Lo{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Er{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Fr(n,e=1){let r=0,o=0;return{members:n.map(h=>{const p=At[h.type].BYTES_PER_ELEMENT,g=r=xl(r,Math.max(e,p)),v=h.components||1;return o=Math.max(o,p),r+=p*v,{name:h.name,type:h.type,components:v,offset:g}}),size:xl(r,Math.max(o,e)),alignment:e}}function xl(n,e){return Math.ceil(n/e)*e}class fa extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const h=2*e;return this.int16[h+0]=r,this.int16[h+1]=o,e}}fa.prototype.bytesPerElement=4,Mt("StructArrayLayout2i4",fa);class lc extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,o)}emplace(e,r,o,h){const p=3*e;return this.int16[p+0]=r,this.int16[p+1]=o,this.int16[p+2]=h,e}}lc.prototype.bytesPerElement=6,Mt("StructArrayLayout3i6",lc);class ki extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,o,h)}emplace(e,r,o,h,p){const g=4*e;return this.int16[g+0]=r,this.int16[g+1]=o,this.int16[g+2]=h,this.int16[g+3]=p,e}}ki.prototype.bytesPerElement=8,Mt("StructArrayLayout4i8",ki);class Xa extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,h,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,o,h,p,g)}emplace(e,r,o,h,p,g,v){const M=6*e;return this.int16[M+0]=r,this.int16[M+1]=o,this.int16[M+2]=h,this.int16[M+3]=p,this.int16[M+4]=g,this.int16[M+5]=v,e}}Xa.prototype.bytesPerElement=12,Mt("StructArrayLayout2i4i12",Xa);class qu extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,h,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,o,h,p,g)}emplace(e,r,o,h,p,g,v){const M=4*e,A=8*e;return this.int16[M+0]=r,this.int16[M+1]=o,this.uint8[A+4]=h,this.uint8[A+5]=p,this.uint8[A+6]=g,this.uint8[A+7]=v,e}}qu.prototype.bytesPerElement=8,Mt("StructArrayLayout2i4ub8",qu);class eo extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const h=2*e;return this.float32[h+0]=r,this.float32[h+1]=o,e}}eo.prototype.bytesPerElement=8,Mt("StructArrayLayout2f8",eo);class to extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,h,p,g,v,M,A,z){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,o,h,p,g,v,M,A,z)}emplace(e,r,o,h,p,g,v,M,A,z,I){const L=10*e;return this.uint16[L+0]=r,this.uint16[L+1]=o,this.uint16[L+2]=h,this.uint16[L+3]=p,this.uint16[L+4]=g,this.uint16[L+5]=v,this.uint16[L+6]=M,this.uint16[L+7]=A,this.uint16[L+8]=z,this.uint16[L+9]=I,e}}to.prototype.bytesPerElement=20,Mt("StructArrayLayout10ui20",to);class ks extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,h,p,g,v,M,A,z,I,L){const B=this.length;return this.resize(B+1),this.emplace(B,e,r,o,h,p,g,v,M,A,z,I,L)}emplace(e,r,o,h,p,g,v,M,A,z,I,L,B){const j=12*e;return this.int16[j+0]=r,this.int16[j+1]=o,this.int16[j+2]=h,this.int16[j+3]=p,this.uint16[j+4]=g,this.uint16[j+5]=v,this.uint16[j+6]=M,this.uint16[j+7]=A,this.int16[j+8]=z,this.int16[j+9]=I,this.int16[j+10]=L,this.int16[j+11]=B,e}}ks.prototype.bytesPerElement=24,Mt("StructArrayLayout4i4ui4i24",ks);class Bo extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,o)}emplace(e,r,o,h){const p=3*e;return this.float32[p+0]=r,this.float32[p+1]=o,this.float32[p+2]=h,e}}Bo.prototype.bytesPerElement=12,Mt("StructArrayLayout3f12",Bo);class cc extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}cc.prototype.bytesPerElement=4,Mt("StructArrayLayout1ul4",cc);class eu extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,h,p,g,v,M,A){const z=this.length;return this.resize(z+1),this.emplace(z,e,r,o,h,p,g,v,M,A)}emplace(e,r,o,h,p,g,v,M,A,z){const I=10*e,L=5*e;return this.int16[I+0]=r,this.int16[I+1]=o,this.int16[I+2]=h,this.int16[I+3]=p,this.int16[I+4]=g,this.int16[I+5]=v,this.uint32[L+3]=M,this.uint16[I+8]=A,this.uint16[I+9]=z,e}}eu.prototype.bytesPerElement=20,Mt("StructArrayLayout6i1ul2ui20",eu);class vl extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,h,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,o,h,p,g)}emplace(e,r,o,h,p,g,v){const M=6*e;return this.int16[M+0]=r,this.int16[M+1]=o,this.int16[M+2]=h,this.int16[M+3]=p,this.int16[M+4]=g,this.int16[M+5]=v,e}}vl.prototype.bytesPerElement=12,Mt("StructArrayLayout2i2i2i12",vl);class bl extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,h,p)}emplace(e,r,o,h,p,g){const v=4*e,M=8*e;return this.float32[v+0]=r,this.float32[v+1]=o,this.float32[v+2]=h,this.int16[M+6]=p,this.int16[M+7]=g,e}}bl.prototype.bytesPerElement=16,Mt("StructArrayLayout2f1f2i16",bl);class Zu extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,h,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,o,h,p,g)}emplace(e,r,o,h,p,g,v){const M=16*e,A=4*e,z=8*e;return this.uint8[M+0]=r,this.uint8[M+1]=o,this.float32[A+1]=h,this.float32[A+2]=p,this.int16[z+6]=g,this.int16[z+7]=v,e}}Zu.prototype.bytesPerElement=16,Mt("StructArrayLayout2ub2f2i16",Zu);class $u extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,o)}emplace(e,r,o,h){const p=3*e;return this.uint16[p+0]=r,this.uint16[p+1]=o,this.uint16[p+2]=h,e}}$u.prototype.bytesPerElement=6,Mt("StructArrayLayout3ui6",$u);class On extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,h,p,g,v,M,A,z,I,L,B,j,q,X,J){const ue=this.length;return this.resize(ue+1),this.emplace(ue,e,r,o,h,p,g,v,M,A,z,I,L,B,j,q,X,J)}emplace(e,r,o,h,p,g,v,M,A,z,I,L,B,j,q,X,J,ue){const le=24*e,ce=12*e,Te=48*e;return this.int16[le+0]=r,this.int16[le+1]=o,this.uint16[le+2]=h,this.uint16[le+3]=p,this.uint32[ce+2]=g,this.uint32[ce+3]=v,this.uint32[ce+4]=M,this.uint16[le+10]=A,this.uint16[le+11]=z,this.uint16[le+12]=I,this.float32[ce+7]=L,this.float32[ce+8]=B,this.uint8[Te+36]=j,this.uint8[Te+37]=q,this.uint8[Te+38]=X,this.uint32[ce+10]=J,this.int16[le+22]=ue,e}}On.prototype.bytesPerElement=48,Mt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",On);class rr extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,h,p,g,v,M,A,z,I,L,B,j,q,X,J,ue,le,ce,Te,ye,ve,we,Ye,We,et,Ue){const it=this.length;return this.resize(it+1),this.emplace(it,e,r,o,h,p,g,v,M,A,z,I,L,B,j,q,X,J,ue,le,ce,Te,ye,ve,we,Ye,We,et,Ue)}emplace(e,r,o,h,p,g,v,M,A,z,I,L,B,j,q,X,J,ue,le,ce,Te,ye,ve,we,Ye,We,et,Ue,it){const tt=32*e,Pt=16*e;return this.int16[tt+0]=r,this.int16[tt+1]=o,this.int16[tt+2]=h,this.int16[tt+3]=p,this.int16[tt+4]=g,this.int16[tt+5]=v,this.int16[tt+6]=M,this.int16[tt+7]=A,this.uint16[tt+8]=z,this.uint16[tt+9]=I,this.uint16[tt+10]=L,this.uint16[tt+11]=B,this.uint16[tt+12]=j,this.uint16[tt+13]=q,this.uint16[tt+14]=X,this.uint16[tt+15]=J,this.uint16[tt+16]=ue,this.uint16[tt+17]=le,this.uint16[tt+18]=ce,this.uint16[tt+19]=Te,this.uint16[tt+20]=ye,this.uint16[tt+21]=ve,this.uint16[tt+22]=we,this.uint32[Pt+12]=Ye,this.float32[Pt+13]=We,this.float32[Pt+14]=et,this.uint16[tt+30]=Ue,this.uint16[tt+31]=it,e}}rr.prototype.bytesPerElement=64,Mt("StructArrayLayout8i15ui1ul2f2ui64",rr);class io extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}io.prototype.bytesPerElement=4,Mt("StructArrayLayout1f4",io);class uc extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,o)}emplace(e,r,o,h){const p=3*e;return this.uint16[6*e+0]=r,this.float32[p+1]=o,this.float32[p+2]=h,e}}uc.prototype.bytesPerElement=12,Mt("StructArrayLayout1ui2f12",uc);class tu extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,o)}emplace(e,r,o,h){const p=4*e;return this.uint32[2*e+0]=r,this.uint16[p+2]=o,this.uint16[p+3]=h,e}}tu.prototype.bytesPerElement=8,Mt("StructArrayLayout1ul2ui8",tu);class fs extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const h=2*e;return this.uint16[h+0]=r,this.uint16[h+1]=o,e}}fs.prototype.bytesPerElement=4,Mt("StructArrayLayout2ui4",fs);class zi extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}zi.prototype.bytesPerElement=2,Mt("StructArrayLayout1ui2",zi);class cr extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,o,h)}emplace(e,r,o,h,p){const g=4*e;return this.float32[g+0]=r,this.float32[g+1]=o,this.float32[g+2]=h,this.float32[g+3]=p,e}}cr.prototype.bytesPerElement=16,Mt("StructArrayLayout4f16",cr);class pr extends Lo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new G(this.anchorPointX,this.anchorPointY)}}pr.prototype.size=20;class wl extends eu{get(e){return new pr(this,e)}}Mt("CollisionBoxArray",wl);class Ot extends Lo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ot.prototype.size=48;class Ht extends On{get(e){return new Ot(this,e)}}Mt("PlacedSymbolArray",Ht);class Sl extends Lo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Sl.prototype.size=64;class Ya extends rr{get(e){return new Sl(this,e)}}Mt("SymbolInstanceArray",Ya);class ro extends io{getoffsetX(e){return this.float32[1*e+0]}}Mt("GlyphOffsetArray",ro);class ea extends lc{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Mt("SymbolLineVertexArray",ea);class tn extends Lo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}tn.prototype.size=12;class pa extends uc{get(e){return new tn(this,e)}}Mt("TextAnchorOffsetArray",pa);class Rh extends Lo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Rh.prototype.size=8;class hc extends tu{get(e){return new Rh(this,e)}}Mt("FeatureIndexArray",hc);class mr extends fa{}class un extends fa{}class iu extends fa{}class Tl extends Xa{}class Ml extends qu{}class ta extends eo{}class gr extends to{}class Oo extends ks{}class Fo extends Bo{}class dc extends cc{}class no extends vl{}class Rs extends Zu{}class ao extends $u{}class Al extends fs{}const Hu=Fr([{name:"a_pos",components:2,type:"Int16"}],4),{members:b}=Hu;class t{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,r,o,h){const p=this.segments[this.segments.length-1];return e>t.MAX_VERTEX_ARRAY_LENGTH&&Nt(`Max vertices per segment is ${t.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${t.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!p||p.vertexLength+e>t.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h?this.createNewSegment(r,o,h):p}createNewSegment(e,r,o){const h={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(h.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(h),h}getOrCreateLatestSegment(e,r,o){return this.prepareSegment(0,e,r,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,o,h){return new t([{vertexOffset:e,primitiveOffset:r,vertexLength:o,primitiveLength:h,vaos:{},sortKey:0}])}}function c(n,e){return 256*(n=Se(Math.floor(n),0,255))+Se(Math.floor(e),0,255)}t.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Mt("SegmentVector",t);const f=Fr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var x,S,C,P={exports:{}},k={exports:{}},O={exports:{}},N=function(){if(C)return P.exports;C=1;var n=(x||(x=1,k.exports=function(r,o){var h,p,g,v,M,A,z,I;for(p=r.length-(h=3&r.length),g=o,M=3432918353,A=461845907,I=0;I<p;)z=255&r.charCodeAt(I)|(255&r.charCodeAt(++I))<<8|(255&r.charCodeAt(++I))<<16|(255&r.charCodeAt(++I))<<24,++I,g=27492+(65535&(v=5*(65535&(g=(g^=z=(65535&(z=(z=(65535&z)*M+(((z>>>16)*M&65535)<<16)&4294967295)<<15|z>>>17))*A+(((z>>>16)*A&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(z=0,h){case 3:z^=(255&r.charCodeAt(I+2))<<16;case 2:z^=(255&r.charCodeAt(I+1))<<8;case 1:g^=z=(65535&(z=(z=(65535&(z^=255&r.charCodeAt(I)))*M+(((z>>>16)*M&65535)<<16)&4294967295)<<15|z>>>17))*A+(((z>>>16)*A&65535)<<16)&4294967295}return g^=r.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),k.exports),e=(S||(S=1,O.exports=function(r,o){for(var h,p=r.length,g=o^p,v=0;p>=4;)h=1540483477*(65535&(h=255&r.charCodeAt(v)|(255&r.charCodeAt(++v))<<8|(255&r.charCodeAt(++v))<<16|(255&r.charCodeAt(++v))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++v;switch(p){case 3:g^=(255&r.charCodeAt(v+2))<<16;case 2:g^=(255&r.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&r.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),O.exports);return P.exports=n,P.exports.murmur3=n,P.exports.murmur2=e,P.exports}(),U=H(N);class V{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,o,h){this.ids.push($(e)),this.positions.push(r,o,h)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=$(e);let o=0,h=this.ids.length-1;for(;o<h;){const g=o+h>>1;this.ids[g]>=r?h=g:o=g+1}const p=[];for(;this.ids[o]===r;)p.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return p}static serialize(e,r){const o=new Float64Array(e.ids),h=new Uint32Array(e.positions);return W(o,h,0,o.length-1),r&&r.push(o.buffer,h.buffer),{ids:o,positions:h}}static deserialize(e){const r=new V;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function $(n){const e=+n;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:U(String(n))}function W(n,e,r,o){for(;r<o;){const h=n[r+o>>1];let p=r-1,g=o+1;for(;;){do p++;while(n[p]<h);do g--;while(n[g]>h);if(p>=g)break;ae(n,p,g),ae(e,3*p,3*g),ae(e,3*p+1,3*g+1),ae(e,3*p+2,3*g+2)}g-r<o-g?(W(n,e,r,g),r=g+1):(W(n,e,g+1,o),o=g)}}function ae(n,e,r){const o=n[e];n[e]=n[r],n[r]=o}Mt("FeaturePositionMap",V);class ne{constructor(e,r){this.gl=e.gl,this.location=r}}class oe extends ne{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class he extends ne{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class ge extends ne{constructor(e,r){super(e,r),this.current=Tt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}function de(n){return[c(255*n.r,255*n.g),c(255*n.b,255*n.a)]}class xe{constructor(e,r,o){this.value=e,this.uniformNames=r.map(h=>`u_${h}`),this.type=o}setUniform(e,r,o){e.set(o.constantOr(this.value))}getBinding(e,r,o){return this.type==="color"?new ge(e,r):new oe(e,r)}}class Me{constructor(e,r){this.uniformNames=r.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,o,h){const p=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&e.set(p)}getBinding(e,r,o){return o.substr(0,9)==="u_pattern"?new he(e,r):new oe(e,r)}}class fe{constructor(e,r,o,h){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(p=>({name:`a_${p}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,r,o){const h=this.paintVertexArray.length,p=this.expression.evaluate(new vi(0,o),r,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(h,e,p)}updatePaintArray(e,r,o,h,p){const g=this.expression.evaluate(new vi(0,p),o,h);this._setPaintValue(e,r,g)}_setPaintValue(e,r,o){if(this.type==="color"){const h=de(o);for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,h[0],h[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ze{constructor(e,r,o,h,p,g){this.expression=e,this.uniformNames=r.map(v=>`u_${v}_t`),this.type=o,this.useIntegerZoom=h,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,r,o){const h=this.expression.evaluate(new vi(this.zoom,o),r,{},o.canonical,[],o.formattedSection),p=this.expression.evaluate(new vi(this.zoom+1,o),r,{},o.canonical,[],o.formattedSection),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,h,p)}updatePaintArray(e,r,o,h,p){const g=this.expression.evaluate(new vi(this.zoom,p),o,h),v=this.expression.evaluate(new vi(this.zoom+1,p),o,h);this._setPaintValue(e,r,g,v)}_setPaintValue(e,r,o,h){if(this.type==="color"){const p=de(o),g=de(h);for(let v=e;v<r;v++)this.paintVertexArray.emplace(v,p[0],p[1],g[0],g[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,o,h);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,h=Se(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(h)}getBinding(e,r,o){return new oe(e,r)}}class Ve{constructor(e,r,o,h,p,g){this.expression=e,this.type=r,this.useIntegerZoom=o,this.zoom=h,this.layerId=g,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,r,o){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(h,e,r.patterns&&r.patterns[this.layerId],o.imagePositions)}updatePaintArray(e,r,o,h,p){this._setPaintValues(e,r,o.patterns&&o.patterns[this.layerId],p.imagePositions)}_setPaintValues(e,r,o,h){if(!h||!o)return;const{min:p,mid:g,max:v}=o,M=h[p],A=h[g],z=h[v];if(M&&A&&z)for(let I=e;I<r;I++)this.zoomInPaintVertexArray.emplace(I,A.tl[0],A.tl[1],A.br[0],A.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],A.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(I,A.tl[0],A.tl[1],A.br[0],A.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],A.pixelRatio,z.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,f.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,f.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ne{constructor(e,r,o){this.binders={},this._buffers=[];const h=[];for(const p in e.paint._values){if(!o(p))continue;const g=e.paint.get(p);if(!(g instanceof ha&&Kl(g.property.specification)))continue;const v=He(p,e.type),M=g.value,A=g.property.specification.type,z=g.property.useIntegerZoom,I=g.property.specification["property-type"],L=I==="cross-faded"||I==="cross-faded-data-driven";if(M.kind==="constant")this.binders[p]=L?new Me(M.value,v):new xe(M.value,v,A),h.push(`/u_${p}`);else if(M.kind==="source"||L){const B=gt(p,A,"source");this.binders[p]=L?new Ve(M,A,z,r,B,e.id):new fe(M,v,A,B),h.push(`/a_${p}`)}else{const B=gt(p,A,"composite");this.binders[p]=new ze(M,v,A,z,r,B),h.push(`/z_${p}`)}}this.cacheKey=h.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof fe||r instanceof ze?r.maxValue:0}populatePaintArrays(e,r,o){for(const h in this.binders){const p=this.binders[h];(p instanceof fe||p instanceof ze||p instanceof Ve)&&p.populatePaintArray(e,r,o)}}setConstantPatternPositions(e,r){for(const o in this.binders){const h=this.binders[o];h instanceof Me&&h.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,o,h,p){let g=!1;for(const v in e){const M=r.getPositions(v);for(const A of M){const z=o.feature(A.index);for(const I in this.binders){const L=this.binders[I];if((L instanceof fe||L instanceof ze||L instanceof Ve)&&L.expression.isStateDependent===!0){const B=h.paint.get(I);L.expression=B.value,L.updatePaintArray(A.start,A.end,z,e[v],p),g=!0}}}}return g}defines(){const e=[];for(const r in this.binders){const o=this.binders[r];(o instanceof xe||o instanceof Me)&&e.push(...o.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof fe||o instanceof ze)for(let h=0;h<o.paintVertexAttributes.length;h++)e.push(o.paintVertexAttributes[h].name);else if(o instanceof Ve)for(let h=0;h<f.members.length;h++)e.push(f.members[h].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof xe||o instanceof Me||o instanceof ze)for(const h of o.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const o=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof xe||p instanceof Me||p instanceof ze){for(const g of p.uniformNames)if(r[g]){const v=p.getBinding(e,r[g],g);o.push({name:g,property:h,binding:v})}}}return o}setUniforms(e,r,o,h){for(const{name:p,property:g,binding:v}of r)this.binders[g].setUniform(v,h,o.get(g),p)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(e&&o instanceof Ve){const h=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(o instanceof fe||o instanceof ze)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const r in this.binders){const o=this.binders[r];(o instanceof fe||o instanceof ze||o instanceof Ve)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof fe||r instanceof ze||r instanceof Ve)&&r.destroy()}}}class Fe{constructor(e,r,o=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new Ne(h,r,o);this.needsUpload=!1,this._featureMap=new V,this._bufferOffset=0}populatePaintArrays(e,r,o,h){for(const p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(e,r,h);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,o,h){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,r,p,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function He(n,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}function gt(n,e,r){const o={color:{source:eo,composite:cr},number:{source:io,composite:eo}},h=function(p){return{"line-pattern":{source:gr,composite:gr},"fill-pattern":{source:gr,composite:gr},"fill-extrusion-pattern":{source:gr,composite:gr}}[p]}(n);return h&&h[r]||o[e][r]}Mt("ConstantBinder",xe),Mt("CrossFadedConstantBinder",Me),Mt("SourceExpressionBinder",fe),Mt("CrossFadedCompositeBinder",Ve),Mt("CompositeExpressionBinder",ze),Mt("ProgramConfiguration",Ne,{omit:["_buffers"]}),Mt("ProgramConfigurationSet",Fe);const yt=Math.pow(2,14)-1,st=-yt-1;function Bt(n){const e=Le/n.extent,r=n.loadGeometry();for(let o=0;o<r.length;o++){const h=r[o];for(let p=0;p<h.length;p++){const g=h[p],v=Math.round(g.x*e),M=Math.round(g.y*e);g.x=Se(v,st,yt),g.y=Se(M,st,yt),(v<g.x||v>g.x+1||M<g.y||M>g.y+1)&&Nt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function oi(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Bt(n):[]}}const Gi=-32768;function yr(n,e,r,o,h){n.emplaceBack(Gi+8*e+o,Gi+8*r+h)}class nr{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new un,this.indexArray=new ao,this.segments=new t,this.programConfigurations=new Fe(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){const h=this.layers[0],p=[];let g=null,v=!1,M=h.type==="heatmap";if(h.type==="circle"){const z=h;g=z.layout.get("circle-sort-key"),v=!g.isConstant(),M=M||z.paint.get("circle-pitch-alignment")==="map"}const A=M?r.subdivisionGranularity.circle:1;for(const{feature:z,id:I,index:L,sourceLayerIndex:B}of e){const j=this.layers[0]._featureFilter.needGeometry,q=oi(z,j);if(!this.layers[0]._featureFilter.filter(new vi(this.zoom,{globalState:this.globalState}),q,o))continue;const X=v?g.evaluate(q,{},o):void 0,J={id:I,properties:z.properties,type:z.type,sourceLayerIndex:B,index:L,geometry:j?q.geometry:Bt(z),patterns:{},sortKey:X};p.push(J)}v&&p.sort((z,I)=>z.sortKey-I.sortKey);for(const z of p){const{geometry:I,index:L,sourceLayerIndex:B}=z,j=e[L].feature;this.addFeature(z,I,L,o,A),r.featureIndex.insert(j,I,L,B,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:o,globalState:this.globalState})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,b),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,o,h,p=1){let g;switch(p){case 1:g=[0,7];break;case 3:g=[0,2,5,7];break;case 5:g=[0,1,3,4,6,7];break;case 7:g=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${p}; valid values are 1, 3, 5, 7.`)}const v=g.length;for(const M of r)for(const A of M){const z=A.x,I=A.y;if(z<0||z>=Le||I<0||I>=Le)continue;const L=this.segments.prepareSegment(v*v,this.layoutVertexArray,this.indexArray,e.sortKey),B=L.vertexLength;for(let j=0;j<v;j++)for(let q=0;q<v;q++)yr(this.layoutVertexArray,z,I,g[q],g[j]);for(let j=0;j<v-1;j++)for(let q=0;q<v-1;q++){const X=B+j*v+q,J=B+(j+1)*v+q;this.indexArray.emplaceBack(X,J+1,X+1),this.indexArray.emplaceBack(X,J,J+1)}L.vertexLength+=v*v,L.primitiveLength+=(v-1)*(v-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:h,globalState:this.globalState})}}function $r(n,e){for(let r=0;r<n.length;r++)if(Pa(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(Pa(n,e[r]))return!0;return!!Hr(n,e)}function jr(n,e,r){return!!Pa(n,e)||!!gn(e,n,r)}function mi(n,e){if(n.length===1)return ps(e,n[0]);for(let r=0;r<e.length;r++){const o=e[r];for(let h=0;h<o.length;h++)if(Pa(n,o[h]))return!0}for(let r=0;r<n.length;r++)if(ps(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(Hr(n,e[r]))return!0;return!1}function _r(n,e,r){if(n.length>1){if(Hr(n,e))return!0;for(let o=0;o<e.length;o++)if(gn(e[o],n,r))return!0}for(let o=0;o<n.length;o++)if(gn(n[o],e,r))return!0;return!1}function Hr(n,e){if(n.length===0||e.length===0)return!1;for(let r=0;r<n.length-1;r++){const o=n[r],h=n[r+1];for(let p=0;p<e.length-1;p++)if(wn(o,h,e[p],e[p+1]))return!0}return!1}function wn(n,e,r,o){return ot(n,r,o)!==ot(e,r,o)&&ot(n,e,r)!==ot(n,e,o)}function gn(n,e,r){const o=r*r;if(e.length===1)return n.distSqr(e[0])<o;for(let h=1;h<e.length;h++)if(ia(n,e[h-1],e[h])<o)return!0;return!1}function ia(n,e,r){const o=e.distSqr(r);if(o===0)return n.distSqr(e);const h=((n.x-e.x)*(r.x-e.x)+(n.y-e.y)*(r.y-e.y))/o;return n.distSqr(h<0?e:h>1?r:r.sub(e)._mult(h)._add(e))}function ps(n,e){let r,o,h,p=!1;for(let g=0;g<n.length;g++){r=n[g];for(let v=0,M=r.length-1;v<r.length;M=v++)o=r[v],h=r[M],o.y>e.y!=h.y>e.y&&e.x<(h.x-o.x)*(e.y-o.y)/(h.y-o.y)+o.x&&(p=!p)}return p}function Pa(n,e){let r=!1;for(let o=0,h=n.length-1;o<n.length;h=o++){const p=n[o],g=n[h];p.y>e.y!=g.y>e.y&&e.x<(g.x-p.x)*(e.y-p.y)/(g.y-p.y)+p.x&&(r=!r)}return r}function ms(n,e,r){const o=r[0],h=r[2];if(n.x<o.x&&e.x<o.x||n.x>h.x&&e.x>h.x||n.y<o.y&&e.y<o.y||n.y>h.y&&e.y>h.y)return!1;const p=ot(n,e,r[0]);return p!==ot(n,e,r[1])||p!==ot(n,e,r[2])||p!==ot(n,e,r[3])}function gs(n,e,r){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:r.programConfigurations.get(e.id).getMaxValue(n)}function ys(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Ds(n,e,r,o,h){if(!e[0]&&!e[1])return n;const p=G.convert(e)._mult(h);r==="viewport"&&p._rotate(-o);const g=[];for(let v=0;v<n.length;v++)g.push(n[v].sub(p));return g}let jo,Fn;Mt("CircleBucket",nr,{omit:["layers"]});var _s={get paint(){return Fn=Fn||new Pn({"circle-radius":new Qt($e.paint_circle["circle-radius"]),"circle-color":new Qt($e.paint_circle["circle-color"]),"circle-blur":new Qt($e.paint_circle["circle-blur"]),"circle-opacity":new Qt($e.paint_circle["circle-opacity"]),"circle-translate":new Ft($e.paint_circle["circle-translate"]),"circle-translate-anchor":new Ft($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ft($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ft($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Qt($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Qt($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Qt($e.paint_circle["circle-stroke-opacity"])})},get layout(){return jo=jo||new Pn({"circle-sort-key":new Qt($e.layout_circle["circle-sort-key"])})}};class ra extends cn{constructor(e){super(e,_s)}createBucket(e){return new nr(e)}queryRadius(e){const r=e;return gs("circle-radius",this,r)+gs("circle-stroke-width",this,r)+ys(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:o,geometry:h,transform:p,pixelsToTileUnits:g,unwrappedTileID:v,getElevation:M}){const A=Ds(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-p.bearingInRadians,g),z=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o),I=this.paint.get("circle-pitch-alignment")==="map",L=I?A:function(j,q,X,J){return j.map(ue=>No(ue,q,X,J))}(A,p,v,M),B=I?z*g:z;for(const j of h)for(const q of j){const X=I?q:No(q,p,v,M);let J=B;const ue=p.projectTileCoordinates(q.x,q.y,v,M).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?J*=ue/p.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(J*=p.cameraToCenterDistance/ue),jr(L,X,J))return!0}return!1}}function No(n,e,r,o){const h=e.projectTileCoordinates(n.x,n.y,r,o).point;return new G((.5*h.x+.5)*e.width,(.5*-h.y+.5)*e.height)}class Dr extends nr{}let Xr;Mt("HeatmapBucket",Dr,{omit:["layers"]});var ma={get paint(){return Xr=Xr||new Pn({"heatmap-radius":new Qt($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Qt($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ft($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new oc($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ft($e.paint_heatmap["heatmap-opacity"])})}};function Lr(n,{width:e,height:r},o,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*r*o)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${e*r*o}`)}else h=new Uint8Array(e*r*o);return n.width=e,n.height=r,n.data=h,n}function Vo(n,{width:e,height:r},o){if(e===n.width&&r===n.height)return;const h=Lr({},{width:e,height:r},o);Uo(n,h,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,r)},o),n.width=e,n.height=r,n.data=h.data}function Uo(n,e,r,o,h,p){if(h.width===0||h.height===0)return e;if(h.width>n.width||h.height>n.height||r.x>n.width-h.width||r.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||o.x>e.width-h.width||o.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const g=n.data,v=e.data;if(g===v)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<h.height;M++){const A=((r.y+M)*n.width+r.x)*p,z=((o.y+M)*e.width+o.x)*p;for(let I=0;I<h.width*p;I++)v[z+I]=g[A+I]}return e}class Ia{constructor(e,r){Lr(this,e,1,r)}resize(e){Vo(this,e,1)}clone(){return new Ia({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,h,p){Uo(e,r,o,h,p,1)}}class xr{constructor(e,r){Lr(this,e,4,r)}resize(e){Vo(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new xr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,h,p){Uo(e,r,o,h,p,4)}setPixel(e,r,o){const h=4*(e*this.width+r);this.data[h+0]=Math.round(255*o.r/o.a),this.data[h+1]=Math.round(255*o.g/o.a),this.data[h+2]=Math.round(255*o.b/o.a),this.data[h+3]=Math.round(255*o.a)}}Mt("AlphaImage",Ia),Mt("RGBAImage",xr);const so="big-fb";class Wa extends cn{createBucket(e){return new Dr(e)}constructor(e){super(e,ma),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=function(e){const r={},o=e.resolution||256,h=e.clips?e.clips.length:1,p=e.image||new xr({width:o,height:h});if(Math.log(o)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${o}`);const g=(v,M,A)=>{r[e.evaluationKey]=A;const z=e.expression.evaluate(r);p.setPixel(v/4/o,M/4,z)};if(e.clips)for(let v=0,M=0;v<h;++v,M+=4*o)for(let A=0,z=0;A<o;A++,z+=4){const I=A/(o-1),{start:L,end:B}=e.clips[v];g(M,z,L*(1-I)+B*I)}else for(let v=0,M=0;v<o;v++,M+=4)g(0,M,v/(o-1));return p}({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(so)&&this.heatmapFbos.delete(so)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let rn;var Go={get paint(){return rn=rn||new Pn({"hillshade-illumination-direction":new Ft($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ft($e.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ft($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ft($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ft($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ft($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ft($e.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ft($e.paint_hillshade["hillshade-method"])})}};class Dh extends cn{constructor(e){super(e,Go),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,h=this.paint.get("hillshade-shadow-color").values;const p=Math.max(e.length,r.length,o.length,h.length);e=e.concat(Array(p-e.length).fill(e.at(-1))),r=r.concat(Array(p-r.length).fill(r.at(-1))),o=o.concat(Array(p-o.length).fill(o.at(-1))),h=h.concat(Array(p-h.length).fill(h.at(-1)));const g=r.map(ui);return{directionRadians:e.map(ui),altitudeRadians:g,shadowColor:h,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let xs;var vs={get paint(){return xs=xs||new Pn({"color-relief-opacity":new Ft($e["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new oc($e["paint_color-relief"]["color-relief-color"])})}};class zr{constructor(e,r,o,h){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(r,h)}update(e,r,o){const{width:h,height:p}=e,g=!(this.size&&this.size[0]===h&&this.size[1]===p||o),{context:v}=this,{gl:M}=v;if(this.useMipmap=!!(r&&r.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!r||r.premultiply!==!1)),g)this.size=[h,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Rt(e)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,e):M.texImage2D(M.TEXTURE_2D,0,this.format,h,p,0,this.format,M.UNSIGNED_BYTE,e.data);else{const{x:A,y:z}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Rt(e)?M.texSubImage2D(M.TEXTURE_2D,0,A,z,M.RGBA,M.UNSIGNED_BYTE,e):M.texSubImage2D(M.TEXTURE_2D,0,A,z,h,p,M.RGBA,M.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D),v.pixelStoreUnpackFlipY.setDefault(),v.pixelStoreUnpack.setDefault(),v.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,r,o){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),o!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,o||e),this.filter=e),r!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Ka{constructor(e,r,o,h=1,p=1,g=1,v=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Nt(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const M=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=p,this.blueFactor=g,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let A=0;A<M;A++)this.data[this._idx(-1,A)]=this.data[this._idx(0,A)],this.data[this._idx(M,A)]=this.data[this._idx(M-1,A)],this.data[this._idx(A,-1)]=this.data[this._idx(A,0)],this.data[this._idx(A,M)]=this.data[this._idx(A,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let A=0;A<M;A++)for(let z=0;z<M;z++){const I=this.get(A,z);I>this.max&&(this.max=I),I<this.min&&(this.min=I)}}get(e,r){const o=new Uint8Array(this.data.buffer),h=4*this._idx(e,r);return this.unpack(o[h],o[h+1],o[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,o){return e*this.redFactor+r*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return xd(e,this.getUnpackVector())}getPixels(){return new xr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=r*this.dim,p=r*this.dim+this.dim,g=o*this.dim,v=o*this.dim+this.dim;switch(r){case-1:h=p-1;break;case 1:p=h+1}switch(o){case-1:g=v-1;break;case 1:v=g+1}const M=-r*this.dim,A=-o*this.dim;for(let z=g;z<v;z++)for(let I=h;I<p;I++)this.data[this._idx(I,z)]=e.data[this._idx(I+M,z+A)]}}function xd(n,e){const r=e[0],o=e[1],h=e[2],p=e[3],g=Math.min(r,o,h),v=Math.round((n+p)/g);return{r:Math.floor(v*g/r)%256,g:Math.floor(v*g/o)%256,b:Math.floor(v*g/h)%256}}Mt("DEMData",Ka);class Of extends cn{constructor(e){super(e,vs)}_createColorRamp(e){const r={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof sl&&o._styleExpression.expression instanceof br){this.colorRampExpression=o;const g=o._styleExpression.expression;r.elevationStops=g.labels,r.colorStops=[];for(const v of r.elevationStops)r.colorStops.push(g.evaluate({globals:{elevation:v}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[Tt.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=e)return r;const h={elevationStops:[],colorStops:[]},p=(r.elevationStops.length-1)/(e-1);for(let g=0;g<r.elevationStops.length-.5;g+=p)h.elevationStops.push(r.elevationStops[Math.round(g)]),h.colorStops.push(r.colorStops[Math.round(g)]);return Nt(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),h}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,r,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const h=this._createColorRamp(r),p=new xr({width:h.colorStops.length,height:1}),g=new xr({width:h.colorStops.length,height:1});for(let v=0;v<h.elevationStops.length;v++){const M=xd(h.elevationStops[v],o);g.setPixel(0,v,new Tt(M.r/255,M.g/255,M.b/255,1)),p.setPixel(0,v,h.colorStops[v])}return this.colorRampTextures={elevationTexture:new zr(e,g,e.gl.RGBA),colorTexture:new zr(e,p,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const af=Fr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ff}=af;function fc(n,e,r){const o=r.patternDependencies;let h=!1;for(const p of e){const g=p.paint.get(`${n}-pattern`);g.isConstant()||(h=!0);const v=g.constantOr(null);v&&(h=!0,o[v.to]=!0,o[v.from]=!0)}return h}function Xu(n,e,r,o,h){const p=h.patternDependencies;for(const g of e){const v=g.paint.get(`${n}-pattern`).value;if(v.kind!=="constant"){let M=v.evaluate({zoom:o-1},r,{},h.availableImages),A=v.evaluate({zoom:o},r,{},h.availableImages),z=v.evaluate({zoom:o+1},r,{},h.availableImages);M=M&&M.name?M.name:M,A=A&&A.name?A.name:A,z=z&&z.name?z.name:z,p[M]=!0,p[A]=!0,p[z]=!0,r.patterns[g.id]={min:M,mid:A,max:z}}}return r}function jf(n,e,r,o,h){let p;if(h===function(g,v,M,A){let z=0;for(let I=v,L=M-A;I<M;I+=A)z+=(g[L]-g[I])*(g[I+1]+g[L+1]),L=I;return z}(n,e,r,o)>0)for(let g=e;g<r;g+=o)p=nu(g/o|0,n[g],n[g+1],p);else for(let g=r-o;g>=e;g-=o)p=nu(g/o|0,n[g],n[g+1],p);return p&&ru(p,p.next)&&(In(p),p=p.next),p}function Cl(n,e){if(!n)return n;e||(e=n);let r,o=n;do if(r=!1,o.steiner||!ru(o,o.next)&&nn(o.prev,o,o.next)!==0)o=o.next;else{if(In(o),o=e=o.prev,o===o.next)break;r=!0}while(r||o!==e);return e}function Lh(n,e,r,o,h,p,g){if(!n)return;!g&&p&&function(M,A,z,I){let L=M;do L.z===0&&(L.z=yn(L.x,L.y,A,z,I)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==M);L.prevZ.nextZ=null,L.prevZ=null,function(B){let j,q=1;do{let X,J=B;B=null;let ue=null;for(j=0;J;){j++;let le=J,ce=0;for(let ye=0;ye<q&&(ce++,le=le.nextZ,le);ye++);let Te=q;for(;ce>0||Te>0&&le;)ce!==0&&(Te===0||!le||J.z<=le.z)?(X=J,J=J.nextZ,ce--):(X=le,le=le.nextZ,Te--),ue?ue.nextZ=X:B=X,X.prevZ=ue,ue=X;J=le}ue.nextZ=null,q*=2}while(j>1)}(L)}(n,o,h,p);let v=n;for(;n.prev!==n.next;){const M=n.prev,A=n.next;if(p?Nf(n,o,h,p):Bh(n))e.push(M.i,n.i,A.i),In(n),n=A.next,v=A.next;else if((n=A)===v){g?g===1?Lh(n=sf(Cl(n),e),e,r,o,h,p,2):g===2&&Yu(n,e,r,o,h,p):Lh(Cl(n),e,r,o,h,p,1);break}}}function Bh(n){const e=n.prev,r=n,o=n.next;if(nn(e,r,o)>=0)return!1;const h=e.x,p=r.x,g=o.x,v=e.y,M=r.y,A=o.y,z=Math.min(h,p,g),I=Math.min(v,M,A),L=Math.max(h,p,g),B=Math.max(v,M,A);let j=o.next;for(;j!==e;){if(j.x>=z&&j.x<=L&&j.y>=I&&j.y<=B&&Oh(h,v,p,M,g,A,j.x,j.y)&&nn(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function Nf(n,e,r,o){const h=n.prev,p=n,g=n.next;if(nn(h,p,g)>=0)return!1;const v=h.x,M=p.x,A=g.x,z=h.y,I=p.y,L=g.y,B=Math.min(v,M,A),j=Math.min(z,I,L),q=Math.max(v,M,A),X=Math.max(z,I,L),J=yn(B,j,e,r,o),ue=yn(q,X,e,r,o);let le=n.prevZ,ce=n.nextZ;for(;le&&le.z>=J&&ce&&ce.z<=ue;){if(le.x>=B&&le.x<=q&&le.y>=j&&le.y<=X&&le!==h&&le!==g&&Oh(v,z,M,I,A,L,le.x,le.y)&&nn(le.prev,le,le.next)>=0||(le=le.prevZ,ce.x>=B&&ce.x<=q&&ce.y>=j&&ce.y<=X&&ce!==h&&ce!==g&&Oh(v,z,M,I,A,L,ce.x,ce.y)&&nn(ce.prev,ce,ce.next)>=0))return!1;ce=ce.nextZ}for(;le&&le.z>=J;){if(le.x>=B&&le.x<=q&&le.y>=j&&le.y<=X&&le!==h&&le!==g&&Oh(v,z,M,I,A,L,le.x,le.y)&&nn(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;ce&&ce.z<=ue;){if(ce.x>=B&&ce.x<=q&&ce.y>=j&&ce.y<=X&&ce!==h&&ce!==g&&Oh(v,z,M,I,A,L,ce.x,ce.y)&&nn(ce.prev,ce,ce.next)>=0)return!1;ce=ce.nextZ}return!0}function sf(n,e){let r=n;do{const o=r.prev,h=r.next.next;!ru(o,h)&&Fh(o,r,r.next,h)&&Ku(o,h)&&Ku(h,o)&&(e.push(o.i,r.i,h.i),In(r),In(r.next),r=n=h),r=r.next}while(r!==n);return Cl(r)}function Yu(n,e,r,o,h,p){let g=n;do{let v=g.next.next;for(;v!==g.prev;){if(g.i!==v.i&&xp(g,v)){let M=wd(g,v);return g=Cl(g,g.next),M=Cl(M,M.next),Lh(g,e,r,o,h,p,0),void Lh(M,e,r,o,h,p,0)}v=v.next}g=g.next}while(g!==n)}function _p(n,e){let r=n.x-e.x;return r===0&&(r=n.y-e.y,r===0)&&(r=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function vd(n,e){const r=function(h,p){let g=p;const v=h.x,M=h.y;let A,z=-1/0;if(ru(h,g))return g;do{if(ru(h,g.next))return g.next;if(M<=g.y&&M>=g.next.y&&g.next.y!==g.y){const q=g.x+(M-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(q<=v&&q>z&&(z=q,A=g.x<g.next.x?g:g.next,q===v))return A}g=g.next}while(g!==p);if(!A)return null;const I=A,L=A.x,B=A.y;let j=1/0;g=A;do{if(v>=g.x&&g.x>=L&&v!==g.x&&of(M<B?v:z,M,L,B,M<B?z:v,M,g.x,g.y)){const q=Math.abs(M-g.y)/(v-g.x);Ku(g,h)&&(q<j||q===j&&(g.x>A.x||g.x===A.x&&bd(A,g)))&&(A=g,j=q)}g=g.next}while(g!==I);return A}(n,e);if(!r)return e;const o=wd(r,n);return Cl(o,o.next),Cl(r,r.next)}function bd(n,e){return nn(n.prev,n,e.prev)<0&&nn(e.next,n,n.next)<0}function yn(n,e,r,o,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function na(n){let e=n,r=n;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==n);return r}function of(n,e,r,o,h,p,g,v){return(h-g)*(e-v)>=(n-g)*(p-v)&&(n-g)*(o-v)>=(r-g)*(e-v)&&(r-g)*(p-v)>=(h-g)*(o-v)}function Oh(n,e,r,o,h,p,g,v){return!(n===g&&e===v)&&of(n,e,r,o,h,p,g,v)}function xp(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(r,o){let h=r;do{if(h.i!==r.i&&h.next.i!==r.i&&h.i!==o.i&&h.next.i!==o.i&&Fh(h,h.next,r,o))return!0;h=h.next}while(h!==r);return!1}(n,e)&&(Ku(n,e)&&Ku(e,n)&&function(r,o){let h=r,p=!1;const g=(r.x+o.x)/2,v=(r.y+o.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&g<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==r);return p}(n,e)&&(nn(n.prev,n,e.prev)||nn(n,e.prev,e))||ru(n,e)&&nn(n.prev,n,n.next)>0&&nn(e.prev,e,e.next)>0)}function nn(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function ru(n,e){return n.x===e.x&&n.y===e.y}function Fh(n,e,r,o){const h=Wu(nn(n,e,r)),p=Wu(nn(n,e,o)),g=Wu(nn(r,o,n)),v=Wu(nn(r,o,e));return h!==p&&g!==v||!(h!==0||!jh(n,r,e))||!(p!==0||!jh(n,o,e))||!(g!==0||!jh(r,n,o))||!(v!==0||!jh(r,e,o))}function jh(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function Wu(n){return n>0?1:n<0?-1:0}function Ku(n,e){return nn(n.prev,n,n.next)<0?nn(n,e,n.next)>=0&&nn(n,n.prev,e)>=0:nn(n,e,n.prev)<0||nn(n,n.next,e)<0}function wd(n,e){const r=Nh(n.i,n.x,n.y),o=Nh(e.i,e.x,e.y),h=n.next,p=e.prev;return n.next=e,e.prev=n,r.next=h,h.prev=r,o.next=r,r.prev=o,p.next=o,o.prev=p,o}function nu(n,e,r,o){const h=Nh(n,e,r);return o?(h.next=o.next,h.prev=o,o.next.prev=h,o.next=h):(h.prev=h,h.next=h),h}function In(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Nh(n,e,r){return{i:n,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class au{constructor(e,r){if(r>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=r}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Sd{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Sd.noSubdivision=new Sd({fill:new au(0,0),line:new au(0,0),tile:new au(0,0),stencil:new au(0,0),circle:1}),Mt("SubdivisionGranularityExpression",au),Mt("SubdivisionGranularitySetting",Sd);const pc=-32768,Vh=32767;class vp{constructor(e,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=Le/e,this._canonical=r}_getKey(e,r){return(e+=32768)<<16|r+32768}_vertexToIndex(e,r){if(e<-32768||r<-32768||e>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),h=0|Math.round(r),p=this._getKey(o,h);if(this._vertexDictionary.has(p))return this._vertexDictionary.get(p);const g=this._vertexBuffer.length/2;return this._vertexDictionary.set(p,g),this._vertexBuffer.push(o,h),g}_subdivideTrianglesScanline(e){if(this._granularity<2)return function(h,p){const g=[];for(let v=0;v<p.length;v+=3){const M=p[v],A=p[v+1],z=p[v+2],I=h[2*M],L=h[2*M+1];(h[2*A]-I)*(h[2*z+1]-L)-(h[2*A+1]-L)*(h[2*z]-I)>0?(g.push(M),g.push(z),g.push(A)):(g.push(M),g.push(A),g.push(z))}return g}(this._vertexBuffer,e);const r=[],o=e.length;for(let h=0;h<o;h+=3){const p=[e[h+0],e[h+1],e[h+2]],g=[this._vertexBuffer[2*e[h+0]+0],this._vertexBuffer[2*e[h+0]+1],this._vertexBuffer[2*e[h+1]+0],this._vertexBuffer[2*e[h+1]+1],this._vertexBuffer[2*e[h+2]+0],this._vertexBuffer[2*e[h+2]+1]];let v=1/0,M=1/0,A=-1/0,z=-1/0;for(let q=0;q<3;q++){const X=g[2*q],J=g[2*q+1];v=Math.min(v,X),A=Math.max(A,X),M=Math.min(M,J),z=Math.max(z,J)}if(v===A||M===z)continue;const I=Math.floor(v/this._granularityCellSize),L=Math.ceil(A/this._granularityCellSize),B=Math.floor(M/this._granularityCellSize),j=Math.ceil(z/this._granularityCellSize);if(I!==L||B!==j)for(let q=B;q<j;q++){const X=this._scanlineGenerateVertexRingForCellRow(q,g,p);qo(this._vertexBuffer,X,r)}else r.push(...p)}return r}_scanlineGenerateVertexRingForCellRow(e,r,o){const h=e*this._granularityCellSize,p=h+this._granularityCellSize,g=[];for(let v=0;v<3;v++){const M=r[2*v],A=r[2*v+1],z=r[2*(v+1)%6],I=r[(2*(v+1)+1)%6],L=r[2*(v+2)%6],B=r[(2*(v+2)+1)%6],j=z-M,q=I-A,X=j===0,J=q===0,ue=(h-A)/q,le=(p-A)/q,ce=Math.min(ue,le),Te=Math.max(ue,le);if(!J&&(ce>=1||Te<=0)||J&&(A<h||A>p)){I>=h&&I<=p&&g.push(o[(v+1)%3]);continue}!J&&ce>0&&g.push(this._vertexToIndex(M+j*ce,A+q*ce));const ye=M+j*Math.max(ce,0),ve=M+j*Math.min(Te,1);X||this._generateIntraEdgeVertices(g,M,A,z,I,ye,ve),!J&&Te<1&&g.push(this._vertexToIndex(M+j*Te,A+q*Te)),(J||I>=h&&I<=p)&&g.push(o[(v+1)%3]),!J&&(I<=h||I>=p)&&this._generateInterEdgeVertices(g,M,A,z,I,L,B,ve,h,p)}return g}_generateIntraEdgeVertices(e,r,o,h,p,g,v){const M=h-r,A=p-o,z=A===0,I=z?Math.min(r,h):Math.min(g,v),L=z?Math.max(r,h):Math.max(g,v),B=Math.floor(I/this._granularityCellSize)+1,j=Math.ceil(L/this._granularityCellSize)-1;if(z?r<h:g<v)for(let q=B;q<=j;q++){const X=q*this._granularityCellSize;e.push(this._vertexToIndex(X,o+A*(X-r)/M))}else for(let q=j;q>=B;q--){const X=q*this._granularityCellSize;e.push(this._vertexToIndex(X,o+A*(X-r)/M))}}_generateInterEdgeVertices(e,r,o,h,p,g,v,M,A,z){const I=p-o,L=g-h,B=v-p,j=(A-p)/B,q=(z-p)/B,X=Math.min(j,q),J=Math.max(j,q),ue=h+L*X;let le=Math.floor(Math.min(ue,M)/this._granularityCellSize)+1,ce=Math.ceil(Math.max(ue,M)/this._granularityCellSize)-1,Te=M<ue;const ye=B===0;if(ye&&(v===A||v===z))return;if(ye||X>=1||J<=0){const we=o-v,Ye=g+(r-g)*Math.min((A-v)/we,(z-v)/we);le=Math.floor(Math.min(Ye,M)/this._granularityCellSize)+1,ce=Math.ceil(Math.max(Ye,M)/this._granularityCellSize)-1,Te=M<Ye}const ve=I>0?z:A;if(Te)for(let we=le;we<=ce;we++)e.push(this._vertexToIndex(we*this._granularityCellSize,ve));else for(let we=ce;we>=le;we--)e.push(this._vertexToIndex(we*this._granularityCellSize,ve))}_generateOutline(e){const r=[];for(const o of e){const h=su(o,this._granularity,!0),p=this._pointArrayToIndices(h),g=[];for(let v=1;v<p.length;v++)g.push(p[v-1]),g.push(p[v]);r.push(g)}return r}_handlePoles(e){let r=!1,o=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(r||o)&&this._fillPoles(e,r,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let r=0;r<e.length;r+=2){const o=e[r+1];o===pc&&(e[r+1]=-32767),o===Vh&&(e[r+1]=32766)}}_generatePoleQuad(e,r,o,h,p,g){h>p!=(g===pc)?(e.push(r),e.push(o),e.push(this._vertexToIndex(h,g)),e.push(o),e.push(this._vertexToIndex(p,g)),e.push(this._vertexToIndex(h,g))):(e.push(o),e.push(r),e.push(this._vertexToIndex(h,g)),e.push(this._vertexToIndex(p,g)),e.push(o),e.push(this._vertexToIndex(h,g)))}_fillPoles(e,r,o){const h=this._vertexBuffer,p=Le,g=e.length;for(let v=2;v<g;v+=3){const M=e[v-2],A=e[v-1],z=e[v],I=h[2*M],L=h[2*M+1],B=h[2*A],j=h[2*A+1],q=h[2*z],X=h[2*z+1];r&&(L===0&&j===0&&this._generatePoleQuad(e,M,A,I,B,pc),j===0&&X===0&&this._generatePoleQuad(e,A,z,B,q,pc),X===0&&L===0&&this._generatePoleQuad(e,z,M,q,I,pc)),o&&(L===p&&j===p&&this._generatePoleQuad(e,M,A,I,B,Vh),j===p&&X===p&&this._generatePoleQuad(e,A,z,B,q,Vh),X===p&&L===p&&this._generatePoleQuad(e,z,M,q,I,Vh))}}_initializeVertices(e){for(let r=0;r<e.length;r+=2)this._vertexToIndex(e[r],e[r+1])}subdividePolygonInternal(e,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:h}=function(v){const M=[],A=[];for(const z of v)if(z.length!==0){z!==v[0]&&M.push(A.length/2);for(let I=0;I<z.length;I++)A.push(z[I].x),A.push(z[I].y)}return{flattened:A,holeIndices:M}}(e);let p;this._initializeVertices(o);try{const v=function(A,z,I=2){const L=z&&z.length,B=L?z[0]*I:A.length;let j=jf(A,0,B,I,!0);const q=[];if(!j||j.next===j.prev)return q;let X,J,ue;if(L&&(j=function(le,ce,Te,ye){const ve=[];for(let we=0,Ye=ce.length;we<Ye;we++){const We=jf(le,ce[we]*ye,we<Ye-1?ce[we+1]*ye:le.length,ye,!1);We===We.next&&(We.steiner=!0),ve.push(na(We))}ve.sort(_p);for(let we=0;we<ve.length;we++)Te=vd(ve[we],Te);return Te}(A,z,j,I)),A.length>80*I){X=A[0],J=A[1];let le=X,ce=J;for(let Te=I;Te<B;Te+=I){const ye=A[Te],ve=A[Te+1];ye<X&&(X=ye),ve<J&&(J=ve),ye>le&&(le=ye),ve>ce&&(ce=ve)}ue=Math.max(le-X,ce-J),ue=ue!==0?32767/ue:0}return Lh(j,q,I,X,J,ue,0),q}(o,h),M=this._convertIndices(o,v);p=this._subdivideTrianglesScanline(M)}catch(v){console.error(v)}let g=[];return r&&(g=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(p),{verticesFlattened:this._vertexBuffer,indicesTriangles:p,indicesLineList:g}}_convertIndices(e,r){const o=[];for(let h=0;h<r.length;h++)o.push(this._vertexToIndex(e[2*r[h]],e[2*r[h]+1]));return o}_pointArrayToIndices(e){const r=[];for(let o=0;o<e.length;o++){const h=e[o];r.push(this._vertexToIndex(h.x,h.y))}return r}}function Td(n,e,r,o=!0){return new vp(r,e).subdividePolygonInternal(n,o)}function su(n,e,r=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const o=n[0],h=n[n.length-1],p=r&&(o.x!==h.x||o.y!==h.y);if(e<2)return p?[...n,n[0]]:[...n];const g=Math.floor(Le/e),v=[];v.push(new G(n[0].x,n[0].y));const M=n.length,A=p?M:M-1;for(let z=0;z<A;z++){const I=n[z],L=z<M-1?n[z+1]:n[0],B=I.x,j=I.y,q=L.x,X=L.y,J=B!==q,ue=j!==X;if(!J&&!ue)continue;const le=q-B,ce=X-j,Te=Math.abs(le),ye=Math.abs(ce);let ve=B,we=j;for(;;){const We=le>0?(Math.floor(ve/g)+1)*g:(Math.ceil(ve/g)-1)*g,et=ce>0?(Math.floor(we/g)+1)*g:(Math.ceil(we/g)-1)*g,Ue=Math.abs(ve-We),it=Math.abs(we-et),tt=Math.abs(ve-q),Pt=Math.abs(we-X),jt=J?Ue/Te:Number.POSITIVE_INFINITY,kt=ue?it/ye:Number.POSITIVE_INFINITY;if((tt<=Ue||!J)&&(Pt<=it||!ue))break;if(jt<kt&&J||!ue){ve=We,we+=ce*jt;const vt=new G(ve,Math.round(we));v[v.length-1].x===vt.x&&v[v.length-1].y===vt.y||v.push(vt)}else{ve+=le*kt,we=et;const vt=new G(Math.round(ve),we);v[v.length-1].x===vt.x&&v[v.length-1].y===vt.y||v.push(vt)}}const Ye=new G(q,X);v[v.length-1].x===Ye.x&&v[v.length-1].y===Ye.y||v.push(Ye)}return v}function qo(n,e,r){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,h=n[2*e[0]];for(let M=1;M<e.length;M++){const A=n[2*e[M]];A<h&&(h=A,o=M)}const p=e.length;let g=o,v=(g+1)%p;for(;;){const M=g-1>=0?g-1:p-1,A=(v+1)%p,z=n[2*e[M]],I=n[2*e[A]],L=n[2*e[g]],B=n[2*e[g]+1],j=n[2*e[v]+1];let q=!1;if(z<I)q=!0;else if(z>I)q=!1;else{const X=j-B,J=-(n[2*e[v]]-L),ue=B<j?1:-1;((z-L)*X+(n[2*e[M]+1]-B)*J)*ue>((I-L)*X+(n[2*e[A]+1]-B)*J)*ue&&(q=!0)}if(q){const X=e[M],J=e[g],ue=e[v];X!==J&&X!==ue&&J!==ue&&r.push(ue,J,X),g--,g<0&&(g=p-1)}else{const X=e[A],J=e[g],ue=e[v];X!==J&&X!==ue&&J!==ue&&r.push(ue,J,X),v++,v>=p&&(v=0)}if(M===A)break}}function Md(n,e,r,o,h,p,g,v,M){const A=h.length/2,z=g&&v&&M;if(A<t.MAX_VERTEX_ARRAY_LENGTH){const I=e.prepareSegment(A,r,o),L=I.vertexLength;for(let q=0;q<p.length;q+=3)o.emplaceBack(L+p[q],L+p[q+1],L+p[q+2]);let B,j;I.vertexLength+=A,I.primitiveLength+=p.length/3,z&&(j=g.prepareSegment(A,r,v),B=j.vertexLength,j.vertexLength+=A);for(let q=0;q<h.length;q+=2)n(h[q],h[q+1]);if(z)for(let q=0;q<M.length;q++){const X=M[q];for(let J=1;J<X.length;J+=2)v.emplaceBack(B+X[J-1],B+X[J]);j.primitiveLength+=X.length/2}}else(function(I,L,B,j,q,X){const J=[];for(let ye=0;ye<j.length/2;ye++)J.push(-1);const ue={count:0};let le=0,ce=I.getOrCreateLatestSegment(L,B),Te=ce.vertexLength;for(let ye=2;ye<q.length;ye+=3){const ve=q[ye-2],we=q[ye-1],Ye=q[ye];let We=J[ve]<le,et=J[we]<le,Ue=J[Ye]<le;ce.vertexLength+((We?1:0)+(et?1:0)+(Ue?1:0))>t.MAX_VERTEX_ARRAY_LENGTH&&(ce=I.createNewSegment(L,B),le=ue.count,We=!0,et=!0,Ue=!0,Te=0);const it=Uh(J,j,X,ue,ve,We,ce),tt=Uh(J,j,X,ue,we,et,ce),Pt=Uh(J,j,X,ue,Ye,Ue,ce);B.emplaceBack(Te+it-le,Te+tt-le,Te+Pt-le),ce.primitiveLength++}})(e,r,o,h,p,n),z&&function(I,L,B,j,q,X){const J=[];for(let ye=0;ye<j.length/2;ye++)J.push(-1);const ue={count:0};let le=0,ce=I.getOrCreateLatestSegment(L,B),Te=ce.vertexLength;for(let ye=0;ye<q.length;ye++){const ve=q[ye];for(let we=1;we<q[ye].length;we+=2){const Ye=ve[we-1],We=ve[we];let et=J[Ye]<le,Ue=J[We]<le;ce.vertexLength+((et?1:0)+(Ue?1:0))>t.MAX_VERTEX_ARRAY_LENGTH&&(ce=I.createNewSegment(L,B),le=ue.count,et=!0,Ue=!0,Te=0);const it=Uh(J,j,X,ue,Ye,et,ce),tt=Uh(J,j,X,ue,We,Ue,ce);B.emplaceBack(Te+it-le,Te+tt-le),ce.primitiveLength++}}}(g,r,v,h,M,n),e.forceNewSegmentOnNextPrepare(),g==null||g.forceNewSegmentOnNextPrepare()}function Uh(n,e,r,o,h,p,g){if(p){const v=o.count;return r(e[2*h],e[2*h+1]),n[h]=o.count,o.count++,g.vertexLength++,v}return n[h]}class lf{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new iu,this.indexArray=new ao,this.indexArray2=new Al,this.programConfigurations=new Fe(e.layers,e.zoom),this.segments=new t,this.segments2=new t,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=fc("fill",this.layers,r);const h=this.layers[0].layout.get("fill-sort-key"),p=!h.isConstant(),g=[];for(const{feature:v,id:M,index:A,sourceLayerIndex:z}of e){const I=this.layers[0]._featureFilter.needGeometry,L=oi(v,I);if(!this.layers[0]._featureFilter.filter(new vi(this.zoom,{globalState:this.globalState}),L,o))continue;const B=p?h.evaluate(L,{},o,r.availableImages):void 0,j={id:M,properties:v.properties,type:v.type,sourceLayerIndex:z,index:A,geometry:I?L.geometry:Bt(v),patterns:{},sortKey:B};g.push(j)}p&&g.sort((v,M)=>v.sortKey-M.sortKey);for(const v of g){const{geometry:M,index:A,sourceLayerIndex:z}=v;if(this.hasPattern){const I=Xu("fill",this.layers,v,this.zoom,r);this.patternFeatures.push(I)}else this.addFeature(v,M,A,o,{},r.subdivisionGranularity);r.featureIndex.insert(e[A].feature,M,A,z,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:o,globalState:this.globalState})}addFeatures(e,r,o){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ff),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,o,h,p,g){for(const v of Yn(r,500)){const M=Td(v,h,g.fill.getGranularityForZoomLevel(h.z)),A=this.layoutVertexArray;Md((z,I)=>{A.emplaceBack(z,I)},this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles,this.segments2,this.indexArray2,M.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,canonical:h,globalState:this.globalState})}}let El,Vf;Mt("FillBucket",lf,{omit:["layers","patternFeatures"]});var Gh={get paint(){return Vf=Vf||new Pn({"fill-antialias":new Ft($e.paint_fill["fill-antialias"]),"fill-opacity":new Qt($e.paint_fill["fill-opacity"]),"fill-color":new Qt($e.paint_fill["fill-color"]),"fill-outline-color":new Qt($e.paint_fill["fill-outline-color"]),"fill-translate":new Ft($e.paint_fill["fill-translate"]),"fill-translate-anchor":new Ft($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new za($e.paint_fill["fill-pattern"])})},get layout(){return El=El||new Pn({"fill-sort-key":new Qt($e.layout_fill["fill-sort-key"])})}};class Qu extends cn{constructor(e){super(e,Gh)}recalculate(e,r){super.recalculate(e,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new lf(e)}queryRadius(){return ys(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:r,transform:o,pixelsToTileUnits:h}){return mi(Ds(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,h),r)}isTileClipped(){return!0}}const hn=Fr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ju=Fr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ad}=hn;class eh{constructor(e,r,o,h,p){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=h,this._values=p,e.readFields(Cd,this,r)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos,o=[];let h,p=1,g=0,v=0,M=0;for(;e.pos<r;){if(g<=0){const A=e.readVarint();p=7&A,g=A>>3}if(g--,p===1||p===2)v+=e.readSVarint(),M+=e.readSVarint(),p===1&&(h&&o.push(h),h=[]),h&&h.push(new G(v,M));else{if(p!==7)throw new Error(`unknown command ${p}`);h&&h.push(h[0].clone())}}return h&&o.push(h),o}bbox(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos;let o=1,h=0,p=0,g=0,v=1/0,M=-1/0,A=1/0,z=-1/0;for(;e.pos<r;){if(h<=0){const I=e.readVarint();o=7&I,h=I>>3}if(h--,o===1||o===2)p+=e.readSVarint(),g+=e.readSVarint(),p<v&&(v=p),p>M&&(M=p),g<A&&(A=g),g>z&&(z=g);else if(o!==7)throw new Error(`unknown command ${o}`)}return[v,A,M,z]}toGeoJSON(e,r,o){const h=this.extent*Math.pow(2,o),p=this.extent*e,g=this.extent*r,v=this.loadGeometry();function M(L){return[360*(L.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(L.y+g)/h)*Math.PI))-90]}function A(L){return L.map(M)}let z;if(this.type===1){const L=[];for(const j of v)L.push(j[0]);const B=A(L);z=L.length===1?{type:"Point",coordinates:B[0]}:{type:"MultiPoint",coordinates:B}}else if(this.type===2){const L=v.map(A);z=L.length===1?{type:"LineString",coordinates:L[0]}:{type:"MultiLineString",coordinates:L}}else{if(this.type!==3)throw new Error("unknown feature type");{const L=function(j){const q=j.length;if(q<=1)return[j];const X=[];let J,ue;for(let le=0;le<q;le++){const ce=ou(j[le]);ce!==0&&(ue===void 0&&(ue=ce<0),ue===ce<0?(J&&X.push(J),J=[j[le]]):J&&J.push(j[le]))}return J&&X.push(J),X}(v),B=[];for(const j of L)B.push(j.map(A));z=B.length===1?{type:"Polygon",coordinates:B[0]}:{type:"MultiPolygon",coordinates:B}}}const I={type:"Feature",geometry:z,properties:this.properties};return this.id!=null&&(I.id=this.id),I}}function Cd(n,e,r){n===1?e.id=r.readVarint():n===2?function(o,h){const p=o.readVarint()+o.pos;for(;o.pos<p;){const g=h._keys[o.readVarint()],v=h._values[o.readVarint()];h.properties[g]=v}}(r,e):n===3?e.type=r.readVarint():n===4&&(e._geometry=r.pos)}function ou(n){let e=0;for(let r,o,h=0,p=n.length,g=p-1;h<p;g=h++)r=n[h],o=n[g],e+=(o.x-r.x)*(r.y+o.y);return e}eh.types=["Unknown","Point","LineString","Polygon"];class Uf{constructor(e,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(bp,this,r),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const r=this._pbf.readVarint()+this._pbf.pos;return new eh(this._pbf,r,this.extent,this._keys,this._values)}}function bp(n,e,r){n===15?e.version=r.readVarint():n===1?e.name=r.readString():n===5?e.extent=r.readVarint():n===2?e._features.push(r.pos):n===3?e._keys.push(r.readString()):n===4&&e._values.push(function(o){let h=null;const p=o.readVarint()+o.pos;for(;o.pos<p;){const g=o.readVarint()>>3;h=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h}(r))}class qh{constructor(e,r){this.layers=e.readFields(zl,{},r)}}function zl(n,e,r){if(n===3){const o=new Uf(r,r.readVarint()+r.pos);o.length&&(e[o.name]=o)}}const Zh=Math.pow(2,13);function th(n,e,r,o,h,p,g,v){n.emplaceBack(e,r,2*Math.floor(o*Zh)+g,h*Zh*2,p*Zh*2,Math.round(v))}class Ed{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Tl,this.centroidVertexArray=new mr,this.indexArray=new ao,this.programConfigurations=new Fe(e.layers,e.zoom),this.segments=new t,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.features=[],this.hasPattern=fc("fill-extrusion",this.layers,r);for(const{feature:h,id:p,index:g,sourceLayerIndex:v}of e){const M=this.layers[0]._featureFilter.needGeometry,A=oi(h,M);if(!this.layers[0]._featureFilter.filter(new vi(this.zoom,{globalState:this.globalState}),A,o))continue;const z={id:p,sourceLayerIndex:v,index:g,geometry:M?A.geometry:Bt(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(Xu("fill-extrusion",this.layers,z,this.zoom,r)):this.addFeature(z,z.geometry,g,o,{},r.subdivisionGranularity),r.featureIndex.insert(h,z.geometry,g,v,this.index,!0)}}addFeatures(e,r,o){for(const h of this.features){const{geometry:p}=h;this.addFeature(h,p,h.index,r,o,e.subdivisionGranularity)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:o,globalState:this.globalState})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ad),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Ju.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,o,h,p,g){for(const v of Yn(r,500)){const M={x:0,y:0,sampleCount:0},A=this.layoutVertexArray.length;this.processPolygon(M,h,e,v,g);const z=this.layoutVertexArray.length-A,I=Math.floor(M.x/M.sampleCount),L=Math.floor(M.y/M.sampleCount);for(let B=0;B<z;B++)this.centroidVertexArray.emplaceBack(I,L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,canonical:h,globalState:this.globalState})}processPolygon(e,r,o,h,p){if(h.length<1||Nr(h[0]))return;for(const I of h)I.length!==0&&ih(e,I);const g={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},v=p.fill.getGranularityForZoomLevel(r.z),M=eh.types[o.type]==="Polygon";for(const I of h){if(I.length===0||Nr(I))continue;const L=su(I,v,M);this._generateSideFaces(L,g)}if(!M)return;const A=Td(h,r,v,!1),z=this.layoutVertexArray;Md((I,L)=>{th(z,I,L,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,A.verticesFlattened,A.indicesTriangles)}_generateSideFaces(e,r){let o=0;for(let h=1;h<e.length;h++){const p=e[h],g=e[h-1];if(Gf(p,g))continue;r.segment.vertexLength+4>t.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const v=p.sub(g)._perp()._unit(),M=g.dist(p);o+M>32768&&(o=0),th(this.layoutVertexArray,p.x,p.y,v.x,v.y,0,0,o),th(this.layoutVertexArray,p.x,p.y,v.x,v.y,0,1,o),o+=M,th(this.layoutVertexArray,g.x,g.y,v.x,v.y,0,0,o),th(this.layoutVertexArray,g.x,g.y,v.x,v.y,0,1,o);const A=r.segment.vertexLength;this.indexArray.emplaceBack(A,A+2,A+1),this.indexArray.emplaceBack(A+1,A+2,A+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function ih(n,e){for(let r=0;r<e.length;r++){const o=e[r];r===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(n.x+=o.x,n.y+=o.y,n.sampleCount++)}}function Gf(n,e){return n.x===e.x&&(n.x<0||n.x>Le)||n.y===e.y&&(n.y<0||n.y>Le)}function Nr(n){return n.every(e=>e.x<0)||n.every(e=>e.x>Le)||n.every(e=>e.y<0)||n.every(e=>e.y>Le)}let lu;Mt("FillExtrusionBucket",Ed,{omit:["layers","features"]});var Pl={get paint(){return lu=lu||new Pn({"fill-extrusion-opacity":new Ft($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Qt($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ft($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ft($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new za($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Qt($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Qt($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ft($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class dn extends cn{constructor(e){super(e,Pl)}createBucket(e){return new Ed(e)}queryRadius(){return ys(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:o,geometry:h,transform:p,pixelsToTileUnits:g,pixelPosMatrix:v}){const M=Ds(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-p.bearingInRadians,g),A=this.paint.get("fill-extrusion-height").evaluate(r,o),z=this.paint.get("fill-extrusion-base").evaluate(r,o),I=function(B,j){const q=[];for(const X of B){const J=[X.x,X.y,0,1];Ze(J,J,j),q.push(new G(J[0]/J[3],J[1]/J[3]))}return q}(M,v),L=function(B,j,q,X){const J=[],ue=[],le=X[8]*j,ce=X[9]*j,Te=X[10]*j,ye=X[11]*j,ve=X[8]*q,we=X[9]*q,Ye=X[10]*q,We=X[11]*q;for(const et of B){const Ue=[],it=[];for(const tt of et){const Pt=tt.x,jt=tt.y,kt=X[0]*Pt+X[4]*jt+X[12],vt=X[1]*Pt+X[5]*jt+X[13],Wt=X[2]*Pt+X[6]*jt+X[14],Kt=X[3]*Pt+X[7]*jt+X[15],li=Wt+Te,Fi=Kt+ye,Ki=kt+ve,Hi=vt+we,ji=Wt+Ye,gi=Kt+We,Ct=new G((kt+le)/Fi,(vt+ce)/Fi);Ct.z=li/Fi,Ue.push(Ct);const Vt=new G(Ki/gi,Hi/gi);Vt.z=ji/gi,it.push(Vt)}J.push(Ue),ue.push(it)}return[J,ue]}(h,z,A,v);return function(B,j,q){let X=1/0;mi(q,j)&&(X=rh(q,j[0]));for(let J=0;J<j.length;J++){const ue=j[J],le=B[J];for(let ce=0;ce<ue.length-1;ce++){const Te=ue[ce],ye=[Te,ue[ce+1],le[ce+1],le[ce],Te];$r(q,ye)&&(X=Math.min(X,rh(q,ye)))}}return X!==1/0&&X}(L[0],L[1],I)}}function Il(n,e){return n.x*e.x+n.y*e.y}function rh(n,e){if(n.length===1){let r=0;const o=e[r++];let h;for(;!h||o.equals(h);)if(h=e[r++],!h)return 1/0;for(;r<e.length;r++){const p=e[r],g=n[0],v=h.sub(o),M=p.sub(o),A=g.sub(o),z=Il(v,v),I=Il(v,M),L=Il(M,M),B=Il(A,v),j=Il(A,M),q=z*L-I*I,X=(L*B-I*j)/q,J=(z*j-I*B)/q,ue=o.z*(1-X-J)+h.z*X+p.z*J;if(isFinite(ue))return ue}return 1/0}{let r=1/0;for(const o of e)r=Math.min(r,o.z);return r}}const Zn=Fr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:wp}=Zn,$h=Fr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:cf}=$h,Pr=Math.cos(Math.PI/180*37.5),aa=Math.pow(2,14)/.5;class ka{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ml,this.layoutVertexArray2=new ta,this.indexArray=new ao,this.programConfigurations=new Fe(e.layers,e.zoom),this.segments=new t,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=fc("line",this.layers,r);const h=this.layers[0].layout.get("line-sort-key"),p=!h.isConstant(),g=[];for(const{feature:v,id:M,index:A,sourceLayerIndex:z}of e){const I=this.layers[0]._featureFilter.needGeometry,L=oi(v,I);if(!this.layers[0]._featureFilter.filter(new vi(this.zoom,{globalState:this.globalState}),L,o))continue;const B=p?h.evaluate(L,{},o):void 0,j={id:M,properties:v.properties,type:v.type,sourceLayerIndex:z,index:A,geometry:I?L.geometry:Bt(v),patterns:{},sortKey:B};g.push(j)}p&&g.sort((v,M)=>v.sortKey-M.sortKey);for(const v of g){const{geometry:M,index:A,sourceLayerIndex:z}=v;if(this.hasPattern){const I=Xu("line",this.layers,v,this.zoom,r);this.patternFeatures.push(I)}else this.addFeature(v,M,A,o,{},r.subdivisionGranularity);r.featureIndex.insert(e[A].feature,M,A,z,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:o,globalState:this.globalState})}addFeatures(e,r,o){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,cf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wp),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,o,h,p,g){const v=this.layers[0].layout,M=v.get("line-join").evaluate(e,{}),A=v.get("line-cap"),z=v.get("line-miter-limit"),I=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const L of r)this.addLine(L,e,M,A,z,I,h,g);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,canonical:h,globalState:this.globalState})}addLine(e,r,o,h,p,g,v,M){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=su(e,v?M.line.getGranularityForZoomLevel(v.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<e.length-1;le++)this.totalDistance+=e[le].dist(e[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=eh.types[r.type]==="Polygon";let z=e.length;for(;z>=2&&e[z-1].equals(e[z-2]);)z--;let I=0;for(;I<z-1&&e[I].equals(e[I+1]);)I++;if(z<(A?3:2))return;o==="bevel"&&(p=1.05);const L=this.overscaling<=16?122880/(512*this.overscaling):0,B=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray);let j,q,X,J,ue;this.e1=this.e2=-1,A&&(j=e[z-2],ue=e[I].sub(j)._unit()._perp());for(let le=I;le<z;le++){if(X=le===z-1?A?e[I+1]:void 0:e[le+1],X&&e[le].equals(X))continue;ue&&(J=ue),j&&(q=j),j=e[le],ue=X?X.sub(j)._unit()._perp():J,J=J||ue;let ce=J.add(ue);ce.x===0&&ce.y===0||ce._unit();const Te=J.x*ue.x+J.y*ue.y,ye=ce.x*ue.x+ce.y*ue.y,ve=ye!==0?1/ye:1/0,we=2*Math.sqrt(2-2*ye),Ye=ye<Pr&&q&&X,We=J.x*ue.y-J.y*ue.x>0;if(Ye&&le>I){const it=j.dist(q);if(it>2*L){const tt=j.sub(j.sub(q)._mult(L/it)._round());this.updateDistance(q,tt),this.addCurrentVertex(tt,J,0,0,B),q=tt}}const et=q&&X;let Ue=et?o:A?"butt":h;if(et&&Ue==="round"&&(ve<g?Ue="miter":ve<=2&&(Ue="fakeround")),Ue==="miter"&&ve>p&&(Ue="bevel"),Ue==="bevel"&&(ve>2&&(Ue="flipbevel"),ve<p&&(Ue="miter")),q&&this.updateDistance(q,j),Ue==="miter")ce._mult(ve),this.addCurrentVertex(j,ce,0,0,B);else if(Ue==="flipbevel"){if(ve>100)ce=ue.mult(-1);else{const it=ve*J.add(ue).mag()/J.sub(ue).mag();ce._perp()._mult(it*(We?-1:1))}this.addCurrentVertex(j,ce,0,0,B),this.addCurrentVertex(j,ce.mult(-1),0,0,B)}else if(Ue==="bevel"||Ue==="fakeround"){const it=-Math.sqrt(ve*ve-1),tt=We?it:0,Pt=We?0:it;if(q&&this.addCurrentVertex(j,J,tt,Pt,B),Ue==="fakeround"){const jt=Math.round(180*we/Math.PI/20);for(let kt=1;kt<jt;kt++){let vt=kt/jt;if(vt!==.5){const Kt=vt-.5;vt+=vt*Kt*(vt-1)*((1.0904+Te*(Te*(3.55645-1.43519*Te)-3.2452))*Kt*Kt+(.848013+Te*(.215638*Te-1.06021)))}const Wt=ue.sub(J)._mult(vt)._add(J)._unit()._mult(We?-1:1);this.addHalfVertex(j,Wt.x,Wt.y,!1,We,0,B)}}X&&this.addCurrentVertex(j,ue,-tt,-Pt,B)}else if(Ue==="butt")this.addCurrentVertex(j,ce,0,0,B);else if(Ue==="square"){const it=q?1:-1;this.addCurrentVertex(j,ce,it,it,B)}else Ue==="round"&&(q&&(this.addCurrentVertex(j,J,0,0,B),this.addCurrentVertex(j,J,1,1,B,!0)),X&&(this.addCurrentVertex(j,ue,-1,-1,B,!0),this.addCurrentVertex(j,ue,0,0,B)));if(Ye&&le<z-1){const it=j.dist(X);if(it>2*L){const tt=j.add(X.sub(j)._mult(L/it)._round());this.updateDistance(j,tt),this.addCurrentVertex(tt,ue,0,0,B),j=tt}}}}addCurrentVertex(e,r,o,h,p,g=!1){const v=r.y*h-r.x,M=-r.y-r.x*h;this.addHalfVertex(e,r.x+r.y*o,r.y-r.x*o,g,!1,o,p),this.addHalfVertex(e,v,M,g,!0,-h,p),this.distance>aa/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,o,h,p,g))}addHalfVertex({x:e,y:r},o,h,p,g,v,M){const A=.5*(this.lineClips?this.scaledDistance*(aa-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(r<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,z,this.e2),M.primitiveLength++),g?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let nh,qf;Mt("LineBucket",ka,{omit:["layers","patternFeatures"]});var Zf={get paint(){return qf=qf||new Pn({"line-opacity":new Qt($e.paint_line["line-opacity"]),"line-color":new Qt($e.paint_line["line-color"]),"line-translate":new Ft($e.paint_line["line-translate"]),"line-translate-anchor":new Ft($e.paint_line["line-translate-anchor"]),"line-width":new Qt($e.paint_line["line-width"]),"line-gap-width":new Qt($e.paint_line["line-gap-width"]),"line-offset":new Qt($e.paint_line["line-offset"]),"line-blur":new Qt($e.paint_line["line-blur"]),"line-dasharray":new Gu($e.paint_line["line-dasharray"]),"line-pattern":new za($e.paint_line["line-pattern"]),"line-gradient":new oc($e.paint_line["line-gradient"])})},get layout(){return nh=nh||new Pn({"line-cap":new Ft($e.layout_line["line-cap"]),"line-join":new Qt($e.layout_line["line-join"]),"line-miter-limit":new Ft($e.layout_line["line-miter-limit"]),"line-round-limit":new Ft($e.layout_line["line-round-limit"]),"line-sort-key":new Qt($e.layout_line["line-sort-key"])})}};class mc extends Qt{possiblyEvaluate(e,r){return r=new vi(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,o,h){return r=wt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,o,h)}}let Ra;class oo extends cn{constructor(e){super(e,Zf),this.gradientVersion=0,Ra||(Ra=new mc(Zf.paint.properties["line-width"].specification),Ra.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Qo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Ra.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new ka(e)}queryRadius(e){const r=e,o=ah(gs("line-width",this,r),gs("line-gap-width",this,r)),h=gs("line-offset",this,r);return o/2+Math.abs(h)+ys(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:o,geometry:h,transform:p,pixelsToTileUnits:g}){const v=Ds(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-p.bearingInRadians,g),M=g/2*ah(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),A=this.paint.get("line-offset").evaluate(r,o);return A&&(h=function(z,I){const L=[];for(let B=0;B<z.length;B++){const j=z[B],q=[];for(let X=0;X<j.length;X++){const J=j[X-1],ue=j[X],le=j[X+1],ce=X===0?new G(0,0):ue.sub(J)._unit()._perp(),Te=X===j.length-1?new G(0,0):le.sub(ue)._unit()._perp(),ye=ce._add(Te)._unit(),ve=ye.x*Te.x+ye.y*Te.y;ve!==0&&ye._mult(1/ve),q.push(ye._mult(I)._add(ue))}L.push(q)}return L}(h,A*g)),function(z,I,L){for(let B=0;B<I.length;B++){const j=I[B];if(z.length>=3){for(let q=0;q<j.length;q++)if(Pa(z,j[q]))return!0}if(_r(z,j,L))return!0}return!1}(v,h,M)}isTileClipped(){return!0}}function ah(n,e){return e>0?e+2*n:n}const Qa=Fr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$f=Fr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Fr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const gc=Fr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Fr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const cu=Fr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);function uu(n,e,r){return n.sections.forEach(o=>{o.text=function(h,p,g){const v=p.layout.get("text-transform").evaluate(g,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),Ks.applyArabicShaping&&(h=Ks.applyArabicShaping(h)),h}(o.text,e,r)}),n}Fr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4),Fr([{name:"triangle",components:3,type:"Uint16"}]),Fr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Fr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Fr([{type:"Float32",name:"offsetX"}]),Fr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Fr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const sh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var kn=24;const lo=4294967296,hu=1/lo,oh=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class yc{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,r,o=this.length){for(;this.pos<o;){const h=this.readVarint(),p=h>>3,g=this.pos;this.type=7&h,e(p,r,this),this.pos===g&&this.skip(h)}return r}readMessage(e,r){return this.readFields(e,r,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*lo;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*lo;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const r=this.buf;let o,h;return h=r[this.pos++],o=127&h,h<128?o:(h=r[this.pos++],o|=(127&h)<<7,h<128?o:(h=r[this.pos++],o|=(127&h)<<14,h<128?o:(h=r[this.pos++],o|=(127&h)<<21,h<128?o:(h=r[this.pos],o|=(15&h)<<28,function(p,g,v){const M=v.buf;let A,z;if(z=M[v.pos++],A=(112&z)>>4,z<128||(z=M[v.pos++],A|=(127&z)<<3,z<128)||(z=M[v.pos++],A|=(127&z)<<10,z<128)||(z=M[v.pos++],A|=(127&z)<<17,z<128)||(z=M[v.pos++],A|=(127&z)<<24,z<128)||(z=M[v.pos++],A|=(1&z)<<31,z<128))return Zo(p,A,g);throw new Error("Expected varint not more than 10 bytes")}(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,r=this.pos;return this.pos=e,e-r>=12&&oh?oh.decode(this.buf.subarray(r,e)):function(o,h,p){let g="",v=h;for(;v<p;){const M=o[v];let A,z,I,L=null,B=M>239?4:M>223?3:M>191?2:1;if(v+B>p)break;B===1?M<128&&(L=M):B===2?(A=o[v+1],(192&A)==128&&(L=(31&M)<<6|63&A,L<=127&&(L=null))):B===3?(A=o[v+1],z=o[v+2],(192&A)==128&&(192&z)==128&&(L=(15&M)<<12|(63&A)<<6|63&z,(L<=2047||L>=55296&&L<=57343)&&(L=null))):B===4&&(A=o[v+1],z=o[v+2],I=o[v+3],(192&A)==128&&(192&z)==128&&(192&I)==128&&(L=(15&M)<<18|(63&A)<<12|(63&z)<<6|63&I,(L<=65535||L>=1114112)&&(L=null))),L===null?(L=65533,B=1):L>65535&&(L-=65536,g+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),g+=String.fromCharCode(L),v+=B}return g}(this.buf,r,e)}readBytes(){const e=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,e);return this.pos=e,r}readPackedVarint(e=[],r){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(r));return e}readPackedSVarint(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const r=7&e;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(e,r){this.writeVarint(e<<3|r)}realloc(e){let r=this.length||16;for(;r<this.pos+e;)r*=2;if(r!==this.length){const o=new Uint8Array(r);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*hu),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*hu),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?function(r,o){let h,p;if(r>=0?(h=r%4294967296|0,p=r/4294967296|0):(h=~(-r%4294967296),p=~(-r/4294967296),4294967295^h?h=h+1|0:(h=0,p=p+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(g,v,M){M.buf[M.pos++]=127&g|128,g>>>=7,M.buf[M.pos++]=127&g|128,g>>>=7,M.buf[M.pos++]=127&g|128,g>>>=7,M.buf[M.pos++]=127&g|128,M.buf[M.pos]=127&(g>>>=7)}(h,0,o),function(g,v){const M=(7&g)<<4;v.buf[v.pos++]|=M|((g>>>=3)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g)))))}(p,o)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const r=this.pos;this.pos=function(h,p,g){for(let v,M,A=0;A<p.length;A++){if(v=p.charCodeAt(A),v>55295&&v<57344){if(!M){v>56319||A+1===p.length?(h[g++]=239,h[g++]=191,h[g++]=189):M=v;continue}if(v<56320){h[g++]=239,h[g++]=191,h[g++]=189,M=v;continue}v=M-55296<<10|v-56320|65536,M=null}else M&&(h[g++]=239,h[g++]=191,h[g++]=189,M=null);v<128?h[g++]=v:(v<2048?h[g++]=v>>6|192:(v<65536?h[g++]=v>>12|224:(h[g++]=v>>18|240,h[g++]=v>>12&63|128),h[g++]=v>>6&63|128),h[g++]=63&v|128)}return g}(this.buf,e,this.pos);const o=this.pos-r;o>=128&&lh(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const r=e.length;this.writeVarint(r),this.realloc(r);for(let o=0;o<r;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,r){this.pos++;const o=this.pos;e(r,this);const h=this.pos-o;h>=128&&lh(o,h,this),this.pos=o-1,this.writeVarint(h),this.pos+=h}writeMessage(e,r,o){this.writeTag(e,2),this.writeRawMessage(r,o)}writePackedVarint(e,r){r.length&&this.writeMessage(e,Hf,r)}writePackedSVarint(e,r){r.length&&this.writeMessage(e,Sp,r)}writePackedBoolean(e,r){r.length&&this.writeMessage(e,Xh,r)}writePackedFloat(e,r){r.length&&this.writeMessage(e,ch,r)}writePackedDouble(e,r){r.length&&this.writeMessage(e,Hh,r)}writePackedFixed32(e,r){r.length&&this.writeMessage(e,Tp,r)}writePackedSFixed32(e,r){r.length&&this.writeMessage(e,qp,r)}writePackedFixed64(e,r){r.length&&this.writeMessage(e,Mp,r)}writePackedSFixed64(e,r){r.length&&this.writeMessage(e,Tr,r)}writeBytesField(e,r){this.writeTag(e,2),this.writeBytes(r)}writeFixed32Field(e,r){this.writeTag(e,5),this.writeFixed32(r)}writeSFixed32Field(e,r){this.writeTag(e,5),this.writeSFixed32(r)}writeFixed64Field(e,r){this.writeTag(e,1),this.writeFixed64(r)}writeSFixed64Field(e,r){this.writeTag(e,1),this.writeSFixed64(r)}writeVarintField(e,r){this.writeTag(e,0),this.writeVarint(r)}writeSVarintField(e,r){this.writeTag(e,0),this.writeSVarint(r)}writeStringField(e,r){this.writeTag(e,2),this.writeString(r)}writeFloatField(e,r){this.writeTag(e,5),this.writeFloat(r)}writeDoubleField(e,r){this.writeTag(e,1),this.writeDouble(r)}writeBooleanField(e,r){this.writeVarintField(e,+r)}}function Zo(n,e,r){return r?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function lh(n,e,r){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(o);for(let h=r.pos-1;h>=n;h--)r.buf[h+o]=r.buf[h]}function Hf(n,e){for(let r=0;r<n.length;r++)e.writeVarint(n[r])}function Sp(n,e){for(let r=0;r<n.length;r++)e.writeSVarint(n[r])}function ch(n,e){for(let r=0;r<n.length;r++)e.writeFloat(n[r])}function Hh(n,e){for(let r=0;r<n.length;r++)e.writeDouble(n[r])}function Xh(n,e){for(let r=0;r<n.length;r++)e.writeBoolean(n[r])}function Tp(n,e){for(let r=0;r<n.length;r++)e.writeFixed32(n[r])}function qp(n,e){for(let r=0;r<n.length;r++)e.writeSFixed32(n[r])}function Mp(n,e){for(let r=0;r<n.length;r++)e.writeFixed64(n[r])}function Tr(n,e){for(let r=0;r<n.length;r++)e.writeSFixed64(n[r])}function Vr(n){let e=0,r=0;for(const g of n)e+=g.w*g.h,r=Math.max(r,g.w);n.sort((g,v)=>v.h-g.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let h=0,p=0;for(const g of n)for(let v=o.length-1;v>=0;v--){const M=o[v];if(!(g.w>M.w||g.h>M.h)){if(g.x=M.x,g.y=M.y,p=Math.max(p,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===M.w&&g.h===M.h){const A=o.pop();A&&v<o.length&&(o[v]=A)}else g.h===M.h?(M.x+=g.w,M.w-=g.w):g.w===M.w?(M.y+=g.h,M.h-=g.h):(o.push({x:M.x+g.w,y:M.y,w:M.w-g.w,h:g.h}),M.y+=g.h,M.h-=g.h);break}}return{w:h,h:p,fill:e/(h*p)||0}}class qi{constructor(e,{pixelRatio:r,version:o,stretchX:h,stretchY:p,content:g,textFitWidth:v,textFitHeight:M}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=h,this.stretchY=p,this.content=g,this.version=o,this.textFitWidth=v,this.textFitHeight=M}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Oi{constructor(e,r){const o={},h={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,o,p),this.addImages(r,h,p);const{w:g,h:v}=Vr(p),M=new xr({width:g||1,height:v||1});for(const A in e){const z=e[A],I=o[A].paddedRect;xr.copy(z.data,M,{x:0,y:0},{x:I.x+1,y:I.y+1},z.data)}for(const A in r){const z=r[A],I=h[A].paddedRect,L=I.x+1,B=I.y+1,j=z.data.width,q=z.data.height;xr.copy(z.data,M,{x:0,y:0},{x:L,y:B},z.data),xr.copy(z.data,M,{x:0,y:q-1},{x:L,y:B-1},{width:j,height:1}),xr.copy(z.data,M,{x:0,y:0},{x:L,y:B+q},{width:j,height:1}),xr.copy(z.data,M,{x:j-1,y:0},{x:L-1,y:B},{width:1,height:q}),xr.copy(z.data,M,{x:0,y:0},{x:L+j,y:B},{width:1,height:q})}this.image=M,this.iconPositions=o,this.patternPositions=h}addImages(e,r,o){for(const h in e){const p=e[h],g={x:0,y:0,w:p.data.width+2,h:p.data.height+2};o.push(g),r[h]=new qi(g,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),r)}patchUpdatedImage(e,r,o){if(!e||!r||e.version===r.version)return;e.version=r.version;const[h,p]=e.tl;o.update(r.data,void 0,{x:h,y:p})}}var Ci;Mt("ImagePosition",qi),Mt("ImageAtlas",Oi),function(n){n[n.none=0]="none",n[n.horizontal=1]="horizontal",n[n.vertical=2]="vertical",n[n.horizontalOnly=3]="horizontalOnly"}(Ci||(Ci={}));class ga{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(e,r,o){const h=new ga;return h.scale=e||1,h.fontStack=r,h.verticalAlign=o||"bottom",h}static forImage(e,r){const o=new ga;return o.imageName=e,o.verticalAlign=r||"bottom",o}}class Ls{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const o=new Ls;for(let h=0;h<e.sections.length;h++){const p=e.sections[h];p.image?o.addImageSection(p):o.addTextSection(p,r)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let o=0;o<e.length;o++){const h=e.charCodeAt(o+1)||null,p=e.charCodeAt(o-1)||null;r+=h&&Cr(h)&&!sh[e[o+1]]||p&&Cr(p)&&!sh[e[o-1]]||!sh[e[o]]?e[o]:sh[e[o]]}return r}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&Yh[this.text.charCodeAt(o)];o++)e++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Yh[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const o=new Ls;return o.text=this.text.substring(e,r),o.sectionIndex=this.sectionIndex.slice(e,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}getMaxImageSize(e){let r=0,o=0;for(let h=0;h<this.length();h++){const p=this.getSection(h);if(p.imageName){const g=e[p.imageName];if(!g)continue;const v=g.displaySize;r=Math.max(r,v[0]),o=Math.max(o,v[1])}}return{maxImageWidth:r,maxImageHeight:o}}addTextSection(e,r){this.text+=e.text,this.sections.push(ga.forText(e.scale,e.fontStack||r,e.verticalAlign));const o=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(o)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Nt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(ga.forImage(r,e.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Nt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _c(n,e,r,o,h,p,g,v,M,A,z,I,L,B,j){const q=Ls.fromFeature(n,h);let X;I===Ci.vertical&&q.verticalizePunctuation();const{processBidirectionalText:J,processStyledBidirectionalText:ue}=Ks;if(J&&q.sections.length===1){X=[];const Te=J(q.toString(),kl(q,A,p,e,o,B));for(const ye of Te){const ve=new Ls;ve.text=ye,ve.sections=q.sections;for(let we=0;we<ye.length;we++)ve.sectionIndex.push(0);X.push(ve)}}else if(ue){X=[];const Te=ue(q.text,q.sectionIndex,kl(q,A,p,e,o,B));for(const ye of Te){const ve=new Ls;ve.text=ye[0],ve.sectionIndex=ye[1],ve.sections=q.sections,X.push(ve)}}else X=function(Te,ye){const ve=[],we=Te.text;let Ye=0;for(const We of ye)ve.push(Te.substring(Ye,We)),Ye=We;return Ye<we.length&&ve.push(Te.substring(Ye,we.length)),ve}(q,kl(q,A,p,e,o,B));const le=[],ce={positionedLines:le,text:q.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:I,iconsInText:!1,verticalizable:!1};return function(Te,ye,ve,we,Ye,We,et,Ue,it,tt,Pt,jt){let kt=0,vt=0,Wt=0,Kt=0;const li=Ue==="right"?1:Ue==="left"?0:.5,Fi=kn/jt;let Ki=0;for(const gi of Ye){gi.trim();const Ct=gi.getMaxScale(),Vt={positionedGlyphs:[],lineOffset:0};Te.positionedLines[Ki]=Vt;const Ni=Vt.positionedGlyphs;let Vi=0;if(!gi.length()){vt+=We,++Ki;continue}const Qi=hf(we,gi,Fi);for(let Wr=0;Wr<gi.length();Wr++){const Kr=gi.getSection(Wr),hr=gi.getSectionIndex(Wr),a=gi.getCharCode(Wr),u=ff(it,Pt,a);let m;if(Kr.imageName){if(Te.iconsInText=!0,Kr.scale=Kr.scale*Fi,m=bc(Kr,u,Ct,Qi,we),!m)continue;Vi=Math.max(Vi,m.imageOffset)}else if(m=pf(Kr,a,u,Qi,ye,ve),!m)continue;const{rect:w,metrics:E,baselineOffset:R}=m;Ni.push({glyph:a,imageName:Kr.imageName,x:kt,y:vt+R+-17,vertical:u,scale:Kr.scale,fontStack:Kr.fontStack,sectionIndex:hr,metrics:E,rect:w}),u?(Te.verticalizable=!0,kt+=(Kr.imageName?E.advance:kn)*Kr.scale+tt):kt+=E.advance*Kr.scale+tt}Ni.length!==0&&(Wt=Math.max(kt-tt,Wt),ya(Ni,0,Ni.length-1,li)),kt=0,Vt.lineOffset=Math.max(Vi,(Ct-1)*kn);const yi=We*Ct+Vi;vt+=yi,Kt=Math.max(yi,Kt),++Ki}const{horizontalAlign:Hi,verticalAlign:ji}=Ja(et);(function(gi,Ct,Vt,Ni,Vi,Qi,yi,Wr,Kr){const hr=(Ct-Vt)*Vi;let a=0;a=Qi!==yi?-Wr*Ni- -17:-Ni*Kr*yi+.5*yi;for(const u of gi)for(const m of u.positionedGlyphs)m.x+=hr,m.y+=a})(Te.positionedLines,li,Hi,ji,Wt,Kt,We,vt,Ye.length),Te.top+=-ji*vt,Te.bottom=Te.top+vt,Te.left+=-Hi*Wt,Te.right=Te.left+Wt}(ce,e,r,o,X,g,v,M,I,A,L,j),!function(Te){for(const ye of Te)if(ye.positionedGlyphs.length!==0)return!1;return!0}(le)&&ce}const Yh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xc={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},_n={40:!0};function $o(n,e,r,o,h,p){if(e.imageName){const g=o[e.imageName];return g?g.displaySize[0]*e.scale*kn/p+h:0}{const g=r[e.fontStack],v=g&&g[n];return v?v.metrics.advance*e.scale+h:0}}function vc(n,e,r,o){const h=Math.pow(n-e,2);return o?n<e?h/2:2*h:h+Math.abs(r)*r}function uf(n,e,r){let o=0;return n===10&&(o-=1e4),r&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function bs(n,e,r,o,h,p){let g=null,v=vc(e,r,h,p);for(const M of o){const A=vc(e-M.x,r,h,p)+M.badness;A<=v&&(g=M,v=A)}return{index:n,x:e,priorBreak:g,badness:v}}function uh(n){return n?uh(n.priorBreak).concat(n.index):[]}function kl(n,e,r,o,h,p){if(!n)return[];const g=[],v=function(I,L,B,j,q,X){let J=0;for(let ue=0;ue<I.length();ue++){const le=I.getSection(ue);J+=$o(I.getCharCode(ue),le,j,q,L,X)}return J/Math.max(1,Math.ceil(J/B))}(n,e,r,o,h,p),M=n.text.indexOf("")>=0;let A=0;for(let I=0;I<n.length();I++){const L=n.getSection(I),B=n.getCharCode(I);if(Yh[B]||(A+=$o(B,L,o,h,e,p)),I<n.length()-1){const j=!((z=B)<11904)&&(!!Yc(z)||!!Xc(z)||!!ua(z)||!!Hc(z)||!!qn(z)||!!Ea(z)||!!_l(z)||!!Ys(z)||Qc.test(String.fromCodePoint(z)));(xc[B]||j||L.imageName||I!==n.length()-2&&_n[n.getCharCode(I+1)])&&g.push(bs(I+1,A,v,g,uf(B,n.getCharCode(I+1),j&&M),!1))}}var z;return uh(bs(n.length(),A,v,g,0,!0))}function Ja(n){let e=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function hf(n,e,r){const o=e.getMaxScale()*kn,{maxImageWidth:h,maxImageHeight:p}=e.getMaxImageSize(n),g=Math.max(o,p*r);return{verticalLineContentWidth:Math.max(o,h*r),horizontalLineContentHeight:g}}function df(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function ff(n,e,r){return!(n===Ci.horizontal||!e&&!Ws(r)||e&&(Yh[r]||(o=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function pf(n,e,r,o,h,p){const g=p[n.fontStack],v=function(A,z,I,L){if(A&&A.rect)return A;const B=z[I.fontStack],j=B&&B[L];return j?{rect:null,metrics:j.metrics}:null}(g&&g[e],h,n,e);if(v===null)return null;let M;if(r)M=o.verticalLineContentWidth-n.scale*kn;else{const A=df(n.verticalAlign);M=(o.horizontalLineContentHeight-n.scale*kn)*A}return{rect:v.rect,metrics:v.metrics,baselineOffset:M}}function bc(n,e,r,o,h){const p=h[n.imageName];if(!p)return null;const g=p.paddedRect,v=p.displaySize,M={width:v[0],height:v[1],left:1,top:-3,advance:e?v[1]:v[0]};let A;if(e)A=o.verticalLineContentWidth-v[1]*n.scale;else{const z=df(n.verticalAlign);A=(o.horizontalLineContentHeight-v[1]*n.scale)*z}return{rect:g,metrics:M,baselineOffset:A,imageOffset:(e?v[0]:v[1])*n.scale-kn*r}}function ya(n,e,r,o){if(o===0)return;const h=n[r],p=(n[r].x+h.metrics.advance*h.scale)*o;for(let g=e;g<=r;g++)n[g].x-=p}function du(n,e,r){const{horizontalAlign:o,verticalAlign:h}=Ja(r),p=e[0]-n.displaySize[0]*o,g=e[1]-n.displaySize[1]*h;return{image:n,top:g,bottom:g+n.displaySize[1],left:p,right:p+n.displaySize[0]}}function Ho(n){var e,r;let o=n.left,h=n.top,p=n.right-o,g=n.bottom-h;const v=(e=n.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",M=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",A=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(M==="proportional"){if(v==="stretchOnly"&&p/g<A||v==="proportional"){const z=Math.ceil(g*A);o*=z/p,p=z}}else if(v==="proportional"&&M==="stretchOnly"&&A!==0&&p/g>A){const z=Math.ceil(p/A);h*=z/g,g=z}return{x1:o,y1:h,x2:o+p,y2:h+g}}function Yr(n,e,r,o,h,p){const g=n.image;let v;if(g.content){const X=g.content,J=g.pixelRatio||1;v=[X[0]/J,X[1]/J,g.displaySize[0]-X[2]/J,g.displaySize[1]-X[3]/J]}const M=e.left*p,A=e.right*p;let z,I,L,B;r==="width"||r==="both"?(B=h[0]+M-o[3],I=h[0]+A+o[1]):(B=h[0]+(M+A-g.displaySize[0])/2,I=B+g.displaySize[0]);const j=e.top*p,q=e.bottom*p;return r==="height"||r==="both"?(z=h[1]+j-o[0],L=h[1]+q+o[2]):(z=h[1]+(j+q-g.displaySize[1])/2,L=z+g.displaySize[1]),{image:g,top:z,right:I,bottom:L,left:B,collisionPadding:v}}const Rl=128,Xo=32640;function mf(n,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new vi(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:h}=r;let p=0;for(;p<o.length&&o[p]<=n;)p++;p=Math.max(0,p-1);let g=p;for(;g<o.length&&o[g]<n+1;)g++;g=Math.min(o.length-1,g);const v=o[p],M=o[g];return r.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:M,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:M,minSize:r.evaluate(new vi(v)),maxSize:r.evaluate(new vi(M)),interpolationType:h}}}function fu(n,e,r){let o="never";const h=n.get(e);return h?o=h:n.get(r)&&(o="always"),o}const pu=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function _a(n,e,r,o,h,p,g,v,M,A,z,I,L){const B=v?Math.min(Xo,Math.round(v[0])):0,j=v?Math.min(Xo,Math.round(v[1])):0;n.emplaceBack(e,r,Math.round(32*o),Math.round(32*h),p,g,(B<<1)+(M?1:0),j,16*A,16*z,256*I,256*L)}function Xf(n,e,r){n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r)}function Bs(n){for(const e of n.sections)if(_d(e.text))return!0;return!1}class gf{constructor(e){this.layoutVertexArray=new Oo,this.indexArray=new ao,this.programConfigurations=e,this.segments=new t,this.dynamicLayoutVertexArray=new Fo,this.opacityVertexArray=new dc,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ht}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,o,h){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qa.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,$f.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,pu,!0),this.opacityVertexBuffer.itemSize=1),(o||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Mt("SymbolBuffers",gf);class yf{constructor(e,r,o){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new o,this.segments=new t,this.collisionVertexArray=new Rs}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,gc.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Mt("CollisionBuffers",yf);class Wh{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=mf(this.zoom,r["text-size"]),this.iconSizeData=mf(this.zoom,r["icon-size"]);const o=this.layers[0].layout,h=o.get("symbol-sort-key"),p=o.get("symbol-z-order");this.canOverlap=fu(o,"text-overlap","text-allow-overlap")!=="never"||fu(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(g=>Ci[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID}createArrays(){this.text=new gf(new Fe(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new gf(new Fe(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ro,this.lineVertexArray=new ea,this.symbolInstances=new Ya,this.textAnchorOffsets=new pa}calculateGlyphDependencies(e,r,o,h,p){for(let g=0;g<e.length;g++)if(r[e.charCodeAt(g)]=!0,(o||h)&&p){const v=sh[e.charAt(g)];v&&(r[v.charCodeAt(0)]=!0)}}populate(e,r,o){const h=this.layers[0],p=h.layout,g=p.get("text-font"),v=p.get("text-field"),M=p.get("icon-image"),A=(v.value.kind!=="constant"||v.value.value instanceof Ii&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),z=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,I=p.get("symbol-sort-key");if(this.features=[],!A&&!z)return;const L=r.iconDependencies,B=r.glyphDependencies,j=r.availableImages,q=new vi(this.zoom,{globalState:this.globalState});for(const{feature:X,id:J,index:ue,sourceLayerIndex:le}of e){const ce=h._featureFilter.needGeometry,Te=oi(X,ce);if(!h._featureFilter.filter(q,Te,o))continue;let ye,ve;if(ce||(Te.geometry=Bt(X)),A){const Ye=h.getValueAndResolveTokens("text-field",Te,o,j),We=Ii.factory(Ye),et=this.hasRTLText=this.hasRTLText||Bs(We);(!et||Ks.getRTLTextPluginStatus()==="unavailable"||et&&Ks.isParsed())&&(ye=uu(We,h,Te))}if(z){const Ye=h.getValueAndResolveTokens("icon-image",Te,o,j);ve=Ye instanceof pt?Ye:pt.fromString(Ye)}if(!ye&&!ve)continue;const we=this.sortFeaturesByKey?I.evaluate(Te,{},o):void 0;if(this.features.push({id:J,text:ye,icon:ve,index:ue,sourceLayerIndex:le,geometry:Te.geometry,properties:X.properties,type:eh.types[X.type],sortKey:we}),ve&&(L[ve.name]=!0),ye){const Ye=g.evaluate(Te,{},o).join(","),We=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ci.vertical)>=0;for(const et of ye.sections)if(et.image)L[et.image.name]=!0;else{const Ue=Bn(ye.toString()),it=et.fontStack||Ye,tt=B[it]=B[it]||{};this.calculateGlyphDependencies(et.text,tt,We,this.allowVerticalPlacement,Ue)}}}p.get("symbol-placement")==="line"&&(this.features=function(X){const J={},ue={},le=[];let ce=0;function Te(Ye){le.push(X[Ye]),ce++}function ye(Ye,We,et){const Ue=ue[Ye];return delete ue[Ye],ue[We]=Ue,le[Ue].geometry[0].pop(),le[Ue].geometry[0]=le[Ue].geometry[0].concat(et[0]),Ue}function ve(Ye,We,et){const Ue=J[We];return delete J[We],J[Ye]=Ue,le[Ue].geometry[0].shift(),le[Ue].geometry[0]=et[0].concat(le[Ue].geometry[0]),Ue}function we(Ye,We,et){const Ue=et?We[0][We[0].length-1]:We[0][0];return`${Ye}:${Ue.x}:${Ue.y}`}for(let Ye=0;Ye<X.length;Ye++){const We=X[Ye],et=We.geometry,Ue=We.text?We.text.toString():null;if(!Ue){Te(Ye);continue}const it=we(Ue,et),tt=we(Ue,et,!0);if(it in ue&&tt in J&&ue[it]!==J[tt]){const Pt=ve(it,tt,et),jt=ye(it,tt,le[Pt].geometry);delete J[it],delete ue[tt],ue[we(Ue,le[jt].geometry,!0)]=jt,le[Pt].geometry=null}else it in ue?ye(it,tt,et):tt in J?ve(it,tt,et):(Te(Ye),J[it]=ce-1,ue[tt]=ce-1)}return le.filter(Ye=>Ye.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,J)=>X.sortKey-J.sortKey)}update(e,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:o,globalState:this.globalState}),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:o,globalState:this.globalState}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const o=this.lineVertexArray.length;if(e.segment!==void 0){let h=e.dist(r[e.segment+1]),p=e.dist(r[e.segment]);const g={};for(let v=e.segment+1;v<r.length;v++)g[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:h},v<r.length-1&&(h+=r[v+1].dist(r[v]));for(let v=e.segment||0;v>=0;v--)g[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:p},v>0&&(p+=r[v-1].dist(r[v]));for(let v=0;v<r.length;v++){const M=g[v];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,r,o,h,p,g,v,M,A,z,I,L){const B=e.indexArray,j=e.layoutVertexArray,q=e.segments.prepareSegment(4*r.length,j,B,this.canOverlap?g.sortKey:void 0),X=this.glyphOffsetArray.length,J=q.vertexLength,ue=this.allowVerticalPlacement&&v===Ci.vertical?Math.PI/2:0,le=g.text&&g.text.sections;for(let ce=0;ce<r.length;ce++){const{tl:Te,tr:ye,bl:ve,br:we,tex:Ye,pixelOffsetTL:We,pixelOffsetBR:et,minFontScaleX:Ue,minFontScaleY:it,glyphOffset:tt,isSDF:Pt,sectionIndex:jt}=r[ce],kt=q.vertexLength,vt=tt[1];_a(j,M.x,M.y,Te.x,vt+Te.y,Ye.x,Ye.y,o,Pt,We.x,We.y,Ue,it),_a(j,M.x,M.y,ye.x,vt+ye.y,Ye.x+Ye.w,Ye.y,o,Pt,et.x,We.y,Ue,it),_a(j,M.x,M.y,ve.x,vt+ve.y,Ye.x,Ye.y+Ye.h,o,Pt,We.x,et.y,Ue,it),_a(j,M.x,M.y,we.x,vt+we.y,Ye.x+Ye.w,Ye.y+Ye.h,o,Pt,et.x,et.y,Ue,it),Xf(e.dynamicLayoutVertexArray,M,ue),B.emplaceBack(kt,kt+2,kt+1),B.emplaceBack(kt+1,kt+2,kt+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tt[0]),ce!==r.length-1&&jt===r[ce+1].sectionIndex||e.programConfigurations.populatePaintArrays(j.length,g,g.index,{imagePositions:{},canonical:L,formattedSection:le&&le[jt],globalState:this.globalState})}e.placedSymbolArray.emplaceBack(M.x,M.y,X,this.glyphOffsetArray.length-X,J,A,z,M.segment,o?o[0]:0,o?o[1]:0,h[0],h[1],v,0,!1,0,I)}_addCollisionDebugVertex(e,r,o,h,p,g){return r.emplaceBack(0,0),e.emplaceBack(o.x,o.y,h,p,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,r,o,h,p,g,v){const M=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),A=M.vertexLength,z=p.layoutVertexArray,I=p.collisionVertexArray,L=v.anchorX,B=v.anchorY;this._addCollisionDebugVertex(z,I,g,L,B,new G(e,r)),this._addCollisionDebugVertex(z,I,g,L,B,new G(o,r)),this._addCollisionDebugVertex(z,I,g,L,B,new G(o,h)),this._addCollisionDebugVertex(z,I,g,L,B,new G(e,h)),M.vertexLength+=4;const j=p.indexArray;j.emplaceBack(A,A+1),j.emplaceBack(A+1,A+2),j.emplaceBack(A+2,A+3),j.emplaceBack(A+3,A),M.primitiveLength+=4}addDebugCollisionBoxes(e,r,o,h){for(let p=e;p<r;p++){const g=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,h?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new yf(no,cu.members,Al),this.iconCollisionBox=new yf(no,cu.members,Al);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,o,h,p,g,v,M,A){const z={};for(let I=r;I<o;I++){const L=e.get(I);z.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},z.textFeatureIndex=L.featureIndex;break}for(let I=h;I<p;I++){const L=e.get(I);z.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},z.verticalTextFeatureIndex=L.featureIndex;break}for(let I=g;I<v;I++){const L=e.get(I);z.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},z.iconFeatureIndex=L.featureIndex;break}for(let I=M;I<A;I++){const L=e.get(I);z.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},z.verticalIconFeatureIndex=L.featureIndex;break}return z}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const o=e.placedSymbolArray.get(r),h=o.vertexStartIndex+4*o.numGlyphs;for(let p=o.vertexStartIndex;p<h;p+=4)e.indexArray.emplaceBack(p,p+2,p+1),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),o=Math.cos(e),h=[],p=[],g=[];for(let v=0;v<this.symbolInstances.length;++v){g.push(v);const M=this.symbolInstances.get(v);h.push(0|Math.round(r*M.anchorX+o*M.anchorY)),p.push(M.featureIndex)}return g.sort((v,M)=>h[v]-h[M]||p[M]-p[v]),g}addToSortKeyRanges(e,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((h,p,g)=>{h>=0&&g.indexOf(h)===p&&this.addIndicesForPlacedSymbol(this.text,h)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let wc,zd;Mt("SymbolBucket",Wh,{omit:["layers","collisionBoxArray","features","compareText"]}),Wh.MAX_GLYPHS=65535,Wh.addDynamicAttributes=Xf;var Pd={get paint(){return zd=zd||new Pn({"icon-opacity":new Qt($e.paint_symbol["icon-opacity"]),"icon-color":new Qt($e.paint_symbol["icon-color"]),"icon-halo-color":new Qt($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new Qt($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Qt($e.paint_symbol["icon-halo-blur"]),"icon-translate":new Ft($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ft($e.paint_symbol["icon-translate-anchor"]),"text-opacity":new Qt($e.paint_symbol["text-opacity"]),"text-color":new Qt($e.paint_symbol["text-color"],{runtimeType:rt,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Qt($e.paint_symbol["text-halo-color"]),"text-halo-width":new Qt($e.paint_symbol["text-halo-width"]),"text-halo-blur":new Qt($e.paint_symbol["text-halo-blur"]),"text-translate":new Ft($e.paint_symbol["text-translate"]),"text-translate-anchor":new Ft($e.paint_symbol["text-translate-anchor"])})},get layout(){return wc=wc||new Pn({"symbol-placement":new Ft($e.layout_symbol["symbol-placement"]),"symbol-spacing":new Ft($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ft($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Qt($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ft($e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ft($e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ft($e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ft($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ft($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ft($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new Qt($e.layout_symbol["icon-size"]),"icon-text-fit":new Ft($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ft($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new Qt($e.layout_symbol["icon-image"]),"icon-rotate":new Qt($e.layout_symbol["icon-rotate"]),"icon-padding":new Qt($e.layout_symbol["icon-padding"]),"icon-keep-upright":new Ft($e.layout_symbol["icon-keep-upright"]),"icon-offset":new Qt($e.layout_symbol["icon-offset"]),"icon-anchor":new Qt($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ft($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ft($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ft($e.layout_symbol["text-rotation-alignment"]),"text-field":new Qt($e.layout_symbol["text-field"]),"text-font":new Qt($e.layout_symbol["text-font"]),"text-size":new Qt($e.layout_symbol["text-size"]),"text-max-width":new Qt($e.layout_symbol["text-max-width"]),"text-line-height":new Ft($e.layout_symbol["text-line-height"]),"text-letter-spacing":new Qt($e.layout_symbol["text-letter-spacing"]),"text-justify":new Qt($e.layout_symbol["text-justify"]),"text-radial-offset":new Qt($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ft($e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Qt($e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Qt($e.layout_symbol["text-anchor"]),"text-max-angle":new Ft($e.layout_symbol["text-max-angle"]),"text-writing-mode":new Ft($e.layout_symbol["text-writing-mode"]),"text-rotate":new Qt($e.layout_symbol["text-rotate"]),"text-padding":new Ft($e.layout_symbol["text-padding"]),"text-keep-upright":new Ft($e.layout_symbol["text-keep-upright"]),"text-transform":new Qt($e.layout_symbol["text-transform"]),"text-offset":new Qt($e.layout_symbol["text-offset"]),"text-allow-overlap":new Ft($e.layout_symbol["text-allow-overlap"]),"text-overlap":new Ft($e.layout_symbol["text-overlap"]),"text-ignore-placement":new Ft($e.layout_symbol["text-ignore-placement"]),"text-optional":new Ft($e.layout_symbol["text-optional"])})}};class hh{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:bt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Mt("FormatSectionOverride",hh,{omit:["defaultValue"]});class Id extends cn{constructor(e){super(e,Pd)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const h=[];for(const p of o)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,o,h){const p=this.layout.get(e).evaluate(r,{},o,h),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Es(g.value)||!p?p:function(v,M){return M.replace(/{([^{}]+)}/g,(A,z)=>v&&z in v?String(v[z]):"")}(r.properties,p)}createBucket(e){return new Wh(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Pd.paint.overridableProperties){if(!Id.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),o=new hh(r),h=new Lu(o,r.property.specification);let p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new sl("source",h):new ol("composite",h,r.value.zoomStops),this.paint._values[e]=new ha(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&Id.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const o=e.get("text-field"),h=Pd.paint.properties[r];let p=!1;const g=v=>{for(const M of v)if(h.overrides&&h.overrides.hasOverride(M))return void(p=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Ii)g(o.value.value.sections);else if(o.value.kind==="source"){const v=A=>{p||(A instanceof ai&&dr(A.value)===Zt?g(A.value.sections):A instanceof Sa?g(A.sections):A.eachChild(v))},M=o.value;M._styleExpression&&v(M._styleExpression.expression)}return p}}let Yf;var Ap={get paint(){return Yf=Yf||new Pn({"background-color":new Ft($e.paint_background["background-color"]),"background-pattern":new Gu($e.paint_background["background-pattern"]),"background-opacity":new Ft($e.paint_background["background-opacity"])})}};class _f extends cn{constructor(e){super(e,Ap)}}let Kh;var xf,mu={get paint(){return Kh=Kh||new Pn({"raster-opacity":new Ft($e.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ft($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ft($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ft($e.paint_raster["raster-brightness-max"]),"raster-saturation":new Ft($e.paint_raster["raster-saturation"]),"raster-contrast":new Ft($e.paint_raster["raster-contrast"]),"raster-resampling":new Ft($e.paint_raster["raster-resampling"]),"raster-fade-duration":new Ft($e.paint_raster["raster-fade-duration"])})}};class kd extends cn{constructor(e){super(e,mu)}}class dh extends cn{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}function Rd(n){if(n.type==="custom")return new dh(n);switch(n.type){case"background":return new _f(n);case"circle":return new ra(n);case"color-relief":return new Of(n);case"fill":return new Qu(n);case"fill-extrusion":return new dn(n);case"heatmap":return new Wa(n);case"hillshade":return new Dh(n);case"line":return new oo(n);case"raster":return new kd(n);case"symbol":return new Id(n)}}class Sc{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(e,r){for(const h of e){this._layerConfigs[h.id]=h;const p=this._layers[h.id]=Rd(h);p._featureFilter=ec(p.filter),this.keyCache[h.id]&&delete this.keyCache[h.id]}for(const h of r)delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h];this.familiesBySource={};const o=function(h,p){const g={};for(let M=0;M<h.length;M++){const A=p&&p[h[M].id]||ul(h[M]);p&&(p[h[M].id]=A);let z=g[A];z||(z=g[A]=[]),z.push(h[M])}const v=[];for(const M in g)v.push(g[M]);return v}(Object.values(this._layerConfigs),this.keyCache);for(const h of o){const p=h.map(I=>this._layers[I.id]),g=p[0];if(g.visibility==="none")continue;const v=g.source||"";let M=this.familiesBySource[v];M||(M=this.familiesBySource[v]={});const A=g.sourceLayer||"_geojsonTileLayer";let z=M[A];z||(z=M[A]=[]),z.push(p)}}}class Dd{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const o=e[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Cp{constructor(e,r,o,h,p){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=o,e._y=h,this.properties=e.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class gu{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const r=new gu;return r.extend(e(new G(this.minX,this.minY))),r.extend(e(new G(this.maxX,this.minY))),r.extend(e(new G(this.minX,this.maxY))),r.extend(e(new G(this.maxX,this.maxY))),r}static fromPoints(e){const r=new gu;for(const o of e)r.extend(o);return r}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class vf{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Pi(Le,16,0),this.grid3D=new Pi(Le,16,0),this.featureIndexArray=new hc,this.promoteId=r}insert(e,r,o,h,p,g){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,h,p);const M=g?this.grid3D:this.grid;for(let A=0;A<r.length;A++){const z=r[A],I=[1/0,1/0,-1/0,-1/0];for(let L=0;L<z.length;L++){const B=z[L];I[0]=Math.min(I[0],B.x),I[1]=Math.min(I[1],B.y),I[2]=Math.max(I[2],B.x),I[3]=Math.max(I[3],B.y)}I[0]<Le&&I[1]<Le&&I[2]>=0&&I[3]>=0&&M.insert(v,I[0],I[1],I[2],I[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new qh(new yc(this.rawTileData)).layers,this.sourceLayerCoder=new Dd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,o,h){this.loadVTLayers();const p=e.params,g=Le/e.tileSize/e.scale,v=ec(p.filter),M=e.queryGeometry,A=e.queryPadding*g,z=gu.fromPoints(M),I=this.grid.query(z.minX-A,z.minY-A,z.maxX+A,z.maxY+A),L=gu.fromPoints(e.cameraQueryGeometry).expandBy(A),B=this.grid3D.query(L.minX,L.minY,L.maxX,L.maxY,(X,J,ue,le)=>function(ce,Te,ye,ve,we){for(const We of ce)if(Te<=We.x&&ye<=We.y&&ve>=We.x&&we>=We.y)return!0;const Ye=[new G(Te,ye),new G(Te,we),new G(ve,we),new G(ve,ye)];if(ce.length>2){for(const We of Ye)if(Pa(ce,We))return!0}for(let We=0;We<ce.length-1;We++)if(ms(ce[We],ce[We+1],Ye))return!0;return!1}(e.cameraQueryGeometry,X-A,J-A,ue+A,le+A));for(const X of B)I.push(X);I.sort(Kf);const j={};let q;for(let X=0;X<I.length;X++){const J=I[X];if(J===q)continue;q=J;const ue=this.featureIndexArray.get(J);let le=null;this.loadMatchingFeature(j,ue.bucketIndex,ue.sourceLayerIndex,ue.featureIndex,v,p.layers,p.availableImages,r,o,h,(ce,Te,ye)=>(le||(le=Bt(ce)),Te.queryIntersectsFeature({queryGeometry:M,feature:ce,featureState:ye,geometry:le,zoom:this.z,transform:e.transform,pixelsToTileUnits:g,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation})))}return j}loadMatchingFeature(e,r,o,h,p,g,v,M,A,z,I){const L=this.bucketLayerIDs[r];if(g&&!L.some(X=>g.has(X)))return;const B=this.sourceLayerCoder.decode(o),j=this.vtLayers[B].feature(h);if(p.needGeometry){const X=oi(j,!0);if(!p.filter(new vi(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!p.filter(new vi(this.tileID.overscaledZ),j))return;const q=this.getId(j,B);for(let X=0;X<L.length;X++){const J=L[X];if(g&&!g.has(J))continue;const ue=M[J];if(!ue)continue;let le={};q&&z&&(le=z.getState(ue.sourceLayer||"_geojsonTileLayer",q));const ce=wt({},A[J]);ce.paint=Wf(ce.paint,ue.paint,j,le,v),ce.layout=Wf(ce.layout,ue.layout,j,le,v);const Te=!I||I(j,ue,le);if(!Te)continue;const ye=new Cp(j,this.z,this.x,this.y,q);ye.layer=ce;let ve=e[J];ve===void 0&&(ve=e[J]=[]),ve.push({featureIndex:h,feature:ye,intersectionZ:Te})}}lookupSymbolFeatures(e,r,o,h,p,g,v,M){const A={};this.loadVTLayers();const z=ec(p);for(const I of e)this.loadMatchingFeature(A,o,h,I,z,g,v,M,r);return A}hasLayer(e){for(const r of this.bucketLayerIDs)for(const o of r)if(e===o)return!0;return!1}getId(e,r){var o;let h=e.id;return this.promoteId&&(h=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof h=="boolean"&&(h=Number(h)),h===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(h=Number(e.properties.cluster_id))),h}}function Wf(n,e,r,o,h){return Ut(n,(p,g)=>{const v=e instanceof da?e.get(g):null;return v&&v.evaluate?v.evaluate(r,o,h):v})}function Kf(n,e){return e-n}Mt("FeatureIndex",vf,{omit:["rawTileData","sourceLayerCoder"]});class Dl extends G{constructor(e,r,o,h){super(e,r),this.angle=o,h!==void 0&&(this.segment=h)}clone(){return new Dl(this.x,this.y,this.angle,this.segment)}}function fh(n,e,r,o,h){if(e.segment===void 0||r===0)return!0;let p=e,g=e.segment+1,v=0;for(;v>-r/2;){if(g--,g<0)return!1;v-=n[g].dist(p),p=n[g]}v+=n[g].dist(n[g+1]),g++;const M=[];let A=0;for(;v<r/2;){const z=n[g],I=n[g+1];if(!I)return!1;let L=n[g-1].angleTo(z)-z.angleTo(I);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:v,angleDelta:L}),A+=L;v-M[0].distance>o;)A-=M.shift().angleDelta;if(A>h)return!1;g++,v+=z.dist(I)}return!0}function Ld(n){let e=0;for(let r=0;r<n.length-1;r++)e+=n[r].dist(n[r+1]);return e}function Qf(n,e,r){return n?.6*e*r:0}function Ir(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function Jf(n,e,r,o,h,p){const g=Qf(r,h,p),v=Ir(r,o)*p;let M=0;const A=Ld(n)/2;for(let z=0;z<n.length-1;z++){const I=n[z],L=n[z+1],B=I.dist(L);if(M+B>A){const j=(A-M)/B,q=Gl.number(I.x,L.x,j),X=Gl.number(I.y,L.y,j),J=new Dl(q,X,L.angleTo(I),z);return J._round(),!g||fh(n,J,v,g,e)?J:void 0}M+=B}}function Zp(n,e,r,o,h,p,g,v,M){const A=Qf(o,p,g),z=Ir(o,h),I=z*g,L=n[0].x===0||n[0].x===M||n[0].y===0||n[0].y===M;return e-I<e/4&&(e=I+e/4),ep(n,L?e/2*v%e:(z/2+2*p)*g*v%e,e,A,r,I,L,!1,M)}function ep(n,e,r,o,h,p,g,v,M){const A=p/2,z=Ld(n);let I=0,L=e-r,B=[];for(let j=0;j<n.length-1;j++){const q=n[j],X=n[j+1],J=q.dist(X),ue=X.angleTo(q);for(;L+r<I+J;){L+=r;const le=(L-I)/J,ce=Gl.number(q.x,X.x,le),Te=Gl.number(q.y,X.y,le);if(ce>=0&&ce<M&&Te>=0&&Te<M&&L-A>=0&&L+A<=z){const ye=new Dl(ce,Te,ue,j);ye._round(),o&&!fh(n,ye,p,o,h)||B.push(ye)}}I+=J}return v||B.length||g||(B=ep(n,I/2,r,o,h,p,g,!0,M)),B}function Ep(n,e,r,o){const h=[],p=n.image,g=p.pixelRatio,v=p.paddedRect.w-2,M=p.paddedRect.h-2;let A={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const z=p.stretchX||[[0,v]],I=p.stretchY||[[0,M]],L=(tt,Pt)=>tt+Pt[1]-Pt[0],B=z.reduce(L,0),j=I.reduce(L,0),q=v-B,X=M-j;let J=0,ue=B,le=0,ce=j,Te=0,ye=q,ve=0,we=X;if(p.content&&o){const tt=p.content,Pt=tt[2]-tt[0],jt=tt[3]-tt[1];(p.textFitWidth||p.textFitHeight)&&(A=Ho(n)),J=bf(z,0,tt[0]),le=bf(I,0,tt[1]),ue=bf(z,tt[0],tt[2]),ce=bf(I,tt[1],tt[3]),Te=tt[0]-J,ve=tt[1]-le,ye=Pt-ue,we=jt-ce}const Ye=A.x1,We=A.y1,et=A.x2-Ye,Ue=A.y2-We,it=(tt,Pt,jt,kt)=>{const vt=yu(tt.stretch-J,ue,et,Ye),Wt=xa(tt.fixed-Te,ye,tt.stretch,B),Kt=yu(Pt.stretch-le,ce,Ue,We),li=xa(Pt.fixed-ve,we,Pt.stretch,j),Fi=yu(jt.stretch-J,ue,et,Ye),Ki=xa(jt.fixed-Te,ye,jt.stretch,B),Hi=yu(kt.stretch-le,ce,Ue,We),ji=xa(kt.fixed-ve,we,kt.stretch,j),gi=new G(vt,Kt),Ct=new G(Fi,Kt),Vt=new G(Fi,Hi),Ni=new G(vt,Hi),Vi=new G(Wt/g,li/g),Qi=new G(Ki/g,ji/g),yi=e*Math.PI/180;if(yi){const hr=Math.sin(yi),a=Math.cos(yi),u=[a,-hr,hr,a];gi._matMult(u),Ct._matMult(u),Ni._matMult(u),Vt._matMult(u)}const Wr=tt.stretch+tt.fixed,Kr=Pt.stretch+Pt.fixed;return{tl:gi,tr:Ct,bl:Ni,br:Vt,tex:{x:p.paddedRect.x+1+Wr,y:p.paddedRect.y+1+Kr,w:jt.stretch+jt.fixed-Wr,h:kt.stretch+kt.fixed-Kr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vi,pixelOffsetBR:Qi,minFontScaleX:ye/g/et,minFontScaleY:we/g/Ue,isSDF:r}};if(o&&(p.stretchX||p.stretchY)){const tt=tp(z,q,B),Pt=tp(I,X,j);for(let jt=0;jt<tt.length-1;jt++){const kt=tt[jt],vt=tt[jt+1];for(let Wt=0;Wt<Pt.length-1;Wt++)h.push(it(kt,Pt[Wt],vt,Pt[Wt+1]))}}else h.push(it({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:M+1}));return h}function bf(n,e,r){let o=0;for(const h of n)o+=Math.max(e,Math.min(r,h[1]))-Math.max(e,Math.min(r,h[0]));return o}function tp(n,e,r){const o=[{fixed:-1,stretch:0}];for(const[h,p]of n){const g=o[o.length-1];o.push({fixed:h-g.stretch,stretch:g.stretch}),o.push({fixed:h-g.stretch,stretch:g.stretch+(p-h)})}return o.push({fixed:e+1,stretch:r}),o}function yu(n,e,r,o){return n/e*r+o}function xa(n,e,r,o){return n-e*r/o}Mt("Anchor",Dl);class Os{constructor(e,r,o,h,p,g,v,M,A,z){var I;if(this.boxStartIndex=e.length,A){let L=g.top,B=g.bottom;const j=g.collisionPadding;j&&(L-=j[1],B+=j[3]);let q=B-L;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{const L=!((I=g.image)===null||I===void 0)&&I.content&&(g.image.textFitWidth||g.image.textFitHeight)?Ho(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};L.y1=L.y1*v-M[0],L.y2=L.y2*v+M[2],L.x1=L.x1*v-M[3],L.x2=L.x2*v+M[1];const B=g.collisionPadding;if(B&&(L.x1-=B[0]*v,L.y1-=B[1]*v,L.x2+=B[2]*v,L.y2+=B[3]*v),z){const j=new G(L.x1,L.y1),q=new G(L.x2,L.y1),X=new G(L.x1,L.y2),J=new G(L.x2,L.y2),ue=z*Math.PI/180;j._rotate(ue),q._rotate(ue),X._rotate(ue),J._rotate(ue),L.x1=Math.min(j.x,q.x,X.x,J.x),L.x2=Math.max(j.x,q.x,X.x,J.x),L.y1=Math.min(j.y,q.y,X.y,J.y),L.y2=Math.max(j.y,q.y,X.y,J.y)}e.emplaceBack(r.x,r.y,L.x1,L.y1,L.x2,L.y2,o,h,p)}this.boxEndIndex=e.length}}class Bd{constructor(e=[],r=(o,h)=>o<h?-1:o>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:o}=this,h=r[e];for(;e>0;){const p=e-1>>1,g=r[p];if(o(h,g)>=0)break;r[e]=g,e=p}r[e]=h}_down(e){const{data:r,compare:o}=this,h=this.length>>1,p=r[e];for(;e<h;){let g=1+(e<<1);const v=g+1;if(v<this.length&&o(r[v],r[g])<0&&(g=v),o(r[g],p)>=0)break;r[e]=r[g],e=g}r[e]=p}}function Od(n,e=1,r=!1){const o=gu.fromPoints(n[0]),h=Math.min(o.width(),o.height());let p=h/2;const g=new Bd([],ph),{minX:v,minY:M,maxX:A,maxY:z}=o;if(h===0)return new G(v,M);for(let B=v;B<A;B+=h)for(let j=M;j<z;j+=h)g.push(new sa(B+p,j+p,p,n));let I=function(B){let j=0,q=0,X=0;const J=B[0];for(let ue=0,le=J.length,ce=le-1;ue<le;ce=ue++){const Te=J[ue],ye=J[ce],ve=Te.x*ye.y-ye.x*Te.y;q+=(Te.x+ye.x)*ve,X+=(Te.y+ye.y)*ve,j+=3*ve}return new sa(q/j,X/j,0,B)}(n),L=g.length;for(;g.length;){const B=g.pop();(B.d>I.d||!I.d)&&(I=B,r&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,L)),B.max-I.d<=e||(p=B.h/2,g.push(new sa(B.p.x-p,B.p.y-p,p,n)),g.push(new sa(B.p.x+p,B.p.y-p,p,n)),g.push(new sa(B.p.x-p,B.p.y+p,p,n)),g.push(new sa(B.p.x+p,B.p.y+p,p,n)),L+=4)}return r&&(console.log(`num probes: ${L}`),console.log(`best distance: ${I.d}`)),I.p}function ph(n,e){return e.max-n.max}function sa(n,e,r,o){this.p=new G(n,e),this.h=r,this.d=function(h,p){let g=!1,v=1/0;for(let M=0;M<p.length;M++){const A=p[M];for(let z=0,I=A.length,L=I-1;z<I;L=z++){const B=A[z],j=A[L];B.y>h.y!=j.y>h.y&&h.x<(j.x-B.x)*(h.y-B.y)/(j.y-B.y)+B.x&&(g=!g),v=Math.min(v,ia(h,B,j))}}return(g?1:-1)*Math.sqrt(v)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}(function(n){n[n.center=1]="center",n[n.left=2]="left",n[n.right=3]="right",n[n.top=4]="top",n[n.bottom=5]="bottom",n[n["top-left"]=6]="top-left",n[n["top-right"]=7]="top-right",n[n["bottom-left"]=8]="bottom-left",n[n["bottom-right"]=9]="bottom-right"})(xf||(xf={}));const Tc=Number.POSITIVE_INFINITY;function zp(n,e){return e[1]!==Tc?function(r,o,h){let p=0,g=0;switch(o=Math.abs(o),h=Math.abs(h),r){case"top-right":case"top-left":case"top":g=h-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-h}switch(r){case"top-right":case"bottom-right":case"right":p=-o;break;case"top-left":case"bottom-left":case"left":p=o}return[p,g]}(n,e[0],e[1]):function(r,o){let h=0,p=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(r){case"top-right":case"top-left":p=g-7;break;case"bottom-right":case"bottom-left":p=7-g;break;case"bottom":p=7-o;break;case"top":p=o-7}switch(r){case"top-right":case"bottom-right":h=-g;break;case"top-left":case"bottom-left":h=g;break;case"left":h=o;break;case"right":h=-o}return[h,p]}(n,e[0])}function Fd(n,e,r){var o;const h=n.layout,p=(o=h.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},r);if(p){const v=p.values,M=[];for(let A=0;A<v.length;A+=2){const z=M[A]=v[A],I=v[A+1].map(L=>L*kn);z.startsWith("top")?I[1]-=7:z.startsWith("bottom")&&(I[1]+=7),M[A+1]=I}return new Bi(M)}const g=h.get("text-variable-anchor");if(g){let v;v=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(e,{},r)*kn,Tc]:h.get("text-offset").evaluate(e,{},r).map(A=>A*kn);const M=[];for(const A of g)M.push(A,zp(A,v));return new Bi(M)}return null}function wf(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Le/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const e=n.bucket.layers[0],r=e.layout,o=e._unevaluatedLayout._values,h={layoutIconSize:o["icon-size"].possiblyEvaluate(new vi(n.bucket.zoom+1),n.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new vi(n.bucket.zoom+1),n.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new vi(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:z}=n.bucket.textSizeData;h.compositeTextSizes=[o["text-size"].possiblyEvaluate(new vi(A),n.canonical),o["text-size"].possiblyEvaluate(new vi(z),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:z}=n.bucket.iconSizeData;h.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new vi(A),n.canonical),o["icon-size"].possiblyEvaluate(new vi(z),n.canonical)]}const p=r.get("text-line-height")*kn,g=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",v=r.get("text-keep-upright"),M=r.get("text-size");for(const A of n.bucket.features){const z=r.get("text-font").evaluate(A,{},n.canonical).join(","),I=M.evaluate(A,{},n.canonical),L=h.layoutTextSize.evaluate(A,{},n.canonical),B=h.layoutIconSize.evaluate(A,{},n.canonical),j={horizontal:{},vertical:void 0},q=A.text;let X,J=[0,0];if(q){const ce=q.toString(),Te=r.get("text-letter-spacing").evaluate(A,{},n.canonical)*kn,ye=Ps(ce)?Te:0,ve=r.get("text-anchor").evaluate(A,{},n.canonical),we=Fd(e,A,n.canonical);if(!we){const Ue=r.get("text-radial-offset").evaluate(A,{},n.canonical);J=Ue?zp(ve,[Ue*kn,Tc]):r.get("text-offset").evaluate(A,{},n.canonical).map(it=>it*kn)}let Ye=g?"center":r.get("text-justify").evaluate(A,{},n.canonical);const We=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(A,{},n.canonical)*kn:1/0,et=()=>{n.bucket.allowVerticalPlacement&&Bn(ce)&&(j.vertical=_c(q,n.glyphMap,n.glyphPositions,n.imagePositions,z,We,p,ve,"left",ye,J,Ci.vertical,!0,L,I))};if(!g&&we){const Ue=new Set;if(Ye==="auto")for(let tt=0;tt<we.values.length;tt+=2)Ue.add(_u(we.values[tt]));else Ue.add(Ye);let it=!1;for(const tt of Ue)if(!j.horizontal[tt])if(it)j.horizontal[tt]=j.horizontal[0];else{const Pt=_c(q,n.glyphMap,n.glyphPositions,n.imagePositions,z,We,p,"center",tt,ye,J,Ci.horizontal,!1,L,I);Pt&&(j.horizontal[tt]=Pt,it=Pt.positionedLines.length===1)}et()}else{Ye==="auto"&&(Ye=_u(ve));const Ue=_c(q,n.glyphMap,n.glyphPositions,n.imagePositions,z,We,p,ve,Ye,ye,J,Ci.horizontal,!1,L,I);Ue&&(j.horizontal[Ye]=Ue),et(),Bn(ce)&&g&&v&&(j.vertical=_c(q,n.glyphMap,n.glyphPositions,n.imagePositions,z,We,p,ve,Ye,ye,J,Ci.vertical,!1,L,I))}}let ue=!1;if(A.icon&&A.icon.name){const ce=n.imageMap[A.icon.name];ce&&(X=du(n.imagePositions[A.icon.name],r.get("icon-offset").evaluate(A,{},n.canonical),r.get("icon-anchor").evaluate(A,{},n.canonical)),ue=!!ce.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=ue:n.bucket.sdfIcons!==ue&&Nt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ce.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const le=Qh(j.horizontal)||j.vertical;n.bucket.iconsInText=!!le&&le.iconsInText,(le||X)&&ip(n.bucket,A,j,X,n.imageMap,h,L,B,J,ue,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()}function _u(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ip(n,e,r,o,h,p,g,v,M,A,z,I){let L=p.textMaxSize.evaluate(e,{});L===void 0&&(L=g);const B=n.layers[0].layout,j=B.get("icon-offset").evaluate(e,{},z),q=Qh(r.horizontal),X=g/24,J=n.tilePixelRatio*X,ue=n.tilePixelRatio*L/24,le=n.tilePixelRatio*v,ce=n.tilePixelRatio*B.get("symbol-spacing"),Te=B.get("text-padding")*n.tilePixelRatio,ye=function(jt,kt,vt,Wt=1){const Kt=jt.get("icon-padding").evaluate(kt,{},vt),li=Kt&&Kt.values;return[li[0]*Wt,li[1]*Wt,li[2]*Wt,li[3]*Wt]}(B,e,z,n.tilePixelRatio),ve=B.get("text-max-angle")/180*Math.PI,we=B.get("text-rotation-alignment")!=="viewport"&&B.get("symbol-placement")!=="point",Ye=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",We=B.get("symbol-placement"),et=ce/2,Ue=B.get("icon-text-fit");let it;o&&Ue!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(it=Yr(o,r.vertical,Ue,B.get("icon-text-fit-padding"),j,X)),q&&(o=Yr(o,q,Ue,B.get("icon-text-fit-padding"),j,X)));const tt=z?I.line.getGranularityForZoomLevel(z.z):1,Pt=(jt,kt)=>{kt.x<0||kt.x>=Le||kt.y<0||kt.y>=Le||function(vt,Wt,Kt,li,Fi,Ki,Hi,ji,gi,Ct,Vt,Ni,Vi,Qi,yi,Wr,Kr,hr,a,u,m,w,E,R,Y){const te=vt.addToLineVertexArray(Wt,Kt);let be,Ge,nt,lt,Xe=0,Ke=0,_i=0,fi=0,Mr=-1,Oe=-1;const Ie={};let qe=U("");if(vt.allowVerticalPlacement&&li.vertical){const Fs=ji.layout.get("text-rotate").evaluate(m,{},R)+90;nt=new Os(gi,Wt,Ct,Vt,Ni,li.vertical,Vi,Qi,yi,Fs),Hi&&(lt=new Os(gi,Wt,Ct,Vt,Ni,Hi,Kr,hr,yi,Fs))}if(Fi){const Fs=ji.layout.get("icon-rotate").evaluate(m,{}),zc=ji.layout.get("icon-text-fit")!=="none",pp=Ep(Fi,Fs,E,zc),Th=Hi?Ep(Hi,Fs,E,zc):void 0;Ge=new Os(gi,Wt,Ct,Vt,Ni,Fi,Kr,hr,!1,Fs),Xe=4*pp.length;const mp=vt.iconSizeData;let ld=null;mp.kind==="source"?(ld=[Rl*ji.layout.get("icon-size").evaluate(m,{})],ld[0]>Xo&&Nt(`${vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):mp.kind==="composite"&&(ld=[Rl*w.compositeIconSizes[0].evaluate(m,{},R),Rl*w.compositeIconSizes[1].evaluate(m,{},R)],(ld[0]>Xo||ld[1]>Xo)&&Nt(`${vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),vt.addSymbols(vt.icon,pp,ld,u,a,m,Ci.none,Wt,te.lineStartIndex,te.lineLength,-1,R),Mr=vt.icon.placedSymbolArray.length-1,Th&&(Ke=4*Th.length,vt.addSymbols(vt.icon,Th,ld,u,a,m,Ci.vertical,Wt,te.lineStartIndex,te.lineLength,-1,R),Oe=vt.icon.placedSymbolArray.length-1)}const ct=Object.keys(li.horizontal);for(const Fs of ct){const zc=li.horizontal[Fs];if(!be){qe=U(zc.text);const Th=ji.layout.get("text-rotate").evaluate(m,{},R);be=new Os(gi,Wt,Ct,Vt,Ni,zc,Vi,Qi,yi,Th)}const pp=zc.positionedLines.length===1;if(_i+=rp(vt,Wt,zc,Ki,ji,yi,m,Wr,te,li.vertical?Ci.horizontal:Ci.horizontalOnly,pp?ct:[Fs],Ie,Mr,w,R),pp)break}li.vertical&&(fi+=rp(vt,Wt,li.vertical,Ki,ji,yi,m,Wr,te,Ci.vertical,["vertical"],Ie,Oe,w,R));const Xt=be?be.boxStartIndex:vt.collisionBoxArray.length,Zi=be?be.boxEndIndex:vt.collisionBoxArray.length,qt=nt?nt.boxStartIndex:vt.collisionBoxArray.length,ci=nt?nt.boxEndIndex:vt.collisionBoxArray.length,$n=Ge?Ge.boxStartIndex:vt.collisionBoxArray.length,vr=Ge?Ge.boxEndIndex:vt.collisionBoxArray.length,bu=lt?lt.boxStartIndex:vt.collisionBoxArray.length,$p=lt?lt.boxEndIndex:vt.collisionBoxArray.length;let an=-1;const ws=(Fs,zc)=>Fs&&Fs.circleDiameter?Math.max(Fs.circleDiameter,zc):zc;an=ws(be,an),an=ws(nt,an),an=ws(Ge,an),an=ws(lt,an);const od=an>-1?1:0;od&&(an*=Y/kn),vt.glyphOffsetArray.length>=Wh.MAX_GLYPHS&&Nt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),m.sortKey!==void 0&&vt.addToSortKeyRanges(vt.symbolInstances.length,m.sortKey);const Ec=Fd(ji,m,R),[Kd,wu]=function(Fs,zc){const pp=Fs.length,Th=zc==null?void 0:zc.values;if((Th==null?void 0:Th.length)>0)for(let mp=0;mp<Th.length;mp+=2){const ld=Th[mp+1];Fs.emplaceBack(xf[Th[mp]],ld[0],ld[1])}return[pp,Fs.length]}(vt.textAnchorOffsets,Ec);vt.symbolInstances.emplaceBack(Wt.x,Wt.y,Ie.right>=0?Ie.right:-1,Ie.center>=0?Ie.center:-1,Ie.left>=0?Ie.left:-1,Ie.vertical||-1,Mr,Oe,qe,Xt,Zi,qt,ci,$n,vr,bu,$p,Ct,_i,fi,Xe,Ke,od,0,Vi,an,Kd,wu)}(n,kt,jt,r,o,h,it,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,J,[Te,Te,Te,Te],we,M,le,ye,Ye,j,e,p,A,z,g)};if(We==="line")for(const jt of function(kt,vt,Wt,Kt,li){const Fi=[];for(let Ki=0;Ki<kt.length;Ki++){const Hi=kt[Ki];let ji;for(let gi=0;gi<Hi.length-1;gi++){let Ct=Hi[gi],Vt=Hi[gi+1];Ct.x<0&&Vt.x<0||(Ct.x<0?Ct=new G(0,Ct.y+(0-Ct.x)/(Vt.x-Ct.x)*(Vt.y-Ct.y))._round():Vt.x<0&&(Vt=new G(0,Ct.y+(0-Ct.x)/(Vt.x-Ct.x)*(Vt.y-Ct.y))._round()),Ct.y<0&&Vt.y<0||(Ct.y<0?Ct=new G(Ct.x+(0-Ct.y)/(Vt.y-Ct.y)*(Vt.x-Ct.x),0)._round():Vt.y<0&&(Vt=new G(Ct.x+(0-Ct.y)/(Vt.y-Ct.y)*(Vt.x-Ct.x),0)._round()),Ct.x>=Kt&&Vt.x>=Kt||(Ct.x>=Kt?Ct=new G(Kt,Ct.y+(Kt-Ct.x)/(Vt.x-Ct.x)*(Vt.y-Ct.y))._round():Vt.x>=Kt&&(Vt=new G(Kt,Ct.y+(Kt-Ct.x)/(Vt.x-Ct.x)*(Vt.y-Ct.y))._round()),Ct.y>=li&&Vt.y>=li||(Ct.y>=li?Ct=new G(Ct.x+(li-Ct.y)/(Vt.y-Ct.y)*(Vt.x-Ct.x),li)._round():Vt.y>=li&&(Vt=new G(Ct.x+(li-Ct.y)/(Vt.y-Ct.y)*(Vt.x-Ct.x),li)._round()),ji&&Ct.equals(ji[ji.length-1])||(ji=[Ct],Fi.push(ji)),ji.push(Vt)))))}}return Fi}(e.geometry,0,0,Le,Le)){const kt=su(jt,tt),vt=Zp(kt,ce,ve,r.vertical||q,o,24,ue,n.overscaling,Le);for(const Wt of vt)q&&np(n,q.text,et,Wt)||Pt(kt,Wt)}else if(We==="line-center"){for(const jt of e.geometry)if(jt.length>1){const kt=su(jt,tt),vt=Jf(kt,ve,r.vertical||q,o,24,ue);vt&&Pt(kt,vt)}}else if(e.type==="Polygon")for(const jt of Yn(e.geometry,0)){const kt=Od(jt,16);Pt(su(jt[0],tt,!0),new Dl(kt.x,kt.y,0))}else if(e.type==="LineString")for(const jt of e.geometry){const kt=su(jt,tt);Pt(kt,new Dl(kt[0].x,kt[0].y,0))}else if(e.type==="Point")for(const jt of e.geometry)for(const kt of jt)Pt([kt],new Dl(kt.x,kt.y,0))}function rp(n,e,r,o,h,p,g,v,M,A,z,I,L,B,j){const q=function(ue,le,ce,Te,ye,ve,we,Ye){const We=Te.layout.get("text-rotate").evaluate(ve,{})*Math.PI/180,et=[];for(const Ue of le.positionedLines)for(const it of Ue.positionedGlyphs){if(!it.rect)continue;const tt=it.rect||{};let Pt=4,jt=!0,kt=1,vt=0;const Wt=(ye||Ye)&&it.vertical,Kt=it.metrics.advance*it.scale/2;if(Ye&&le.verticalizable&&(vt=Ue.lineOffset/2-(it.imageName?-(kn-it.metrics.width*it.scale)/2:(it.scale-1)*kn)),it.imageName){const hr=we[it.imageName];jt=hr.sdf,kt=hr.pixelRatio,Pt=1/kt}const li=ye?[it.x+Kt,it.y]:[0,0];let Fi=ye?[0,0]:[it.x+Kt+ce[0],it.y+ce[1]-vt],Ki=[0,0];Wt&&(Ki=Fi,Fi=[0,0]);const Hi=it.metrics.isDoubleResolution?2:1,ji=(it.metrics.left-Pt)*it.scale-Kt+Fi[0],gi=(-it.metrics.top-Pt)*it.scale+Fi[1],Ct=ji+tt.w/Hi*it.scale/kt,Vt=gi+tt.h/Hi*it.scale/kt,Ni=new G(ji,gi),Vi=new G(Ct,gi),Qi=new G(ji,Vt),yi=new G(Ct,Vt);if(Wt){const hr=new G(-Kt,Kt- -17),a=-Math.PI/2,u=12-Kt,m=new G(22-u,-(it.imageName?u:0)),w=new G(...Ki);Ni._rotateAround(a,hr)._add(m)._add(w),Vi._rotateAround(a,hr)._add(m)._add(w),Qi._rotateAround(a,hr)._add(m)._add(w),yi._rotateAround(a,hr)._add(m)._add(w)}if(We){const hr=Math.sin(We),a=Math.cos(We),u=[a,-hr,hr,a];Ni._matMult(u),Vi._matMult(u),Qi._matMult(u),yi._matMult(u)}const Wr=new G(0,0),Kr=new G(0,0);et.push({tl:Ni,tr:Vi,bl:Qi,br:yi,tex:tt,writingMode:le.writingMode,glyphOffset:li,sectionIndex:it.sectionIndex,isSDF:jt,pixelOffsetTL:Wr,pixelOffsetBR:Kr,minFontScaleX:0,minFontScaleY:0})}return et}(0,r,v,h,p,g,o,n.allowVerticalPlacement),X=n.textSizeData;let J=null;X.kind==="source"?(J=[Rl*h.layout.get("text-size").evaluate(g,{})],J[0]>Xo&&Nt(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):X.kind==="composite"&&(J=[Rl*B.compositeTextSizes[0].evaluate(g,{},j),Rl*B.compositeTextSizes[1].evaluate(g,{},j)],(J[0]>Xo||J[1]>Xo)&&Nt(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,q,J,v,p,g,A,e,M.lineStartIndex,M.lineLength,L,j);for(const ue of z)I[ue]=n.text.placedSymbolArray.length-1;return 4*q.length}function Qh(n){for(const e in n)return n[e];return null}function np(n,e,r,o){const h=n.compareText;if(e in h){const p=h[e];for(let g=p.length-1;g>=0;g--)if(o.dist(p[g])<r)return!0}else h[e]=[];return h[e].push(o),!1}class Jh{constructor(e){const r={},o=[];for(const v in e){const M=e[v],A=r[v]={};for(const z in M){const I=M[+z];if(!I||I.bitmap.width===0||I.bitmap.height===0)continue;const L={x:0,y:0,w:I.bitmap.width+2,h:I.bitmap.height+2};o.push(L),A[z]={rect:L,metrics:I.metrics}}}const{w:h,h:p}=Vr(o),g=new Ia({width:h||1,height:p||1});for(const v in e){const M=e[v];for(const A in M){const z=M[+A];if(!z||z.bitmap.width===0||z.bitmap.height===0)continue;const I=r[v][A].rect;Ia.copy(z.bitmap,g,{x:0,y:0},{x:I.x+1,y:I.y+1},z.bitmap)}}this.image=g,this.positions=r}}function ap(n,e,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}Mt("GlyphAtlas",Jh);const Sf=63710088e-1;class Mc{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Mc(function(e,r){const o=((e-r)%360+360)%360+r;return o===r?180:o}(this.lng,-180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,o=this.lat*r,h=e.lat*r,p=Math.sin(o)*Math.sin(h)+Math.cos(o)*Math.cos(h)*Math.cos((e.lng-this.lng)*r);return Sf*Math.acos(Math.min(p,1))}static convert(e){if(e instanceof Mc)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Mc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Mc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const sp=2*Math.PI*Sf;function Pp(n){return sp*Math.cos(n*Math.PI/180)}function mh(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class op{constructor(e,r,o=0){this.x=+e,this.y=+r,this.z=+o}static fromLngLat(e,r=0){const o=Mc.convert(e);return new op((180+o.lng)/360,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o.lat*Math.PI/360)))/360,function(h,p){return h/Pp(p)}(r,o.lat))}toLngLat(){return new Mc(360*this.x-180,mh(this.y))}toAltitude(){return function(e,r){return e*Pp(mh(r))}(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/sp*(e=mh(this.y),1/Math.cos(e*Math.PI/180));var e}}class lp{constructor(e,r,o){if(!function(h,p,g){return!(h<0||h>25||g<0||g>=Math.pow(2,h)||p<0||p>=Math.pow(2,h))}(e,r,o))throw new Error(`x=${r}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=o,this.key=es(0,e,e,r,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,o){const h=function(g,v,M){var A=ap(256*g,256*(v=Math.pow(2,M)-v-1),M),z=ap(256*(g+1),256*(v+1),M);return A[0]+","+A[1]+","+z[0]+","+z[1]}(this.x,this.y,this.z),p=function(g,v,M){let A,z="";for(let I=g;I>0;I--)A=1<<I-1,z+=(v&A?1:0)+(M&A?2:0);return z}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,p).replace(/{bbox-epsg-3857}/g,h)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new G((e.x*r-this.x)*Le,(e.y*r-this.y)*Le)}toString(){return`${this.z}/${this.x}/${this.y}`}}class $i{constructor(e,r){this.wrap=e,this.canonical=r,this.key=es(e,r.z,r.z,r.x,r.y)}}class va{constructor(e,r,o,h,p){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=r,this.canonical=new lp(o,+h,+p),this.key=es(r,e,o,h,p)}clone(){return new va(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new va(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new va(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?es(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):es(this.wrap*+r,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new va(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,h=2*this.canonical.y;return[new va(r,this.wrap,r,o,h),new va(r,this.wrap,r,o+1,h),new va(r,this.wrap,r,o,h+1),new va(r,this.wrap,r,o+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new va(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new va(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new $i(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new op(e.x-this.wrap,e.y))}}function es(n,e,r,o,h){(n*=2)<0&&(n=-1*n-1);const p=1<<r;return(p*p*n+p*h+o).toString(36)+r.toString(36)+e.toString(36)}Mt("CanonicalTileID",lp),Mt("OverscaledTileID",va,{omit:["terrainRttPosMatrix32f"]});class Tf{constructor(e){this.tileID=new va(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.inFlightDependencies=[],this.globalState=e.globalState}parse(e,r,o,h,p){return D(this,void 0,void 0,function*(){this.status="parsing",this.data=e,this.collisionBoxArray=new wl;const g=new Dd(Object.keys(e.layers).sort()),v=new vf(this.tileID,this.promoteId);v.bucketLayerIDs=[];const M={},A={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:o,subdivisionGranularity:p},z=r.familiesBySource[this.source];for(const ye in z){const ve=e.layers[ye];if(!ve)continue;ve.version===1&&Nt(`Vector tile source "${this.source}" layer "${ye}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const we=g.encode(ye),Ye=[];for(let We=0;We<ve.length;We++){const et=ve.feature(We),Ue=v.getId(et,ye);Ye.push({feature:et,id:Ue,index:We,sourceLayerIndex:we})}for(const We of z[ye]){const et=We[0];et.source!==this.source&&Nt(`layer.source = ${et.source} does not equal this.source = ${this.source}`),et.minzoom&&this.zoom<Math.floor(et.minzoom)||et.maxzoom&&this.zoom>=et.maxzoom||et.visibility!=="none"&&(jd(We,this.zoom,o,this.globalState),(M[et.id]=et.createBucket({index:v.bucketLayerIDs.length,layers:We,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:we,sourceID:this.source,globalState:this.globalState})).populate(Ye,A,this.tileID.canonical),v.bucketLayerIDs.push(We.map(Ue=>Ue.id)))}}const I=Ut(A.glyphDependencies,ye=>Object.keys(ye).map(Number));this.inFlightDependencies.forEach(ye=>ye==null?void 0:ye.abort()),this.inFlightDependencies=[];let L=Promise.resolve({});if(Object.keys(I).length){const ye=new AbortController;this.inFlightDependencies.push(ye),L=h.sendAsync({type:"GG",data:{stacks:I,source:this.source,tileID:this.tileID,type:"glyphs"}},ye)}const B=Object.keys(A.iconDependencies);let j=Promise.resolve({});if(B.length){const ye=new AbortController;this.inFlightDependencies.push(ye),j=h.sendAsync({type:"GI",data:{icons:B,source:this.source,tileID:this.tileID,type:"icons"}},ye)}const q=Object.keys(A.patternDependencies);let X=Promise.resolve({});if(q.length){const ye=new AbortController;this.inFlightDependencies.push(ye),X=h.sendAsync({type:"GI",data:{icons:q,source:this.source,tileID:this.tileID,type:"patterns"}},ye)}const[J,ue,le]=yield Promise.all([L,j,X]),ce=new Jh(J),Te=new Oi(ue,le);for(const ye in M){const ve=M[ye];ve instanceof Wh?(jd(ve.layers,this.zoom,o,this.globalState),wf({bucket:ve,glyphMap:J,glyphPositions:ce.positions,imageMap:ue,imagePositions:Te.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:A.subdivisionGranularity})):ve.hasPattern&&(ve instanceof ka||ve instanceof lf||ve instanceof Ed)&&(jd(ve.layers,this.zoom,o,this.globalState),ve.addFeatures(A,this.tileID.canonical,Te.patternPositions))}return this.status="done",{buckets:Object.values(M).filter(ye=>!ye.isEmpty()),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ce.image,imageAtlas:Te,glyphMap:this.returnDependencies?J:null,iconMap:this.returnDependencies?ue:null,glyphPositions:this.returnDependencies?ce.positions:null}})}}function jd(n,e,r,o){const h=new vi(e,{globalState:o});for(const p of n)p.recalculate(h,r)}var Nd,gh,ed;(function(n){n.create="create",n.load="load",n.fullLoad="fullLoad"})(Nd||(Nd={}));class Ac{constructor(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let e=performance.getEntriesByName(this._marks.measure);return e.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),e=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),e}}class Mf{constructor(e,r,o){this.actor=e,this.layerIndex=r,this.availableImages=o,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(e,r){return D(this,void 0,void 0,function*(){const o=yield((h,p)=>Zc(wt(h,{type:"arrayBuffer"}),p))(e.request,r);try{return{vectorTile:new qh(new yc(o.data)),rawData:o.data,cacheControl:o.cacheControl,expires:o.expires}}catch(h){const p=new Uint8Array(o.data);let g=`Unable to parse the tile at ${e.request.url}, `;throw g+=p[0]===31&&p[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${h.message}`,new Error(g)}})}loadTile(e){return D(this,void 0,void 0,function*(){const r=e.uid,o=!!(e&&e.request&&e.request.collectResourceTiming)&&new Ac(e.request),h=new Tf(e);this.loading[r]=h;const p=new AbortController;h.abort=p;try{const g=yield this.loadVectorTile(e,p);if(delete this.loading[r],!g)return null;const v=g.rawData,M={};g.expires&&(M.expires=g.expires),g.cacheControl&&(M.cacheControl=g.cacheControl);const A={};if(o){const I=o.finish();I&&(A.resourceTiming=JSON.parse(JSON.stringify(I)))}h.vectorTile=g.vectorTile;const z=h.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,e.subdivisionGranularity);this.loaded[r]=h,this.fetching[r]={rawTileData:v,cacheControl:M,resourceTiming:A};try{const I=yield z;return wt({rawTileData:v.slice(0)},I,M,A)}finally{delete this.fetching[r]}}catch(g){throw delete this.loading[r],h.status="done",this.loaded[r]=h,g}})}reloadTile(e){return D(this,void 0,void 0,function*(){const r=e.uid;if(!this.loaded||!this.loaded[r])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const o=this.loaded[r];if(o.showCollisionBoxes=e.showCollisionBoxes,o.globalState=e.globalState,o.status==="parsing"){const h=yield o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,e.subdivisionGranularity);let p;if(this.fetching[r]){const{rawTileData:g,cacheControl:v,resourceTiming:M}=this.fetching[r];delete this.fetching[r],p=wt({rawTileData:g.slice(0)},h,v,M)}else p=h;return p}if(o.status==="done"&&o.vectorTile)return o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,e.subdivisionGranularity)})}abortTile(e){return D(this,void 0,void 0,function*(){const r=this.loading,o=e.uid;r&&r[o]&&r[o].abort&&(r[o].abort.abort(),delete r[o])})}removeTile(e){return D(this,void 0,void 0,function*(){this.loaded&&this.loaded[e.uid]&&delete this.loaded[e.uid]})}}class Vd{constructor(){this.loaded={}}loadTile(e){return D(this,void 0,void 0,function*(){const{uid:r,encoding:o,rawImageData:h,redFactor:p,greenFactor:g,blueFactor:v,baseShift:M}=e,A=h.width+2,z=h.height+2,I=Rt(h)?new xr({width:A,height:z},yield function(B,j,q,X,J){return D(this,void 0,void 0,function*(){if(function(){if(se==null&&(se=!1,y==null&&(y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),y)){const le=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(le){for(let Te=0;Te<5*5;Te++){const ye=4*Te;le.fillStyle=`rgb(${ye},${ye+1},${ye+2})`,le.fillRect(Te%5,Math.floor(Te/5),1,1)}const ce=le.getImageData(0,0,5,5).data;for(let Te=0;Te<5*5*4;Te++)if(Te%4!=3&&ce[Te]!==Te){se=!0;break}}}return se||!1}())try{return yield function(ue,le,ce,Te,ye){return D(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const ve=new VideoFrame(ue,{timestamp:0});try{const we=ve==null?void 0:ve.format;if(!we||!we.startsWith("BGR")&&!we.startsWith("RGB"))throw new Error(`Unrecognized format ${we}`);const Ye=we.startsWith("BGR"),We=new Uint8ClampedArray(Te*ye*4);if(yield ve.copyTo(We,function(et,Ue,it,tt,Pt){const jt=4*Math.max(-Ue,0),kt=(Math.max(0,it)-it)*tt*4+jt,vt=4*tt,Wt=Math.max(0,Ue),Kt=Math.max(0,it);return{rect:{x:Wt,y:Kt,width:Math.min(et.width,Ue+tt)-Wt,height:Math.min(et.height,it+Pt)-Kt},layout:[{offset:kt,stride:vt}]}}(ue,le,ce,Te,ye)),Ye)for(let et=0;et<We.length;et+=4){const Ue=We[et];We[et]=We[et+2],We[et+2]=Ue}return We}finally{ve.close()}})}(B,j,q,X,J)}catch{}return function(ue,le,ce,Te,ye){const ve=ue.width,we=ue.height;Gt&&ti||(Gt=new OffscreenCanvas(ve,we),ti=Gt.getContext("2d",{willReadFrequently:!0})),Gt.width=ve,Gt.height=we,ti.drawImage(ue,0,0,ve,we);const Ye=ti.getImageData(le,ce,Te,ye);return ti.clearRect(0,0,ve,we),Ye.data}(B,j,q,X,J)})}(h,-1,-1,A,z)):h,L=new Ka(r,I,o,p,g,v,M);return this.loaded=this.loaded||{},this.loaded[r]=L,L})}removeTile(e){const r=this.loaded,o=e.uid;r&&r[o]&&delete r[o]}}var Ip=function(){if(ed)return gh;function n(r,o){if(r.length!==0){e(r[0],o);for(var h=1;h<r.length;h++)e(r[h],!o)}}function e(r,o){for(var h=0,p=0,g=0,v=r.length,M=v-1;g<v;M=g++){var A=(r[g][0]-r[M][0])*(r[M][1]+r[g][1]),z=h+A;p+=Math.abs(h)>=Math.abs(A)?h-z+A:A-z+h,h=z}h+p>=0!=!!o&&r.reverse()}return ed=1,gh=function r(o,h){var p,g=o&&o.type;if(g==="FeatureCollection")for(p=0;p<o.features.length;p++)r(o.features[p],h);else if(g==="GeometryCollection")for(p=0;p<o.geometries.length;p++)r(o.geometries[p],h);else if(g==="Feature")r(o.geometry,h);else if(g==="Polygon")n(o.coordinates,h);else if(g==="MultiPolygon")for(p=0;p<o.coordinates.length;p++)n(o.coordinates[p],h);return o}}(),Af=H(Ip);class cp extends eh{constructor(e,r){super(new yc,0,r,[],[]),this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],r=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of r){const h=[];for(const p of o)h.push(new G(p[0],p[1]));e.push(h)}return e}}class Da extends Uf{constructor(e,r){super(new yc),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=r?r.version:1,this.extent=r?r.extent:4096,this.length=e.length,this.features=e}feature(e){return new cp(this.features[e],this.extent)}}function ur(n,e){e.writeVarintField(15,n.version||1),e.writeStringField(1,n.name||""),e.writeVarintField(5,n.extent||4096);const r={keys:[],values:[],keycache:{},valuecache:{}};for(let p=0;p<n.length;p++)r.feature=n.feature(p),e.writeMessage(2,yh,r);const o=r.keys;for(const p of o)e.writeStringField(3,p);const h=r.values;for(const p of h)e.writeMessage(4,Gd,p)}function yh(n,e){if(!n.feature)return;const r=n.feature;r.id!==void 0&&e.writeVarintField(1,r.id),e.writeMessage(2,xn,n),e.writeVarintField(3,r.type),e.writeMessage(4,Ef,r)}function xn(n,e){var r;for(const o in(r=n.feature)==null?void 0:r.properties){let h=n.feature.properties[o],p=n.keycache[o];if(h===null)continue;p===void 0&&(n.keys.push(o),p=n.keys.length-1,n.keycache[o]=p),e.writeVarint(p),typeof h!="string"&&typeof h!="boolean"&&typeof h!="number"&&(h=JSON.stringify(h));const g=typeof h+":"+h;let v=n.valuecache[g];v===void 0&&(n.values.push(h),v=n.values.length-1,n.valuecache[g]=v),e.writeVarint(v)}}function Cf(n,e){return(e<<3)+(7&n)}function Ud(n){return n<<1^n>>31}function Ef(n,e){const r=n.loadGeometry(),o=n.type;let h=0,p=0;for(const g of r){let v=1;o===1&&(v=g.length),e.writeVarint(Cf(1,v));const M=o===3?g.length-1:g.length;for(let A=0;A<M;A++){A===1&&o!==1&&e.writeVarint(Cf(2,M-1));const z=g[A].x-h,I=g[A].y-p;e.writeVarint(Ud(z)),e.writeVarint(Ud(I)),h+=z,p+=I}n.type===3&&e.writeVarint(Cf(7,1))}}function Gd(n,e){const r=typeof n;r==="string"?e.writeStringField(1,n):r==="boolean"?e.writeBooleanField(7,n):r==="number"&&(n%1!=0?e.writeDoubleField(3,n):n<0?e.writeSVarintField(6,n):e.writeVarintField(5,n))}const up=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qd{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,o]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=o>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=up[15&o];if(!p)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new qd(v,g,p,e)}constructor(e,r=64,o=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=up.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${o}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+M,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+v+M),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+M,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=r,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return co(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:v}=this,M=[0,p.length-1,0],A=[];for(;M.length;){const z=M.pop()||0,I=M.pop()||0,L=M.pop()||0;if(I-L<=v){for(let X=L;X<=I;X++){const J=g[2*X],ue=g[2*X+1];J>=e&&J<=o&&ue>=r&&ue<=h&&A.push(p[X])}continue}const B=L+I>>1,j=g[2*B],q=g[2*B+1];j>=e&&j<=o&&q>=r&&q<=h&&A.push(p[B]),(z===0?e<=j:r<=q)&&(M.push(L),M.push(B-1),M.push(1-z)),(z===0?o>=j:h>=q)&&(M.push(B+1),M.push(I),M.push(1-z))}return A}within(e,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:g}=this,v=[0,h.length-1,0],M=[],A=o*o;for(;v.length;){const z=v.pop()||0,I=v.pop()||0,L=v.pop()||0;if(I-L<=g){for(let X=L;X<=I;X++)hp(p[2*X],p[2*X+1],e,r)<=A&&M.push(h[X]);continue}const B=L+I>>1,j=p[2*B],q=p[2*B+1];hp(j,q,e,r)<=A&&M.push(h[B]),(z===0?e-o<=j:r-o<=q)&&(v.push(L),v.push(B-1),v.push(1-z)),(z===0?e+o>=j:r+o>=q)&&(v.push(B+1),v.push(I),v.push(1-z))}return M}}function co(n,e,r,o,h,p){if(h-o<=r)return;const g=o+h>>1;Zd(n,e,g,o,h,p),co(n,e,r,o,g-1,1-p),co(n,e,r,g+1,h,1-p)}function Zd(n,e,r,o,h,p){for(;h>o;){if(h-o>600){const A=h-o+1,z=r-o+1,I=Math.log(A),L=.5*Math.exp(2*I/3),B=.5*Math.sqrt(I*L*(A-L)/A)*(z-A/2<0?-1:1);Zd(n,e,r,Math.max(o,Math.floor(r-z*L/A+B)),Math.min(h,Math.floor(r+(A-z)*L/A+B)),p)}const g=e[2*r+p];let v=o,M=h;for(td(n,e,o,r),e[2*h+p]>g&&td(n,e,o,h);v<M;){for(td(n,e,v,M),v++,M--;e[2*v+p]<g;)v++;for(;e[2*M+p]>g;)M--}e[2*o+p]===g?td(n,e,o,M):(M++,td(n,e,M,h)),M<=r&&(o=M+1),r<=M&&(h=M-1)}}function td(n,e,r,o){$d(n,r,o),$d(e,2*r,2*o),$d(e,2*r+1,2*o+1)}function $d(n,e,r){const o=n[e];n[e]=n[r],n[r]=o}function hp(n,e,r,o){const h=n-r,p=e-o;return h*h+p*p}const kp={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:n=>n},Rp=Math.fround||(zf=new Float32Array(1),n=>(zf[0]=+n,zf[0]));var zf;class Cc{constructor(e){this.options=Object.assign(Object.create(kp),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:r,minZoom:o,maxZoom:h}=this.options;r&&console.time("total time");const p=`prepare ${e.length} points`;r&&console.time(p),this.points=e;const g=[];for(let M=0;M<e.length;M++){const A=e[M];if(!A.geometry)continue;const[z,I]=A.geometry.coordinates,L=Rp(_h(z)),B=Rp(xh(I));g.push(L,B,1/0,M,-1,1),this.options.reduce&&g.push(0)}let v=this.trees[h+1]=this._createTree(g);r&&console.timeEnd(p);for(let M=h;M>=o;M--){const A=+Date.now();v=this.trees[M]=this._createTree(this._cluster(v,M)),r&&console.log("z%d: %d clusters in %dms",M,v.numItems,+Date.now()-A)}return r&&console.timeEnd("total time"),this}getClusters(e,r){let o=((e[0]+180)%360+360)%360-180;const h=Math.max(-90,Math.min(90,e[1]));let p=e[2]===180?180:((e[2]+180)%360+360)%360-180;const g=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)o=-180,p=180;else if(o>p){const I=this.getClusters([o,h,180,g],r),L=this.getClusters([-180,h,p,g],r);return I.concat(L)}const v=this.trees[this._limitZoom(r)],M=v.range(_h(o),xh(g),_h(p),xh(h)),A=v.data,z=[];for(const I of M){const L=this.stride*I;z.push(A[L+5]>1?id(A,L,this.clusterProps):this.points[A[L+3]])}return z}getChildren(e){const r=this._getOriginId(e),o=this._getOriginZoom(e),h="No cluster with the specified id.",p=this.trees[o];if(!p)throw new Error(h);const g=p.data;if(r*this.stride>=g.length)throw new Error(h);const v=this.options.radius/(this.options.extent*Math.pow(2,o-1)),M=p.within(g[r*this.stride],g[r*this.stride+1],v),A=[];for(const z of M){const I=z*this.stride;g[I+4]===e&&A.push(g[I+5]>1?id(g,I,this.clusterProps):this.points[g[I+3]])}if(A.length===0)throw new Error(h);return A}getLeaves(e,r,o){const h=[];return this._appendLeaves(h,e,r=r||10,o=o||0,0),h}getTile(e,r,o){const h=this.trees[this._limitZoom(e)],p=Math.pow(2,e),{extent:g,radius:v}=this.options,M=v/g,A=(o-M)/p,z=(o+1+M)/p,I={features:[]};return this._addTileFeatures(h.range((r-M)/p,A,(r+1+M)/p,z),h.data,r,o,p,I),r===0&&this._addTileFeatures(h.range(1-M/p,A,1,z),h.data,p,o,p,I),r===p-1&&this._addTileFeatures(h.range(0,A,M/p,z),h.data,-1,o,p,I),I.features.length?I:null}getClusterExpansionZoom(e){let r=this._getOriginZoom(e)-1;for(;r<=this.options.maxZoom;){const o=this.getChildren(e);if(r++,o.length!==1)break;e=o[0].properties.cluster_id}return r}_appendLeaves(e,r,o,h,p){const g=this.getChildren(r);for(const v of g){const M=v.properties;if(M&&M.cluster?p+M.point_count<=h?p+=M.point_count:p=this._appendLeaves(e,M.cluster_id,o,h,p):p<h?p++:e.push(v),e.length===o)break}return p}_createTree(e){const r=new qd(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let o=0;o<e.length;o+=this.stride)r.add(e[o],e[o+1]);return r.finish(),r.data=e,r}_addTileFeatures(e,r,o,h,p,g){for(const v of e){const M=v*this.stride,A=r[M+5]>1;let z,I,L;if(A)z=Hd(r,M,this.clusterProps),I=r[M],L=r[M+1];else{const q=this.points[r[M+3]];z=q.properties;const[X,J]=q.geometry.coordinates;I=_h(X),L=xh(J)}const B={type:1,geometry:[[Math.round(this.options.extent*(I*p-o)),Math.round(this.options.extent*(L*p-h))]],tags:z};let j;j=A||this.options.generateId?r[M+3]:this.points[r[M+3]].id,j!==void 0&&(B.id=j),g.features.push(B)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,r){const{radius:o,extent:h,reduce:p,minPoints:g}=this.options,v=o/(h*Math.pow(2,r)),M=e.data,A=[],z=this.stride;for(let I=0;I<M.length;I+=z){if(M[I+2]<=r)continue;M[I+2]=r;const L=M[I],B=M[I+1],j=e.within(M[I],M[I+1],v),q=M[I+5];let X=q;for(const J of j){const ue=J*z;M[ue+2]>r&&(X+=M[ue+5])}if(X>q&&X>=g){let J,ue=L*q,le=B*q,ce=-1;const Te=(I/z<<5)+(r+1)+this.points.length;for(const ye of j){const ve=ye*z;if(M[ve+2]<=r)continue;M[ve+2]=r;const we=M[ve+5];ue+=M[ve]*we,le+=M[ve+1]*we,M[ve+4]=Te,p&&(J||(J=this._map(M,I,!0),ce=this.clusterProps.length,this.clusterProps.push(J)),p(J,this._map(M,ve)))}M[I+4]=Te,A.push(ue/X,le/X,1/0,Te,-1,X),p&&A.push(ce)}else{for(let J=0;J<z;J++)A.push(M[I+J]);if(X>1)for(const J of j){const ue=J*z;if(!(M[ue+2]<=r)){M[ue+2]=r;for(let le=0;le<z;le++)A.push(M[ue+le])}}}}return A}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,r,o){if(e[r+5]>1){const g=this.clusterProps[e[r+6]];return o?Object.assign({},g):g}const h=this.points[e[r+3]].properties,p=this.options.map(h);return o&&p===h?Object.assign({},p):p}}function id(n,e,r){return{type:"Feature",id:n[e+3],properties:Hd(n,e,r),geometry:{type:"Point",coordinates:[(o=n[e],360*(o-.5)),rd(n[e+1])]}};var o}function Hd(n,e,r){const o=n[e+5],h=o>=1e4?`${Math.round(o/1e3)}k`:o>=1e3?Math.round(o/100)/10+"k":o,p=n[e+6],g=p===-1?{}:Object.assign({},r[p]);return Object.assign(g,{cluster:!0,cluster_id:n[e+3],point_count:o,point_count_abbreviated:h})}function _h(n){return n/360+.5}function xh(n){const e=Math.sin(n*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function rd(n){const e=(180-360*n)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function dp(n,e,r,o){let h=o;const p=e+(r-e>>1);let g,v=r-e;const M=n[e],A=n[e+1],z=n[r],I=n[r+1];for(let L=e+3;L<r;L+=3){const B=Yo(n[L],n[L+1],M,A,z,I);if(B>h)g=L,h=B;else if(B===h){const j=Math.abs(L-p);j<v&&(g=L,v=j)}}h>o&&(g-e>3&&dp(n,e,g,o),n[g+2]=h,r-g>3&&dp(n,g,r,o))}function Yo(n,e,r,o,h,p){let g=h-r,v=p-o;if(g!==0||v!==0){const M=((n-r)*g+(e-o)*v)/(g*g+v*v);M>1?(r=h,o=p):M>0&&(r+=g*M,o+=v*M)}return g=n-r,v=e-o,g*g+v*v}function vh(n,e,r,o){const h={id:n??null,type:e,geometry:r,tags:o,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(e==="Point"||e==="MultiPoint"||e==="LineString")Ll(h,r);else if(e==="Polygon")Ll(h,r[0]);else if(e==="MultiLineString")for(const p of r)Ll(h,p);else if(e==="MultiPolygon")for(const p of r)Ll(h,p[0]);return h}function Ll(n,e){for(let r=0;r<e.length;r+=3)n.minX=Math.min(n.minX,e[r]),n.minY=Math.min(n.minY,e[r+1]),n.maxX=Math.max(n.maxX,e[r]),n.maxY=Math.max(n.maxY,e[r+1])}function Rn(n,e,r,o){if(!e.geometry)return;const h=e.geometry.coordinates;if(h&&h.length===0)return;const p=e.geometry.type,g=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2);let v=[],M=e.id;if(r.promoteId?M=e.properties[r.promoteId]:r.generateId&&(M=o||0),p==="Point")xu(h,v);else if(p==="MultiPoint")for(const A of h)xu(A,v);else if(p==="LineString")ts(h,v,g,!1);else if(p==="MultiLineString"){if(r.lineMetrics){for(const A of h)v=[],ts(A,v,g,!1),n.push(vh(M,"LineString",v,e.properties));return}Xd(h,v,g,!1)}else if(p==="Polygon")Xd(h,v,g,!0);else{if(p!=="MultiPolygon"){if(p==="GeometryCollection"){for(const A of e.geometry.geometries)Rn(n,{id:M,geometry:A,properties:e.properties},r,o);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const A of h){const z=[];Xd(A,z,g,!0),v.push(z)}}n.push(vh(M,p,v,e.properties))}function xu(n,e){e.push(bh(n[0]),Bl(n[1]),0)}function ts(n,e,r,o){let h,p,g=0;for(let M=0;M<n.length;M++){const A=bh(n[M][0]),z=Bl(n[M][1]);e.push(A,z,0),M>0&&(g+=o?(h*z-A*p)/2:Math.sqrt(Math.pow(A-h,2)+Math.pow(z-p,2))),h=A,p=z}const v=e.length-3;e[2]=1,dp(e,0,v,r),e[v+2]=1,e.size=Math.abs(g),e.start=0,e.end=e.size}function Xd(n,e,r,o){for(let h=0;h<n.length;h++){const p=[];ts(n[h],p,r,o),e.push(p)}}function bh(n){return n/360+.5}function Bl(n){const e=Math.sin(n*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function Ol(n,e,r,o,h,p,g,v){if(o/=e,p>=(r/=e)&&g<o)return n;if(g<r||p>=o)return null;const M=[];for(const A of n){const z=A.geometry;let I=A.type;const L=h===0?A.minX:A.minY,B=h===0?A.maxX:A.maxY;if(L>=r&&B<o){M.push(A);continue}if(B<r||L>=o)continue;let j=[];if(I==="Point"||I==="MultiPoint")Dp(z,j,r,o,h);else if(I==="LineString")wh(z,j,r,o,h,!1,v.lineMetrics);else if(I==="MultiLineString")Yd(z,j,r,o,h,!1);else if(I==="Polygon")Yd(z,j,r,o,h,!0);else if(I==="MultiPolygon")for(const q of z){const X=[];Yd(q,X,r,o,h,!0),X.length&&j.push(X)}if(j.length){if(v.lineMetrics&&I==="LineString"){for(const q of j)M.push(vh(A.id,I,q,A.tags));continue}I!=="LineString"&&I!=="MultiLineString"||(j.length===1?(I="LineString",j=j[0]):I="MultiLineString"),I!=="Point"&&I!=="MultiPoint"||(I=j.length===3?"Point":"MultiPoint"),M.push(vh(A.id,I,j,A.tags))}}return M.length?M:null}function Dp(n,e,r,o,h){for(let p=0;p<n.length;p+=3){const g=n[p+h];g>=r&&g<=o&&vu(e,n[p],n[p+1],n[p+2])}}function wh(n,e,r,o,h,p,g){let v=Pf(n);const M=h===0?Lp:Wd;let A,z,I=n.start;for(let X=0;X<n.length-3;X+=3){const J=n[X],ue=n[X+1],le=n[X+2],ce=n[X+3],Te=n[X+4],ye=h===0?J:ue,ve=h===0?ce:Te;let we=!1;g&&(A=Math.sqrt(Math.pow(J-ce,2)+Math.pow(ue-Te,2))),ye<r?ve>r&&(z=M(v,J,ue,ce,Te,r),g&&(v.start=I+A*z)):ye>o?ve<o&&(z=M(v,J,ue,ce,Te,o),g&&(v.start=I+A*z)):vu(v,J,ue,le),ve<r&&ye>=r&&(z=M(v,J,ue,ce,Te,r),we=!0),ve>o&&ye<=o&&(z=M(v,J,ue,ce,Te,o),we=!0),!p&&we&&(g&&(v.end=I+A*z),e.push(v),v=Pf(n)),g&&(I+=A)}let L=n.length-3;const B=n[L],j=n[L+1],q=h===0?B:j;q>=r&&q<=o&&vu(v,B,j,n[L+2]),L=v.length-3,p&&L>=3&&(v[L]!==v[0]||v[L+1]!==v[1])&&vu(v,v[0],v[1],v[2]),v.length&&e.push(v)}function Pf(n){const e=[];return e.size=n.size,e.start=n.start,e.end=n.end,e}function Yd(n,e,r,o,h,p){for(const g of n)wh(g,e,r,o,h,p,!1)}function vu(n,e,r,o){n.push(e,r,o)}function Lp(n,e,r,o,h,p){const g=(p-e)/(o-e);return vu(n,p,r+(h-r)*g,1),g}function Wd(n,e,r,o,h,p){const g=(p-r)/(h-r);return vu(n,e+(o-e)*g,p,1),g}function If(n,e){const r=[];for(let o=0;o<n.length;o++){const h=n[o],p=h.type;let g;if(p==="Point"||p==="MultiPoint"||p==="LineString")g=kf(h.geometry,e);else if(p==="MultiLineString"||p==="Polygon"){g=[];for(const v of h.geometry)g.push(kf(v,e))}else if(p==="MultiPolygon"){g=[];for(const v of h.geometry){const M=[];for(const A of v)M.push(kf(A,e));g.push(M)}}r.push(vh(h.id,p,g,h.tags))}return r}function kf(n,e){const r=[];r.size=n.size,n.start!==void 0&&(r.start=n.start,r.end=n.end);for(let o=0;o<n.length;o+=3)r.push(n[o]+e,n[o+1],n[o+2]);return r}function Rf(n,e){if(n.transformed)return n;const r=1<<n.z,o=n.x,h=n.y;for(const p of n.features){const g=p.geometry,v=p.type;if(p.geometry=[],v===1)for(let M=0;M<g.length;M+=2)p.geometry.push(nd(g[M],g[M+1],e,r,o,h));else for(let M=0;M<g.length;M++){const A=[];for(let z=0;z<g[M].length;z+=2)A.push(nd(g[M][z],g[M][z+1],e,r,o,h));p.geometry.push(A)}}return n.transformed=!0,n}function nd(n,e,r,o,h,p){return[Math.round(r*(n*o-h)),Math.round(r*(e*o-p))]}function Fl(n,e,r,o,h){const p=e===h.maxZoom?0:h.tolerance/((1<<e)*h.extent),g={features:[],numPoints:0,numSimplified:0,numFeatures:n.length,source:null,x:r,y:o,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const v of n)Sh(g,v,p,h);return g}function Sh(n,e,r,o){const h=e.geometry,p=e.type,g=[];if(n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),p==="Point"||p==="MultiPoint")for(let v=0;v<h.length;v+=3)g.push(h[v],h[v+1]),n.numPoints++,n.numSimplified++;else if(p==="LineString")ad(g,h,n,r,!1,!1);else if(p==="MultiLineString"||p==="Polygon")for(let v=0;v<h.length;v++)ad(g,h[v],n,r,p==="Polygon",v===0);else if(p==="MultiPolygon")for(let v=0;v<h.length;v++){const M=h[v];for(let A=0;A<M.length;A++)ad(g,M[A],n,r,!0,A===0)}if(g.length){let v=e.tags||null;if(p==="LineString"&&o.lineMetrics){v={};for(const A in e.tags)v[A]=e.tags[A];v.mapbox_clip_start=h.start/h.size,v.mapbox_clip_end=h.end/h.size}const M={geometry:g,type:p==="Polygon"||p==="MultiPolygon"?3:p==="LineString"||p==="MultiLineString"?2:1,tags:v};e.id!==null&&(M.id=e.id),n.features.push(M)}}function ad(n,e,r,o,h,p){const g=o*o;if(o>0&&e.size<(h?g:o))return void(r.numPoints+=e.length/3);const v=[];for(let M=0;M<e.length;M+=3)(o===0||e[M+2]>g)&&(r.numSimplified++,v.push(e[M],e[M+1])),r.numPoints++;h&&function(M,A){let z=0;for(let I=0,L=M.length,B=L-2;I<L;B=I,I+=2)z+=(M[I]-M[B])*(M[I+1]+M[B+1]);if(z>0===A)for(let I=0,L=M.length;I<L/2;I+=2){const B=M[I],j=M[I+1];M[I]=M[L-2-I],M[I+1]=M[L-1-I],M[L-2-I]=B,M[L-1-I]=j}}(v,p),n.push(v)}const fp={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class sd{constructor(e,r){const o=(r=this.options=function(p,g){for(const v in g)p[v]=g[v];return p}(Object.create(fp),r)).debug;if(o&&console.time("preprocess data"),r.maxZoom<0||r.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(r.promoteId&&r.generateId)throw new Error("promoteId and generateId cannot be used together.");let h=function(p,g){const v=[];if(p.type==="FeatureCollection")for(let M=0;M<p.features.length;M++)Rn(v,p.features[M],g,M);else Rn(v,p.type==="Feature"?p:{geometry:p},g);return v}(e,r);this.tiles={},this.tileCoords=[],o&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",r.indexMaxZoom,r.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),h=function(p,g){const v=g.buffer/g.extent;let M=p;const A=Ol(p,1,-1-v,v,0,-1,2,g),z=Ol(p,1,1-v,2+v,0,-1,2,g);return(A||z)&&(M=Ol(p,1,-v,1+v,0,-1,2,g)||[],A&&(M=If(A,1).concat(M)),z&&(M=M.concat(If(z,-1)))),M}(h,r),h.length&&this.splitTile(h,0,0,0),o&&(h.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,r,o,h,p,g,v){const M=[e,r,o,h],A=this.options,z=A.debug;for(;M.length;){h=M.pop(),o=M.pop(),r=M.pop(),e=M.pop();const I=1<<r,L=l(r,o,h);let B=this.tiles[L];if(!B&&(z>1&&console.time("creation"),B=this.tiles[L]=Fl(e,r,o,h,A),this.tileCoords.push({z:r,x:o,y:h}),z)){z>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",r,o,h,B.numFeatures,B.numPoints,B.numSimplified),console.timeEnd("creation"));const we=`z${r}`;this.stats[we]=(this.stats[we]||0)+1,this.total++}if(B.source=e,p==null){if(r===A.indexMaxZoom||B.numPoints<=A.indexMaxPoints)continue}else{if(r===A.maxZoom||r===p)continue;if(p!=null){const we=p-r;if(o!==g>>we||h!==v>>we)continue}}if(B.source=null,e.length===0)continue;z>1&&console.time("clipping");const j=.5*A.buffer/A.extent,q=.5-j,X=.5+j,J=1+j;let ue=null,le=null,ce=null,Te=null,ye=Ol(e,I,o-j,o+X,0,B.minX,B.maxX,A),ve=Ol(e,I,o+q,o+J,0,B.minX,B.maxX,A);e=null,ye&&(ue=Ol(ye,I,h-j,h+X,1,B.minY,B.maxY,A),le=Ol(ye,I,h+q,h+J,1,B.minY,B.maxY,A),ye=null),ve&&(ce=Ol(ve,I,h-j,h+X,1,B.minY,B.maxY,A),Te=Ol(ve,I,h+q,h+J,1,B.minY,B.maxY,A),ve=null),z>1&&console.timeEnd("clipping"),M.push(ue||[],r+1,2*o,2*h),M.push(le||[],r+1,2*o,2*h+1),M.push(ce||[],r+1,2*o+1,2*h),M.push(Te||[],r+1,2*o+1,2*h+1)}}getTile(e,r,o){e=+e,r=+r,o=+o;const h=this.options,{extent:p,debug:g}=h;if(e<0||e>24)return null;const v=1<<e,M=l(e,r=r+v&v-1,o);if(this.tiles[M])return Rf(this.tiles[M],p);g>1&&console.log("drilling down to z%d-%d-%d",e,r,o);let A,z=e,I=r,L=o;for(;!A&&z>0;)z--,I>>=1,L>>=1,A=this.tiles[l(z,I,L)];return A&&A.source?(g>1&&(console.log("found parent tile z%d-%d-%d",z,I,L),console.time("drilling down")),this.splitTile(A.source,z,I,L,e,r,o),g>1&&console.timeEnd("drilling down"),this.tiles[M]?Rf(this.tiles[M],p):null):null}}function l(n,e,r){return 32*((1<<n)*r+e)+n}function i(n,e){return e?n.properties[e]:n.id}function s(n,e){if(n==null)return!0;if(n.type==="Feature")return i(n,e)!=null;if(n.type==="FeatureCollection"){const r=new Set;for(const o of n.features){const h=i(o,e);if(h==null||r.has(h))return!1;r.add(h)}return!0}return!1}function d(n,e){const r=new Map;if(n!=null)if(n.type==="Feature")r.set(i(n,e),n);else for(const o of n.features)r.set(i(o,e),o);return r}class _ extends Mf{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(e,r){return D(this,void 0,void 0,function*(){const o=e.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const h=this._geoJSONIndex.getTile(o.z,o.x,o.y);if(!h)return null;const p=new Da(h.features,{version:2,extent:Le});let g=function(v){const M=new yc;return function(A,z){for(const I in A.layers)z.writeMessage(3,ur,A.layers[I])}(v,M),M.finish()}(p);return g.byteOffset===0&&g.byteLength===g.buffer.byteLength||(g=new Uint8Array(g)),{vectorTile:p,rawData:g.buffer}})}loadData(e){return D(this,void 0,void 0,function*(){var r;(r=this._pendingRequest)===null||r===void 0||r.abort();const o=!!(e&&e.request&&e.request.collectResourceTiming)&&new Ac(e.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(e,this._pendingRequest);const h=yield this._pendingData;this._geoJSONIndex=e.cluster?new Cc(function({superclusterOptions:g,clusterProperties:v}){if(!v||!g)return g;const M={},A={},z={accumulated:null,zoom:0},I={properties:null},L=Object.keys(v);for(const B of L){const[j,q]=v[B],X=Zs(q),J=Zs(typeof j=="string"?[j,["accumulated"],["get",B]]:j);M[B]=X.value,A[B]=J.value}return g.map=B=>{I.properties=B;const j={};for(const q of L)j[q]=M[q].evaluate(z,I);return j},g.reduce=(B,j)=>{I.properties=j;for(const q of L)z.accumulated=B[q],B[q]=A[q].evaluate(z,I)},g}(e)).load(h.features):function(g,v){return new sd(g,v)}(h,e.geojsonVtOptions),this.loaded={};const p={data:h};if(o){const g=o.finish();g&&(p.resourceTiming={},p.resourceTiming[e.source]=JSON.parse(JSON.stringify(g)))}return p}catch(h){if(delete this._pendingRequest,function(p){return p.message===Gc}(h))return{abandoned:!0};throw h}})}getData(){return D(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(e){const r=this.loaded;return r&&r[e.uid]?super.reloadTile(e):this.loadTile(e)}loadAndProcessGeoJSON(e,r){return D(this,void 0,void 0,function*(){let o=yield this.loadGeoJSON(e,r);if(delete this._pendingRequest,typeof o!="object")throw new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`);if(Af(o,!0),e.filter){const h=Zs(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(h.result==="error")throw new Error(h.value.map(g=>`${g.key}: ${g.message}`).join(", "));o={type:"FeatureCollection",features:o.features.filter(g=>h.value.evaluate({zoom:0},g))}}return o})}loadGeoJSON(e,r){return D(this,void 0,void 0,function*(){const{promoteId:o}=e;if(e.request){const h=yield((p,g)=>Zc(wt(p,{type:"json"}),g))(e.request,r);return this._dataUpdateable=s(h.data,o)?d(h.data,o):void 0,h.data}if(typeof e.data=="string")try{const h=JSON.parse(e.data);return this._dataUpdateable=s(h,o)?d(h,o):void 0,h}catch{throw new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`)}if(!e.dataDiff)throw new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${e.source}`);return function(h,p,g){var v,M,A,z;if(p.removeAll&&h.clear(),p.remove)for(const I of p.remove)h.delete(I);if(p.add)for(const I of p.add){const L=i(I,g);L!=null&&h.set(L,I)}if(p.update)for(const I of p.update){let L=h.get(I.id);if(L==null)continue;const B=!I.removeAllProperties&&(((v=I.removeProperties)===null||v===void 0?void 0:v.length)>0||((M=I.addOrUpdateProperties)===null||M===void 0?void 0:M.length)>0);if((I.newGeometry||I.removeAllProperties||B)&&(L=Object.assign({},L),h.set(I.id,L),B&&(L.properties=Object.assign({},L.properties))),I.newGeometry&&(L.geometry=I.newGeometry),I.removeAllProperties)L.properties={};else if(((A=I.removeProperties)===null||A===void 0?void 0:A.length)>0)for(const j of I.removeProperties)Object.prototype.hasOwnProperty.call(L.properties,j)&&delete L.properties[j];if(((z=I.addOrUpdateProperties)===null||z===void 0?void 0:z.length)>0)for(const{key:j,value:q}of I.addOrUpdateProperties)L.properties[j]=q}}(this._dataUpdateable,e.dataDiff,o),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(e){return D(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(e){return this._geoJSONIndex.getClusterExpansionZoom(e.clusterId)}getClusterChildren(e){return this._geoJSONIndex.getChildren(e.clusterId)}getClusterLeaves(e){return this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset)}}class T{constructor(e){this.self=e,this.actor=new Io(e),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(r,o)=>{if(this.externalWorkerSourceTypes[r])throw new Error(`Worker source with name "${r}" already registered.`);this.externalWorkerSourceTypes[r]=o},this.self.addProtocol=Kn,this.self.removeProtocol=yd,this.self.registerRTLTextPlugin=r=>{Ks.setMethods(r)},this.actor.registerMessageHandler("LDT",(r,o)=>this._getDEMWorkerSource(r,o.source).loadTile(o)),this.actor.registerMessageHandler("RDT",(r,o)=>D(this,void 0,void 0,function*(){this._getDEMWorkerSource(r,o.source).removeTile(o)})),this.actor.registerMessageHandler("GCEZ",(r,o)=>D(this,void 0,void 0,function*(){return this._getWorkerSource(r,o.type,o.source).getClusterExpansionZoom(o)})),this.actor.registerMessageHandler("GCC",(r,o)=>D(this,void 0,void 0,function*(){return this._getWorkerSource(r,o.type,o.source).getClusterChildren(o)})),this.actor.registerMessageHandler("GCL",(r,o)=>D(this,void 0,void 0,function*(){return this._getWorkerSource(r,o.type,o.source).getClusterLeaves(o)})),this.actor.registerMessageHandler("LD",(r,o)=>this._getWorkerSource(r,o.type,o.source).loadData(o)),this.actor.registerMessageHandler("GD",(r,o)=>this._getWorkerSource(r,o.type,o.source).getData()),this.actor.registerMessageHandler("LT",(r,o)=>this._getWorkerSource(r,o.type,o.source).loadTile(o)),this.actor.registerMessageHandler("RT",(r,o)=>this._getWorkerSource(r,o.type,o.source).reloadTile(o)),this.actor.registerMessageHandler("AT",(r,o)=>this._getWorkerSource(r,o.type,o.source).abortTile(o)),this.actor.registerMessageHandler("RMT",(r,o)=>this._getWorkerSource(r,o.type,o.source).removeTile(o)),this.actor.registerMessageHandler("RS",(r,o)=>D(this,void 0,void 0,function*(){if(!this.workerSources[r]||!this.workerSources[r][o.type]||!this.workerSources[r][o.type][o.source])return;const h=this.workerSources[r][o.type][o.source];delete this.workerSources[r][o.type][o.source],h.removeSource!==void 0&&h.removeSource(o)})),this.actor.registerMessageHandler("RM",r=>D(this,void 0,void 0,function*(){delete this.layerIndexes[r],delete this.availableImages[r],delete this.workerSources[r],delete this.demWorkerSources[r]})),this.actor.registerMessageHandler("SR",(r,o)=>D(this,void 0,void 0,function*(){this.referrer=o})),this.actor.registerMessageHandler("SRPS",(r,o)=>this._syncRTLPluginState(r,o)),this.actor.registerMessageHandler("IS",(r,o)=>D(this,void 0,void 0,function*(){this.self.importScripts(o)})),this.actor.registerMessageHandler("SI",(r,o)=>this._setImages(r,o)),this.actor.registerMessageHandler("UL",(r,o)=>D(this,void 0,void 0,function*(){this._getLayerIndex(r).update(o.layers,o.removedIds)})),this.actor.registerMessageHandler("SL",(r,o)=>D(this,void 0,void 0,function*(){this._getLayerIndex(r).replace(o)}))}_setImages(e,r){return D(this,void 0,void 0,function*(){this.availableImages[e]=r;for(const o in this.workerSources[e]){const h=this.workerSources[e][o];for(const p in h)h[p].availableImages=r}})}_syncRTLPluginState(e,r){return D(this,void 0,void 0,function*(){return yield Ks.syncState(r,this.self.importScripts)})}_getAvailableImages(e){let r=this.availableImages[e];return r||(r=[]),r}_getLayerIndex(e){let r=this.layerIndexes[e];return r||(r=this.layerIndexes[e]=new Sc),r}_getWorkerSource(e,r,o){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][r]||(this.workerSources[e][r]={}),!this.workerSources[e][r][o]){const h={sendAsync:(p,g)=>(p.targetMapId=e,this.actor.sendAsync(p,g))};switch(r){case"vector":this.workerSources[e][r][o]=new Mf(h,this._getLayerIndex(e),this._getAvailableImages(e));break;case"geojson":this.workerSources[e][r][o]=new _(h,this._getLayerIndex(e),this._getAvailableImages(e));break;default:this.workerSources[e][r][o]=new this.externalWorkerSourceTypes[r](h,this._getLayerIndex(e),this._getAvailableImages(e))}}return this.workerSources[e][r][o]}_getDEMWorkerSource(e,r){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][r]||(this.demWorkerSources[e][r]=new Vd),this.demWorkerSources[e][r]}}return St(self)&&(self.worker=new T(self)),T}()),tg}var s_=a_();function Sg(D){var G,H,Z="";if(typeof D=="string"||typeof D=="number")Z+=D;else if(typeof D=="object")if(Array.isArray(D)){var Q=D.length;for(G=0;G<Q;G++)D[G]&&(H=Sg(D[G]))&&(Z&&(Z+=" "),Z+=H)}else for(H in D)D[H]&&(Z&&(Z+=" "),Z+=H);return Z}function o_(){for(var D,G,H=0,Z="",Q=arguments.length;H<Q;H++)(D=arguments[H])&&(G=Sg(D))&&(Z&&(Z+=" "),Z+=G);return Z}const Am="-",l_=D=>{const G=u_(D),{conflictingClassGroups:H,conflictingClassGroupModifiers:Z}=D;return{getClassGroupId:F=>{const y=F.split(Am);return y[0]===""&&y.length!==1&&y.shift(),Tg(y,G)||c_(F)},getConflictingClassGroupIds:(F,y)=>{const se=H[F]||[];return y&&Z[F]?[...se,...Z[F]]:se}}},Tg=(D,G)=>{var F;if(D.length===0)return G.classGroupId;const H=D[0],Z=G.nextPart.get(H),Q=Z?Tg(D.slice(1),Z):void 0;if(Q)return Q;if(G.validators.length===0)return;const ie=D.join(Am);return(F=G.validators.find(({validator:y})=>y(ie)))==null?void 0:F.classGroupId},rg=/^\[(.+)\]$/,c_=D=>{if(rg.test(D)){const G=rg.exec(D)[1],H=G==null?void 0:G.substring(0,G.indexOf(":"));if(H)return"arbitrary.."+H}},u_=D=>{const{theme:G,classGroups:H}=D,Z={nextPart:new Map,validators:[]};for(const Q in H)xm(H[Q],Z,Q,G);return Z},xm=(D,G,H,Z)=>{D.forEach(Q=>{if(typeof Q=="string"){const ie=Q===""?G:ng(G,Q);ie.classGroupId=H;return}if(typeof Q=="function"){if(h_(Q)){xm(Q(Z),G,H,Z);return}G.validators.push({validator:Q,classGroupId:H});return}Object.entries(Q).forEach(([ie,F])=>{xm(F,ng(G,ie),H,Z)})})},ng=(D,G)=>{let H=D;return G.split(Am).forEach(Z=>{H.nextPart.has(Z)||H.nextPart.set(Z,{nextPart:new Map,validators:[]}),H=H.nextPart.get(Z)}),H},h_=D=>D.isThemeGetter,d_=D=>{if(D<1)return{get:()=>{},set:()=>{}};let G=0,H=new Map,Z=new Map;const Q=(ie,F)=>{H.set(ie,F),G++,G>D&&(G=0,Z=H,H=new Map)};return{get(ie){let F=H.get(ie);if(F!==void 0)return F;if((F=Z.get(ie))!==void 0)return Q(ie,F),F},set(ie,F){H.has(ie)?H.set(ie,F):Q(ie,F)}}},vm="!",bm=":",f_=bm.length,p_=D=>{const{prefix:G,experimentalParseClassName:H}=D;let Z=Q=>{const ie=[];let F=0,y=0,se=0,pe;for(let wt=0;wt<Q.length;wt++){let Ut=Q[wt];if(F===0&&y===0){if(Ut===bm){ie.push(Q.slice(se,wt)),se=wt+f_;continue}if(Ut==="/"){pe=wt;continue}}Ut==="["?F++:Ut==="]"?F--:Ut==="("?y++:Ut===")"&&y--}const Ce=ie.length===0?Q:Q.substring(se),Ze=m_(Ce),Le=Ze!==Ce,Se=pe&&pe>se?pe-se:void 0;return{modifiers:ie,hasImportantModifier:Le,baseClassName:Ze,maybePostfixModifierPosition:Se}};if(G){const Q=G+bm,ie=Z;Z=F=>F.startsWith(Q)?ie(F.substring(Q.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:F,maybePostfixModifierPosition:void 0}}if(H){const Q=Z;Z=ie=>H({className:ie,parseClassName:Q})}return Z},m_=D=>D.endsWith(vm)?D.substring(0,D.length-1):D.startsWith(vm)?D.substring(1):D,g_=D=>{const G=Object.fromEntries(D.orderSensitiveModifiers.map(Z=>[Z,!0]));return Z=>{if(Z.length<=1)return Z;const Q=[];let ie=[];return Z.forEach(F=>{F[0]==="["||G[F]?(Q.push(...ie.sort(),F),ie=[]):ie.push(F)}),Q.push(...ie.sort()),Q}},y_=D=>({cache:d_(D.cacheSize),parseClassName:p_(D),sortModifiers:g_(D),...l_(D)}),__=/\s+/,x_=(D,G)=>{const{parseClassName:H,getClassGroupId:Z,getConflictingClassGroupIds:Q,sortModifiers:ie}=G,F=[],y=D.trim().split(__);let se="";for(let pe=y.length-1;pe>=0;pe-=1){const Ce=y[pe],{isExternal:Ze,modifiers:Le,hasImportantModifier:Se,baseClassName:wt,maybePostfixModifierPosition:Ut}=H(Ce);if(Ze){se=Ce+(se.length>0?" "+se:se);continue}let Et=!!Ut,Yt=Z(Et?wt.substring(0,Ut):wt);if(!Yt){if(!Et){se=Ce+(se.length>0?" "+se:se);continue}if(Yt=Z(wt),!Yt){se=Ce+(se.length>0?" "+se:se);continue}Et=!1}const Nt=ie(Le).join(":"),ot=Se?Nt+vm:Nt,St=ot+Yt;if(F.includes(St))continue;F.push(St);const Rt=Q(Yt,Et);for(let Gt=0;Gt<Rt.length;++Gt){const ti=Rt[Gt];F.push(ot+ti)}se=Ce+(se.length>0?" "+se:se)}return se};function v_(){let D=0,G,H,Z="";for(;D<arguments.length;)(G=arguments[D++])&&(H=Mg(G))&&(Z&&(Z+=" "),Z+=H);return Z}const Mg=D=>{if(typeof D=="string")return D;let G,H="";for(let Z=0;Z<D.length;Z++)D[Z]&&(G=Mg(D[Z]))&&(H&&(H+=" "),H+=G);return H};function b_(D,...G){let H,Z,Q,ie=F;function F(se){const pe=G.reduce((Ce,Ze)=>Ze(Ce),D());return H=y_(pe),Z=H.cache.get,Q=H.cache.set,ie=y,y(se)}function y(se){const pe=Z(se);if(pe)return pe;const Ce=x_(se,H);return Q(se,Ce),Ce}return function(){return ie(v_.apply(null,arguments))}}const is=D=>{const G=H=>H[D]||[];return G.isThemeGetter=!0,G},Ag=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,Cg=/^\((?:(\w[\w-]*):)?(.+)\)$/i,w_=/^\d+\/\d+$/,S_=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,T_=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,M_=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,A_=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,C_=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Bp=D=>w_.test(D),ar=D=>!!D&&!Number.isNaN(Number(D)),Df=D=>!!D&&Number.isInteger(Number(D)),gm=D=>D.endsWith("%")&&ar(D.slice(0,-1)),Qd=D=>S_.test(D),E_=()=>!0,z_=D=>T_.test(D)&&!M_.test(D),Eg=()=>!1,P_=D=>A_.test(D),I_=D=>C_.test(D),k_=D=>!Jt(D)&&!ei(D),R_=D=>Vp(D,Ig,Eg),Jt=D=>Ag.test(D),gp=D=>Vp(D,kg,z_),ym=D=>Vp(D,F_,ar),ag=D=>Vp(D,zg,Eg),D_=D=>Vp(D,Pg,I_),Qp=D=>Vp(D,Rg,P_),ei=D=>Cg.test(D),Yp=D=>Up(D,kg),L_=D=>Up(D,j_),sg=D=>Up(D,zg),B_=D=>Up(D,Ig),O_=D=>Up(D,Pg),Jp=D=>Up(D,Rg,!0),Vp=(D,G,H)=>{const Z=Ag.exec(D);return Z?Z[1]?G(Z[1]):H(Z[2]):!1},Up=(D,G,H=!1)=>{const Z=Cg.exec(D);return Z?Z[1]?G(Z[1]):H:!1},zg=D=>D==="position"||D==="percentage",Pg=D=>D==="image"||D==="url",Ig=D=>D==="length"||D==="size"||D==="bg-size",kg=D=>D==="length",F_=D=>D==="number",j_=D=>D==="family-name",Rg=D=>D==="shadow",N_=()=>{const D=is("color"),G=is("font"),H=is("text"),Z=is("font-weight"),Q=is("tracking"),ie=is("leading"),F=is("breakpoint"),y=is("container"),se=is("spacing"),pe=is("radius"),Ce=is("shadow"),Ze=is("inset-shadow"),Le=is("text-shadow"),Se=is("drop-shadow"),wt=is("blur"),Ut=is("perspective"),Et=is("aspect"),Yt=is("ease"),Nt=is("animate"),ot=()=>["auto","avoid","all","avoid-page","page","left","right","column"],St=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],Rt=()=>[...St(),ei,Jt],Gt=()=>["auto","hidden","clip","visible","scroll"],ti=()=>["auto","contain","none"],zt=()=>[ei,Jt,se],ui=()=>[Bp,"full","auto",...zt()],Pi=()=>[Df,"none","subgrid",ei,Jt],$e=()=>["auto",{span:["full",Df,ei,Jt]},Df,ei,Jt],Ji=()=>[Df,"auto",ei,Jt],ft=()=>["auto","min","max","fr",ei,Jt],fn=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],Ri=()=>["start","end","center","stretch","center-safe","end-safe"],Qe=()=>["auto",...zt()],bt=()=>[Bp,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...zt()],Be=()=>[D,ei,Jt],_t=()=>[...St(),sg,ag,{position:[ei,Jt]}],_e=()=>["no-repeat",{repeat:["","x","y","space","round"]}],rt=()=>["auto","cover","contain",B_,R_,{size:[ei,Jt]}],It=()=>[gm,Yp,gp],mt=()=>["","none","full",pe,ei,Jt],ut=()=>["",ar,Yp,gp],bi=()=>["solid","dashed","dotted","double"],Zt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Di=()=>[ar,gm,sg,ag],Ei=()=>["","none",wt,ei,Jt],kr=()=>["none",ar,ei,Jt],jn=()=>["none",ar,ei,Jt],Hn=()=>[ar,ei,Jt],sr=()=>[Bp,"full",...zt()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Qd],breakpoint:[Qd],color:[E_],container:[Qd],"drop-shadow":[Qd],ease:["in","out","in-out"],font:[k_],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Qd],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Qd],shadow:[Qd],spacing:["px",ar],text:[Qd],"text-shadow":[Qd],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Bp,Jt,ei,Et]}],container:["container"],columns:[{columns:[ar,Jt,ei,y]}],"break-after":[{"break-after":ot()}],"break-before":[{"break-before":ot()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:Rt()}],overflow:[{overflow:Gt()}],"overflow-x":[{"overflow-x":Gt()}],"overflow-y":[{"overflow-y":Gt()}],overscroll:[{overscroll:ti()}],"overscroll-x":[{"overscroll-x":ti()}],"overscroll-y":[{"overscroll-y":ti()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:ui()}],"inset-x":[{"inset-x":ui()}],"inset-y":[{"inset-y":ui()}],start:[{start:ui()}],end:[{end:ui()}],top:[{top:ui()}],right:[{right:ui()}],bottom:[{bottom:ui()}],left:[{left:ui()}],visibility:["visible","invisible","collapse"],z:[{z:[Df,"auto",ei,Jt]}],basis:[{basis:[Bp,"full","auto",y,...zt()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[ar,Bp,"auto","initial","none",Jt]}],grow:[{grow:["",ar,ei,Jt]}],shrink:[{shrink:["",ar,ei,Jt]}],order:[{order:[Df,"first","last","none",ei,Jt]}],"grid-cols":[{"grid-cols":Pi()}],"col-start-end":[{col:$e()}],"col-start":[{"col-start":Ji()}],"col-end":[{"col-end":Ji()}],"grid-rows":[{"grid-rows":Pi()}],"row-start-end":[{row:$e()}],"row-start":[{"row-start":Ji()}],"row-end":[{"row-end":Ji()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":ft()}],"auto-rows":[{"auto-rows":ft()}],gap:[{gap:zt()}],"gap-x":[{"gap-x":zt()}],"gap-y":[{"gap-y":zt()}],"justify-content":[{justify:[...fn(),"normal"]}],"justify-items":[{"justify-items":[...Ri(),"normal"]}],"justify-self":[{"justify-self":["auto",...Ri()]}],"align-content":[{content:["normal",...fn()]}],"align-items":[{items:[...Ri(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...Ri(),{baseline:["","last"]}]}],"place-content":[{"place-content":fn()}],"place-items":[{"place-items":[...Ri(),"baseline"]}],"place-self":[{"place-self":["auto",...Ri()]}],p:[{p:zt()}],px:[{px:zt()}],py:[{py:zt()}],ps:[{ps:zt()}],pe:[{pe:zt()}],pt:[{pt:zt()}],pr:[{pr:zt()}],pb:[{pb:zt()}],pl:[{pl:zt()}],m:[{m:Qe()}],mx:[{mx:Qe()}],my:[{my:Qe()}],ms:[{ms:Qe()}],me:[{me:Qe()}],mt:[{mt:Qe()}],mr:[{mr:Qe()}],mb:[{mb:Qe()}],ml:[{ml:Qe()}],"space-x":[{"space-x":zt()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":zt()}],"space-y-reverse":["space-y-reverse"],size:[{size:bt()}],w:[{w:[y,"screen",...bt()]}],"min-w":[{"min-w":[y,"screen","none",...bt()]}],"max-w":[{"max-w":[y,"screen","none","prose",{screen:[F]},...bt()]}],h:[{h:["screen","lh",...bt()]}],"min-h":[{"min-h":["screen","lh","none",...bt()]}],"max-h":[{"max-h":["screen","lh",...bt()]}],"font-size":[{text:["base",H,Yp,gp]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[Z,ei,ym]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",gm,Jt]}],"font-family":[{font:[L_,Jt,G]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[Q,ei,Jt]}],"line-clamp":[{"line-clamp":[ar,"none",ei,ym]}],leading:[{leading:[ie,...zt()]}],"list-image":[{"list-image":["none",ei,Jt]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",ei,Jt]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:Be()}],"text-color":[{text:Be()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...bi(),"wavy"]}],"text-decoration-thickness":[{decoration:[ar,"from-font","auto",ei,gp]}],"text-decoration-color":[{decoration:Be()}],"underline-offset":[{"underline-offset":[ar,"auto",ei,Jt]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:zt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ei,Jt]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ei,Jt]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:_t()}],"bg-repeat":[{bg:_e()}],"bg-size":[{bg:rt()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Df,ei,Jt],radial:["",ei,Jt],conic:[Df,ei,Jt]},O_,D_]}],"bg-color":[{bg:Be()}],"gradient-from-pos":[{from:It()}],"gradient-via-pos":[{via:It()}],"gradient-to-pos":[{to:It()}],"gradient-from":[{from:Be()}],"gradient-via":[{via:Be()}],"gradient-to":[{to:Be()}],rounded:[{rounded:mt()}],"rounded-s":[{"rounded-s":mt()}],"rounded-e":[{"rounded-e":mt()}],"rounded-t":[{"rounded-t":mt()}],"rounded-r":[{"rounded-r":mt()}],"rounded-b":[{"rounded-b":mt()}],"rounded-l":[{"rounded-l":mt()}],"rounded-ss":[{"rounded-ss":mt()}],"rounded-se":[{"rounded-se":mt()}],"rounded-ee":[{"rounded-ee":mt()}],"rounded-es":[{"rounded-es":mt()}],"rounded-tl":[{"rounded-tl":mt()}],"rounded-tr":[{"rounded-tr":mt()}],"rounded-br":[{"rounded-br":mt()}],"rounded-bl":[{"rounded-bl":mt()}],"border-w":[{border:ut()}],"border-w-x":[{"border-x":ut()}],"border-w-y":[{"border-y":ut()}],"border-w-s":[{"border-s":ut()}],"border-w-e":[{"border-e":ut()}],"border-w-t":[{"border-t":ut()}],"border-w-r":[{"border-r":ut()}],"border-w-b":[{"border-b":ut()}],"border-w-l":[{"border-l":ut()}],"divide-x":[{"divide-x":ut()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":ut()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...bi(),"hidden","none"]}],"divide-style":[{divide:[...bi(),"hidden","none"]}],"border-color":[{border:Be()}],"border-color-x":[{"border-x":Be()}],"border-color-y":[{"border-y":Be()}],"border-color-s":[{"border-s":Be()}],"border-color-e":[{"border-e":Be()}],"border-color-t":[{"border-t":Be()}],"border-color-r":[{"border-r":Be()}],"border-color-b":[{"border-b":Be()}],"border-color-l":[{"border-l":Be()}],"divide-color":[{divide:Be()}],"outline-style":[{outline:[...bi(),"none","hidden"]}],"outline-offset":[{"outline-offset":[ar,ei,Jt]}],"outline-w":[{outline:["",ar,Yp,gp]}],"outline-color":[{outline:Be()}],shadow:[{shadow:["","none",Ce,Jp,Qp]}],"shadow-color":[{shadow:Be()}],"inset-shadow":[{"inset-shadow":["none",Ze,Jp,Qp]}],"inset-shadow-color":[{"inset-shadow":Be()}],"ring-w":[{ring:ut()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:Be()}],"ring-offset-w":[{"ring-offset":[ar,gp]}],"ring-offset-color":[{"ring-offset":Be()}],"inset-ring-w":[{"inset-ring":ut()}],"inset-ring-color":[{"inset-ring":Be()}],"text-shadow":[{"text-shadow":["none",Le,Jp,Qp]}],"text-shadow-color":[{"text-shadow":Be()}],opacity:[{opacity:[ar,ei,Jt]}],"mix-blend":[{"mix-blend":[...Zt(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Zt()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[ar]}],"mask-image-linear-from-pos":[{"mask-linear-from":Di()}],"mask-image-linear-to-pos":[{"mask-linear-to":Di()}],"mask-image-linear-from-color":[{"mask-linear-from":Be()}],"mask-image-linear-to-color":[{"mask-linear-to":Be()}],"mask-image-t-from-pos":[{"mask-t-from":Di()}],"mask-image-t-to-pos":[{"mask-t-to":Di()}],"mask-image-t-from-color":[{"mask-t-from":Be()}],"mask-image-t-to-color":[{"mask-t-to":Be()}],"mask-image-r-from-pos":[{"mask-r-from":Di()}],"mask-image-r-to-pos":[{"mask-r-to":Di()}],"mask-image-r-from-color":[{"mask-r-from":Be()}],"mask-image-r-to-color":[{"mask-r-to":Be()}],"mask-image-b-from-pos":[{"mask-b-from":Di()}],"mask-image-b-to-pos":[{"mask-b-to":Di()}],"mask-image-b-from-color":[{"mask-b-from":Be()}],"mask-image-b-to-color":[{"mask-b-to":Be()}],"mask-image-l-from-pos":[{"mask-l-from":Di()}],"mask-image-l-to-pos":[{"mask-l-to":Di()}],"mask-image-l-from-color":[{"mask-l-from":Be()}],"mask-image-l-to-color":[{"mask-l-to":Be()}],"mask-image-x-from-pos":[{"mask-x-from":Di()}],"mask-image-x-to-pos":[{"mask-x-to":Di()}],"mask-image-x-from-color":[{"mask-x-from":Be()}],"mask-image-x-to-color":[{"mask-x-to":Be()}],"mask-image-y-from-pos":[{"mask-y-from":Di()}],"mask-image-y-to-pos":[{"mask-y-to":Di()}],"mask-image-y-from-color":[{"mask-y-from":Be()}],"mask-image-y-to-color":[{"mask-y-to":Be()}],"mask-image-radial":[{"mask-radial":[ei,Jt]}],"mask-image-radial-from-pos":[{"mask-radial-from":Di()}],"mask-image-radial-to-pos":[{"mask-radial-to":Di()}],"mask-image-radial-from-color":[{"mask-radial-from":Be()}],"mask-image-radial-to-color":[{"mask-radial-to":Be()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":St()}],"mask-image-conic-pos":[{"mask-conic":[ar]}],"mask-image-conic-from-pos":[{"mask-conic-from":Di()}],"mask-image-conic-to-pos":[{"mask-conic-to":Di()}],"mask-image-conic-from-color":[{"mask-conic-from":Be()}],"mask-image-conic-to-color":[{"mask-conic-to":Be()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:_t()}],"mask-repeat":[{mask:_e()}],"mask-size":[{mask:rt()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",ei,Jt]}],filter:[{filter:["","none",ei,Jt]}],blur:[{blur:Ei()}],brightness:[{brightness:[ar,ei,Jt]}],contrast:[{contrast:[ar,ei,Jt]}],"drop-shadow":[{"drop-shadow":["","none",Se,Jp,Qp]}],"drop-shadow-color":[{"drop-shadow":Be()}],grayscale:[{grayscale:["",ar,ei,Jt]}],"hue-rotate":[{"hue-rotate":[ar,ei,Jt]}],invert:[{invert:["",ar,ei,Jt]}],saturate:[{saturate:[ar,ei,Jt]}],sepia:[{sepia:["",ar,ei,Jt]}],"backdrop-filter":[{"backdrop-filter":["","none",ei,Jt]}],"backdrop-blur":[{"backdrop-blur":Ei()}],"backdrop-brightness":[{"backdrop-brightness":[ar,ei,Jt]}],"backdrop-contrast":[{"backdrop-contrast":[ar,ei,Jt]}],"backdrop-grayscale":[{"backdrop-grayscale":["",ar,ei,Jt]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[ar,ei,Jt]}],"backdrop-invert":[{"backdrop-invert":["",ar,ei,Jt]}],"backdrop-opacity":[{"backdrop-opacity":[ar,ei,Jt]}],"backdrop-saturate":[{"backdrop-saturate":[ar,ei,Jt]}],"backdrop-sepia":[{"backdrop-sepia":["",ar,ei,Jt]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":zt()}],"border-spacing-x":[{"border-spacing-x":zt()}],"border-spacing-y":[{"border-spacing-y":zt()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",ei,Jt]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[ar,"initial",ei,Jt]}],ease:[{ease:["linear","initial",Yt,ei,Jt]}],delay:[{delay:[ar,ei,Jt]}],animate:[{animate:["none",Nt,ei,Jt]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[Ut,ei,Jt]}],"perspective-origin":[{"perspective-origin":Rt()}],rotate:[{rotate:kr()}],"rotate-x":[{"rotate-x":kr()}],"rotate-y":[{"rotate-y":kr()}],"rotate-z":[{"rotate-z":kr()}],scale:[{scale:jn()}],"scale-x":[{"scale-x":jn()}],"scale-y":[{"scale-y":jn()}],"scale-z":[{"scale-z":jn()}],"scale-3d":["scale-3d"],skew:[{skew:Hn()}],"skew-x":[{"skew-x":Hn()}],"skew-y":[{"skew-y":Hn()}],transform:[{transform:[ei,Jt,"","none","gpu","cpu"]}],"transform-origin":[{origin:Rt()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:sr()}],"translate-x":[{"translate-x":sr()}],"translate-y":[{"translate-y":sr()}],"translate-z":[{"translate-z":sr()}],"translate-none":["translate-none"],accent:[{accent:Be()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:Be()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ei,Jt]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":zt()}],"scroll-mx":[{"scroll-mx":zt()}],"scroll-my":[{"scroll-my":zt()}],"scroll-ms":[{"scroll-ms":zt()}],"scroll-me":[{"scroll-me":zt()}],"scroll-mt":[{"scroll-mt":zt()}],"scroll-mr":[{"scroll-mr":zt()}],"scroll-mb":[{"scroll-mb":zt()}],"scroll-ml":[{"scroll-ml":zt()}],"scroll-p":[{"scroll-p":zt()}],"scroll-px":[{"scroll-px":zt()}],"scroll-py":[{"scroll-py":zt()}],"scroll-ps":[{"scroll-ps":zt()}],"scroll-pe":[{"scroll-pe":zt()}],"scroll-pt":[{"scroll-pt":zt()}],"scroll-pr":[{"scroll-pr":zt()}],"scroll-pb":[{"scroll-pb":zt()}],"scroll-pl":[{"scroll-pl":zt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ei,Jt]}],fill:[{fill:["none",...Be()]}],"stroke-w":[{stroke:[ar,Yp,gp,ym]}],stroke:[{stroke:["none",...Be()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},V_=b_(N_);function cd(...D){return V_(o_(D))}function U_({className:D,type:G,...H}){return dt.jsx("input",{type:G,"data-slot":"input",className:cd("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",D),...H})}function og(D,G){if(typeof D=="function")return D(G);D!=null&&(D.current=G)}function Dg(...D){return G=>{let H=!1;const Z=D.map(Q=>{const ie=og(Q,G);return!H&&typeof ie=="function"&&(H=!0),ie});if(H)return()=>{for(let Q=0;Q<Z.length;Q++){const ie=Z[Q];typeof ie=="function"?ie():og(D[Q],null)}}}}function Su(...D){return De.useCallback(Dg(...D),D)}function wm(D){const G=G_(D),H=De.forwardRef((Z,Q)=>{const{children:ie,...F}=Z,y=De.Children.toArray(ie),se=y.find(Z_);if(se){const pe=se.props.children,Ce=y.map(Ze=>Ze===se?De.Children.count(pe)>1?De.Children.only(null):De.isValidElement(pe)?pe.props.children:null:Ze);return dt.jsx(G,{...F,ref:Q,children:De.isValidElement(pe)?De.cloneElement(pe,void 0,Ce):null})}return dt.jsx(G,{...F,ref:Q,children:ie})});return H.displayName=`${D}.Slot`,H}function G_(D){const G=De.forwardRef((H,Z)=>{const{children:Q,...ie}=H;if(De.isValidElement(Q)){const F=H_(Q),y=$_(ie,Q.props);return Q.type!==De.Fragment&&(y.ref=Z?Dg(Z,F):F),De.cloneElement(Q,y)}return De.Children.count(Q)>1?De.Children.only(null):null});return G.displayName=`${D}.SlotClone`,G}var q_=Symbol("radix.slottable");function Z_(D){return De.isValidElement(D)&&typeof D.type=="function"&&"__radixId"in D.type&&D.type.__radixId===q_}function $_(D,G){const H={...G};for(const Z in G){const Q=D[Z],ie=G[Z];/^on[A-Z]/.test(Z)?Q&&ie?H[Z]=(...y)=>{const se=ie(...y);return Q(...y),se}:Q&&(H[Z]=Q):Z==="style"?H[Z]={...Q,...ie}:Z==="className"&&(H[Z]=[Q,ie].filter(Boolean).join(" "))}return{...D,...H}}function H_(D){var Z,Q;let G=(Z=Object.getOwnPropertyDescriptor(D.props,"ref"))==null?void 0:Z.get,H=G&&"isReactWarning"in G&&G.isReactWarning;return H?D.ref:(G=(Q=Object.getOwnPropertyDescriptor(D,"ref"))==null?void 0:Q.get,H=G&&"isReactWarning"in G&&G.isReactWarning,H?D.props.ref:D.props.ref||D.ref)}var X_=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Nl=X_.reduce((D,G)=>{const H=wm(`Primitive.${G}`),Z=De.forwardRef((Q,ie)=>{const{asChild:F,...y}=Q,se=F?H:G;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),dt.jsx(se,{...y,ref:ie})});return Z.displayName=`Primitive.${G}`,{...D,[G]:Z}},{}),Fp=globalThis!=null&&globalThis.document?De.useLayoutEffect:()=>{};function Y_(D,G){return De.useReducer((H,Z)=>G[H][Z]??H,D)}var Gp=D=>{const{present:G,children:H}=D,Z=W_(G),Q=typeof H=="function"?H({present:Z.isPresent}):De.Children.only(H),ie=Su(Z.ref,K_(Q));return typeof H=="function"||Z.isPresent?De.cloneElement(Q,{ref:ie}):null};Gp.displayName="Presence";function W_(D){const[G,H]=De.useState(),Z=De.useRef(null),Q=De.useRef(D),ie=De.useRef("none"),F=D?"mounted":"unmounted",[y,se]=Y_(F,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return De.useEffect(()=>{const pe=em(Z.current);ie.current=y==="mounted"?pe:"none"},[y]),Fp(()=>{const pe=Z.current,Ce=Q.current;if(Ce!==D){const Le=ie.current,Se=em(pe);D?se("MOUNT"):Se==="none"||(pe==null?void 0:pe.display)==="none"?se("UNMOUNT"):se(Ce&&Le!==Se?"ANIMATION_OUT":"UNMOUNT"),Q.current=D}},[D,se]),Fp(()=>{if(G){let pe;const Ce=G.ownerDocument.defaultView??window,Ze=Se=>{const Ut=em(Z.current).includes(Se.animationName);if(Se.target===G&&Ut&&(se("ANIMATION_END"),!Q.current)){const Et=G.style.animationFillMode;G.style.animationFillMode="forwards",pe=Ce.setTimeout(()=>{G.style.animationFillMode==="forwards"&&(G.style.animationFillMode=Et)})}},Le=Se=>{Se.target===G&&(ie.current=em(Z.current))};return G.addEventListener("animationstart",Le),G.addEventListener("animationcancel",Ze),G.addEventListener("animationend",Ze),()=>{Ce.clearTimeout(pe),G.removeEventListener("animationstart",Le),G.removeEventListener("animationcancel",Ze),G.removeEventListener("animationend",Ze)}}else se("ANIMATION_END")},[G,se]),{isPresent:["mounted","unmountSuspended"].includes(y),ref:De.useCallback(pe=>{Z.current=pe?getComputedStyle(pe):null,H(pe)},[])}}function em(D){return(D==null?void 0:D.animationName)||"none"}function K_(D){var Z,Q;let G=(Z=Object.getOwnPropertyDescriptor(D.props,"ref"))==null?void 0:Z.get,H=G&&"isReactWarning"in G&&G.isReactWarning;return H?D.ref:(G=(Q=Object.getOwnPropertyDescriptor(D,"ref"))==null?void 0:Q.get,H=G&&"isReactWarning"in G&&G.isReactWarning,H?D.props.ref:D.props.ref||D.ref)}function Wp(D,G=[]){let H=[];function Z(ie,F){const y=De.createContext(F),se=H.length;H=[...H,F];const pe=Ze=>{var Yt;const{scope:Le,children:Se,...wt}=Ze,Ut=((Yt=Le==null?void 0:Le[D])==null?void 0:Yt[se])||y,Et=De.useMemo(()=>wt,Object.values(wt));return dt.jsx(Ut.Provider,{value:Et,children:Se})};pe.displayName=ie+"Provider";function Ce(Ze,Le){var Ut;const Se=((Ut=Le==null?void 0:Le[D])==null?void 0:Ut[se])||y,wt=De.useContext(Se);if(wt)return wt;if(F!==void 0)return F;throw new Error(`\`${Ze}\` must be used within \`${ie}\``)}return[pe,Ce]}const Q=()=>{const ie=H.map(F=>De.createContext(F));return function(y){const se=(y==null?void 0:y[D])||ie;return De.useMemo(()=>({[`__scope${D}`]:{...y,[D]:se}}),[y,se])}};return Q.scopeName=D,[Z,Q_(Q,...G)]}function Q_(...D){const G=D[0];if(D.length===1)return G;const H=()=>{const Z=D.map(Q=>({useScope:Q(),scopeName:Q.scopeName}));return function(ie){const F=Z.reduce((y,{useScope:se,scopeName:pe})=>{const Ze=se(ie)[`__scope${pe}`];return{...y,...Ze}},{});return De.useMemo(()=>({[`__scope${G.scopeName}`]:F}),[F])}};return H.scopeName=G.scopeName,H}function Bf(D){const G=De.useRef(D);return De.useEffect(()=>{G.current=D}),De.useMemo(()=>(...H)=>{var Z;return(Z=G.current)==null?void 0:Z.call(G,...H)},[])}var J_=De.createContext(void 0);function Cm(D){const G=De.useContext(J_);return D||G||"ltr"}function ex(D,[G,H]){return Math.min(H,Math.max(G,D))}function js(D,G,{checkForDefaultPrevented:H=!0}={}){return function(Q){if(D==null||D(Q),H===!1||!Q.defaultPrevented)return G==null?void 0:G(Q)}}function tx(D,G){return De.useReducer((H,Z)=>G[H][Z]??H,D)}var Em="ScrollArea",[Lg,ev]=Wp(Em),[ix,Tu]=Lg(Em),Bg=De.forwardRef((D,G)=>{const{__scopeScrollArea:H,type:Z="hover",dir:Q,scrollHideDelay:ie=600,...F}=D,[y,se]=De.useState(null),[pe,Ce]=De.useState(null),[Ze,Le]=De.useState(null),[Se,wt]=De.useState(null),[Ut,Et]=De.useState(null),[Yt,Nt]=De.useState(0),[ot,St]=De.useState(0),[Rt,Gt]=De.useState(!1),[ti,zt]=De.useState(!1),ui=Su(G,$e=>se($e)),Pi=Cm(Q);return dt.jsx(ix,{scope:H,type:Z,dir:Pi,scrollHideDelay:ie,scrollArea:y,viewport:pe,onViewportChange:Ce,content:Ze,onContentChange:Le,scrollbarX:Se,onScrollbarXChange:wt,scrollbarXEnabled:Rt,onScrollbarXEnabledChange:Gt,scrollbarY:Ut,onScrollbarYChange:Et,scrollbarYEnabled:ti,onScrollbarYEnabledChange:zt,onCornerWidthChange:Nt,onCornerHeightChange:St,children:dt.jsx(Nl.div,{dir:Pi,...F,ref:ui,style:{position:"relative","--radix-scroll-area-corner-width":Yt+"px","--radix-scroll-area-corner-height":ot+"px",...D.style}})})});Bg.displayName=Em;var Og="ScrollAreaViewport",Fg=De.forwardRef((D,G)=>{const{__scopeScrollArea:H,children:Z,nonce:Q,...ie}=D,F=Tu(Og,H),y=De.useRef(null),se=Su(G,y,F.onViewportChange);return dt.jsxs(dt.Fragment,{children:[dt.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:Q}),dt.jsx(Nl.div,{"data-radix-scroll-area-viewport":"",...ie,ref:se,style:{overflowX:F.scrollbarXEnabled?"scroll":"hidden",overflowY:F.scrollbarYEnabled?"scroll":"hidden",...D.style},children:dt.jsx("div",{ref:F.onContentChange,style:{minWidth:"100%",display:"table"},children:Z})})]})});Fg.displayName=Og;var ud="ScrollAreaScrollbar",jg=De.forwardRef((D,G)=>{const{forceMount:H,...Z}=D,Q=Tu(ud,D.__scopeScrollArea),{onScrollbarXEnabledChange:ie,onScrollbarYEnabledChange:F}=Q,y=D.orientation==="horizontal";return De.useEffect(()=>(y?ie(!0):F(!0),()=>{y?ie(!1):F(!1)}),[y,ie,F]),Q.type==="hover"?dt.jsx(rx,{...Z,ref:G,forceMount:H}):Q.type==="scroll"?dt.jsx(nx,{...Z,ref:G,forceMount:H}):Q.type==="auto"?dt.jsx(Ng,{...Z,ref:G,forceMount:H}):Q.type==="always"?dt.jsx(zm,{...Z,ref:G}):null});jg.displayName=ud;var rx=De.forwardRef((D,G)=>{const{forceMount:H,...Z}=D,Q=Tu(ud,D.__scopeScrollArea),[ie,F]=De.useState(!1);return De.useEffect(()=>{const y=Q.scrollArea;let se=0;if(y){const pe=()=>{window.clearTimeout(se),F(!0)},Ce=()=>{se=window.setTimeout(()=>F(!1),Q.scrollHideDelay)};return y.addEventListener("pointerenter",pe),y.addEventListener("pointerleave",Ce),()=>{window.clearTimeout(se),y.removeEventListener("pointerenter",pe),y.removeEventListener("pointerleave",Ce)}}},[Q.scrollArea,Q.scrollHideDelay]),dt.jsx(Gp,{present:H||ie,children:dt.jsx(Ng,{"data-state":ie?"visible":"hidden",...Z,ref:G})})}),nx=De.forwardRef((D,G)=>{const{forceMount:H,...Z}=D,Q=Tu(ud,D.__scopeScrollArea),ie=D.orientation==="horizontal",F=om(()=>se("SCROLL_END"),100),[y,se]=tx("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return De.useEffect(()=>{if(y==="idle"){const pe=window.setTimeout(()=>se("HIDE"),Q.scrollHideDelay);return()=>window.clearTimeout(pe)}},[y,Q.scrollHideDelay,se]),De.useEffect(()=>{const pe=Q.viewport,Ce=ie?"scrollLeft":"scrollTop";if(pe){let Ze=pe[Ce];const Le=()=>{const Se=pe[Ce];Ze!==Se&&(se("SCROLL"),F()),Ze=Se};return pe.addEventListener("scroll",Le),()=>pe.removeEventListener("scroll",Le)}},[Q.viewport,ie,se,F]),dt.jsx(Gp,{present:H||y!=="hidden",children:dt.jsx(zm,{"data-state":y==="hidden"?"hidden":"visible",...Z,ref:G,onPointerEnter:js(D.onPointerEnter,()=>se("POINTER_ENTER")),onPointerLeave:js(D.onPointerLeave,()=>se("POINTER_LEAVE"))})})}),Ng=De.forwardRef((D,G)=>{const H=Tu(ud,D.__scopeScrollArea),{forceMount:Z,...Q}=D,[ie,F]=De.useState(!1),y=D.orientation==="horizontal",se=om(()=>{if(H.viewport){const pe=H.viewport.offsetWidth<H.viewport.scrollWidth,Ce=H.viewport.offsetHeight<H.viewport.scrollHeight;F(y?pe:Ce)}},10);return jp(H.viewport,se),jp(H.content,se),dt.jsx(Gp,{present:Z||ie,children:dt.jsx(zm,{"data-state":ie?"visible":"hidden",...Q,ref:G})})}),zm=De.forwardRef((D,G)=>{const{orientation:H="vertical",...Z}=D,Q=Tu(ud,D.__scopeScrollArea),ie=De.useRef(null),F=De.useRef(0),[y,se]=De.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),pe=Zg(y.viewport,y.content),Ce={...Z,sizes:y,onSizesChange:se,hasThumb:pe>0&&pe<1,onThumbChange:Le=>ie.current=Le,onThumbPointerUp:()=>F.current=0,onThumbPointerDown:Le=>F.current=Le};function Ze(Le,Se){return ux(Le,F.current,y,Se)}return H==="horizontal"?dt.jsx(ax,{...Ce,ref:G,onThumbPositionChange:()=>{if(Q.viewport&&ie.current){const Le=Q.viewport.scrollLeft,Se=lg(Le,y,Q.dir);ie.current.style.transform=`translate3d(${Se}px, 0, 0)`}},onWheelScroll:Le=>{Q.viewport&&(Q.viewport.scrollLeft=Le)},onDragScroll:Le=>{Q.viewport&&(Q.viewport.scrollLeft=Ze(Le,Q.dir))}}):H==="vertical"?dt.jsx(sx,{...Ce,ref:G,onThumbPositionChange:()=>{if(Q.viewport&&ie.current){const Le=Q.viewport.scrollTop,Se=lg(Le,y);ie.current.style.transform=`translate3d(0, ${Se}px, 0)`}},onWheelScroll:Le=>{Q.viewport&&(Q.viewport.scrollTop=Le)},onDragScroll:Le=>{Q.viewport&&(Q.viewport.scrollTop=Ze(Le))}}):null}),ax=De.forwardRef((D,G)=>{const{sizes:H,onSizesChange:Z,...Q}=D,ie=Tu(ud,D.__scopeScrollArea),[F,y]=De.useState(),se=De.useRef(null),pe=Su(G,se,ie.onScrollbarXChange);return De.useEffect(()=>{se.current&&y(getComputedStyle(se.current))},[se]),dt.jsx(Ug,{"data-orientation":"horizontal",...Q,ref:pe,sizes:H,style:{bottom:0,left:ie.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:ie.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":sm(H)+"px",...D.style},onThumbPointerDown:Ce=>D.onThumbPointerDown(Ce.x),onDragScroll:Ce=>D.onDragScroll(Ce.x),onWheelScroll:(Ce,Ze)=>{if(ie.viewport){const Le=ie.viewport.scrollLeft+Ce.deltaX;D.onWheelScroll(Le),Hg(Le,Ze)&&Ce.preventDefault()}},onResize:()=>{se.current&&ie.viewport&&F&&Z({content:ie.viewport.scrollWidth,viewport:ie.viewport.offsetWidth,scrollbar:{size:se.current.clientWidth,paddingStart:am(F.paddingLeft),paddingEnd:am(F.paddingRight)}})}})}),sx=De.forwardRef((D,G)=>{const{sizes:H,onSizesChange:Z,...Q}=D,ie=Tu(ud,D.__scopeScrollArea),[F,y]=De.useState(),se=De.useRef(null),pe=Su(G,se,ie.onScrollbarYChange);return De.useEffect(()=>{se.current&&y(getComputedStyle(se.current))},[se]),dt.jsx(Ug,{"data-orientation":"vertical",...Q,ref:pe,sizes:H,style:{top:0,right:ie.dir==="ltr"?0:void 0,left:ie.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":sm(H)+"px",...D.style},onThumbPointerDown:Ce=>D.onThumbPointerDown(Ce.y),onDragScroll:Ce=>D.onDragScroll(Ce.y),onWheelScroll:(Ce,Ze)=>{if(ie.viewport){const Le=ie.viewport.scrollTop+Ce.deltaY;D.onWheelScroll(Le),Hg(Le,Ze)&&Ce.preventDefault()}},onResize:()=>{se.current&&ie.viewport&&F&&Z({content:ie.viewport.scrollHeight,viewport:ie.viewport.offsetHeight,scrollbar:{size:se.current.clientHeight,paddingStart:am(F.paddingTop),paddingEnd:am(F.paddingBottom)}})}})}),[ox,Vg]=Lg(ud),Ug=De.forwardRef((D,G)=>{const{__scopeScrollArea:H,sizes:Z,hasThumb:Q,onThumbChange:ie,onThumbPointerUp:F,onThumbPointerDown:y,onThumbPositionChange:se,onDragScroll:pe,onWheelScroll:Ce,onResize:Ze,...Le}=D,Se=Tu(ud,H),[wt,Ut]=De.useState(null),Et=Su(G,ui=>Ut(ui)),Yt=De.useRef(null),Nt=De.useRef(""),ot=Se.viewport,St=Z.content-Z.viewport,Rt=Bf(Ce),Gt=Bf(se),ti=om(Ze,10);function zt(ui){if(Yt.current){const Pi=ui.clientX-Yt.current.left,$e=ui.clientY-Yt.current.top;pe({x:Pi,y:$e})}}return De.useEffect(()=>{const ui=Pi=>{const $e=Pi.target;(wt==null?void 0:wt.contains($e))&&Rt(Pi,St)};return document.addEventListener("wheel",ui,{passive:!1}),()=>document.removeEventListener("wheel",ui,{passive:!1})},[ot,wt,St,Rt]),De.useEffect(Gt,[Z,Gt]),jp(wt,ti),jp(Se.content,ti),dt.jsx(ox,{scope:H,scrollbar:wt,hasThumb:Q,onThumbChange:Bf(ie),onThumbPointerUp:Bf(F),onThumbPositionChange:Gt,onThumbPointerDown:Bf(y),children:dt.jsx(Nl.div,{...Le,ref:Et,style:{position:"absolute",...Le.style},onPointerDown:js(D.onPointerDown,ui=>{ui.button===0&&(ui.target.setPointerCapture(ui.pointerId),Yt.current=wt.getBoundingClientRect(),Nt.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",Se.viewport&&(Se.viewport.style.scrollBehavior="auto"),zt(ui))}),onPointerMove:js(D.onPointerMove,zt),onPointerUp:js(D.onPointerUp,ui=>{const Pi=ui.target;Pi.hasPointerCapture(ui.pointerId)&&Pi.releasePointerCapture(ui.pointerId),document.body.style.webkitUserSelect=Nt.current,Se.viewport&&(Se.viewport.style.scrollBehavior=""),Yt.current=null})})})}),nm="ScrollAreaThumb",Gg=De.forwardRef((D,G)=>{const{forceMount:H,...Z}=D,Q=Vg(nm,D.__scopeScrollArea);return dt.jsx(Gp,{present:H||Q.hasThumb,children:dt.jsx(lx,{ref:G,...Z})})}),lx=De.forwardRef((D,G)=>{const{__scopeScrollArea:H,style:Z,...Q}=D,ie=Tu(nm,H),F=Vg(nm,H),{onThumbPositionChange:y}=F,se=Su(G,Ze=>F.onThumbChange(Ze)),pe=De.useRef(void 0),Ce=om(()=>{pe.current&&(pe.current(),pe.current=void 0)},100);return De.useEffect(()=>{const Ze=ie.viewport;if(Ze){const Le=()=>{if(Ce(),!pe.current){const Se=hx(Ze,y);pe.current=Se,y()}};return y(),Ze.addEventListener("scroll",Le),()=>Ze.removeEventListener("scroll",Le)}},[ie.viewport,Ce,y]),dt.jsx(Nl.div,{"data-state":F.hasThumb?"visible":"hidden",...Q,ref:se,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...Z},onPointerDownCapture:js(D.onPointerDownCapture,Ze=>{const Se=Ze.target.getBoundingClientRect(),wt=Ze.clientX-Se.left,Ut=Ze.clientY-Se.top;F.onThumbPointerDown({x:wt,y:Ut})}),onPointerUp:js(D.onPointerUp,F.onThumbPointerUp)})});Gg.displayName=nm;var Pm="ScrollAreaCorner",qg=De.forwardRef((D,G)=>{const H=Tu(Pm,D.__scopeScrollArea),Z=!!(H.scrollbarX&&H.scrollbarY);return H.type!=="scroll"&&Z?dt.jsx(cx,{...D,ref:G}):null});qg.displayName=Pm;var cx=De.forwardRef((D,G)=>{const{__scopeScrollArea:H,...Z}=D,Q=Tu(Pm,H),[ie,F]=De.useState(0),[y,se]=De.useState(0),pe=!!(ie&&y);return jp(Q.scrollbarX,()=>{var Ze;const Ce=((Ze=Q.scrollbarX)==null?void 0:Ze.offsetHeight)||0;Q.onCornerHeightChange(Ce),se(Ce)}),jp(Q.scrollbarY,()=>{var Ze;const Ce=((Ze=Q.scrollbarY)==null?void 0:Ze.offsetWidth)||0;Q.onCornerWidthChange(Ce),F(Ce)}),pe?dt.jsx(Nl.div,{...Z,ref:G,style:{width:ie,height:y,position:"absolute",right:Q.dir==="ltr"?0:void 0,left:Q.dir==="rtl"?0:void 0,bottom:0,...D.style}}):null});function am(D){return D?parseInt(D,10):0}function Zg(D,G){const H=D/G;return isNaN(H)?0:H}function sm(D){const G=Zg(D.viewport,D.content),H=D.scrollbar.paddingStart+D.scrollbar.paddingEnd,Z=(D.scrollbar.size-H)*G;return Math.max(Z,18)}function ux(D,G,H,Z="ltr"){const Q=sm(H),ie=Q/2,F=G||ie,y=Q-F,se=H.scrollbar.paddingStart+F,pe=H.scrollbar.size-H.scrollbar.paddingEnd-y,Ce=H.content-H.viewport,Ze=Z==="ltr"?[0,Ce]:[Ce*-1,0];return $g([se,pe],Ze)(D)}function lg(D,G,H="ltr"){const Z=sm(G),Q=G.scrollbar.paddingStart+G.scrollbar.paddingEnd,ie=G.scrollbar.size-Q,F=G.content-G.viewport,y=ie-Z,se=H==="ltr"?[0,F]:[F*-1,0],pe=ex(D,se);return $g([0,F],[0,y])(pe)}function $g(D,G){return H=>{if(D[0]===D[1]||G[0]===G[1])return G[0];const Z=(G[1]-G[0])/(D[1]-D[0]);return G[0]+Z*(H-D[0])}}function Hg(D,G){return D>0&&D<G}var hx=(D,G=()=>{})=>{let H={left:D.scrollLeft,top:D.scrollTop},Z=0;return function Q(){const ie={left:D.scrollLeft,top:D.scrollTop},F=H.left!==ie.left,y=H.top!==ie.top;(F||y)&&G(),H=ie,Z=window.requestAnimationFrame(Q)}(),()=>window.cancelAnimationFrame(Z)};function om(D,G){const H=Bf(D),Z=De.useRef(0);return De.useEffect(()=>()=>window.clearTimeout(Z.current),[]),De.useCallback(()=>{window.clearTimeout(Z.current),Z.current=window.setTimeout(H,G)},[H,G])}function jp(D,G){const H=Bf(G);Fp(()=>{let Z=0;if(D){const Q=new ResizeObserver(()=>{cancelAnimationFrame(Z),Z=window.requestAnimationFrame(H)});return Q.observe(D),()=>{window.cancelAnimationFrame(Z),Q.unobserve(D)}}},[D,H])}var dx=Bg,fx=Fg,px=qg;function mx({className:D,children:G,...H}){return dt.jsxs(dx,{"data-slot":"scroll-area",className:cd("relative",D),...H,children:[dt.jsx(fx,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:G}),dt.jsx(gx,{}),dt.jsx(px,{})]})}function gx({className:D,orientation:G="vertical",...H}){return dt.jsx(jg,{"data-slot":"scroll-area-scrollbar",orientation:G,className:cd("flex touch-none p-px transition-colors select-none",G==="vertical"&&"h-full w-2.5 border-l border-l-transparent",G==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",D),...H,children:dt.jsx(Gg,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}var yx=gg[" useInsertionEffect ".trim().toString()]||Fp;function Im({prop:D,defaultProp:G,onChange:H=()=>{},caller:Z}){const[Q,ie,F]=_x({defaultProp:G,onChange:H}),y=D!==void 0,se=y?D:Q;{const Ce=De.useRef(D!==void 0);De.useEffect(()=>{const Ze=Ce.current;Ze!==y&&console.warn(`${Z} is changing from ${Ze?"controlled":"uncontrolled"} to ${y?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),Ce.current=y},[y,Z])}const pe=De.useCallback(Ce=>{var Ze;if(y){const Le=xx(Ce)?Ce(D):Ce;Le!==D&&((Ze=F.current)==null||Ze.call(F,Le))}else ie(Ce)},[y,D,ie,F]);return[se,pe]}function _x({defaultProp:D,onChange:G}){const[H,Z]=De.useState(D),Q=De.useRef(H),ie=De.useRef(G);return yx(()=>{ie.current=G},[G]),De.useEffect(()=>{var F;Q.current!==H&&((F=ie.current)==null||F.call(ie,H),Q.current=H)},[H,Q]),[H,Z,ie]}function xx(D){return typeof D=="function"}function vx(D){const G=De.useRef({value:D,previous:D});return De.useMemo(()=>(G.current.value!==D&&(G.current.previous=G.current.value,G.current.value=D),G.current.previous),[D])}function bx(D){const[G,H]=De.useState(void 0);return Fp(()=>{if(D){H({width:D.offsetWidth,height:D.offsetHeight});const Z=new ResizeObserver(Q=>{if(!Array.isArray(Q)||!Q.length)return;const ie=Q[0];let F,y;if("borderBoxSize"in ie){const se=ie.borderBoxSize,pe=Array.isArray(se)?se[0]:se;F=pe.inlineSize,y=pe.blockSize}else F=D.offsetWidth,y=D.offsetHeight;H({width:F,height:y})});return Z.observe(D,{box:"border-box"}),()=>Z.unobserve(D)}else H(void 0)},[D]),G}var lm="Switch",[wx,tv]=Wp(lm),[Sx,Tx]=wx(lm),Xg=De.forwardRef((D,G)=>{const{__scopeSwitch:H,name:Z,checked:Q,defaultChecked:ie,required:F,disabled:y,value:se="on",onCheckedChange:pe,form:Ce,...Ze}=D,[Le,Se]=De.useState(null),wt=Su(G,ot=>Se(ot)),Ut=De.useRef(!1),Et=Le?Ce||!!Le.closest("form"):!0,[Yt,Nt]=Im({prop:Q,defaultProp:ie??!1,onChange:pe,caller:lm});return dt.jsxs(Sx,{scope:H,checked:Yt,disabled:y,children:[dt.jsx(Nl.button,{type:"button",role:"switch","aria-checked":Yt,"aria-required":F,"data-state":Qg(Yt),"data-disabled":y?"":void 0,disabled:y,value:se,...Ze,ref:wt,onClick:js(D.onClick,ot=>{Nt(St=>!St),Et&&(Ut.current=ot.isPropagationStopped(),Ut.current||ot.stopPropagation())})}),Et&&dt.jsx(Kg,{control:Le,bubbles:!Ut.current,name:Z,value:se,checked:Yt,required:F,disabled:y,form:Ce,style:{transform:"translateX(-100%)"}})]})});Xg.displayName=lm;var Yg="SwitchThumb",Wg=De.forwardRef((D,G)=>{const{__scopeSwitch:H,...Z}=D,Q=Tx(Yg,H);return dt.jsx(Nl.span,{"data-state":Qg(Q.checked),"data-disabled":Q.disabled?"":void 0,...Z,ref:G})});Wg.displayName=Yg;var Mx="SwitchBubbleInput",Kg=De.forwardRef(({__scopeSwitch:D,control:G,checked:H,bubbles:Z=!0,...Q},ie)=>{const F=De.useRef(null),y=Su(F,ie),se=vx(H),pe=bx(G);return De.useEffect(()=>{const Ce=F.current;if(!Ce)return;const Ze=window.HTMLInputElement.prototype,Se=Object.getOwnPropertyDescriptor(Ze,"checked").set;if(se!==H&&Se){const wt=new Event("click",{bubbles:Z});Se.call(Ce,H),Ce.dispatchEvent(wt)}},[se,H,Z]),dt.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:H,...Q,tabIndex:-1,ref:y,style:{...Q.style,...pe,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Kg.displayName=Mx;function Qg(D){return D?"checked":"unchecked"}var Ax=Xg,Cx=Wg;function cg({className:D,...G}){return dt.jsx(Ax,{"data-slot":"switch",className:cd("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",D),...G,children:dt.jsx(Cx,{"data-slot":"switch-thumb",className:cd("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}var Ex="Label",Jg=De.forwardRef((D,G)=>dt.jsx(Nl.label,{...D,ref:G,onMouseDown:H=>{var Q;H.target.closest("button, input, select, textarea")||((Q=D.onMouseDown)==null||Q.call(D,H),!H.defaultPrevented&&H.detail>1&&H.preventDefault())}}));Jg.displayName=Ex;var zx=Jg;function ug({className:D,...G}){return dt.jsx(zx,{"data-slot":"label",className:cd("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",D),...G})}function Px(D){const G=D+"CollectionProvider",[H,Z]=Wp(G),[Q,ie]=H(G,{collectionRef:{current:null},itemMap:new Map}),F=Ut=>{const{scope:Et,children:Yt}=Ut,Nt=Lf.useRef(null),ot=Lf.useRef(new Map).current;return dt.jsx(Q,{scope:Et,itemMap:ot,collectionRef:Nt,children:Yt})};F.displayName=G;const y=D+"CollectionSlot",se=wm(y),pe=Lf.forwardRef((Ut,Et)=>{const{scope:Yt,children:Nt}=Ut,ot=ie(y,Yt),St=Su(Et,ot.collectionRef);return dt.jsx(se,{ref:St,children:Nt})});pe.displayName=y;const Ce=D+"CollectionItemSlot",Ze="data-radix-collection-item",Le=wm(Ce),Se=Lf.forwardRef((Ut,Et)=>{const{scope:Yt,children:Nt,...ot}=Ut,St=Lf.useRef(null),Rt=Su(Et,St),Gt=ie(Ce,Yt);return Lf.useEffect(()=>(Gt.itemMap.set(St,{ref:St,...ot}),()=>void Gt.itemMap.delete(St))),dt.jsx(Le,{[Ze]:"",ref:Rt,children:Nt})});Se.displayName=Ce;function wt(Ut){const Et=ie(D+"CollectionConsumer",Ut);return Lf.useCallback(()=>{const Nt=Et.collectionRef.current;if(!Nt)return[];const ot=Array.from(Nt.querySelectorAll(`[${Ze}]`));return Array.from(Et.itemMap.values()).sort((Gt,ti)=>ot.indexOf(Gt.ref.current)-ot.indexOf(ti.ref.current))},[Et.collectionRef,Et.itemMap])}return[{Provider:F,Slot:pe,ItemSlot:Se},wt,Z]}var Ix=gg[" useId ".trim().toString()]||(()=>{}),kx=0;function ey(D){const[G,H]=De.useState(Ix());return Fp(()=>{H(Z=>Z??String(kx++))},[D]),D||(G?`radix-${G}`:"")}var _m="rovingFocusGroup.onEntryFocus",Rx={bubbles:!1,cancelable:!0},Kp="RovingFocusGroup",[Sm,ty,Dx]=Px(Kp),[Lx,iy]=Wp(Kp,[Dx]),[Bx,Ox]=Lx(Kp),ry=De.forwardRef((D,G)=>dt.jsx(Sm.Provider,{scope:D.__scopeRovingFocusGroup,children:dt.jsx(Sm.Slot,{scope:D.__scopeRovingFocusGroup,children:dt.jsx(Fx,{...D,ref:G})})}));ry.displayName=Kp;var Fx=De.forwardRef((D,G)=>{const{__scopeRovingFocusGroup:H,orientation:Z,loop:Q=!1,dir:ie,currentTabStopId:F,defaultCurrentTabStopId:y,onCurrentTabStopIdChange:se,onEntryFocus:pe,preventScrollOnEntryFocus:Ce=!1,...Ze}=D,Le=De.useRef(null),Se=Su(G,Le),wt=Cm(ie),[Ut,Et]=Im({prop:F,defaultProp:y??null,onChange:se,caller:Kp}),[Yt,Nt]=De.useState(!1),ot=Bf(pe),St=ty(H),Rt=De.useRef(!1),[Gt,ti]=De.useState(0);return De.useEffect(()=>{const zt=Le.current;if(zt)return zt.addEventListener(_m,ot),()=>zt.removeEventListener(_m,ot)},[ot]),dt.jsx(Bx,{scope:H,orientation:Z,dir:wt,loop:Q,currentTabStopId:Ut,onItemFocus:De.useCallback(zt=>Et(zt),[Et]),onItemShiftTab:De.useCallback(()=>Nt(!0),[]),onFocusableItemAdd:De.useCallback(()=>ti(zt=>zt+1),[]),onFocusableItemRemove:De.useCallback(()=>ti(zt=>zt-1),[]),children:dt.jsx(Nl.div,{tabIndex:Yt||Gt===0?-1:0,"data-orientation":Z,...Ze,ref:Se,style:{outline:"none",...D.style},onMouseDown:js(D.onMouseDown,()=>{Rt.current=!0}),onFocus:js(D.onFocus,zt=>{const ui=!Rt.current;if(zt.target===zt.currentTarget&&ui&&!Yt){const Pi=new CustomEvent(_m,Rx);if(zt.currentTarget.dispatchEvent(Pi),!Pi.defaultPrevented){const $e=St().filter(Qe=>Qe.focusable),Ji=$e.find(Qe=>Qe.active),ft=$e.find(Qe=>Qe.id===Ut),Ri=[Ji,ft,...$e].filter(Boolean).map(Qe=>Qe.ref.current);sy(Ri,Ce)}}Rt.current=!1}),onBlur:js(D.onBlur,()=>Nt(!1))})})}),ny="RovingFocusGroupItem",ay=De.forwardRef((D,G)=>{const{__scopeRovingFocusGroup:H,focusable:Z=!0,active:Q=!1,tabStopId:ie,children:F,...y}=D,se=ey(),pe=ie||se,Ce=Ox(ny,H),Ze=Ce.currentTabStopId===pe,Le=ty(H),{onFocusableItemAdd:Se,onFocusableItemRemove:wt,currentTabStopId:Ut}=Ce;return De.useEffect(()=>{if(Z)return Se(),()=>wt()},[Z,Se,wt]),dt.jsx(Sm.ItemSlot,{scope:H,id:pe,focusable:Z,active:Q,children:dt.jsx(Nl.span,{tabIndex:Ze?0:-1,"data-orientation":Ce.orientation,...y,ref:G,onMouseDown:js(D.onMouseDown,Et=>{Z?Ce.onItemFocus(pe):Et.preventDefault()}),onFocus:js(D.onFocus,()=>Ce.onItemFocus(pe)),onKeyDown:js(D.onKeyDown,Et=>{if(Et.key==="Tab"&&Et.shiftKey){Ce.onItemShiftTab();return}if(Et.target!==Et.currentTarget)return;const Yt=Vx(Et,Ce.orientation,Ce.dir);if(Yt!==void 0){if(Et.metaKey||Et.ctrlKey||Et.altKey||Et.shiftKey)return;Et.preventDefault();let ot=Le().filter(St=>St.focusable).map(St=>St.ref.current);if(Yt==="last")ot.reverse();else if(Yt==="prev"||Yt==="next"){Yt==="prev"&&ot.reverse();const St=ot.indexOf(Et.currentTarget);ot=Ce.loop?Ux(ot,St+1):ot.slice(St+1)}setTimeout(()=>sy(ot))}}),children:typeof F=="function"?F({isCurrentTabStop:Ze,hasTabStop:Ut!=null}):F})})});ay.displayName=ny;var jx={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Nx(D,G){return G!=="rtl"?D:D==="ArrowLeft"?"ArrowRight":D==="ArrowRight"?"ArrowLeft":D}function Vx(D,G,H){const Z=Nx(D.key,H);if(!(G==="vertical"&&["ArrowLeft","ArrowRight"].includes(Z))&&!(G==="horizontal"&&["ArrowUp","ArrowDown"].includes(Z)))return jx[Z]}function sy(D,G=!1){const H=document.activeElement;for(const Z of D)if(Z===H||(Z.focus({preventScroll:G}),document.activeElement!==H))return}function Ux(D,G){return D.map((H,Z)=>D[(G+Z)%D.length])}var Gx=ry,qx=ay,cm="Tabs",[Zx,iv]=Wp(cm,[iy]),oy=iy(),[$x,km]=Zx(cm),ly=De.forwardRef((D,G)=>{const{__scopeTabs:H,value:Z,onValueChange:Q,defaultValue:ie,orientation:F="horizontal",dir:y,activationMode:se="automatic",...pe}=D,Ce=Cm(y),[Ze,Le]=Im({prop:Z,onChange:Q,defaultProp:ie??"",caller:cm});return dt.jsx($x,{scope:H,baseId:ey(),value:Ze,onValueChange:Le,orientation:F,dir:Ce,activationMode:se,children:dt.jsx(Nl.div,{dir:Ce,"data-orientation":F,...pe,ref:G})})});ly.displayName=cm;var cy="TabsList",uy=De.forwardRef((D,G)=>{const{__scopeTabs:H,loop:Z=!0,...Q}=D,ie=km(cy,H),F=oy(H);return dt.jsx(Gx,{asChild:!0,...F,orientation:ie.orientation,dir:ie.dir,loop:Z,children:dt.jsx(Nl.div,{role:"tablist","aria-orientation":ie.orientation,...Q,ref:G})})});uy.displayName=cy;var hy="TabsTrigger",dy=De.forwardRef((D,G)=>{const{__scopeTabs:H,value:Z,disabled:Q=!1,...ie}=D,F=km(hy,H),y=oy(H),se=my(F.baseId,Z),pe=gy(F.baseId,Z),Ce=Z===F.value;return dt.jsx(qx,{asChild:!0,...y,focusable:!Q,active:Ce,children:dt.jsx(Nl.button,{type:"button",role:"tab","aria-selected":Ce,"aria-controls":pe,"data-state":Ce?"active":"inactive","data-disabled":Q?"":void 0,disabled:Q,id:se,...ie,ref:G,onMouseDown:js(D.onMouseDown,Ze=>{!Q&&Ze.button===0&&Ze.ctrlKey===!1?F.onValueChange(Z):Ze.preventDefault()}),onKeyDown:js(D.onKeyDown,Ze=>{[" ","Enter"].includes(Ze.key)&&F.onValueChange(Z)}),onFocus:js(D.onFocus,()=>{const Ze=F.activationMode!=="manual";!Ce&&!Q&&Ze&&F.onValueChange(Z)})})})});dy.displayName=hy;var fy="TabsContent",py=De.forwardRef((D,G)=>{const{__scopeTabs:H,value:Z,forceMount:Q,children:ie,...F}=D,y=km(fy,H),se=my(y.baseId,Z),pe=gy(y.baseId,Z),Ce=Z===y.value,Ze=De.useRef(Ce);return De.useEffect(()=>{const Le=requestAnimationFrame(()=>Ze.current=!1);return()=>cancelAnimationFrame(Le)},[]),dt.jsx(Gp,{present:Q||Ce,children:({present:Le})=>dt.jsx(Nl.div,{"data-state":Ce?"active":"inactive","data-orientation":y.orientation,role:"tabpanel","aria-labelledby":se,hidden:!Le,id:pe,tabIndex:0,...F,ref:G,style:{...D.style,animationDuration:Ze.current?"0s":void 0},children:Le&&ie})})});py.displayName=fy;function my(D,G){return`${D}-trigger-${G}`}function gy(D,G){return`${D}-content-${G}`}var Hx=ly,Xx=uy,Yx=dy,Wx=py;function Kx({className:D,...G}){return dt.jsx(Hx,{"data-slot":"tabs",className:cd("flex flex-col gap-2",D),...G})}function Qx({className:D,...G}){return dt.jsx(Xx,{"data-slot":"tabs-list",className:cd("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",D),...G})}function hg({className:D,...G}){return dt.jsx(Yx,{"data-slot":"tabs-trigger",className:cd("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",D),...G})}function dg({className:D,...G}){return dt.jsx(Wx,{"data-slot":"tabs-content",className:cd("flex-1 outline-none",D),...G})}Mm.workerClass=s_.MapLibreGLWorker;function tm(D){return D==null||Number.isNaN(D)?"":D.toLocaleString("de-DE")}function fg(){return["step",["get","pop"],"#7f0000",5e3,"#cc0000",1e4,"#ff66a3",2e4,"#cc5500",3e4,"#ff9900",4e4,"#ffff00",5e4,"#add8e6",6e4,"#0000ff",8e4,"#90ee90",1e5,"#008000"]}function Jx(){const[D,G]=De.useState(null),[H,Z]=De.useState(null),[Q,ie]=De.useState(""),[F,y]=De.useState(!0),[se,pe]=De.useState(!0),[Ce,Ze]=De.useState(null),[Le,Se]=De.useState(null);De.useEffect(()=>{fetch("/data/gemeinden.geojson").then(ot=>ot.json()).then(ot=>G(ot)),fetch("/data/ortsteile.geojson").then(ot=>ot.json()).then(ot=>Z(ot))},[]);const wt=De.useMemo(()=>{const ot=[];D&&ot.push(...D.features),H&&ot.push(...H.features);const St=ot.map(ti=>({...ti,properties:{...ti.properties,pop:ti.properties.pop??null}})).sort((ti,zt)=>{const ui=ti.properties.pop??-1,Pi=zt.properties.pop??-1;return ui===-1&&Pi===-1?0:ui===-1?1:Pi===-1?-1:ui-Pi});let Rt=1;return St.map(ti=>({...ti,properties:{...ti.properties,rank:ti.properties.pop?Rt++:void 0}}))},[D,H]),Ut=De.useMemo(()=>{const ot=Rt=>Rt.toLowerCase().includes(Q.toLowerCase());return wt.filter(Rt=>{const Gt=Rt.properties;return ot(Gt.name)||Gt.parent&&ot(Gt.parent)||Gt.county&&ot(Gt.county)})},[wt,Q]),Et=De.useMemo(()=>D?{type:"FeatureCollection",features:wt.filter(ot=>ot.properties.kind==="gemeinde")}:null,[wt,D]),Yt=De.useMemo(()=>H?{type:"FeatureCollection",features:wt.filter(ot=>ot.properties.kind==="ortsteil")}:null,[wt,H]);function Nt(ot){const St=ot.features&&ot.features[0];if(!St)return Ze(null);Ze(St),Se({lng:ot.lngLat.lng,lat:ot.lngLat.lat})}return dt.jsxs("div",{className:"h-screen w-screen grid grid-cols-[360px_1fr]",children:[dt.jsxs("div",{className:"border-r border-border flex flex-col",children:[dt.jsxs("div",{className:"p-4 space-y-3",children:[dt.jsx("div",{className:"text-xl font-serif",children:"Deutschlandkarte  Gemeinden & Ortsteile"}),dt.jsx("div",{className:"text-sm text-muted-foreground",children:"Gemeinden, Stdte und Ortsteile"}),dt.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[dt.jsx(cg,{checked:F,onCheckedChange:y,id:"g"}),dt.jsx(ug,{htmlFor:"g",children:"Gemeinden/Stdte"})]}),dt.jsxs("div",{className:"flex items-center gap-2",children:[dt.jsx(cg,{checked:se,onCheckedChange:pe,id:"o"}),dt.jsx(ug,{htmlFor:"o",children:"Ortsteile"})]}),dt.jsx(U_,{placeholder:"Suchen nach Name, Gemeinde, Kreis",value:Q,onChange:ot=>ie(ot.target.value)})]}),dt.jsxs(Kx,{defaultValue:"liste",className:"flex flex-1 min-h-0 flex-col",children:[dt.jsxs(Qx,{className:"mx-4",children:[dt.jsx(hg,{value:"liste",children:"Liste"}),dt.jsx(hg,{value:"legende",children:"Legende"})]}),dt.jsx(dg,{value:"liste",className:"flex-1 min-h-0",children:dt.jsx(mx,{className:"h-full px-4",children:dt.jsx("div",{className:"space-y-2 pb-6",children:Ut.map(ot=>{const St=ot.properties;return dt.jsxs("div",{className:"rounded-lg border p-3",children:[dt.jsxs("div",{className:"flex items-center justify-between",children:[dt.jsx("div",{className:"font-medium",children:St.name}),dt.jsx("div",{className:"text-xs text-muted-foreground",children:St.rank?`#${St.rank}`:"#"})]}),dt.jsxs("div",{className:"text-xs text-muted-foreground",children:[St.kind==="ortsteil"&&St.parent?St.parent+", ":"",St.county??""]}),dt.jsxs("div",{className:"mt-1 text-sm",children:["Einwohner: ",tm(St.pop)]}),dt.jsxs("div",{className:"text-sm",children:["Dichte: ",St.density?`${tm(Math.round(St.density))} je km`:""]})]},`${St.kind}-${St.id}`)})})})}),dt.jsx(dg,{value:"legende",className:"px-4",children:dt.jsx("div",{className:"grid grid-cols-1 gap-2 pb-6",children:[{label:"0  5.000",color:"#7f0000"},{label:"5.001  10.000",color:"#cc0000"},{label:"10.001  20.000",color:"#ff66a3"},{label:"20.001  30.000",color:"#cc5500"},{label:"30.001  40.000",color:"#ff9900"},{label:"40.001  50.000",color:"#ffff00"},{label:"50.001  60.000",color:"#add8e6"},{label:"60.001  80.000",color:"#0000ff"},{label:"80.001  100.000",color:"#90ee90"},{label:"100.001+",color:"#008000"}].map(ot=>dt.jsxs("div",{className:"flex items-center gap-2",children:[dt.jsx("div",{className:"h-4 w-4 rounded-sm",style:{background:ot.color}}),dt.jsxs("div",{className:"text-sm",children:[ot.label," Einwohner"]})]},ot.label))})})]})]}),dt.jsxs("div",{className:"relative",children:[dt.jsxs(Ny,{mapLib:Mm,initialViewState:{longitude:10.5,latitude:51.2,zoom:5.2},style:{width:"100%",height:"100%"},mapStyle:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:" OpenStreetMap-Mitwirkende"}},layers:[{id:"osm",type:"raster",source:"osm"}]},interactiveLayerIds:["gemeinden-fill","ortsteile-fill"],onMouseMove:Nt,children:[F&&Et&&dt.jsx(Qm,{id:"gemeinden",type:"geojson",data:Et,promoteId:"properties.id",children:dt.jsx(Jm,{id:"gemeinden-fill",type:"fill",paint:{"fill-color":fg(),"fill-opacity":.55,"fill-outline-color":"#555"}})}),se&&Yt&&dt.jsx(Qm,{id:"ortsteile",type:"geojson",data:Yt,promoteId:"properties.id",children:dt.jsx(Jm,{id:"ortsteile-fill",type:"fill",paint:{"fill-color":fg(),"fill-opacity":.45,"fill-outline-color":"#333"}})}),Ce&&Le&&dt.jsx(Uy,{longitude:Le.lng,latitude:Le.lat,closeButton:!1,closeOnClick:!1,anchor:"bottom",offset:8,children:dt.jsxs("div",{className:"space-y-0.5",children:[dt.jsxs("div",{className:"font-medium text-sm flex items-center gap-2",children:[dt.jsx("span",{children:Ce.properties.name}),dt.jsx("span",{className:"text-xs text-muted-foreground",children:Ce.properties.rank?`#${Ce.properties.rank}`:"#"})]}),dt.jsxs("div",{className:"text-xs text-muted-foreground",children:[Ce.properties.kind==="ortsteil"&&Ce.properties.parent?Ce.properties.parent+", ":"",Ce.properties.county??""]}),dt.jsxs("div",{className:"text-xs",children:["Einwohner: ",tm(Ce.properties.pop)]}),dt.jsxs("div",{className:"text-xs",children:["Dichte: ",Ce.properties.density?`${tm(Math.round(Ce.properties.density))} je km`:""]})]})})]}),!D&&dt.jsx("div",{className:"absolute left-4 top-4 rounded-md bg-background/90 border px-3 py-2 text-sm shadow",children:"Daten werden geladen "})]})]})}My.createRoot(document.getElementById("root")).render(dt.jsx(De.StrictMode,{children:dt.jsx(Jx,{})}));
